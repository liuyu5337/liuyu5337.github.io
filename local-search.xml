<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>NATæ¨¡å¼Ubuntu Serverä¸‹çš„Dockerä»£ç†è®¾ç½®</title>
    <link href="/2025/09/26/NAT%E6%A8%A1%E5%BC%8FUbuntu-Server%E4%B8%8B%E7%9A%84Docker%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/"/>
    <url>/2025/09/26/NAT%E6%A8%A1%E5%BC%8FUbuntu-Server%E4%B8%8B%E7%9A%84Docker%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>VMWareæˆ–è€…VirtualBoxå®‰è£…Ubuntu Serveråï¼Œå¦‚æœubuntuserveréœ€è¦é€šè¿‡å®¿ä¸»æœº(windows/Mac)ä»£ç†(clash)è®¿é—®Docker æˆ–è€…GitHubï¼Œéœ€è¦åœ¨Ubuntu Serverè®¾ç½®ä»£ç†é…ç½®ã€‚</p><h4 id="å®¿ä¸»æœºé…ç½®">å®¿ä¸»æœºé…ç½®</h4><p>é¦–å…ˆï¼Œå®¿ä¸»æœº(windows/Mac)é¦–å…ˆéœ€è¦æ‰“å¼€"å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿æ¥"</p><p>macé…ç½®</p><p><img src="mac.png" /></p><p>windowsé…ç½®</p><p><img src="windows.png" /></p><h4 id="è™šæ‹Ÿæœºé…ç½®ä»£ç†">è™šæ‹Ÿæœºé…ç½®ä»£ç†</h4><h5 id="æ™®é€šä»£ç†">æ™®é€šä»£ç†</h5><p>åœ¨ubuntu serveré…ç½®ä»£ç†:</p><p>~/.bashrc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">export https_proxy=http://192.168.132.1:7897  # æŒ‰ç…§å®¿ä¸»æœºåœ¨è™šæ‹Ÿç½‘ç»œçš„åœ°å€è¿›è¡Œé…ç½®<br>export http_proxy=http://192.168.132.1:7897<br>export all_proxy=socks5://192.168.132.1:7897<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ source ~/.bashrcï¼Œè¿™æ ·ç³»ç»Ÿå¯åŠ¨ä¹‹åï¼Œå°±å¯ä»¥è‡ªåŠ¨ä½¿ç”¨ä»£ç†ã€‚</p><h5 id="dockerä»£ç†">dockerä»£ç†</h5><p>å¦‚æœä¸å­˜åœ¨é…ç½®æ–‡ä»¶ï¼ˆ/etc/systemd/system/docker.service.d/proxy.confï¼‰å°±æ–°å»ºé…ç½®æ–‡ä»¶ï¼Œç„¶åç¼–è¾‘è¯¥é…ç½®æ–‡ä»¶,å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Service]<br>Environment=&quot;HTTP_PROXY=http://192.168.132.1:7897&quot;<br>Environment=&quot;HTTPS_PROXY=http://192.168.132.1:7897&quot;<br>Environment=&quot;NO_PROXY=localhost,127.0.0.1,192.168.0.0/16&quot;  # å¿½ç•¥å†…ç½‘ä»£ç†<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo systemctl daemon-reload<br>sudo systemctl restart docker  #é‡å¯docker <br></code></pre></td></tr></table></figure><p>æµ‹è¯•dockeræ‹‰å–é•œåƒæ˜¯å¦æˆåŠŸ</p><p><img src="docker-pull.png" /></p><p>æ‹‰å–é•œåƒæˆåŠŸã€‚</p><p>æ€»ç»“ï¼šå¦‚æœè¦åœ¨NATç½‘ç»œæ¨¡å¼ä¸‹ï¼Œå®ç°è™šæ‹Ÿæœºçš„ä»£ç†ä¸Šç½‘ï¼Œå®¿ä¸»æœºéœ€è¦<strong>å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿æ¥</strong>, è™šæ‹Ÿæœº éœ€è¦åˆ†åˆ«åœ¨ ~/.bashrcå’Œdockerå¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ä»£ç†ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>OS</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu LVMï¼ˆé€»è¾‘å·ç®¡ç†ï¼‰ä½¿ç”¨</title>
    <link href="/2025/09/23/Ubuntu-LVM%EF%BC%88%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86%EF%BC%89%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/09/23/Ubuntu-LVM%EF%BC%88%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86%EF%BC%89%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>ä»Ubuntu 18.04LTSå¼€å§‹ï¼Œå®‰è£…ç¨‹åºåœ¨åˆ†åŒºæ—¶é»˜è®¤æä¾›â€œä½¿ç”¨LVMâ€çš„é€‰é¡¹ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤é€‰ä¸­ã€‚ç”¨æˆ·éœ€è¦æ‰‹åŠ¨é€‰æ‹©ä½¿ç”¨LVMã€‚åœ¨Ubuntu20.04LTSåŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå®‰è£…ç¨‹åºæä¾›äº†æ›´é«˜çº§çš„â€œé«˜çº§åˆ†åŒºâ€é€‰é¡¹ï¼Œå…¶ä¸­å¯ä»¥æ˜ç¡®è®¾ç½®åˆ†åŒºå¤§å°å’ŒLVMé…ç½®ã€‚</p><ol type="1"><li>Ubuntu LVMä½¿ç”¨æ—¶é—´çº¿</li></ol><p>Ubuntu 18.04 LTS (2018) â†’ å¼€å§‹æ›´å¹¿æ³›ä½¿ç”¨ LVM Ubuntu 20.04 LTS (2020)â†’ LVM æˆä¸ºæœåŠ¡å™¨ç‰ˆå¸¸è§é€‰æ‹© Ubuntu 22.04 LTS (2022) â†’ åœ¨æ›´å¤šåœºæ™¯é»˜è®¤ä½¿ç”¨LVM</p><p><strong>LVM æ™®åŠè¶‹åŠ¿</strong>ï¼šä» Ubuntu 18.04å¼€å§‹è¶Šæ¥è¶Šå¸¸è§ï¼Œ<strong>æœåŠ¡å™¨ç‰ˆæ›´æ™®é</strong>ï¼šæœåŠ¡å™¨å®‰è£…æ›´å€¾å‘äºä½¿ç”¨LVMã€‚</p><blockquote><p>LVMæ˜¯ä¸€ç§ç”¨äºLinuxçš„é€»è¾‘å·ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ä½ ç®¡ç†ç£ç›˜é©±åŠ¨å™¨å’Œå…¶ä»–å¤§å®¹é‡å­˜å‚¨è®¾å¤‡ã€‚ä½¿ç”¨LVMï¼Œä½ å¯ä»¥å°†å¤šä¸ªç‰©ç†ç£ç›˜æˆ–åˆ†åŒºç»„åˆæˆä¸€ä¸ªå·ç»„ï¼Œç„¶åä»è¯¥å·ç»„ä¸­åˆ›å»ºé€»è¾‘å·ã€‚é€»è¾‘å·å¯ä»¥åƒæ™®é€šåˆ†åŒºä¸€æ ·ä½¿ç”¨ï¼Œä½†å®ƒä»¬å…·æœ‰æ›´çµæ´»çš„ç‰¹æ€§ï¼Œä¾‹å¦‚å¯ä»¥åŠ¨æ€è°ƒæ•´å¤§å°ã€è·¨å¤šä¸ªç£ç›˜ç­‰ã€‚</p></blockquote><p>LVMç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>ç‰©ç†å· (PV) â†’ å·ç»„ (VG) â†’ é€»è¾‘å· (LV) â†‘ â†‘ â†‘ ç£ç›˜åˆ†åŒº å¤šä¸ªPVç»„åˆå®é™…ä½¿ç”¨çš„å·</p><p>ï¼ˆåé¢ç”¨åˆ°çš„å‘½ä»¤, PVã€ VGã€LVåˆ†åˆ«è¡¨ç¤º å¯¹åº”æŸ¥çœ‹ç£ç›˜å¯¹åº”çš„LVMå‘½ä»¤ä¿¡æ¯ï¼‰</p><ol start="2" type="1"><li><p>åœ¨æœåŠ¡å™¨å®‰è£…è¿‡ç¨‹ä¸­ï¼ˆä»¥ 24.04æœåŠ¡ç‰ˆä¸ºä¾‹ï¼‰ï¼ŒLVMæ˜¯é»˜è®¤é€‰é¡¹ã€‚</p><p><img src="lvm.png" /></p></li></ol><p>åœ¨å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æ˜¯"Set up this disk as an LVM group"</p><ol start="3" type="1"><li><p>ç³»ç»Ÿå®‰è£…æˆåŠŸåï¼Œå¯ä»¥æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"> <span class="hljs-comment">#æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ä¿¡æ¯</span><br><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><p><img src="disk-1.png" /></p></li></ol><p>å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç£ç›˜æ˜¯50Gï¼Œ ä½†æ˜¯çœ‹åˆ°ç£ç›˜çš„ä¿¡æ¯åŠ èµ·æ¥ä¸åˆ°50Gï¼Œè€Œä¸”/dev/mapper/ubuntuâ€“vg-ubuntuâ€“lvåªæœ‰24Gã€‚é‚£å‰©ä½™çš„ç£ç›˜å»å“ªé‡Œäº†å‘¢ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜</span><br><span class="hljs-attribute">fdisk</span> -l <br></code></pre></td></tr></table></figure><p><img src="disk-2.png" /></p><p>åœ¨å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ° /dev/sda3 æœ‰48G,ç£ç›˜50Gæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚åªæ˜¯ä½¿ç”¨çš„åªæœ‰24Gï¼ˆ/dev/mapper/ubuntuâ€“vg-ubuntuâ€“lvï¼‰ã€‚</p><ol start="4" type="1"><li><p>æŸ¥çœ‹LVMä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰«æç‰©ç†å·</span><br>sudo pvscan<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºç‰©ç†å·è¯¦ç»†ä¿¡æ¯</span><br>sudo pvdisplay<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºå·ç»„</span><br>sudo vgdisplay<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºé€»è¾‘å·</span><br>sudo lvdisplay<br></code></pre></td></tr></table></figure><p>pvscan å¯ä»¥çœ‹åˆ°ç£ç›˜ä¿¡æ¯</p><p><img src="pvscan.png" /></p></li></ol><p>â€‹ pvdisplay å¯ä»¥çœ‹åˆ° total PE æ˜¯12287 , Free PE 6144, Allocate PE6143, é‚£ä¹ˆå°‘çš„24G å°±æ˜¯ free PE</p><p>â€‹ <img src="pvdisplay.png" /></p><p>vgdisplay å‘½ä»¤å¯ä»¥çœ‹çš„æ›´æ¸…æ¥šï¼Œ Free PE 24GB, df -h å°‘çš„24Gæ‰¾åˆ°äº†ã€‚Alloc PE 24GBå°±æ˜¯ df -h çœ‹åˆ°çš„ç£ç›˜ç©ºé—´ã€‚</p><p><img src="vgdisplay.png" /></p><p>lvdisplay å¯ä»¥çœ‹åˆ° é€»è¾‘å·çš„å…·ä½“ä¿¡æ¯ï¼Œåˆ†é…çš„ç©ºé—´æ˜¯24G,é€»è¾‘å·çš„è·¯å¾„ã€åç§°ã€å·ç»„çš„åç§°ç­‰ç­‰</p><p><img src="lvdisplay.png" /></p><ol start="5" type="1"><li><p>ä¸Šé¢çš„å‘½ä»¤å¯ä»¥åŠ å‚æ•°</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># æŸ¥çœ‹ ubuntu-vg å·ä¿¡æ¯</span><br>sudo vgdisplay ubuntu-vg<br><span class="hljs-comment"># æŸ¥çœ‹ /dev/sda3 çš„ç£ç›˜ä¿¡æ¯</span><br>sudo pvdisplay <span class="hljs-regexp">/dev/</span>sda3<br></code></pre></td></tr></table></figure></li><li><p>lsblk å’Œ blkid æ˜¯ Linuxä¸­ç”¨äºæŸ¥çœ‹å—è®¾å¤‡ï¼ˆå¦‚ç¡¬ç›˜ã€åˆ†åŒºç­‰ï¼‰ä¿¡æ¯çš„ä¸¤ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œå¯æä¾›è®¾å¤‡åç§°ã€å¤§å°ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€æŒ‚è½½ç‚¹ç­‰è¯¦ç»†ä¿¡æ¯ã€‚</p><p>lsblk å‘½ä»¤ç»“æœ</p></li></ol><p><img src="lsblk.png" /></p><p>blkidå‘½ä»¤ç»“æœ</p><p><img src="blkid.png" /></p><ol start="7" type="1"><li><p>å·²åˆ†é…çš„ç£ç›˜ç©ºé—´ç”¨å°½ï¼Œ<strong>ç³»ç»Ÿä¸ä¼šè‡ªåŠ¨æ‰©å±•</strong>ï¼ˆä¸ä¼šè‡ªåŠ¨æŠŠæœªåˆ†é…çš„ç£ç›˜è¿›è¡Œç©ºé—´æ‰©å±•ï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</p><blockquote><p>ä¸è¿›è¡Œè‡ªåŠ¨æ‰©å±•çš„åŸå› ï¼š</p><ol type="1"><li><strong>LVM è®¾è®¡åŸåˆ™</strong>ï¼šLVM éœ€è¦æ˜ç¡®çš„ç®¡ç†å‘˜æ“ä½œç¡®è®¤</li><li><strong>æ–‡ä»¶ç³»ç»Ÿç‹¬ç«‹æ€§</strong>ï¼šé€»è¾‘å·æ‰©å±•å’Œæ–‡ä»¶ç³»ç»Ÿè°ƒæ•´æ˜¯ä¸¤ä¸ªç‹¬ç«‹æ­¥éª¤</li><li><strong>é£é™©æ§åˆ¶</strong>ï¼šè‡ªåŠ¨æ‰©å±•å¯èƒ½å¯¼è‡´æ•°æ®æŸåæˆ–ç³»ç»Ÿä¸ç¨³å®š</li></ol></blockquote></li><li><p>å°†æœªä½¿ç”¨çš„ç©ºé—´è¿›è¡Œæ‰©å±•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. æ£€æŸ¥å½“å‰ç©ºé—´çŠ¶å†µï¼ˆç¡®è®¤é—®é¢˜ï¼‰</span><br><span class="hljs-built_in">df</span> -h<br>sudo vgdisplay ubuntu-vg<br><br><span class="hljs-comment"># 2. æ‰©å±•é€»è¾‘å·ï¼ˆä½¿ç”¨éƒ¨åˆ†æˆ–å…¨éƒ¨ç©ºé—²ç©ºé—´ï¼‰</span><br><span class="hljs-comment"># æ‰©å±•10Gï¼š</span><br>sudo lvextend -L +10G /dev/ubuntu-vg/ubuntu-lv<br><br><span class="hljs-comment"># æˆ–è€…æ‰©å±•æ‰€æœ‰ç©ºé—²ç©ºé—´ï¼š</span><br>sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv<br><br><span class="hljs-comment"># 3. è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°</span><br><span class="hljs-comment"># å¯¹äºext4ï¼š</span><br>sudo resize2fs /dev/ubuntu-vg/ubuntu-lv<br><br><span class="hljs-comment"># å¯¹äºxfsï¼š</span><br>sudo xfs_growfs /<br><br><span class="hljs-comment"># 4. éªŒè¯æ‰©å±•ç»“æœ</span><br><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure></li></ol><blockquote><p><strong>æ‰©å±•é€»è¾‘å·åå¿…é¡»æ‰§è¡Œ<code>sudo resize2fs /dev/ubuntu-vg/ubuntu-lv</code></strong></p><p>é€»è¾‘å·æ‰©å±•å’Œæ–‡ä»¶ç³»ç»Ÿè°ƒæ•´æ˜¯ ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼š</p><ol type="1"><li>é€»è¾‘å·æ‰©å±• (lvextend) åªæ˜¯æ‰©å¤§äº†"å®¹å™¨"çš„å¤§å°</li></ol><p>ç›¸å½“äºç»™æˆ¿å­æ‰©å»ºäº†æˆ¿é—´</p><p>ä½†æ–‡ä»¶ç³»ç»Ÿè¿˜ä¸çŸ¥é“è¿™ä¸ªå˜åŒ–</p><ol start="2" type="1"><li>æ–‡ä»¶ç³»ç»Ÿè°ƒæ•´ (resize2fs) è®©æ–‡ä»¶ç³»ç»Ÿè¯†åˆ«å¹¶ä½¿ç”¨æ–°çš„ç©ºé—´</li></ol><p>ç›¸å½“äºå‘Šè¯‰å®¶å…·å¯ä»¥æ‘†æ”¾åˆ°æ–°æ‰©å»ºçš„æˆ¿é—´</p><p>å¿…é¡»æ‰§è¡Œæ‰èƒ½å®é™…ä½¿ç”¨æ–°ç©ºé—´</p></blockquote><p>åœ¨æ‰§è¡Œ lvextend å’Œ resize2fs å‘½ä»¤æ—¶ï¼Œåé¢çš„ è·¯å¾„å°±æ˜¯ lvdisplayæ˜¾ç¤ºçš„<strong>LV Path</strong>ã€‚</p><p><img src="lvdisplay-1.png" /></p><p>ç©ºé—´æ‰©å±•æˆåŠŸï¼Œå¹¶ä¸” é‡æ–°è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°åï¼Œå†ç”¨df -hæˆ–è€… df-hTæŸ¥çœ‹ï¼Œå°±å‘ç°å¯ç”¨ç©ºé—´å·²ç»å˜å¤§äº†ã€‚</p><p><img src="df-hT.png" /></p><p>ç»¼ä¸Šï¼ŒLVMçš„åŸºæœ¬ä½¿ç”¨å°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>OS</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Macç¯å¢ƒpythonç¯å¢ƒè®¾ç½®</title>
    <link href="/2025/09/17/Mac%E7%8E%AF%E5%A2%83python%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE/"/>
    <url>/2025/09/17/Mac%E7%8E%AF%E5%A2%83python%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>Mac ç¯å¢ƒé»˜è®¤ä¼šæœ‰pythonï¼š</p><p><img src="python.png" /></p><p>ä½†æ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å€™ä¼šç”¨åˆ°ä¸åŒç‰ˆæœ¬çš„pythonï¼Œä¸ºäº†æ–¹ä¾¿å¼€å‘å’Œç®¡ç†ï¼Œå¸¸ç”¨çš„pythonç‰ˆæœ¬ç®¡ç†æœ‰pyenv, virtualenv/virtualenvwrapperã€‚</p><p>æœ¬æ–‡ä»‹ç»ä½¿ç”¨virtualenv/virtualenvwrapper æ„å»ºå¤šç‰ˆæœ¬çš„pythonç®¡ç†ã€‚</p><h4 id="ä¸€æ¡ä»¶å‡†å¤‡">ä¸€ã€æ¡ä»¶å‡†å¤‡</h4><p>Mac æˆ–è€…linux/Unixç¯å¢ƒé»˜è®¤ä¼šå¸¦æœ‰pythonç‰ˆæœ¬ï¼Œå¦‚æœè¾ƒè€çš„ç³»ç»Ÿé»˜è®¤çš„pythonç‰ˆæœ¬ä¼šæ¯”è¾ƒä½ï¼›å¦å¤–ï¼Œæœ‰æ—¶å€™æƒ³ä¿ç•™çº¯å‡€çš„macpythonç‰ˆæœ¬ï¼Œä»¥ä¸Šä¸¤ç§æƒ…å†µå°±éœ€è¦å¦å¤–å®‰è£…æ–°çš„pythonç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†é¿å…å’Œç³»ç»Ÿä¸­å·²æœ‰çš„ç‰ˆæœ¬åŒºåˆ†ï¼Œå®‰è£…æ–°ç‰ˆæœ¬çš„pythonå»ºè®®å®‰è£…åœ¨æŒ‡å®šç›®å½•ä¸‹ï¼Œé€šè¿‡linuxå¦‚ubuntu ç­‰ä¸æ”¯æŒé€šè¿‡ç³»ç»Ÿå‘½ä»¤(å¦‚aptinstall) å®‰è£…åˆ°æŒ‡å®šç›®å½•ï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡æºç å®‰è£…python.</p><ol type="1"><li><p>ä¸‹è½½æºç  å¦‚åˆ°https://www.python.org/downloads/release/python-3137/ ä¸‹è½½3.13.7çš„æºç åŒ…ã€‚</p></li><li><p>è§£å‹æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">å¦‚æœæ˜¯.tar.xzåŒ…<br>tar -xvf Python-3.13.7.tar.xz<br>å¦‚æœæ˜¯ .tgzåŒ…<br>tar -zxvf Python-3.13.7.tgz<br><br>æ³¨ï¼š.tgz (æˆ– .tar.gz) å’Œ .tar.xz çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬ä½¿ç”¨ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œå…¶ä¸­ .tar.xz ä½¿ç”¨æ›´å…ˆè¿›ã€å‹ç¼©ç‡æ›´é«˜çš„ xz ç®—æ³•ï¼Œè€Œ .tgz ä½¿ç”¨ä¼ ç»Ÿçš„ gzip ç®—æ³•ã€‚è¿™æ„å‘³ç€ .tar.xz æ–‡ä»¶é€šå¸¸æ¯”åŒç­‰æ–‡ä»¶å‹ç¼©çš„ .tgz æ–‡ä»¶ä½“ç§¯æ›´å°ï¼Œå°¤å…¶æ˜¯åœ¨å­˜å‚¨ç©ºé—´æœ‰é™æˆ–éœ€è¦ä¼ è¾“å¤§é‡æ•°æ®æ—¶æ›´æœ‰ä¼˜åŠ¿ã€‚ç„¶è€Œï¼Œxz å‹ç¼©éœ€è¦æ›´é•¿çš„æ—¶é—´å’Œæ›´å¤šçš„è®¡ç®—èµ„æºï¼Œé€Ÿåº¦ä¸å¦‚ gzipã€‚<br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘ï¼ŒæŒ‡å®šå®‰è£…ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">./configure --prefix=/Users/yourname/my_python --enable-optimizations<br>å¦‚<br>./configure --prefix=/Users/xxxx/dev_env/python/python_env/3.13.7 --enable-optimizations #xxxxæ˜¯ä½ çš„ç™»å½•ç”¨æˆ·åç§°<br>--prefixï¼šæŒ‡å®šå®‰è£…æ ¹ç›®å½•ï¼ˆæ ¸å¿ƒå‚æ•°ï¼‰<br>--enable-optimizationsï¼šå¯ç”¨ç¼–è¯‘ä¼˜åŒ–ï¼ˆå¯é€‰ï¼Œä¼šæ…¢ä¸€äº›ä½†è¿è¡Œæ›´å¿«ï¼‰<br><br>make -j4  # å¤šçº¿ç¨‹ç¼–è¯‘ï¼ˆ4 æ ¸å¿ƒï¼Œæ ¹æ® CPU è°ƒæ•´ï¼‰<br>make install<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æˆåŠŸåï¼ŒæŸ¥çœ‹ç‰ˆæœ¬</span><br>/Users/xxxx/dev_env/python/python_env/3.13.7/bin/python3 --version<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å®‰è£…è·¯å¾„</span><br>ls /Users/xxxx/dev_env/python/python_env/3.13.7/bin/  # åŒ…å« python3ã€pip3 ç­‰<br></code></pre></td></tr></table></figure></li><li><p>æŠŠå®‰è£…çš„ pythonè·¯å¾„å†™å…¥åˆ° ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ˜¯ç”¨zsh,å¯ä»¥åœ¨~/.zshrcå†™å…¥ç¯å¢ƒå˜é‡ï¼Œä¸ç”¨zsh,é»˜è®¤æƒ…å†µä¸‹ï¼Œmac å†™å…¥ ~/.bash_profile, ubuntuæˆ–è€…å…¶ä»–linuxå¯ä»¥å†™å…¥ ~/.bashrc</span><br><br>export PATH=$HOME/dev_env/python/python_env/3.13.7/bin:$PATH<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç„¶å æ‰§è¡Œ <span class="hljs-built_in">source</span> ~/.å¯¹åº”çš„é…ç½®é…ç½®æ–‡ä»¶</span><br>source ~/.zshrc  ## æˆ–è€… source ~/.bash_profile<br><br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…virtualenv å’Œvirtualwrapperã€‚ä¸ºäº†ä¿æŒç³»ç»Ÿçš„"çº¯å‡€"ï¼Œæˆ–è€…è¯´ä¾¿äºç®¡ç†ï¼Œè¿™é‡ŒæŠŠvirtualenvæˆ–è€…virtualenvwrapperå®‰è£…åœ¨æŒ‡å®šç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŠŠ virtualenv virtualenvwrapper å®‰è£…åˆ°<span class="hljs-variable">$HOME</span>/dev_env/python/python_env/virtualenv_bin</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">HOME/dev_env/python/python_env/3.13.7/bin/python3 -m pip install --prefix=<span class="hljs-variable">$HOME</span>/dev_env/python/python_env/virtualenv_bin virtualenv virtualenvwrapper</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœä¸æƒ³å®‰è£…åˆ°æŒ‡å®šç›®å½• æ‰§è¡Œ</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">HOME/dev_env/python/python_env/3.13.7/bin/python3 -m pip install --user virtualenv virtualenvwrapper <span class="hljs-comment"># --user è¡¨ç¤ºç”¨æˆ·çº§å®‰è£…</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœæœ‰è¾“å‡ºä¿¡æ¯ï¼Œå°±è¡¨ç¤ºæŒ‰ç…§æˆåŠŸ</span> <br><span class="hljs-meta prompt_">$</span><span class="language-bash">HOME/dev_env/python/python_env/3.13.7/bin/python3 -m pip show virtualenvwrapper</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">HOME/dev_env/python/python_env/3.13.7/bin/python3 -m pip show virtualenv</span><br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®virtualenvç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨~/.zshrc(Mac)æˆ–è€…å…¶ä»–çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®</span> <br>export WORKON_HOME=$HOME/dev_env/python/virtualenvs<br>export VIRTUALENVWRAPPER_PYTHON=$HOME/dev_env/python/python_env/3.13.7/bin/python3<br>export VIRTUALENVWRAPPER_VIRTUALENV=$HOME/dev_env/python/python_env/virtualenv_bin/bin/virtualenv<br>export PATH=$HOME/dev_env/python/python_env/virtualenv_bin/bin:$PATH<br>source $HOME/dev_env/python/python_env/virtualenv_bin/bin/virtualenvwrapper.sh<br></code></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source ~/.zshrc # mac ç¯å¢ƒ<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°å‘½ä»¤ æŠ¥é”™ï¼š'virtualenvwrapper.hook_loader'(ModuleNotFoundError: No module named 'virtualenvwrapper')virtualenvwrapper.sh: There was a problem running the initializationhooks.</p><p>è¿™æ˜¯å› ä¸º <strong>virtualenvwrapper æ¨¡å—å’Œ Python ç¯å¢ƒä¸åŒ¹é…</strong>é—®é¢˜, ä½¿ç”¨ â€”prefixå®‰è£… virtualenv ã€virtualenvwrapperåï¼Œè¦æŠŠ Pythonsite-packages è·¯å¾„åŠ å…¥ <code>PYTHONPATH</code></p></li><li><p>è®¾ç½® PYTHONPATH</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PYTHONPATH=$HOME/dev_env/python/python_env/virtualenv_bin/lib/python3.13/site-packages:$PYTHONPATH<br></code></pre></td></tr></table></figure><p>å®Œæ•´ç‰ˆé…ç½®ä¿¡æ¯å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PATH=$HOME/dev_env/python/python_env/3.13.7/bin:$PATH<br>export WORKON_HOME=$HOME/dev_env/python/virtualenvs<br>export VIRTUALENVWRAPPER_PYTHON=$HOME/dev_env/python/python_env/3.13.7/bin/python3<br>export VIRTUALENVWRAPPER_VIRTUALENV=$HOME/dev_env/python/python_env/virtualenv_bin/bin/virtualenv<br>export PATH=$HOME/dev_env/python/python_env/virtualenv_bin/bin:$PATH<br>export PYTHONPATH=$HOME/dev_env/python/python_env/virtualenv_bin/lib/python3.13/site-packages:$PYTHONPATH<br>source $HOME/dev_env/python/python_env/virtualenv_bin/bin/virtualenvwrapper.sh<br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°åŠ è½½é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¯å¢ƒå˜é‡å†™åœ¨å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œå°±å¯¹å“ªä¸ªé…ç½®æ–‡ä»¶æ‰§è¡Œ <span class="hljs-built_in">source</span>å‘½ä»¤</span><br>source ~/.zshrc #mac zsh æˆ–è€… source ~/.bash_profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä»–ç³»ç»Ÿæ‰§è¡Œ å¦‚ <span class="hljs-built_in">source</span> ~/.bashrc ç­‰</span><br><br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ•ˆæœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1. åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ lsvirtualenv æˆ– workon</span><br>workon <br>lsvirtualenv<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2. è¿›å…¥æŒ‡å®šè™šæ‹Ÿç¯å¢ƒenv1</span><br>workon env1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒenv2</span><br>mkvirtualenv env2<br><span class="hljs-meta prompt_"># </span><span class="language-bash">4. é€€å‡ºå½“å‰çš„è™šæ‹Ÿç¯å¢ƒï¼Œå›åˆ°å…¨å±€ç¯å¢ƒ</span><br>deactivate<br><span class="hljs-meta prompt_"># </span><span class="language-bash">5. åˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„è™šæ‹Ÿç¯å¢ƒ</span><br>rmvirtualenv env2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">6. æŒ‡å®špython ç‰ˆæœ¬ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span><br>mkvirtualenv --python=python3.6 venv<br><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>å¼€å‘è¯­è¨€</category>
      
      <category>python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æœ¬åœ°åˆ¶ä½œdockeré•œåƒ</title>
    <link href="/2025/09/08/%E6%9C%AC%E5%9C%B0%E5%88%B6%E4%BD%9Cdocker%E9%95%9C%E5%83%8F/"/>
    <url>/2025/09/08/%E6%9C%AC%E5%9C%B0%E5%88%B6%E4%BD%9Cdocker%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<p>å›½å†…ä½¿ç”¨ dockerï¼Œå¦‚æœä¸ä½¿ç”¨æ¢¯å­ï¼Œå­˜åœ¨æ‹‰å–dockeré•œåƒå¤±è´¥çš„æƒ…å†µã€‚ä¸ºäº†ä½¿ç”¨dockerï¼Œéœ€è¦è‡ªå·±æ„å»ºé•œåƒã€‚</p><h4 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h4><p>åœ¨æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œå¦‚æœä¸ç”¨æ¢¯å­ï¼Œç»å¸¸é‡åˆ°çš„é”™è¯¯æ˜¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Get https://registry-1.docker.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œé€šå¸¸æ˜¯<strong>ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ</strong>,å¯ä»¥ç”¨é•œåƒåŠ é€Ÿå™¨ï¼š</p><ul><li><p>ç¼–è¾‘é…ç½®æ–‡ä»¶<code>/etc/docker/daemon.json</code>ï¼ˆå¦‚æœæ²¡æœ‰å°±æ–°å»ºï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;https://mirror.ccs.tencentyun.com&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ç±»æ–¹æ³•éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p></li></ul><h4 id="ä»£ç†çš„æ–¹å¼">ä»£ç†çš„æ–¹å¼</h4><p>å¦‚æœä½ éœ€è¦ç¿»å¢™ï¼š</p><ul><li><p>ç¡®è®¤ç¯å¢ƒå˜é‡ä¸­ <code>http_proxy</code> / <code>https_proxy</code>é…ç½®æ­£ç¡®ï¼›</p></li><li><p>æˆ–è€…åœ¨<code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>æ·»åŠ ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Service]<br>Environment=&quot;HTTP_PROXY=http://127.0.0.1:7890/&quot;<br>Environment=&quot;HTTPS_PROXY=http://127.0.0.1:7890/&quot;<br>Environment=&quot;NO_PROXY=localhost,127.0.0.1&quot;<br></code></pre></td></tr></table></figure></li></ul><p>ç„¶åæ‰§è¡Œ</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">sudo systemctl daemon-reload<br>sudo systemctl <span class="hljs-built_in">restart</span> docker<br><br>æˆ–è€…<br>sudo service docker <span class="hljs-built_in">restart</span><br></code></pre></td></tr></table></figure><p>å¦‚æœï¼Œä½ å¯ä»¥ç§‘å­¦ä¸Šç½‘ï¼Œé‚£ä¹ˆä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå°±å¯ä»¥äº†ã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸å…è®¸ä½ ä½¿ç”¨æ¢¯å­ï¼Œå°±è¯·å¾€ä¸‹çœ‹ã€‚</p><p>ä¸‹é¢é€šè¿‡è„šæœ¬æ’æŸ¥é—®é¢˜å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥å®ç°è‡ªå®šä¹‰åˆ›å»ºé•œåƒã€‚</p><h5 id="æ’æŸ¥è„šæœ¬">1 æ’æŸ¥è„šæœ¬</h5><p><strong>ä¸€é”®æ’æŸ¥è„šæœ¬</strong>ï¼Œå¯ä»¥æ£€æµ‹ DNSã€Docker Hubè®¿é—®ã€åŠ é€Ÿå™¨é…ç½®ã€ä»£ç†ç¯å¢ƒå˜é‡ï¼Œå¸®åŠ©ä½ å®šä½åˆ°åº•å¡åœ¨å“ªä¸€æ­¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>echo &quot;====== Docker ç½‘ç»œæ’æŸ¥è„šæœ¬ ======&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">1. æ£€æŸ¥ DNS è§£æ</span><br>echo -e &quot;\n[1] æ£€æŸ¥ DNS è§£æ registry-1.docker.io ...&quot;<br>nslookup registry-1.docker.io 2&gt;/dev/null || dig registry-1.docker.io<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">2. æ£€æŸ¥èƒ½å¦è®¿é—® Docker Hub</span><br>echo -e &quot;\n[2] æµ‹è¯• curl è®¿é—® Docker Hub ...&quot;<br>curl -I --max-time 10 https://registry-1.docker.io/v2/ || echo &quot;âŒ æ— æ³•è®¿é—® Docker Hub&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. æ£€æŸ¥ Docker Daemon é…ç½®</span><br>echo -e &quot;\n[3] æ£€æŸ¥ Docker é…ç½®æ–‡ä»¶ /etc/docker/daemon.json ...&quot;<br>if [ -f /etc/docker/daemon.json ]; then<br>    cat /etc/docker/daemon.json<br>else<br>    echo &quot;âš ï¸ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">4. æ£€æŸ¥ä»£ç†ç¯å¢ƒå˜é‡</span><br>echo -e &quot;\n[4] æ£€æŸ¥ä»£ç†ç¯å¢ƒå˜é‡ ...&quot;<br>echo &quot;HTTP_PROXY=$HTTP_PROXY&quot;<br>echo &quot;HTTPS_PROXY=$HTTPS_PROXY&quot;<br>echo &quot;NO_PROXY=$NO_PROXY&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">5. æ£€æŸ¥ systemd é‡Œçš„ Docker ä»£ç†é…ç½®</span><br>echo -e &quot;\n[5] æ£€æŸ¥ systemd ä¸­ Docker çš„ä»£ç†é…ç½® ...&quot;<br>systemctl show --property=Environment docker | grep -i proxy<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">6. æµ‹è¯• docker pull</span><br>echo -e &quot;\n[6] æµ‹è¯• docker pull hello-world ...&quot;<br>docker pull hello-world<br><br>echo -e &quot;\n====== æ’æŸ¥ç»“æŸ ======&quot;<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œæ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod +x check-docker.sh<br>./check-docker.sh<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¼šä¾æ¬¡å‘Šè¯‰ä½ ï¼š</p><ol type="1"><li>DNS æ˜¯å¦èƒ½è§£æ <code>registry-1.docker.io</code></li><li>æ˜¯å¦èƒ½ç›´è¿è®¿é—® Docker Hub</li><li>Docker æ˜¯å¦é…ç½®äº†åŠ é€Ÿå™¨</li><li>æ˜¯å¦æœ‰ä»£ç†ç¯å¢ƒå˜é‡</li><li>systemd é‡Œæ˜¯å¦æœ‰ä»£ç†é…ç½®</li><li>æ‹‰å– <code>hello-world</code> æ˜¯å¦æˆåŠŸ</li></ol><h5 id="è‡ªå·±åˆ¶ä½œé•œåƒ">2. è‡ªå·±åˆ¶ä½œé•œåƒ</h5><p>é€šè¿‡ä¸Šé¢çš„æ’æŸ¥è„šæœ¬ï¼Œå¦‚æœä½ ä¸èƒ½ç›´æ¥è®¿é—®docker hub,è€Œä¸”ä¹Ÿæ²¡æœ‰é…ç½®ä»£ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦è‡ªå·±åˆ¶ä½œé•œåƒã€‚é¦–å…ˆæ˜¯åˆ¶ä½œæ“ä½œç³»ç»Ÿé•œåƒï¼Œè¿™é‡Œå°±ç”¨ubuntuä¸ºä¾‹ã€‚</p><p>åˆ¶ä½œUbuntué•œåƒï¼Œå¯ä»¥é‡‡ç”¨çš„æ–¹å¼ï¼š</p><p>ä¸€ã€åŸºäºå®˜æ–¹ Ubuntu é•œåƒå®šåˆ¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">FROM ubuntu:20.04<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®æ—¶åŒºï¼ˆé¿å…äº¤äº’å¡ä½ï¼‰</span><br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…å¸¸ç”¨å·¥å…·</span><br>RUN apt-get update &amp;&amp; apt-get install -y \<br>    vim curl wget net-tools iputils-ping \<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®é»˜è®¤å‘½ä»¤</span><br>CMD [&quot;/bin/bash&quot;]<br><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ æ— æ³•è¿æ¥docker hub, é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä¸èƒ½ä½¿ç”¨ã€‚</p><p>äºŒã€å®Œå…¨â€œè£¸åšâ€ä¸€ä¸ª Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿ</p><p>å¦‚æœä½ å®Œå…¨ä¸æƒ³ä¾èµ–å®˜æ–¹ <code>ubuntu:20.04</code> é•œåƒï¼Œå¯ä»¥ç”¨<strong>debootstrap</strong> è‡ªå·±ç”Ÿæˆ rootfsï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">1.å®‰è£…å·¥å…·ï¼š<br>sudo apt-get install debootstrap<br>2.åˆ›å»ºä¸€ä¸ª Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿï¼š<br>sudo debootstrap --arch=amd64 focal ./ubuntu-rootfs http://archive.ubuntu.com/ubuntu/<br>3.ç”¨è¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œé•œåƒï¼š<br>cd ubuntu-rootfs<br>sudo tar -C . -c . | docker import - my-ubuntu:20.04<br>4. è¿è¡Œå®¹å™¨ï¼š<br>docker run -it my-ubuntu:20.04 /bin/bash<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æ˜¯çœŸæ­£â€œè‡ªå·±åšâ€çš„ Ubuntu é•œåƒï¼Œå®Œå…¨ä¸ä¾èµ– Docker Hubã€‚</p><p>ä¸‰ã€ä» ISO åšé•œåƒï¼ˆæ›´ç¡¬æ ¸ï¼‰</p><p>ä½ å¯ä»¥ä¸‹è½½ Ubuntu çš„ ISOï¼Œç”¨ chroot æå– rootfsï¼Œç„¶å<code>docker import</code>ã€‚ä¸è¿‡æ¯” <code>debootstrap</code> éº»çƒ¦.</p><p>ä¸‹é¢å†™ä¸€ä¸ª <strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>ï¼Œç”¨ <code>debootstrap</code>æ¥ä¸€é”®æ„å»º Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å¯¼å…¥ Docker æˆä¸ºé•œåƒã€‚</p><p>ä¿å­˜æˆ <code>build-ubuntu-image.sh</code>ï¼Œæ‰§è¡Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ–°çš„Ubuntu é•œåƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># é»˜è®¤å‚æ•°</span><br>UBUNTU_VERSION=focal      <span class="hljs-comment"># Ubuntu 20.04 (focal)ï¼Œå¯æ”¹ä¸º jammy(22.04) ç­‰</span><br>ARCH=amd64<br>MIRROR=http://archive.ubuntu.com/ubuntu/<br>ROOTFS_DIR=ubuntu-rootfs<br>IMAGE_NAME=my-ubuntu<br>TAG=20.04<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç‰ˆæœ¬: <span class="hljs-variable">$UBUNTU_VERSION</span>  æ¶æ„: <span class="hljs-variable">$ARCH</span>  é•œåƒå: <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä½¿ç”¨é•œåƒæº: <span class="hljs-variable">$MIRROR</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">command</span> -v debootstrap &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;</span><br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># åˆ›å»º rootfs</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;</span><br>sudo <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>sudo debootstrap --<span class="hljs-built_in">arch</span>=<span class="hljs-variable">$ARCH</span> <span class="hljs-variable">$UBUNTU_VERSION</span> <span class="hljs-variable">$ROOTFS_DIR</span> <span class="hljs-variable">$MIRROR</span><br><br><span class="hljs-comment"># å¯¼å…¥åˆ° Docker</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ‰“åŒ…å¹¶å¯¼å…¥ Docker...&quot;</span><br>sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -c . | docker import - <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span><br><br><span class="hljs-comment"># æ¸…ç†</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;</span><br>sudo <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> /bin/bash&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. chmod +x build-ubuntu-image.sh<br>2. ./build-ubuntu-image.sh<br>3. docker images<br>4. docker run -it my-ubuntu:20.04 /bin/bash<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ åœ¨å›½å†…ï¼Œ<code>archive.ubuntu.com</code>å¯èƒ½å¾ˆæ…¢ï¼Œå¯ä»¥æ”¹æˆæ¸…åæºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">MIRROR=https:<span class="hljs-regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="hljs-regexp">/ubuntu/</span><br></code></pre></td></tr></table></figure><p><code>UBUNTU_VERSION</code> å¯ä»¥æ”¹æˆ <code>jammy</code>(22.04)ï¼Œ<code>noble</code> (24.04)</p><h5 id="å‡çº§ä¸€ä¸‹è„šæœ¬æ”¯æŒ-å¯é€‰å‚æ•°">3.å‡çº§ä¸€ä¸‹è„šæœ¬ï¼Œæ”¯æŒ<strong>å¯é€‰å‚æ•°</strong></h5><ul><li>ç¬¬ 1 ä¸ªå‚æ•°ï¼šUbuntu ä»£å·ï¼ˆå¦‚<code>focal</code>ã€<code>jammy</code>ã€<code>noble</code>ï¼‰</li><li>ç¬¬ 2 ä¸ªå‚æ•°ï¼šé•œåƒ TAGï¼ˆå¦‚<code>20.04</code>ã€<code>22.04</code>ã€<code>24.04</code>ï¼‰</li></ul><p>å¦‚æœä¸ä¼ å‚æ•°ï¼Œé»˜è®¤å°±æ˜¯ Ubuntu 20.04ï¼ˆfocalï¼‰ã€‚</p><p>è„šæœ¬ï¼š<code>build-ubuntu-image.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸€é”®æ„å»º Ubuntu Docker é•œåƒ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨: ./build-ubuntu-image.sh [release] [tag]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¾‹å­: ./build-ubuntu-image.sh jammy 22.04</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>ARCH=amd64<br>MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/   # æ¸…åæºï¼Œå›½å†…å¿«<br>ROOTFS_DIR=ubuntu-rootfs<br>IMAGE_NAME=my-ubuntu<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¯»å–ç”¨æˆ·å‚æ•°</span><br>UBUNTU_RELEASE=$&#123;1:-$DEFAULT_RELEASE&#125;<br>TAG=$&#123;2:-$DEFAULT_TAG&#125;<br><br>echo &quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;Ubuntu Release: $UBUNTU_RELEASE&quot;<br>echo &quot;Docker Tag: $TAG&quot;<br>echo &quot;æ¶æ„: $ARCH&quot;<br>echo &quot;é•œåƒæº: $MIRROR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br>if ! command -v debootstrap &gt;/dev/null 2&gt;&amp;1; then<br>    echo &quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;<br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º rootfs</span><br>echo &quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;<br>sudo rm -rf $ROOTFS_DIR<br>sudo debootstrap --arch=$ARCH $UBUNTU_RELEASE $ROOTFS_DIR $MIRROR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥åˆ° Docker</span><br>echo &quot;ğŸ‘‰ æ‰“åŒ…å¹¶å¯¼å…¥ Docker...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $IMAGE_NAME:$TAG<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†</span><br>echo &quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;<br>sudo rm -rf $ROOTFS_DIR<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it $IMAGE_NAME:$TAG /bin/bash&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æ„å»ºé»˜è®¤ Ubuntu 20.04ï¼š<br>./build-ubuntu-image.sh<br><span class="hljs-bullet">2.</span> æ„å»º Ubuntu 22.04ï¼š<br>./build-ubuntu-image.sh jammy 22.04<br><span class="hljs-bullet">3.</span> æ„å»º Ubuntu 24.04ï¼š<br>./build-ubuntu-image.sh noble 24.04<br><span class="hljs-bullet">4.</span> æŸ¥çœ‹é•œåƒï¼š<br>docker images<br></code></pre></td></tr></table></figure><p>è¿™æ ·å®‰è£…çš„é•œåƒï¼Œæ²¡æœ‰å¸¸ç”¨å·¥å…·ï¼ŒæŠŠè„šæœ¬å‡çº§æˆ<strong>å¸¦å¸¸ç”¨å·¥å…·é¢„è£…ç‰ˆ</strong>ï¼Œè¿™æ ·ä½ æ„å»ºçš„ Ubuntué•œåƒå¯åŠ¨åå°±èƒ½ç›´æ¥ç”¨<code>vim</code>ã€<code>curl</code>ã€<code>ping</code>ã€<code>netstat</code>ç­‰ï¼Œä¸ç”¨å†æ¯æ¬¡æ‰‹åŠ¨å®‰è£…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸€é”®æ„å»º Ubuntu Docker é•œåƒ (é¢„è£…å¸¸ç”¨å·¥å…·)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨: ./build-ubuntu-image.sh [release] [tag]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¾‹å­: ./build-ubuntu-image.sh jammy 22.04</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>ARCH=amd64<br>MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/   # æ¸…åæºï¼Œå›½å†…å¿«<br>ROOTFS_DIR=ubuntu-rootfs<br>IMAGE_NAME=my-ubuntu<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¯»å–ç”¨æˆ·å‚æ•°</span><br>UBUNTU_RELEASE=$&#123;1:-$DEFAULT_RELEASE&#125;<br>TAG=$&#123;2:-$DEFAULT_TAG&#125;<br><br>echo &quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;Ubuntu Release: $UBUNTU_RELEASE&quot;<br>echo &quot;Docker Tag: $TAG&quot;<br>echo &quot;æ¶æ„: $ARCH&quot;<br>echo &quot;é•œåƒæº: $MIRROR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br>if ! command -v debootstrap &gt;/dev/null 2&gt;&amp;1; then<br>    echo &quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;<br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º rootfs</span><br>echo &quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;<br>sudo rm -rf $ROOTFS_DIR<br>sudo debootstrap --arch=$ARCH $UBUNTU_RELEASE $ROOTFS_DIR $MIRROR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰“åŒ… rootfs å¹¶å¯¼å…¥ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ æ‰“åŒ… rootfs...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$TAG<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ„å»ºæœ€ç»ˆé•œåƒ (é¢„è£…å¸¸ç”¨å·¥å…·)</span><br>echo &quot;ğŸ‘‰ åˆ›å»º Dockerfile å¹¶å®‰è£…å¸¸ç”¨å·¥å…·...&quot;<br>cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$TAG<br><br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br><br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br><br>CMD [&quot;/bin/bash&quot;]<br>EOF<br><br>docker build -t $IMAGE_NAME:$TAG .<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†</span><br>echo &quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;<br>rm -rf $ROOTFS_DIR Dockerfile<br>docker rmi $&#123;IMAGE_NAME&#125;-base:$TAG &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it $IMAGE_NAME:$TAG /bin/bash&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-number">1</span>. æ„å»ºé»˜è®¤ Ubuntu <span class="hljs-number">20.04</span>ï¼š<br>./build-ubuntu-image.<span class="hljs-keyword">sh</span><br><span class="hljs-number">2</span>. æ„å»º Ubuntu <span class="hljs-number">22.04</span>ï¼š<br>./build-ubuntu-image.<span class="hljs-keyword">sh</span> jammy <span class="hljs-number">22.04</span><br><span class="hljs-number">3</span>. æ„å»º Ubuntu <span class="hljs-number">24.04</span>ï¼š<br>./build-ubuntu-image.<span class="hljs-keyword">sh</span> noble <span class="hljs-number">24.04</span><br><span class="hljs-number">4</span>. æŸ¥çœ‹é•œåƒï¼š<br>docker images<br><span class="hljs-number">5</span>. å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•ï¼š<br>docker run -it my-ubuntu:<span class="hljs-number">22.04</span><br><br>åœ¨å®¹å™¨é‡Œ å¯ä»¥ç›´æ¥ç”¨ï¼š<br><span class="hljs-keyword">vim</span><br>curl https://www.google.<span class="hljs-keyword">com</span><br>ping baidu.<span class="hljs-keyword">com</span><br>netstat -tulnp<br></code></pre></td></tr></table></figure><h5 id="æŠŠè„šæœ¬å†å‡çº§ä¸€ä¸‹åŠ ä¸Š-æ¨¡å¼å‚æ•°">4. æŠŠè„šæœ¬å†å‡çº§ä¸€ä¸‹ï¼ŒåŠ ä¸Š<strong>æ¨¡å¼å‚æ•°</strong></h5><ul><li><code>--minimal</code> ï¼šåªç”Ÿæˆçº¯å‡€çš„ Ubuntu é•œåƒ</li><li><code>--full</code>ï¼šåœ¨é•œåƒä¸­é¢„è£…å¸¸ç”¨å·¥å…·ï¼ˆ<code>vim curl wget iputils-ping net-tools</code>ç­‰ï¼‰</li></ul><p>build-ubuntu-image.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># ==============================</span><br><span class="hljs-comment"># ä¸€é”®æ„å»º Ubuntu Docker é•œåƒ</span><br><span class="hljs-comment"># ä½¿ç”¨:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh [release] [tag] [mode]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ç¤ºä¾‹:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh focal 20.04 --minimal</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh jammy 22.04 --full</span><br><span class="hljs-comment"># ==============================</span><br><br><span class="hljs-comment"># é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>DEFAULT_MODE=--full<br>ARCH=amd64<br>MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/   <span class="hljs-comment"># æ¸…åæºï¼Œå›½å†…å¿«</span><br>ROOTFS_DIR=ubuntu-rootfs<br>IMAGE_NAME=my-ubuntu<br><br><span class="hljs-comment"># è¯»å–ç”¨æˆ·è¾“å…¥</span><br>UBUNTU_RELEASE=<span class="hljs-variable">$&#123;1:-<span class="hljs-variable">$DEFAULT_RELEASE</span>&#125;</span><br>TAG=<span class="hljs-variable">$&#123;2:-<span class="hljs-variable">$DEFAULT_TAG</span>&#125;</span><br>MODE=<span class="hljs-variable">$&#123;3:-<span class="hljs-variable">$DEFAULT_MODE</span>&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Ubuntu Release: <span class="hljs-variable">$UBUNTU_RELEASE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Docker Tag: <span class="hljs-variable">$TAG</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¶æ„: <span class="hljs-variable">$ARCH</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒæº: <span class="hljs-variable">$MIRROR</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¨¡å¼: <span class="hljs-variable">$MODE</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">command</span> -v debootstrap &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;</span><br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># åˆ›å»º rootfs</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;</span><br>sudo <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>sudo debootstrap --<span class="hljs-built_in">arch</span>=<span class="hljs-variable">$ARCH</span> <span class="hljs-variable">$UBUNTU_RELEASE</span> <span class="hljs-variable">$ROOTFS_DIR</span> <span class="hljs-variable">$MIRROR</span><br><br><span class="hljs-comment"># æ‰“åŒ… rootfs å¹¶å¯¼å…¥ä¸´æ—¶é•œåƒ</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ‰“åŒ… rootfs...&quot;</span><br>sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -c . | docker import - <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span><br><br><span class="hljs-comment"># æ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦å®‰è£…å·¥å…·</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$MODE</span>&quot;</span> = <span class="hljs-string">&quot;--full&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º FULL æ¨¡å¼é•œåƒï¼Œå®‰è£…å¸¸ç”¨å·¥å…·...&quot;</span><br>    <span class="hljs-built_in">cat</span> &gt; Dockerfile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">FROM $&#123;IMAGE_NAME&#125;-base:$TAG</span><br><span class="hljs-string"></span><br><span class="hljs-string">ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai</span><br><span class="hljs-string"></span><br><span class="hljs-string">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class="hljs-string">    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\</span><br><span class="hljs-string">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="hljs-string"></span><br><span class="hljs-string">CMD [&quot;/bin/bash&quot;]</span><br><span class="hljs-string">EOF</span><br><br>    docker build -t <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> .<br>    <span class="hljs-built_in">rm</span> -f Dockerfile<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º MINIMAL æ¨¡å¼é•œåƒ...&quot;</span><br>    docker tag <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ¸…ç†</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;</span><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>docker rmi <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> /bin/bash&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. æ„å»º Ubuntu 20.04 çº¯å‡€ç‰ˆï¼š<br>./build-ubuntu-image.sh focal 20.04 --minimal<br><br>2. æ„å»º Ubuntu 22.04 å·¥å…·å¢å¼ºç‰ˆï¼š<br>./build-ubuntu-image.sh jammy 22.04 --full<br><br>3. æ„å»º Ubuntu 24.04ï¼ˆé»˜è®¤ FULL æ¨¡å¼ï¼‰ï¼š<br>./build-ubuntu-image.sh noble 24.04<br><br>4. æŸ¥çœ‹é•œåƒï¼š<br>docker images<br>5. å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•ï¼š<br>docker run -it my-ubuntu:22.04 /bin/bash<br><br></code></pre></td></tr></table></figure><h5 id="å†å‡çº§è„šæœ¬å¢åŠ -è‡ªå®šä¹‰é•œåƒåå‚æ•°">4.1 å†å‡çº§è„šæœ¬ï¼Œå¢åŠ <strong>è‡ªå®šä¹‰é•œåƒåå‚æ•°</strong>ã€‚</h5><p>ç°åœ¨è„šæœ¬æ”¯æŒå››ä¸ªå‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">./build-ubuntu-image.sh [release] [tag] [mode] [imagename]<br><br></code></pre></td></tr></table></figure><p><code>release</code> ï¼šUbuntu ä»£å·ï¼ˆé»˜è®¤ <code>focal</code>ï¼‰</p><p><code>tag</code> ï¼šé•œåƒ tagï¼ˆé»˜è®¤ <code>20.04</code>ï¼‰</p><p><code>mode</code> ï¼š<code>--minimal</code> æˆ–<code>--full</code>ï¼ˆé»˜è®¤ <code>--full</code>ï¼‰</p><p><code>imagename</code> ï¼šè‡ªå®šä¹‰é•œåƒåï¼ˆé»˜è®¤<code>my-ubuntu</code>ï¼‰</p><p>build-ubuntu-image.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># ==============================</span><br><span class="hljs-comment"># ä¸€é”®æ„å»º Ubuntu Docker é•œåƒ</span><br><span class="hljs-comment"># ä½¿ç”¨:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh [release] [tag] [mode] [imagename]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ç¤ºä¾‹:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh focal 20.04 --minimal</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh jammy 22.04 --full my-ubuntu-dev</span><br><span class="hljs-comment"># ==============================</span><br><br><span class="hljs-comment"># é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>DEFAULT_MODE=--full<br>DEFAULT_IMAGE=my-ubuntu<br>ARCH=amd64<br>MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/   <span class="hljs-comment"># æ¸…åæºï¼Œå›½å†…å¿«</span><br>ROOTFS_DIR=ubuntu-rootfs<br><br><span class="hljs-comment"># è¯»å–ç”¨æˆ·è¾“å…¥</span><br>UBUNTU_RELEASE=<span class="hljs-variable">$&#123;1:-<span class="hljs-variable">$DEFAULT_RELEASE</span>&#125;</span><br>TAG=<span class="hljs-variable">$&#123;2:-<span class="hljs-variable">$DEFAULT_TAG</span>&#125;</span><br>MODE=<span class="hljs-variable">$&#123;3:-<span class="hljs-variable">$DEFAULT_MODE</span>&#125;</span><br>IMAGE_NAME=<span class="hljs-variable">$&#123;4:-<span class="hljs-variable">$DEFAULT_IMAGE</span>&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Ubuntu Release : <span class="hljs-variable">$UBUNTU_RELEASE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Docker Tag     : <span class="hljs-variable">$TAG</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¨¡å¼           : <span class="hljs-variable">$MODE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒå         : <span class="hljs-variable">$IMAGE_NAME</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¶æ„           : <span class="hljs-variable">$ARCH</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒæº         : <span class="hljs-variable">$MIRROR</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">command</span> -v debootstrap &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;</span><br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># åˆ›å»º rootfs</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;</span><br>sudo <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>sudo debootstrap --<span class="hljs-built_in">arch</span>=<span class="hljs-variable">$ARCH</span> <span class="hljs-variable">$UBUNTU_RELEASE</span> <span class="hljs-variable">$ROOTFS_DIR</span> <span class="hljs-variable">$MIRROR</span><br><br><span class="hljs-comment"># æ‰“åŒ… rootfs å¹¶å¯¼å…¥ä¸´æ—¶é•œåƒ</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ‰“åŒ… rootfs...&quot;</span><br>sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -c . | docker import - <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span><br><br><span class="hljs-comment"># æ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦å®‰è£…å·¥å…·</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$MODE</span>&quot;</span> = <span class="hljs-string">&quot;--full&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º FULL æ¨¡å¼é•œåƒï¼Œå®‰è£…å¸¸ç”¨å·¥å…·...&quot;</span><br>    <span class="hljs-built_in">cat</span> &gt; Dockerfile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">FROM $&#123;IMAGE_NAME&#125;-base:$TAG</span><br><span class="hljs-string"></span><br><span class="hljs-string">ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai</span><br><span class="hljs-string"></span><br><span class="hljs-string">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class="hljs-string">    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\</span><br><span class="hljs-string">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="hljs-string"></span><br><span class="hljs-string">CMD [&quot;/bin/bash&quot;]</span><br><span class="hljs-string">EOF</span><br><br>    docker build -t <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> .<br>    <span class="hljs-built_in">rm</span> -f Dockerfile<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º MINIMAL æ¨¡å¼é•œåƒ...&quot;</span><br>    docker tag <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ¸…ç†</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;</span><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>docker rmi <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> /bin/bash&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1.</span> æ„å»º Ubuntu <span class="hljs-number">20.04</span> çº¯å‡€ç‰ˆï¼ˆé»˜è®¤é•œåƒå <span class="hljs-keyword">my</span>-ubuntuï¼‰ï¼š<br>./build-ubuntu-image.sh focal <span class="hljs-number">20.04</span> <span class="hljs-comment">--minimal</span><br><br><span class="hljs-number">2.</span> æ„å»º Ubuntu <span class="hljs-number">22.04</span> å·¥å…·å¢å¼ºç‰ˆï¼Œé•œåƒåè‡ªå®šä¹‰ä¸º <span class="hljs-keyword">my</span>-ubuntu-devï¼š<br>./build-ubuntu-image.sh jammy <span class="hljs-number">22.04</span> <span class="hljs-comment">--full my-ubuntu-dev</span><br><br><span class="hljs-number">3.</span> æ„å»º Ubuntu <span class="hljs-number">24.04</span>ï¼Œä¿æŒé»˜è®¤ï¼ˆfull æ¨¡å¼ï¼Œé•œåƒå <span class="hljs-keyword">my</span>-ubuntuï¼‰ï¼š<br>./build-ubuntu-image.sh noble <span class="hljs-number">24.04</span><br><br><span class="hljs-number">4.</span> æŸ¥çœ‹é•œåƒï¼š<br>docker images<br><span class="hljs-number">5.</span> å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•ï¼š<br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu-dev:<span class="hljs-number">22.04</span> /bin/bash<br></code></pre></td></tr></table></figure><h5 id="å…¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸€é”®ç”Ÿæˆ-ubuntu-docker-é•œåƒæ”¯æŒ">5.<strong>å…¨è‡ªåŠ¨åŒ–è„šæœ¬</strong>ï¼Œä¸€é”®ç”Ÿæˆ Ubuntu Docker é•œåƒï¼Œæ”¯æŒï¼š</h5><ul><li>é€‰æ‹© Ubuntu ç‰ˆæœ¬ï¼ˆfocal / jammy / nobleï¼‰</li><li>é€‰æ‹©æ¨¡å¼ï¼š<code>--minimal</code> æˆ–<code>--full</code>ï¼ˆæ˜¯å¦é¢„è£…å¸¸ç”¨å·¥å…·ï¼‰</li><li>è‡ªå®šä¹‰ Docker é•œåƒåç§°</li><li>å¯è‡ªå®šä¹‰ apt é•œåƒæºï¼ˆå›½å†…/å®˜æ–¹ï¼‰</li></ul><p>build-ubuntu-image.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸€é”®æ„å»º Ubuntu Docker é•œåƒ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  ./build-ubuntu-image.sh [release] [tag] [mode] [imagename] [mirror]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  ./build-ubuntu-image.sh jammy 22.04 --full my-ubuntu-dev https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>DEFAULT_MODE=--full<br>DEFAULT_IMAGE=my-ubuntu<br>DEFAULT_MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/<br>ARCH=amd64<br>ROOTFS_DIR=ubuntu-rootfs<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¯»å–å‚æ•°</span><br>UBUNTU_RELEASE=$&#123;1:-$DEFAULT_RELEASE&#125;<br>TAG=$&#123;2:-$DEFAULT_TAG&#125;<br>MODE=$&#123;3:-$DEFAULT_MODE&#125;<br>IMAGE_NAME=$&#123;4:-$DEFAULT_IMAGE&#125;<br>MIRROR=$&#123;5:-$DEFAULT_MIRROR&#125;<br><br>echo &quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;Ubuntu Release : $UBUNTU_RELEASE&quot;<br>echo &quot;Docker Tag     : $TAG&quot;<br>echo &quot;æ¨¡å¼           : $MODE&quot;<br>echo &quot;é•œåƒå         : $IMAGE_NAME&quot;<br>echo &quot;APT é•œåƒæº     : $MIRROR&quot;<br>echo &quot;æ¶æ„           : $ARCH&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br>if ! command -v debootstrap &gt;/dev/null 2&gt;&amp;1; then<br>    echo &quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;<br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º rootfs</span><br>echo &quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;<br>sudo rm -rf $ROOTFS_DIR<br>sudo debootstrap --arch=$ARCH $UBUNTU_RELEASE $ROOTFS_DIR $MIRROR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰“åŒ… rootfs å¹¶å¯¼å…¥ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ æ‰“åŒ… rootfs...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$TAG<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦å®‰è£…å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ æ„å»º FULL æ¨¡å¼é•œåƒï¼Œå®‰è£…å¸¸ç”¨å·¥å…·...&quot;<br>    cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$TAG<br><br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br><br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br><br>CMD [&quot;/bin/bash&quot;]<br>EOF<br><br>    docker build -t $IMAGE_NAME:$TAG .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ æ„å»º MINIMAL æ¨¡å¼é•œåƒ...&quot;<br>    docker tag $&#123;IMAGE_NAME&#125;-base:$TAG $IMAGE_NAME:$TAG<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†</span><br>echo &quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;<br>rm -rf $ROOTFS_DIR<br>docker rmi $&#123;IMAGE_NAME&#125;-base:$TAG &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it $IMAGE_NAME:$TAG /bin/bash&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">æ„å»º Ubuntu 20.04 æœ€å°ç‰ˆï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> focal 20.04 <span class="hljs-params">--minimal</span><br><br><br>æ„å»º Ubuntu 22.04 å·¥å…·å¢å¼ºç‰ˆï¼Œè‡ªå®šä¹‰é•œåƒå my-ubuntu-devï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> jammy 22.04 <span class="hljs-params">--full</span> my-ubuntu-dev<br><br><br>æ„å»º Ubuntu 24.04ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> noble 24.04 <span class="hljs-params">--full</span> my-ubuntu-24 https:<span class="hljs-string">//mirrors.aliyun.com/ubuntu/</span><br><br><br>æŸ¥çœ‹é•œåƒï¼š<br><br>docker images<br><br><br>å¯åŠ¨å®¹å™¨ï¼š<br><br>docker run -it my-ubuntu-dev<span class="hljs-function">:22.04</span> <span class="hljs-string">/bin/bash</span><br></code></pre></td></tr></table></figure><h4 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h4><p>å¦‚æœä½ åœ¨æ‰§è¡Œè„šæœ¬è¿‡ç¨‹ä¸­ï¼Œé‡åˆ° E: No such script:/usr/share/debootstrap/scripts/focal è¿™ä¸ªé”™è¯¯ã€‚ è¯´æ˜<strong>ä½ çš„ç³»ç»Ÿé‡Œdebootstrap æ²¡æœ‰ focal çš„è„šæœ¬</strong>ã€‚è¿™æ˜¯ debootstrapçš„å¸¸è§é—®é¢˜ï¼Œå°¤å…¶åœ¨ä¸€äº›è€ç‰ˆæœ¬æˆ–é Ubuntu ç³»ç»Ÿä¸Šã€‚å¯ä»¥è¿™æ ·è§£å†³ï¼š</p><ol type="1"><li><p>è§£å†³æ–¹æ³•ä¸€ï¼šå®‰è£…æœ€æ–°ç‰ˆ debootstrap</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-built_in">get</span> update<br>sudo apt-<span class="hljs-built_in">get</span> install -y debootstrap<br><br></code></pre></td></tr></table></figure></li><li><p>è§£å†³æ–¹æ³•äºŒï¼šä½¿ç”¨ç°æœ‰è„šæœ¬ä»£æ›¿</p><p>å¦‚æœä½ æ²¡æœ‰ <code>focal</code>ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ç‰ˆæœ¬ï¼ˆä¾‹å¦‚<code>jammy</code> æˆ– <code>bionic</code>ï¼‰æ¥ä»£æ›¿ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo debootstrap --<span class="hljs-built_in">arch</span>=amd64 jammy ./ubuntu-rootfs https://mirrors.tuna.tsinghua.edu.cn/ubuntu/<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šJammy = 22.04ï¼ŒBionic = 18.04</p></blockquote></li><li><p>è§£å†³æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨ä¸‹è½½è„šæœ¬</p><p>å¦‚æœé Ubuntu ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ debootstrap è„šæœ¬ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo wget https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/debootstrap/</span>debootstrap<span class="hljs-regexp">/master/</span>scripts<span class="hljs-regexp">/focal -O /u</span>sr<span class="hljs-regexp">/share/</span>debootstrap<span class="hljs-regexp">/scripts/</span>focal<br></code></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo debootstrap --<span class="hljs-built_in">arch</span>=amd64 focal ./ubuntu-rootfs http://archive.ubuntu.com/ubuntu/<br></code></pre></td></tr></table></figure></li></ol><h4 id="æ”¹è¿›1">æ”¹è¿›1</h4><p>å‡çº§è„šæœ¬ï¼Œè®©å®ƒ <strong>å³ä½¿ç³»ç»Ÿ debootstrapæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬</strong>ï¼Œä¹Ÿèƒ½è‡ªåŠ¨ä¸‹è½½å¯¹åº”çš„è„šæœ¬æ¥æ„å»º rootfsï¼Œä»è€Œæ”¯æŒä»»æ„Ubuntu ç‰ˆæœ¬ã€‚</p><p>build-ubuntu-image.shï¼ˆæ”¯æŒè‡ªåŠ¨ä¸‹è½½ debootstrap è„šæœ¬ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># ==============================</span><br><span class="hljs-comment"># ä¸€é”®æ„å»º Ubuntu Docker é•œåƒï¼ˆè‡ªåŠ¨ä¸‹è½½ç¼ºå¤± debootstrap è„šæœ¬ï¼‰</span><br><span class="hljs-comment"># ä½¿ç”¨:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh [release] [tag] [mode] [imagename] [mirror]</span><br><span class="hljs-comment"># ç¤ºä¾‹:</span><br><span class="hljs-comment">#   ./build-ubuntu-image.sh jammy 22.04 --full my-ubuntu-dev</span><br><span class="hljs-comment"># ==============================</span><br><br><span class="hljs-comment"># é»˜è®¤å‚æ•°</span><br>DEFAULT_RELEASE=focal<br>DEFAULT_TAG=20.04<br>DEFAULT_MODE=--full<br>DEFAULT_IMAGE=my-ubuntu<br>DEFAULT_MIRROR=https://mirrors.tuna.tsinghua.edu.cn/ubuntu/<br>ARCH=amd64<br>ROOTFS_DIR=ubuntu-rootfs<br>SCRIPTS_DIR=/usr/share/debootstrap/scripts<br>DEBOOTSTRAP_GIT=https://raw.githubusercontent.com/debootstrap/debootstrap/master/scripts<br><br><span class="hljs-comment"># è¯»å–å‚æ•°</span><br>USER_RELEASE=<span class="hljs-variable">$&#123;1:-<span class="hljs-variable">$DEFAULT_RELEASE</span>&#125;</span><br>TAG=<span class="hljs-variable">$&#123;2:-<span class="hljs-variable">$DEFAULT_TAG</span>&#125;</span><br>MODE=<span class="hljs-variable">$&#123;3:-<span class="hljs-variable">$DEFAULT_MODE</span>&#125;</span><br>IMAGE_NAME=<span class="hljs-variable">$&#123;4:-<span class="hljs-variable">$DEFAULT_IMAGE</span>&#125;</span><br>MIRROR=<span class="hljs-variable">$&#123;5:-<span class="hljs-variable">$DEFAULT_MIRROR</span>&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç”¨æˆ·è¾“å…¥ç‰ˆæœ¬ : <span class="hljs-variable">$USER_RELEASE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Docker Tag    : <span class="hljs-variable">$TAG</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¨¡å¼          : <span class="hljs-variable">$MODE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒå        : <span class="hljs-variable">$IMAGE_NAME</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;APT é•œåƒæº    : <span class="hljs-variable">$MIRROR</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¶æ„          : <span class="hljs-variable">$ARCH</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ£€æŸ¥ debootstrap æ˜¯å¦å®‰è£…</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">command</span> -v debootstrap &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ æœªæ‰¾åˆ° debootstrapï¼Œæ­£åœ¨å®‰è£…...&quot;</span><br>    sudo apt-get update &amp;&amp; sudo apt-get install -y debootstrap wget<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ£€æŸ¥è„šæœ¬æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;<span class="hljs-variable">$SCRIPTS_DIR</span>/<span class="hljs-variable">$USER_RELEASE</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ debootstrap è„šæœ¬ <span class="hljs-variable">$USER_RELEASE</span> ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨ä¸‹è½½...&quot;</span><br>    sudo wget -O <span class="hljs-string">&quot;<span class="hljs-variable">$SCRIPTS_DIR</span>/<span class="hljs-variable">$USER_RELEASE</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$DEBOOTSTRAP_GIT</span>/<span class="hljs-variable">$USER_RELEASE</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ $? -ne 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç‰ˆæœ¬åæ˜¯å¦æ­£ç¡®ã€‚&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># åˆ›å»º rootfs</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¼€å§‹æ„å»º rootfs...&quot;</span><br>sudo <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>sudo debootstrap --<span class="hljs-built_in">arch</span>=<span class="hljs-variable">$ARCH</span> <span class="hljs-variable">$USER_RELEASE</span> <span class="hljs-variable">$ROOTFS_DIR</span> <span class="hljs-variable">$MIRROR</span><br><br><span class="hljs-comment"># æ‰“åŒ… rootfs å¹¶å¯¼å…¥ä¸´æ—¶é•œåƒ</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ‰“åŒ… rootfs...&quot;</span><br>sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -c . | docker import - <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span><br><br><span class="hljs-comment"># æ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦å®‰è£…å·¥å…·</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$MODE</span>&quot;</span> = <span class="hljs-string">&quot;--full&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º FULL æ¨¡å¼é•œåƒï¼Œå®‰è£…å¸¸ç”¨å·¥å…·...&quot;</span><br>    <span class="hljs-built_in">cat</span> &gt; Dockerfile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">FROM $&#123;IMAGE_NAME&#125;-base:$TAG</span><br><span class="hljs-string"></span><br><span class="hljs-string">ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai</span><br><span class="hljs-string"></span><br><span class="hljs-string">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class="hljs-string">    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\</span><br><span class="hljs-string">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="hljs-string"></span><br><span class="hljs-string">CMD [&quot;/bin/bash&quot;]</span><br><span class="hljs-string">EOF</span><br><br>    docker build -t <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> .<br>    <span class="hljs-built_in">rm</span> -f Dockerfile<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ„å»º MINIMAL æ¨¡å¼é•œåƒ...&quot;</span><br>    docker tag <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ¸…ç†</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†ä¸´æ—¶æ–‡ä»¶...&quot;</span><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>docker rmi <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$TAG</span> &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä½ ç°åœ¨å¯ä»¥è¿è¡Œ: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$TAG</span> /bin/bash&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">æ„å»º Ubuntu 20.04 FULL æ¨¡å¼ï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> focal 20.04 <span class="hljs-params">--full</span> my-ubuntu-dev<br><br><br>æ„å»º Ubuntu 22.04 MINIMAL æ¨¡å¼ï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> jammy 22.04 <span class="hljs-params">--minimal</span> my-ubuntu-22<br><br><br>æ„å»º Ubuntu 24.04ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼š<br><br><span class="hljs-string">./build-ubuntu-image.sh</span> noble 24.04 <span class="hljs-params">--full</span> my-ubuntu-24 https:<span class="hljs-string">//mirrors.aliyun.com/ubuntu/</span><br></code></pre></td></tr></table></figure><p>è‡ªåŠ¨æ£€æµ‹ debootstrap è„šæœ¬æ˜¯å¦å­˜åœ¨</p><p>ä¸å­˜åœ¨æ—¶è‡ªåŠ¨ä» GitHub ä¸‹è½½æœ€æ–°è„šæœ¬</p><p>æ”¯æŒè‡ªå®šä¹‰ Ubuntu ç‰ˆæœ¬ã€é•œåƒåã€æ¨¡å¼ï¼ˆminimal/fullï¼‰</p><p>æ”¯æŒè‡ªå®šä¹‰ apt é•œåƒæº</p><p>FULL æ¨¡å¼ä¼šå®‰è£…å¸¸ç”¨å·¥å…·</p><p>æ‰§è¡Œä¸Šè¿°è„šæœ¬å‡ºç°https://raw.githubusercontent.com/debootstrap/debootstrap/master/scripts404 ç”±äº Ubuntu å®˜æ–¹çš„ debootstrap è„šæœ¬å·²ä¸å†ç»´æŠ¤ Ubuntu Focalï¼ˆ20.04LTSï¼‰ï¼Œå¯¼è‡´ <code>/usr/share/debootstrap/scripts/focal</code>æ–‡ä»¶ç¼ºå¤±ã€‚å› æ­¤ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ debootstrap æ„å»º Ubuntu 20.04 çš„rootfsã€‚</p><h4 id="æ”¹è¿›2">æ”¹è¿›2</h4><p>é¢ä¸´çš„é—®é¢˜ï¼š</p><ul><li>debootstrap é»˜è®¤è„šæœ¬å¯èƒ½ç¼ºå¤±</li><li><strong>æ— æ³•è®¿é—® Docker Hub</strong>ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥<code>docker pull ubuntu:20.04</code></li><li>ç›®æ ‡æ˜¯ <strong>æ„å»ºå¯ç”¨çš„ Ubuntu é•œåƒ</strong></li></ul><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ <strong>ç¦»çº¿æ–¹å¼</strong> æ„å»º Ubuntu Dockeré•œåƒ</p><p>ä½¿ç”¨å®˜æ–¹ Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿ tar åŒ…ï¼ˆæ¨èï¼‰</p><p>Ubuntu å®˜æ–¹æä¾› <strong>rootfs tarball</strong>ï¼Œå¯ä»¥ç¦»çº¿ä¸‹è½½ï¼š</p><ul><li>å®˜ç½‘åœ°å€ï¼ˆå¯åœ¨å¯è®¿é—®ç½‘ç»œçš„æœºå™¨ä¸‹è½½ï¼Œå†ä¼ åˆ°ç›®æ ‡æœºï¼‰ï¼š<ul><li>https://partner-images.canonical.com/core/focal/current/</li><li>æ–‡ä»¶ç¤ºä¾‹ï¼š<code>ubuntu-20.04-core-cloudimg-amd64-root.tar.gz</code></li></ul></li></ul><p>æ„å»ºæµç¨‹</p><ol type="1"><li><p>ä¸‹è½½ tar åŒ…åˆ°ç›®æ ‡æœºï¼ˆé€šè¿‡ U ç›˜ã€å†…ç½‘æœåŠ¡å™¨ç­‰æ–¹å¼ä¼ è¾“ï¼‰ã€‚</p></li><li><p>å¯¼å…¥ Dockerï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> import ubuntu-<span class="hljs-number">20</span>.<span class="hljs-number">04</span>-core-cloudimg-amd64-root.tar.gz my-ubuntu:<span class="hljs-number">20</span>.<span class="hljs-number">04</span><br></code></pre></td></tr></table></figure></li><li><p>éªŒè¯ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash<br></code></pre></td></tr></table></figure></li><li><p>å¯é€‰ï¼šåœ¨ Dockerfile ä¸­åŸºäºæ­¤é•œåƒå®‰è£…å¸¸ç”¨å·¥å…·ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> my-ubuntu:<span class="hljs-number">20.04</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y vim curl wget iputils-ping net-tools &amp;&amp; <span class="hljs-built_in">rm</span> -rf /var/lib/apt/lists/*</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/bash&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ol><p>âœ… ä¼˜ç‚¹ï¼šå®Œå…¨ç¦»çº¿ã€å¯æ§ã€å®˜æ–¹æ”¯æŒ âš ï¸ ç¼ºç‚¹ï¼šéœ€è¦å…ˆä¸‹è½½ tar åŒ…</p><p>2ï¸âƒ£ ä½¿ç”¨ <code>debootstrap</code> ç¦»çº¿æ„å»ºï¼ˆé Ubuntu ç³»ç»Ÿï¼‰</p><p>å³ä½¿ä½ çš„ç³»ç»Ÿä¸æ˜¯ Ubuntuï¼Œä¹Ÿå¯ä»¥ï¼š</p><ol type="1"><li><p>åœ¨å¯è”ç½‘çš„ Ubuntu ç³»ç»Ÿä¸Šè¿è¡Œ <code>debootstrap</code> æ„å»ºrootfsï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo debootstrap --<span class="hljs-built_in">arch</span>=amd64 focal ./ubuntu-rootfs http://archive.ubuntu.com/ubuntu/<br></code></pre></td></tr></table></figure></li><li><p>æ‰“åŒ… rootfsï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">sudo tar -C ./ubuntu-rootfs -c . <span class="hljs-string">| gzip &gt; ubuntu-focal-rootfs.tar.gz</span><br></code></pre></td></tr></table></figure></li><li><p>å¤åˆ¶ tar åŒ…åˆ°ç›®æ ‡ç³»ç»Ÿã€‚</p></li><li><p>å¯¼å…¥ Dockerï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cat</span> ubuntu-focal-rootfs.tar.gz | docker import - my-ubuntu:<span class="hljs-number">20</span>.<span class="hljs-number">04</span><br></code></pre></td></tr></table></figure></li></ol><p>âœ… ä¼˜ç‚¹ï¼šå®Œå…¨ç¦»çº¿ï¼Œæ”¯æŒä»»æ„ç³»ç»Ÿ âš ï¸ ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„ Ubuntu ç¯å¢ƒç”Ÿæˆrootfs</p><p>3ï¸âƒ£ ä½¿ç”¨ç°æœ‰ ISO ç¦»çº¿æ„å»º</p><ol type="1"><li><p>ä¸‹è½½ Ubuntu Server ISOï¼ˆä¾‹å¦‚<code>ubuntu-20.04-live-server-amd64.iso</code>ï¼‰</p></li><li><p>æŒ‚è½½ ISOï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> mount -o loop ubuntu-<span class="hljs-number">20</span>.<span class="hljs-number">04</span>.iso /mnt<br></code></pre></td></tr></table></figure></li><li><p>æå– squashfs æ–‡ä»¶ç³»ç»Ÿï¼š</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">sudo unsquashfs -d ubuntu-rootfs /mnt/casper/<span class="hljs-keyword">file</span><span class="hljs-params">system</span>.squashfs<br></code></pre></td></tr></table></figure></li><li><p>æ‰“åŒ… rootfsï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> tar -C ubuntu-rootfs -c . | docker import - my-ubuntu:<span class="hljs-number">20</span>.<span class="hljs-number">04</span><br></code></pre></td></tr></table></figure></li></ol><p>âœ… ä¼˜ç‚¹ï¼šå®Œå…¨ç¦»çº¿ï¼Œä¸ä¾èµ– Docker Hub âš ï¸ ç¼ºç‚¹ï¼šISOæå–å¯èƒ½æ¯”è¾ƒå¤æ‚</p><p>ğŸ’¡ æ€»ç»“</p><table><thead><tr><th>æ–¹æ³•</th><th>æ˜¯å¦å¯ç¦»çº¿</th><th>æ˜¯å¦å®˜æ–¹æ”¯æŒ</th><th>éš¾æ˜“åº¦</th></tr></thead><tbody><tr><td>å®˜æ–¹ rootfs tar</td><td>âœ…</td><td>âœ…</td><td>ç®€å•</td></tr><tr><td>debootstrap ç¦»çº¿</td><td>âœ…</td><td>âœ…</td><td>ä¸­ç­‰ï¼Œéœ€è¦ Ubuntu ç¯å¢ƒ</td></tr><tr><td>ISO æå–</td><td>âœ…</td><td>âœ…</td><td>è¾ƒå¤æ‚</td></tr></tbody></table><p>å®Œæ•´è„šæœ¬ï¼ˆå¸¦æœ¬æœºç¼“å­˜ç®¡ç†ï¼‰offline-ubuntu-docker-auto-v4.sh</p><p>æ¯æ¬¡æ„å»ºé•œåƒæ—¶ï¼Œä¼šåœ¨ <code>$HOME/.offline-ubuntu-cache</code> ä¿å­˜rootfs</p><p>ä¸‹æ¬¡åŒç‰ˆæœ¬åŒæ¶æ„ç›´æ¥ä½¿ç”¨ç¼“å­˜</p><p>è‡ªåŠ¨åˆ é™¤è¶…è¿‡ N å¤©çš„è€ç¼“å­˜ï¼ˆé¿å…å ç”¨è¿‡å¤šç£ç›˜ç©ºé—´ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># ==============================</span><br><span class="hljs-comment"># ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆè‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬/æ¶æ„ï¼ŒFULL æ¨¡å¼å®‰è£…å·¥å…·ï¼Œæœ¬æœºç¼“å­˜ç®¡ç†ï¼‰</span><br><span class="hljs-comment"># ä½¿ç”¨:</span><br><span class="hljs-comment">#   ./offline-ubuntu-docker-auto-v4.sh &lt;source&gt; &lt;type&gt; &lt;tag&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># å‚æ•°:</span><br><span class="hljs-comment">#   source    : rootfs tar æ–‡ä»¶è·¯å¾„ æˆ– ISO æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-comment">#   type      : tar æˆ– iso</span><br><span class="hljs-comment">#   tag       : Docker é•œåƒ tag (å¦‚ 20.04)</span><br><span class="hljs-comment">#   mode      : --minimal æˆ– --full</span><br><span class="hljs-comment">#   imagename : Docker é•œåƒå (é»˜è®¤ my-ubuntu)</span><br><span class="hljs-comment"># ==============================</span><br><br>SOURCE_FILE=<span class="hljs-variable">$1</span><br>TYPE=<span class="hljs-variable">$2</span><br>TAG=<span class="hljs-variable">$&#123;3:-latest&#125;</span><br>MODE=<span class="hljs-variable">$&#123;4:---full&#125;</span><br>IMAGE_NAME=<span class="hljs-variable">$&#123;5:-my-ubuntu&#125;</span><br>CACHE_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.offline-ubuntu-cache&quot;</span><br>ROOTFS_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>/rootfs-<span class="hljs-variable">$TAG</span>&quot;</span><br>CACHE_MAX_DAYS=30   <span class="hljs-comment"># è‡ªåŠ¨æ¸…ç†è¶…è¿‡30å¤©çš„ç¼“å­˜</span><br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$SOURCE_FILE</span>&quot;</span> ] || [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$CACHE_DIR</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æºæ–‡ä»¶       : <span class="hljs-variable">$SOURCE_FILE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç±»å‹         : <span class="hljs-variable">$TYPE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Docker Tag   : <span class="hljs-variable">$TAG</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¨¡å¼         : <span class="hljs-variable">$MODE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒå       : <span class="hljs-variable">$IMAGE_NAME</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¼“å­˜ç›®å½•     : <span class="hljs-variable">$CACHE_DIR</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ¸…ç†è¿‡æœŸç¼“å­˜</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ <span class="hljs-variable">$CACHE_MAX_DAYS</span> å¤©çš„ç¼“å­˜...&quot;</span><br>find <span class="hljs-variable">$CACHE_DIR</span> -maxdepth 1 -<span class="hljs-built_in">type</span> d -name <span class="hljs-string">&quot;rootfs-*&quot;</span> -mtime +<span class="hljs-variable">$CACHE_MAX_DAYS</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;<br><br><span class="hljs-comment"># æ£€æŸ¥ç¼“å­˜</span><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment"># æ¸…ç†æ—§ rootfs</span><br>    <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$ROOTFS_DIR</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$ROOTFS_DIR</span><br><br>    <span class="hljs-comment"># æå– rootfs</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> = <span class="hljs-string">&quot;tar&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;</span><br>        sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -xf <span class="hljs-variable">$SOURCE_FILE</span><br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> = <span class="hljs-string">&quot;iso&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;</span><br>        MOUNT_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>/iso-mount-<span class="hljs-variable">$TAG</span>&quot;</span><br>        <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$MOUNT_DIR</span><br>        sudo mount -o loop <span class="hljs-variable">$SOURCE_FILE</span> <span class="hljs-variable">$MOUNT_DIR</span><br>        <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>/casper/filesystem.squashfs&quot;</span> ]; <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ ISO ä¸­æœªæ‰¾åˆ° casper/filesystem.squashfs&quot;</span><br>            <span class="hljs-built_in">exit</span> 1<br>        <span class="hljs-keyword">fi</span><br>        sudo unsquashfs -d <span class="hljs-variable">$ROOTFS_DIR</span> <span class="hljs-variable">$MOUNT_DIR</span>/casper/filesystem.squashfs<br>        sudo umount <span class="hljs-variable">$MOUNT_DIR</span><br>        <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$MOUNT_DIR</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… rootfs å·²ç¼“å­˜åˆ° <span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># è‡ªåŠ¨æ£€æµ‹ Ubuntu ç‰ˆæœ¬</span><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>/etc/os-release&quot;</span> ]; <span class="hljs-keyword">then</span><br>    UBUNTU_VERSION=$(grep <span class="hljs-string">&#x27;VERSION_ID=&#x27;</span> <span class="hljs-variable">$ROOTFS_DIR</span>/etc/os-release | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;&quot;&#x27;</span> -f2)<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ£€æµ‹åˆ° Ubuntu ç‰ˆæœ¬: <span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ æ— æ³•æ£€æµ‹ Ubuntu ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤ tag: <span class="hljs-variable">$TAG</span>&quot;</span><br>    UBUNTU_VERSION=<span class="hljs-variable">$TAG</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># è‡ªåŠ¨æ£€æµ‹æ¶æ„</span><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>/usr/bin/file&quot;</span> ]; <span class="hljs-keyword">then</span><br>    ARCH=$(file -bL <span class="hljs-variable">$ROOTFS_DIR</span>/bin/bash | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>)<br><span class="hljs-keyword">else</span><br>    ARCH=<span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ£€æµ‹åˆ°æ¶æ„: <span class="hljs-variable">$ARCH</span>&quot;</span><br><br><span class="hljs-comment"># å¯¼å…¥ä¸´æ—¶ Docker é•œåƒ</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;</span><br>sudo tar -C <span class="hljs-variable">$ROOTFS_DIR</span> -c . | docker import - <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span><br><br><span class="hljs-comment"># FULL æ¨¡å¼å®‰è£…å¸¸ç”¨å·¥å…·</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$MODE</span>&quot;</span> = <span class="hljs-string">&quot;--full&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£…å¸¸ç”¨å·¥å…·...&quot;</span><br>    <span class="hljs-built_in">cat</span> &gt; Dockerfile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION</span><br><span class="hljs-string">ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai</span><br><span class="hljs-string">RUN dpkg --add-architecture $ARCH || true</span><br><span class="hljs-string">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class="hljs-string">    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\</span><br><span class="hljs-string">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="hljs-string">CMD [&quot;/bin/bash&quot;]</span><br><span class="hljs-string">EOF</span><br><br>    docker build -t <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span> .<br>    <span class="hljs-built_in">rm</span> -f Dockerfile<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä¸å®‰è£…é¢å¤–å·¥å…·&quot;</span><br>    docker tag <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span> <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ¸…ç†ä¸´æ—¶é•œåƒ</span><br>docker rmi <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span> &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;è¿è¡Œç¤ºä¾‹: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span> /bin/bash&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¼“å­˜ rootfs è·¯å¾„: <span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ä½¿ç”¨ tar æ„å»º FULL æ¨¡å¼<br><br>./offline-ubuntu-docker-auto-v4<span class="hljs-selector-class">.sh</span> ubuntu-<span class="hljs-number">20.04</span>-core-rootfs<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> tar <span class="hljs-number">20.04</span> <span class="hljs-attr">--full</span> my-ubuntu<br><br><br>ä½¿ç”¨ ISO æ„å»º MINIMAL æ¨¡å¼<br><br>./offline-ubuntu-docker-auto-v4<span class="hljs-selector-class">.sh</span> ubuntu-<span class="hljs-number">22.04</span>-live-server-amd64<span class="hljs-selector-class">.iso</span> iso <span class="hljs-number">22.04</span> <span class="hljs-attr">--minimal</span> my-ubuntu<br><br><br>è¿è¡Œå®¹å™¨<br><br>docker run -it my-ubuntu:<span class="hljs-number">20.04</span> /bin/bash<br><br></code></pre></td></tr></table></figure><p>æ–°å¢åŠŸèƒ½</p><ul><li><strong>æœ¬æœºç¼“å­˜ç®¡ç†</strong>ï¼š<code>$HOME/.offline-ubuntu-cache</code></li><li>è‡ªåŠ¨æ¸…ç† <strong>è¶…è¿‡ 30 å¤©çš„æ—§ rootfs</strong></li><li>ä¸‹æ¬¡æ„å»ºåŒç‰ˆæœ¬ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œé€Ÿåº¦æå¿«</li><li>FULL æ¨¡å¼è‡ªåŠ¨å®‰è£…å·¥å…·ï¼Œå¹¶æ”¯æŒè‡ªåŠ¨æ£€æµ‹æ¶æ„</li></ul><h4 id="æ”¹è¿›3">æ”¹è¿›3</h4><p>æ‰§è¡Œä¸Šè¿°è„šæœ¬ å‡ºç° â€œcontainer_linux.go:247: starting container processcaused "exec: "/bin/sh": stat /bin/sh: no such file or directory" ociruntime error: container_linux.go:247: starting container process caused"exec: "/bin/sh": stat /bin/sh: no such file or directory"â€ é”™è¯¯ã€‚</p><p>è¯´æ˜ <strong>Docker å®¹å™¨é‡Œæ²¡æœ‰ <code>/bin/sh</code>æˆ–è€…è·¯å¾„ä¸å¯¹</strong>ã€‚å¸¸è§åŸå› å’Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>1.<strong>rootfs æˆ– ISO ä¸æ˜¯å®Œæ•´çš„ Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿ</strong></p><ul><li>æœ‰äº› ISOï¼ˆæ¯”å¦‚ LiveISOï¼‰é‡Œé¢çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸æ˜¯æ ‡å‡†è·¯å¾„ï¼Œæˆ–è€…æ˜¯åªè¯»å‹ç¼©ç³»ç»Ÿï¼ˆsquashfsï¼‰æœªæ­£ç¡®è§£å‹ã€‚</li><li>å¯¼å…¥ Docker å <code>/bin/sh</code>å¯èƒ½ä¸å­˜åœ¨ï¼Œå¯¼è‡´å®¹å™¨æ— æ³•å¯åŠ¨ã€‚</li></ul><p>2.<strong>è§£å‹æˆ–å¯¼å…¥è¿‡ç¨‹å‡ºé”™</strong></p><ul><li>å¯èƒ½ä½ å¯¼å…¥äº†éƒ¨åˆ†æ–‡ä»¶å¤¹ï¼Œç¼ºå°‘ <code>/bin/bash</code> æˆ–<code>/bin/sh</code>ã€‚</li><li>ä½¿ç”¨ tar å¯¼å…¥æ—¶ï¼Œéœ€è¦ç¡®ä¿ <code>tar -C &lt;dir&gt; -c .</code>çš„è·¯å¾„æ˜¯ <strong>å®Œæ•´ rootfs</strong> æ ¹ç›®å½•ã€‚</li></ul><p>3.<strong>æ¶æ„ä¸åŒ¹é…</strong></p><ul><li>æ¯”å¦‚ä½ å¯¼å…¥äº† <code>arm64</code> rootfsï¼Œåœ¨ x86_64 Dockerä¸Šè¿è¡Œï¼Œå®¹å™¨æ— æ³•å¯åŠ¨ã€‚</li></ul><p>æŠŠè„šæœ¬å‡çº§ï¼Œä¿è¯å¯¼å…¥ Docker çš„ rootfs <strong>ä¸€å®šåŒ…å«<code>/bin/bash</code> æˆ– <code>/bin/sh</code></strong>ï¼Œå¹¶åœ¨ FULLæ¨¡å¼ä¸‹è‡ªåŠ¨éªŒè¯æ¶æ„å’Œ shellã€‚</p><p>åŒæ—¶ï¼Œå¦‚æœ shell ä¸å­˜åœ¨ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æç¤ºå¹¶åœæ­¢ï¼Œé¿å…å®¹å™¨å¯åŠ¨å¤±è´¥ã€‚</p><p>offline-ubuntu-docker-safe.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆä¿è¯ /bin/sh æˆ– /bin/bash å­˜åœ¨ï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬/æ¶æ„ï¼ŒFULL æ¨¡å¼å®‰è£…å·¥å…·ï¼Œæœ¬æœºç¼“å­˜ç®¡ç†</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  ./offline-ubuntu-docker-safe.sh &lt;<span class="hljs-built_in">source</span>&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;tag&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><br>SOURCE_FILE=$1<br>TYPE=$2<br>TAG=$&#123;3:-latest&#125;<br>MODE=$&#123;4:---full&#125;<br>IMAGE_NAME=$&#123;5:-my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$TAG&quot;<br>CACHE_MAX_DAYS=30   # è‡ªåŠ¨æ¸…ç†è¶…è¿‡30å¤©çš„ç¼“å­˜<br><br>if [ -z &quot;$SOURCE_FILE&quot; ] || [ -z &quot;$TYPE&quot; ]; then<br>    echo &quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;<br>    exit 1<br>fi<br><br>mkdir -p $CACHE_DIR<br><br>echo &quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æºæ–‡ä»¶       : $SOURCE_FILE&quot;<br>echo &quot;ç±»å‹         : $TYPE&quot;<br>echo &quot;Docker Tag   : $TAG&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå       : $IMAGE_NAME&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find $CACHE_DIR -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +$CACHE_MAX_DAYS -exec rm -rf &#123;&#125; \;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç¼“å­˜</span><br>if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>    echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>else<br>    rm -rf $ROOTFS_DIR<br>    mkdir -p $ROOTFS_DIR<br><br>    # æå– rootfs<br>    if [ &quot;$TYPE&quot; = &quot;tar&quot; ]; then<br>        echo &quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;<br>        sudo tar -C $ROOTFS_DIR -xf $SOURCE_FILE<br>    elif [ &quot;$TYPE&quot; = &quot;iso&quot; ]; then<br>        echo &quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;<br>        MOUNT_DIR=&quot;$CACHE_DIR/iso-mount-$TAG&quot;<br>        mkdir -p $MOUNT_DIR<br>        sudo mount -o loop $SOURCE_FILE $MOUNT_DIR<br>        if [ ! -f &quot;$MOUNT_DIR/casper/filesystem.squashfs&quot; ]; then<br>            echo &quot;âŒ ISO ä¸­æœªæ‰¾åˆ° casper/filesystem.squashfs&quot;<br>            exit 1<br>        fi<br>        sudo unsquashfs -d $ROOTFS_DIR $MOUNT_DIR/casper/filesystem.squashfs<br>        sudo umount $MOUNT_DIR<br>        rm -rf $MOUNT_DIR<br>    else<br>        echo &quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;<br>        exit 1<br>    fi<br>    echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹ Ubuntu ç‰ˆæœ¬</span><br>if [ -f &quot;$ROOTFS_DIR/etc/os-release&quot; ]; then<br>    UBUNTU_VERSION=$(grep &#x27;VERSION_ID=&#x27; $ROOTFS_DIR/etc/os-release | cut -d &#x27;&quot;&#x27; -f2)<br>    echo &quot;ğŸ‘‰ æ£€æµ‹åˆ° Ubuntu ç‰ˆæœ¬: $UBUNTU_VERSION&quot;<br>else<br>    echo &quot;âš ï¸ æ— æ³•æ£€æµ‹ Ubuntu ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤ tag: $TAG&quot;<br>    UBUNTU_VERSION=$TAG<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹æ¶æ„</span><br>if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>    ARCH=$(file -bL $ROOTFS_DIR/bin/bash | awk &#x27;&#123;print $2&#125;&#x27;)<br>elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>    ARCH=$(file -bL $ROOTFS_DIR/bin/sh | awk &#x27;&#123;print $2&#125;&#x27;)<br>else<br>    echo &quot;âŒ rootfs ç¼ºå°‘ /bin/sh æˆ– /bin/bashï¼Œæ— æ³•æ„å»º Docker é•œåƒï¼&quot;<br>    exit 1<br>fi<br>echo &quot;ğŸ‘‰ æ£€æµ‹åˆ°æ¶æ„: $ARCH&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ä¸´æ—¶ Docker é•œåƒ</span><br>echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼å®‰è£…å¸¸ç”¨å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£…å¸¸ç”¨å·¥å…·...&quot;<br>    cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN dpkg --add-architecture $ARCH || true<br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [&quot;/bin/bash&quot;]<br>EOF<br><br>    docker build -t $IMAGE_NAME:$UBUNTU_VERSION .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä¸å®‰è£…é¢å¤–å·¥å…·&quot;<br>    docker tag $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION $IMAGE_NAME:$UBUNTU_VERSION<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†ä¸´æ—¶é•œåƒ</span><br>docker rmi $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $IMAGE_NAME:$UBUNTU_VERSION /bin/bash&quot;<br>echo &quot;ç¼“å­˜ rootfs è·¯å¾„: $ROOTFS_DIR&quot;<br><br></code></pre></td></tr></table></figure><p><strong>ç¡®ä¿ <code>/bin/bash</code> æˆ– <code>/bin/sh</code>å­˜åœ¨</strong></p><ul><li>å¦‚æœç¼ºå¤±ï¼Œæ„å»ºä¼šåœæ­¢å¹¶æç¤ºé”™è¯¯ã€‚</li></ul><p><strong>è‡ªåŠ¨æ£€æµ‹ Ubuntu ç‰ˆæœ¬ä¸æ¶æ„</strong></p><ul><li>FULL æ¨¡å¼è‡ªåŠ¨å®‰è£…å·¥å…·æ—¶ä¼šè€ƒè™‘æ¶æ„ã€‚</li></ul><p><strong>æœ¬æœºç¼“å­˜ç®¡ç†</strong></p><ul><li><code>$HOME/.offline-ubuntu-cache</code> ä¿å­˜ rootfs</li><li>è‡ªåŠ¨æ¸…ç†è¶…è¿‡ 30 å¤©çš„ç¼“å­˜</li></ul><p><strong>æ”¯æŒ tar / ISO</strong></p><ul><li>ISO ä¼šè§£å‹ squashfs åˆ°å®Œæ•´ rootfs</li></ul><p><strong>FULL / MINIMAL æ¨¡å¼</strong></p><ul><li>FULL æ¨¡å¼è‡ªåŠ¨å®‰è£… vimã€curlã€wgetã€ping ç­‰å¸¸ç”¨å·¥å…·</li><li>MINIMAL æ¨¡å¼ä¿æŒå¹²å‡€ rootfs</li></ul><h4 id="æ”¹è¿›4">æ”¹è¿›4</h4><p>å®ç° <strong>ç›´æ¥ä½¿ç”¨ Ubuntu Live ISO ä¸€é”®ç”Ÿæˆ Dockeré•œåƒ</strong>ï¼Œæ— éœ€ debootstrapï¼Œè‡ªåŠ¨å¤„ç† squashfs å¹¶ä¿è¯<code>/bin/bash</code> æˆ– <code>/bin/sh</code> å­˜åœ¨ã€‚</p><p>offline-ubuntu-docker-liveiso.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆæ”¯æŒ Live ISO ä¸€é”®æ„å»ºï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬/æ¶æ„ï¼ŒFULL æ¨¡å¼å®‰è£…å·¥å…·ï¼Œæœ¬æœºç¼“å­˜ç®¡ç†</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  ./offline-ubuntu-docker-liveiso.sh &lt;<span class="hljs-built_in">source</span>&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;tag&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">source</span>    : rootfs tar æ–‡ä»¶è·¯å¾„ æˆ– ISO æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">type</span>      : tar æˆ– iso</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  tag       : Docker é•œåƒ tag (å¦‚ 20.04)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  mode      : --minimal æˆ– --full</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  imagename : Docker é•œåƒå (é»˜è®¤ my-ubuntu)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><br>SOURCE_FILE=$1<br>TYPE=$2<br>TAG=$&#123;3:-latest&#125;<br>MODE=$&#123;4:---full&#125;<br>IMAGE_NAME=$&#123;5:-my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$TAG&quot;<br>CACHE_MAX_DAYS=30<br><br>if [ -z &quot;$SOURCE_FILE&quot; ] || [ -z &quot;$TYPE&quot; ]; then<br>    echo &quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;<br>    exit 1<br>fi<br><br>mkdir -p $CACHE_DIR<br><br>echo &quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æºæ–‡ä»¶       : $SOURCE_FILE&quot;<br>echo &quot;ç±»å‹         : $TYPE&quot;<br>echo &quot;Docker Tag   : $TAG&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå       : $IMAGE_NAME&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find $CACHE_DIR -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +$CACHE_MAX_DAYS -exec rm -rf &#123;&#125; \;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç¼“å­˜</span><br>if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>    echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>else<br>    rm -rf $ROOTFS_DIR<br>    mkdir -p $ROOTFS_DIR<br><br>    if [ &quot;$TYPE&quot; = &quot;tar&quot; ]; then<br>        echo &quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;<br>        sudo tar -C $ROOTFS_DIR -xf $SOURCE_FILE<br>    elif [ &quot;$TYPE&quot; = &quot;iso&quot; ]; then<br>        echo &quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;<br>        MOUNT_DIR=&quot;$CACHE_DIR/iso-mount-$TAG&quot;<br>        mkdir -p $MOUNT_DIR<br>        sudo mount -o loop $SOURCE_FILE $MOUNT_DIR<br><br>        # æ£€æŸ¥ squashfs<br>        SQUASHFS_PATH=$(find $MOUNT_DIR -name &quot;filesystem.squashfs&quot; | head -n1)<br>        if [ -z &quot;$SQUASHFS_PATH&quot; ]; then<br>            echo &quot;âŒ ISO ä¸­æœªæ‰¾åˆ° filesystem.squashfs&quot;<br>            exit 1<br>        fi<br><br>        echo &quot;ğŸ‘‰ è§£å‹ squashfs åˆ° rootfs...&quot;<br>        sudo unsquashfs -d $ROOTFS_DIR $SQUASHFS_PATH<br>        sudo umount $MOUNT_DIR<br>        rm -rf $MOUNT_DIR<br>    else<br>        echo &quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;<br>        exit 1<br>    fi<br>    echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ shell</span><br>if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>    SHELL_PATH=&quot;/bin/bash&quot;<br>elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>else<br>    echo &quot;âŒ rootfs ç¼ºå°‘ /bin/sh æˆ– /bin/bashï¼Œæ— æ³•æ„å»º Docker é•œåƒï¼&quot;<br>    exit 1<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æµ‹ Ubuntu ç‰ˆæœ¬</span><br>if [ -f &quot;$ROOTFS_DIR/etc/os-release&quot; ]; then<br>    UBUNTU_VERSION=$(grep &#x27;VERSION_ID=&#x27; $ROOTFS_DIR/etc/os-release | cut -d &#x27;&quot;&#x27; -f2)<br>    echo &quot;ğŸ‘‰ æ£€æµ‹åˆ° Ubuntu ç‰ˆæœ¬: $UBUNTU_VERSION&quot;<br>else<br>    echo &quot;âš ï¸ æ— æ³•æ£€æµ‹ Ubuntu ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤ tag: $TAG&quot;<br>    UBUNTU_VERSION=$TAG<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹æ¶æ„</span><br>ARCH=$(file -bL $ROOTFS_DIR$SHELL_PATH | awk &#x27;&#123;print $2&#125;&#x27;)<br>echo &quot;ğŸ‘‰ æ£€æµ‹åˆ°æ¶æ„: $ARCH&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼å®‰è£…å¸¸ç”¨å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£…å¸¸ç”¨å·¥å…·...&quot;<br>    cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN dpkg --add-architecture $ARCH || true<br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [&quot;$SHELL_PATH&quot;]<br>EOF<br><br>    docker build -t $IMAGE_NAME:$UBUNTU_VERSION .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä¸å®‰è£…é¢å¤–å·¥å…·&quot;<br>    docker tag $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION $IMAGE_NAME:$UBUNTU_VERSION<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†ä¸´æ—¶é•œåƒ</span><br>docker rmi $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $IMAGE_NAME:$UBUNTU_VERSION $SHELL_PATH&quot;<br>echo &quot;ç¼“å­˜ rootfs è·¯å¾„: $ROOTFS_DIR&quot;<br><br></code></pre></td></tr></table></figure><ol type="1"><li><strong>ç›´æ¥æ”¯æŒ Live ISO</strong>ï¼Œæ— éœ€ debootstrap</li><li><strong>è‡ªåŠ¨è§£å‹ squashfs</strong>ï¼Œç”Ÿæˆå®Œæ•´ rootfs</li><li><strong>è‡ªåŠ¨æ£€æµ‹ shell</strong> (<code>/bin/bash</code> æˆ–<code>/bin/sh</code>)</li><li><strong>è‡ªåŠ¨æ£€æµ‹ Ubuntu ç‰ˆæœ¬å’Œæ¶æ„</strong></li><li><strong>FULL / MINIMAL æ¨¡å¼</strong></li><li><strong>æœ¬æœºç¼“å­˜ç®¡ç†</strong>ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜</li></ol><p>ğŸ”¹ ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># FULL æ¨¡å¼æ„å»º ISO</span><br>./offline-ubuntu-docker-liveiso.sh ubuntu<span class="hljs-number">-22.04</span>-live-server-amd64.iso iso <span class="hljs-number">22.04</span> <span class="hljs-comment">--full my-ubuntu</span><br><br><span class="hljs-comment"># MINIMAL æ¨¡å¼æ„å»º tar</span><br>./offline-ubuntu-docker-liveiso.sh ubuntu<span class="hljs-number">-20.04</span>-core-rootfs.tar.gz tar <span class="hljs-number">20.04</span> <span class="hljs-comment">--minimal my-ubuntu</span><br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">22.04</span> /bin/bash<br></code></pre></td></tr></table></figure><hr /><p>è¿™ä¸ªè„šæœ¬å¯ä»¥ä¿è¯ <strong>å®¹å™¨ä¸€å®šæœ‰å¯ç”¨ shell</strong>ï¼ŒLive ISOä¹Ÿèƒ½ç›´æ¥æ„å»º Docker é•œåƒï¼Œæ— éœ€é¢å¤–ç½‘ç»œæˆ– debootstrapã€‚</p><h4 id="æ”¹è¿›5">æ”¹è¿›5</h4><p>å®˜ç½‘åªæœ‰ ubuntu-focal-core-cloudimg-amd64-root.tar.gz æ²¡æœ‰ubuntu-20.04-core-rootfs.tar.gzã€‚æŠŠè„šæœ¬æ”¹æˆ <strong>ç›´æ¥å…¼å®¹å®˜æ–¹ cloudimage å‘½å</strong>ï¼Œä¸ç”¨æ”¹åå­—å°±èƒ½ç›´æ¥æ„å»º Docker é•œåƒï¼ŒåŒæ—¶ä¿ç•™ LiveISO æ”¯æŒå’Œ shell æ£€æµ‹åŠŸèƒ½ã€‚</p><p>offline-ubuntu-docker-auto-cloud.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆå…¼å®¹ cloud image å‘½åï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬/æ¶æ„ï¼ŒFULL æ¨¡å¼å®‰è£…å·¥å…·ï¼Œæœ¬æœºç¼“å­˜ç®¡ç†</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  ./offline-ubuntu-docker-auto-cloud.sh &lt;<span class="hljs-built_in">source</span>&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">source</span>    : rootfs tar æ–‡ä»¶è·¯å¾„ æˆ– ISO æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">type</span>      : tar æˆ– iso</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  mode      : --minimal æˆ– --full</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  imagename : Docker é•œåƒå (é»˜è®¤ my-ubuntu)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================</span><br><br>SOURCE_FILE=$1<br>TYPE=$2<br>MODE=$&#123;3:---full&#125;<br>IMAGE_NAME=$&#123;4:-my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>CACHE_MAX_DAYS=30<br><br>if [ -z &quot;$SOURCE_FILE&quot; ] || [ -z &quot;$TYPE&quot; ]; then<br>    echo &quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;<br>    exit 1<br>fi<br><br>mkdir -p $CACHE_DIR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨è§£æç‰ˆæœ¬å·</span><br>BASENAME=$(basename &quot;$SOURCE_FILE&quot;)<br>if [[ &quot;$BASENAME&quot; =~ ubuntu-([a-z]+)-core ]]; then<br>    UBUNTU_CODENAME=&quot;$&#123;BASH_REMATCH[1]&#125;&quot;<br>    case &quot;$UBUNTU_CODENAME&quot; in<br>        focal) UBUNTU_VERSION=&quot;20.04&quot; ;;<br>        jammy) UBUNTU_VERSION=&quot;22.04&quot; ;;<br>        bionic) UBUNTU_VERSION=&quot;18.04&quot; ;;<br>        *) UBUNTU_VERSION=&quot;latest&quot; ;;<br>    esac<br>else<br>    UBUNTU_VERSION=&quot;latest&quot;<br>fi<br><br>ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$UBUNTU_VERSION&quot;<br><br>echo &quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æºæ–‡ä»¶       : $SOURCE_FILE&quot;<br>echo &quot;ç±»å‹         : $TYPE&quot;<br>echo &quot;Docker Tag   : $UBUNTU_VERSION&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå       : $IMAGE_NAME&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find $CACHE_DIR -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +$CACHE_MAX_DAYS -exec rm -rf &#123;&#125; \;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç¼“å­˜</span><br>if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>    echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>else<br>    rm -rf $ROOTFS_DIR<br>    mkdir -p $ROOTFS_DIR<br><br>    if [ &quot;$TYPE&quot; = &quot;tar&quot; ]; then<br>        echo &quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;<br>        sudo tar -C $ROOTFS_DIR -xf $SOURCE_FILE<br>    elif [ &quot;$TYPE&quot; = &quot;iso&quot; ]; then<br>        echo &quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;<br>        MOUNT_DIR=&quot;$CACHE_DIR/iso-mount-$UBUNTU_VERSION&quot;<br>        mkdir -p $MOUNT_DIR<br>        sudo mount -o loop $SOURCE_FILE $MOUNT_DIR<br><br>        SQUASHFS_PATH=$(find $MOUNT_DIR -name &quot;filesystem.squashfs&quot; | head -n1)<br>        if [ -z &quot;$SQUASHFS_PATH&quot; ]; then<br>            echo &quot;âŒ ISO ä¸­æœªæ‰¾åˆ° filesystem.squashfs&quot;<br>            exit 1<br>        fi<br><br>        echo &quot;ğŸ‘‰ è§£å‹ squashfs åˆ° rootfs...&quot;<br>        sudo unsquashfs -d $ROOTFS_DIR $SQUASHFS_PATH<br>        sudo umount $MOUNT_DIR<br>        rm -rf $MOUNT_DIR<br>    else<br>        echo &quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;<br>        exit 1<br>    fi<br>    echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ shell</span><br>if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>    SHELL_PATH=&quot;/bin/bash&quot;<br>elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>else<br>    echo &quot;âŒ rootfs ç¼ºå°‘ /bin/sh æˆ– /bin/bashï¼Œæ— æ³•æ„å»º Docker é•œåƒï¼&quot;<br>    exit 1<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨æ£€æµ‹æ¶æ„</span><br>ARCH=$(file -bL $ROOTFS_DIR$SHELL_PATH | awk &#x27;&#123;print $2&#125;&#x27;)<br>echo &quot;ğŸ‘‰ æ£€æµ‹åˆ°æ¶æ„: $ARCH&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼å®‰è£…å¸¸ç”¨å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£…å¸¸ç”¨å·¥å…·...&quot;<br>    cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN dpkg --add-architecture $ARCH || true<br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [&quot;$SHELL_PATH&quot;]<br>EOF<br><br>    docker build -t $IMAGE_NAME:$UBUNTU_VERSION .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä¸å®‰è£…é¢å¤–å·¥å…·&quot;<br>    docker tag $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION $IMAGE_NAME:$UBUNTU_VERSION<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†ä¸´æ—¶é•œåƒ</span><br>docker rmi $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $IMAGE_NAME:$UBUNTU_VERSION $SHELL_PATH&quot;<br>echo &quot;ç¼“å­˜ rootfs è·¯å¾„: $ROOTFS_DIR&quot;<br><br></code></pre></td></tr></table></figure><ol type="1"><li><strong>å…¼å®¹å®˜æ–¹ cloud image tar æ–‡ä»¶å‘½å</strong><ul><li>è‡ªåŠ¨è§£æ focal/jammy/bionic å¹¶æ˜ å°„åˆ° 20.04/22.04/18.04</li></ul></li><li><strong>æ”¯æŒ Live ISO</strong>ï¼Œè‡ªåŠ¨è§£å‹ squashfs</li><li><strong>ç¡®ä¿å®¹å™¨æœ‰å¯ç”¨ shell</strong> (<code>/bin/bash</code> æˆ–<code>/bin/sh</code>)</li><li><strong>FULL / MINIMAL æ¨¡å¼</strong>ï¼Œè‡ªåŠ¨å®‰è£…å·¥å…·</li><li><strong>æœ¬æœºç¼“å­˜ç®¡ç†</strong>ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸ rootfs</li></ol><p>ğŸ”¹ ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># ä½¿ç”¨å®˜æ–¹ cloud image tar æ„å»º FULL é•œåƒ</span><br>./offline-ubuntu-docker-auto-cloud.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--full my-ubuntu</span><br><br><span class="hljs-comment"># ä½¿ç”¨ Live ISO æ„å»º MINIMAL é•œåƒ</span><br>./offline-ubuntu-docker-auto-cloud.sh ubuntu<span class="hljs-number">-22.04</span>-live-server-amd64.iso iso <span class="hljs-comment">--minimal my-ubuntu</span><br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash<br></code></pre></td></tr></table></figure><hr /><p>è¿™ä¸ªè„šæœ¬å¯ä»¥ç›´æ¥å…¼å®¹ <strong>å®˜æ–¹ cloud imageå‘½å</strong>ï¼Œä¸ç”¨æ”¹åå­—å°±èƒ½æ„å»º Docker é•œåƒï¼Œå¹¶æ”¯æŒ ISO ä¸€é”®æ„å»ºã€‚</p><h4 id="æ”¹è¿›6">æ”¹è¿›6</h4><p>æ‰§è¡Œä¸Šé¢çš„è„šæœ¬å‡ºç° offline-ubuntu-docker-auto-cloud.sh: 32:offline-ubuntu-docker-auto-cloud.sh: Syntax error: "(" unexpected(expecting "then")é”™è¯¯ã€‚</p><p>é€šå¸¸ <strong>å‡ºç°åœ¨ <code>/bin/sh</code> æ‰§è¡Œ Bashè„šæœ¬æ—¶</strong>ï¼Œè€Œè„šæœ¬ä½¿ç”¨äº† <strong>Bash ç‰¹æœ‰è¯­æ³•</strong>ï¼ˆå¦‚<code>[[ ... =~ ... ]]</code> æˆ–æ•°ç»„ã€æ‹¬å·æ‰©å±•ï¼‰ã€‚</p><p>åŸå› åˆ†æ</p><ol type="1"><li>ä½ å¯èƒ½ç”¨ <code>sh offline-ubuntu-docker-auto-cloud.sh</code>æ‰§è¡Œï¼Œè€Œä¸æ˜¯ <code>bash</code>ã€‚<ul><li><code>/bin/sh</code> åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šæ˜¯ dashï¼Œä¸æ”¯æŒ<code>[[ ... =~ ... ]]</code> æ­£åˆ™åŒ¹é…è¯­æ³•ã€‚</li></ul></li><li>è„šæœ¬ç¬¬ä¸€è¡Œæ˜¯ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br></code></pre></td></tr></table></figure><ul><li>è¡¨ç¤ºå¿…é¡»ç”¨ <strong>bash</strong> è¿è¡Œã€‚</li></ul><p>è§£å†³æ–¹æ³•</p><p>æ–¹æ³• 1ï¼šç”¨ bash æ‰§è¡Œ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">bash offline-ubuntu-docker-auto-cloud<span class="hljs-selector-class">.sh</span> ubuntu-focal-core-cloudimg-amd64-root<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> tar <span class="hljs-attr">--full</span> my-ubuntu<br></code></pre></td></tr></table></figure><p>æ–¹æ³• 2ï¼šç»™è„šæœ¬å¯æ‰§è¡Œæƒé™å¹¶ç›´æ¥è¿è¡Œ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">chmod +x offline-ubuntu-docker-auto-cloud<span class="hljs-selector-class">.sh</span><br>./offline-ubuntu-docker-auto-cloud<span class="hljs-selector-class">.sh</span> ubuntu-focal-core-cloudimg-amd64-root<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> tar <span class="hljs-attr">--full</span> my-ubuntu<br></code></pre></td></tr></table></figure><p>âœ… è¿™æ ·å°±ä¸ä¼šå‡ºç° <code>Syntax error: "(" unexpected</code>çš„é—®é¢˜ã€‚</p><p>æ³¨æ„</p><ul><li><p><strong>ä¸è¦ç”¨ <code>sh script.sh</code></strong>ï¼Œå› ä¸º<code>/bin/sh</code> ä¸åŒäº bashï¼Œå¾ˆå¤šè¯­æ³•ä¸å…¼å®¹ã€‚</p></li><li><p>è„šæœ¬é‡Œç”¨åˆ°äº†ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-string">[[ &quot;$BASENAME&quot; =~ ubuntu-([a-z]+)-core ]]</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ Bash ç‰¹æœ‰æ­£åˆ™åŒ¹é…è¯­æ³•ï¼Œå¿…é¡»ç”¨ bashã€‚</p></li></ul><p>å¦‚æœå‡ºç°ï¼Œubuntu-focal-core-cloudimg-amd64-root.tar.gz rootfs ç¼ºå°‘/bin/sh æˆ– /bin/bashï¼Œæ— æ³•æ„å»º Docker é•œåƒï¼å®˜æ–¹çš„<code>ubuntu-focal-core-cloudimg-amd64-root.tar.gz</code><strong>æ˜¯æœ€å°åŒ– rootfs</strong>ï¼Œé‡Œé¢å¯èƒ½åªåŒ…å« <code>/bin/dash</code>æˆ– <code>/usr/bin/sh</code>ï¼Œæ²¡æœ‰ <code>/bin/bash</code>ã€‚minimal rootfsé»˜è®¤åªæœ‰ <code>/bin/sh</code>ï¼ˆdashï¼‰ï¼Œæ²¡æœ‰ bash</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol type="1"><li>ä½¿ç”¨ <code>/bin/sh</code> å¯åŠ¨å®¹å™¨å³å¯</li><li>FULL æ¨¡å¼ä¸‹å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</li></ol><p>è®©å®ƒ <strong>å…¼å®¹ minimal rootfs</strong>ï¼Œè‡ªåŠ¨å¤„ç†<code>/bin/sh</code> æˆ– <code>/bin/bash</code>ï¼š</p><ul><li><strong>å¦‚æœ rootfs æ²¡æœ‰ bash</strong>ï¼ŒCMD å°±ç”¨<code>/bin/sh</code>ï¼Œé¿å…æŠ¥é”™</li><li><strong>FULL æ¨¡å¼</strong> ä¸‹è‡ªåŠ¨å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</li></ul><p>offline-ubuntu-docker-auto-cloud-fixed.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆæ”¯æŒ cloud image minimal rootfsï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼ä¼šå®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ï¼š</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">./offline-ubuntu-docker-auto-cloud-fixed.sh &lt;<span class="hljs-built_in">source</span>&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><br>SOURCE_FILE=$1<br>TYPE=$2<br>MODE=$&#123;3:---full&#125;<br>IMAGE_NAME=$&#123;4:-my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>CACHE_MAX_DAYS=30<br><br>if [ -z &quot;$SOURCE_FILE&quot; ] || [ -z &quot;$TYPE&quot; ]; then<br>    echo &quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;<br>    exit 1<br>fi<br><br>mkdir -p $CACHE_DIR<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨è§£æç‰ˆæœ¬å·</span><br>BASENAME=$(basename &quot;$SOURCE_FILE&quot;)<br>if [[ &quot;$BASENAME&quot; =~ ubuntu-([a-z]+)-core ]]; then<br>    UBUNTU_CODENAME=&quot;$&#123;BASH_REMATCH[1]&#125;&quot;<br>    case &quot;$UBUNTU_CODENAME&quot; in<br>        focal) UBUNTU_VERSION=&quot;20.04&quot; ;;<br>        jammy) UBUNTU_VERSION=&quot;22.04&quot; ;;<br>        bionic) UBUNTU_VERSION=&quot;18.04&quot; ;;<br>        *) UBUNTU_VERSION=&quot;latest&quot; ;;<br>    esac<br>else<br>    UBUNTU_VERSION=&quot;latest&quot;<br>fi<br><br>ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$UBUNTU_VERSION&quot;<br><br>echo &quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æºæ–‡ä»¶       : $SOURCE_FILE&quot;<br>echo &quot;ç±»å‹         : $TYPE&quot;<br>echo &quot;Docker Tag   : $UBUNTU_VERSION&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå       : $IMAGE_NAME&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find $CACHE_DIR -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +$CACHE_MAX_DAYS -exec rm -rf &#123;&#125; \;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç¼“å­˜</span><br>if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>    echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>else<br>    rm -rf $ROOTFS_DIR<br>    mkdir -p $ROOTFS_DIR<br><br>    if [ &quot;$TYPE&quot; = &quot;tar&quot; ]; then<br>        echo &quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;<br>        sudo tar -C $ROOTFS_DIR -xf $SOURCE_FILE<br>    elif [ &quot;$TYPE&quot; = &quot;iso&quot; ]; then<br>        echo &quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;<br>        MOUNT_DIR=&quot;$CACHE_DIR/iso-mount-$UBUNTU_VERSION&quot;<br>        mkdir -p $MOUNT_DIR<br>        sudo mount -o loop $SOURCE_FILE $MOUNT_DIR<br><br>        SQUASHFS_PATH=$(find $MOUNT_DIR -name &quot;filesystem.squashfs&quot; | head -n1)<br>        if [ -z &quot;$SQUASHFS_PATH&quot; ]; then<br>            echo &quot;âŒ ISO ä¸­æœªæ‰¾åˆ° filesystem.squashfs&quot;<br>            exit 1<br>        fi<br><br>        echo &quot;ğŸ‘‰ è§£å‹ squashfs åˆ° rootfs...&quot;<br>        sudo unsquashfs -d $ROOTFS_DIR $SQUASHFS_PATH<br>        sudo umount $MOUNT_DIR<br>        rm -rf $MOUNT_DIR<br>    else<br>        echo &quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;<br>        exit 1<br>    fi<br>    echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ shell</span><br>if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>    SHELL_PATH=&quot;/bin/bash&quot;<br>elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>else<br>    echo &quot;âš ï¸ rootfs æ²¡æœ‰ shellï¼Œä½¿ç”¨ dash ä»£æ›¿&quot;<br>    SHELL_PATH=&quot;/bin/dash&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æµ‹æ¶æ„</span><br>ARCH=$(file -bL $ROOTFS_DIR$SHELL_PATH | awk &#x27;&#123;print $2&#125;&#x27;)<br>echo &quot;ğŸ‘‰ æ£€æµ‹åˆ°æ¶æ„: $ARCH&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;<br>sudo tar -C $ROOTFS_DIR -c . | docker import - $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼å®‰è£…å¸¸ç”¨å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·...&quot;<br>    cat &gt; Dockerfile &lt;&lt;EOF<br>FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN apt-get update &amp;&amp; apt-get install -y \\<br>    bash vim curl wget net-tools iputils-ping less lsb-release ca-certificates \\<br>    &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [&quot;/bin/bash&quot;]<br>EOF<br><br>    docker build -t $IMAGE_NAME:$UBUNTU_VERSION .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä¸å®‰è£…é¢å¤–å·¥å…·ï¼Œä½¿ç”¨ $SHELL_PATH&quot;<br>    docker tag $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION $IMAGE_NAME:$UBUNTU_VERSION<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†ä¸´æ—¶é•œåƒ</span><br>docker rmi $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $IMAGE_NAME:$UBUNTU_VERSION $SHELL_PATH&quot;<br>echo &quot;ç¼“å­˜ rootfs è·¯å¾„: $ROOTFS_DIR&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¯´æ˜</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># FULL æ¨¡å¼ï¼ˆå®‰è£… bash å’Œå·¥å…·ï¼‰</span><br>./offline-ubuntu-docker-auto-cloud-fixed.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--full my-ubuntu</span><br><br><span class="hljs-comment"># MINIMAL æ¨¡å¼ï¼ˆä¿ç•™ minimal rootfsï¼‰</span><br>./offline-ubuntu-docker-auto-cloud-fixed.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--minimal my-ubuntu</span><br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash   <span class="hljs-comment"># FULL æ¨¡å¼</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/sh     <span class="hljs-comment"># MINIMAL æ¨¡å¼</span><br><br></code></pre></td></tr></table></figure><h4 id="æ”¹è¿›7">æ”¹è¿›7</h4><p>æ‰§è¡Œä¸Šé¢çš„è„šæœ¬å‡ºç°é”™è¯¯ ./offline-ubuntu-docker-auto-cloud-fixed.sh:25: ./offline-ubuntu-docker-auto-cloud-fixed.sh: Syntax error: "("unexpected (expecting "then")</p><p>å’Œä¹‹å‰æåˆ°çš„åŸå› å®Œå…¨ä¸€æ ·ï¼šç³»ç»Ÿåœ¨ <strong>ç”¨ <code>/bin/sh</code>æ‰§è¡Œè„šæœ¬</strong>ï¼Œè€Œè„šæœ¬ä½¿ç”¨äº† <strong>Bash ç‰¹æœ‰è¯­æ³•</strong>ï¼ˆå¦‚<code>[[ ... =~ ... ]]</code> çš„æ­£åˆ™åŒ¹é…ï¼‰ã€‚</p><p>åœ¨ä½ çš„è„šæœ¬é‡Œï¼Œå‡ºé”™çš„ä½ç½®æ˜¯ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> <span class="hljs-string">[[ &quot;$BASENAME&quot; =~ ubuntu-([a-z]+)-core ]]</span>; <span class="hljs-keyword">then</span><br></code></pre></td></tr></table></figure><ul><li><code>[[ ... =~ ... ]]</code> æ˜¯ <strong>bash</strong> ä¸“ç”¨</li><li><code>/bin/sh</code>ï¼ˆdashï¼‰ä¸æ”¯æŒè¿™ä¸ªè¯­æ³•ï¼Œä¼šæŠ¥<code>Syntax error: "(" unexpected</code></li></ul><p><strong>è§£å†³æ–¹æ³•</strong></p><p>1ï¸âƒ£ <strong>ç”¨ bash æ‰§è¡Œ</strong></p><p>ä¸è¦ç”¨ <code>sh script.sh</code>ï¼Œä¸€å®šè¦ç”¨ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">bash offline-ubuntu-docker-auto-cloud-fixed<span class="hljs-selector-class">.sh</span> ubuntu-focal-core-cloudimg-amd64-root<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> tar <span class="hljs-attr">--full</span> my-ubuntu<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">chmod +x offline-ubuntu-docker-auto-cloud-fixed<span class="hljs-selector-class">.sh</span><br>./offline-ubuntu-docker-auto-cloud-fixed<span class="hljs-selector-class">.sh</span> ubuntu-focal-core-cloudimg-amd64-root<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> tar <span class="hljs-attr">--full</span> my-ubuntu<br></code></pre></td></tr></table></figure><blockquote><p>è¿™æ · <code>/bin/bash</code> ä¼šæ‰§è¡Œè„šæœ¬ï¼Œ<code>[[ ... =~ ... ]]</code>å°±å¯ä»¥å·¥ä½œã€‚</p></blockquote><p>2ï¸âƒ£ <strong>ä¿®æ”¹è„šæœ¬å…¼å®¹ shï¼ˆå¯é€‰ï¼‰</strong></p><p>å¦‚æœä½ å¸Œæœ›è„šæœ¬å®Œå…¨å…¼å®¹ <code>/bin/sh</code>ï¼Œéœ€è¦æŠŠï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> <span class="hljs-string">[[ &quot;$BASENAME&quot; =~ ubuntu-([a-z]+)-core ]]</span>; <span class="hljs-keyword">then</span><br>    UBUNTU_CODENAME=<span class="hljs-string">&quot;$&#123;BASH_REMATCH[1]&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>æ”¹æˆ POSIX sh å…¼å®¹å†™æ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">UBUNTU_CODENAME</span>=$(echo <span class="hljs-string">&quot;<span class="hljs-variable">$BASENAME</span>&quot;</span> | sed -n <span class="hljs-string">&#x27;s/ubuntu-\([a-z]\+\)-core.*/\1/p&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç„¶åæ ¹æ® UBUNTU_CODENAME è®¾ç½® UBUNTU_VERSIONã€‚</p><p>è¿™ç§æ–¹å¼å®Œå…¨å…¼å®¹<code>/bin/sh</code>ï¼Œä¸ä¼šå†æŠ¥è¯­æ³•é”™è¯¯ï¼Œä½†è„šæœ¬è¯­æ³•ä¼šæ›´å†—é•¿ã€‚</p><hr /><p>ğŸ’¡ <strong>æ¨èåšæ³•</strong>ï¼š</p><ul><li>è„šæœ¬å¼€å¤´å£°æ˜ <code>#!/bin/bash</code></li><li>æ‰§è¡Œæ—¶ä¸€å®šç”¨ <code>bash script.sh</code> æˆ–<code>./script.sh</code></li><li>ä¸è¦ç”¨ <code>sh script.sh</code>ï¼Œå¦åˆ™ minimal cloud imageçš„æ„å»ºå’Œæ­£åˆ™åŒ¹é…éƒ½ä¼šæŠ¥é”™</li></ul><p>æ”¹å†™ä¸€ç‰ˆ <strong>å®Œå…¨å…¼å®¹ <code>/bin/sh</code> çš„ç¦»çº¿ Ubuntu Dockeræ„å»ºè„šæœ¬</strong>ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><strong>ä¸ä¾èµ– Bash</strong>ï¼Œå¯ç”¨ <code>sh script.sh</code>ç›´æ¥è¿è¡Œ</li><li><strong>å…¼å®¹å®˜æ–¹ cloud image minimal rootfs</strong></li><li><strong>FULL æ¨¡å¼è‡ªåŠ¨å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</strong></li><li><strong>MINIMAL æ¨¡å¼ç›´æ¥ä½¿ç”¨ <code>/bin/sh</code> æˆ–<code>/bin/dash</code></strong></li><li><strong>æ”¯æŒ tar å’Œ ISO ä¸¤ç§ç±»å‹</strong></li></ul><p>offline-ubuntu-docker-sh.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-comment"># ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼ˆå®Œå…¨å…¼å®¹ shï¼‰</span><br><span class="hljs-comment"># ä½¿ç”¨ï¼š</span><br><span class="hljs-comment"># sh offline-ubuntu-docker-sh.sh &lt;source&gt; &lt;type&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><br>SOURCE_FILE=<span class="hljs-variable">$1</span><br>TYPE=<span class="hljs-variable">$2</span><br>MODE=<span class="hljs-variable">$&#123;3:=--full&#125;</span><br>IMAGE_NAME=<span class="hljs-variable">$&#123;4:=my-ubuntu&#125;</span><br>CACHE_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.offline-ubuntu-cache&quot;</span><br>CACHE_MAX_DAYS=30<br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$SOURCE_FILE</span>&quot;</span> ] || [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>&quot;</span><br><br><span class="hljs-comment"># æå– Ubuntu ç‰ˆæœ¬ï¼ˆsh å…¼å®¹ï¼‰</span><br>BASENAME=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SOURCE_FILE</span>&quot;</span>)<br>UBUNTU_CODENAME=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$BASENAME</span>&quot;</span> | sed -n <span class="hljs-string">&#x27;s/ubuntu-\([a-z]\+\)-core.*/\1/p&#x27;</span>)<br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$UBUNTU_CODENAME</span>&quot;</span> <span class="hljs-keyword">in</span><br>    focal) UBUNTU_VERSION=<span class="hljs-string">&quot;20.04&quot;</span> ;;<br>    jammy) UBUNTU_VERSION=<span class="hljs-string">&quot;22.04&quot;</span> ;;<br>    bionic) UBUNTU_VERSION=<span class="hljs-string">&quot;18.04&quot;</span> ;;<br>    *) UBUNTU_VERSION=<span class="hljs-string">&quot;latest&quot;</span> ;;<br><span class="hljs-keyword">esac</span><br><br>ROOTFS_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>/rootfs-<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æºæ–‡ä»¶       : <span class="hljs-variable">$SOURCE_FILE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç±»å‹         : <span class="hljs-variable">$TYPE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Docker Tag   : <span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ¨¡å¼         : <span class="hljs-variable">$MODE</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é•œåƒå       : <span class="hljs-variable">$IMAGE_NAME</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¼“å­˜ç›®å½•     : <span class="hljs-variable">$CACHE_DIR</span>&quot;</span><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-comment"># æ¸…ç†è¿‡æœŸç¼“å­˜</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ <span class="hljs-variable">$CACHE_MAX_DAYS</span> å¤©çš„ç¼“å­˜...&quot;</span><br>find <span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>&quot;</span> -maxdepth 1 -<span class="hljs-built_in">type</span> d -name <span class="hljs-string">&quot;rootfs-*&quot;</span> -mtime +<span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_MAX_DAYS</span>&quot;</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;<br><br><span class="hljs-comment"># å¯¼å…¥ rootfs</span><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> = <span class="hljs-string">&quot;tar&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;</span><br>        sudo tar -C <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span> -xf <span class="hljs-string">&quot;<span class="hljs-variable">$SOURCE_FILE</span>&quot;</span><br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$TYPE</span>&quot;</span> = <span class="hljs-string">&quot;iso&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;</span><br>        MOUNT_DIR=<span class="hljs-string">&quot;<span class="hljs-variable">$CACHE_DIR</span>/iso-mount-<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br>        <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>&quot;</span><br>        sudo mount -o loop <span class="hljs-string">&quot;<span class="hljs-variable">$SOURCE_FILE</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>&quot;</span><br><br>        SQUASHFS_PATH=$(find <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>&quot;</span> -name <span class="hljs-string">&quot;filesystem.squashfs&quot;</span> | <span class="hljs-built_in">head</span> -n1)<br>        <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$SQUASHFS_PATH</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ ISO ä¸­æœªæ‰¾åˆ° filesystem.squashfs&quot;</span><br>            <span class="hljs-built_in">exit</span> 1<br>        <span class="hljs-keyword">fi</span><br><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ è§£å‹ squashfs åˆ° rootfs...&quot;</span><br>        sudo unsquashfs -d <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SQUASHFS_PATH</span>&quot;</span><br>        sudo umount <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>&quot;</span><br>        <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNT_DIR</span>&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… rootfs å·²ç¼“å­˜åˆ° <span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># æ£€æŸ¥ shell</span><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>/bin/bash&quot;</span> ]; <span class="hljs-keyword">then</span><br>    SHELL_PATH=<span class="hljs-string">&quot;/bin/bash&quot;</span><br><span class="hljs-keyword">elif</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>/bin/sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>    SHELL_PATH=<span class="hljs-string">&quot;/bin/sh&quot;</span><br><span class="hljs-keyword">elif</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>/bin/dash&quot;</span> ]; <span class="hljs-keyword">then</span><br>    SHELL_PATH=<span class="hljs-string">&quot;/bin/dash&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âš ï¸ rootfs æ²¡æœ‰ shellï¼Œä½¿ç”¨ /bin/sh&quot;</span><br>    SHELL_PATH=<span class="hljs-string">&quot;/bin/sh&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;</span><br>sudo tar -C <span class="hljs-string">&quot;<span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span> -c . | docker import - <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br><br><span class="hljs-comment"># FULL æ¨¡å¼å®‰è£…å·¥å…·</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$MODE</span>&quot;</span> = <span class="hljs-string">&quot;--full&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·...&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FROM <span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span></span><br><span class="hljs-string">ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai</span><br><span class="hljs-string">RUN apt-get update &amp;&amp; apt-get install -y bash vim curl wget net-tools iputils-ping less lsb-release ca-certificates &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="hljs-string">CMD [\&quot;/bin/bash\&quot;]&quot;</span> &gt; Dockerfile<br><br>    docker build -t <span class="hljs-string">&quot;<span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span> .<br>    <span class="hljs-built_in">rm</span> -f Dockerfile<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä½¿ç”¨ <span class="hljs-variable">$SHELL_PATH</span>&quot;</span><br>    docker tag <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><br>docker rmi <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;IMAGE_NAME&#125;</span>-base:<span class="hljs-variable">$UBUNTU_VERSION</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1 || <span class="hljs-literal">true</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;è¿è¡Œç¤ºä¾‹: docker run -it <span class="hljs-variable">$IMAGE_NAME</span>:<span class="hljs-variable">$UBUNTU_VERSION</span> <span class="hljs-variable">$SHELL_PATH</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¼“å­˜ rootfs è·¯å¾„: <span class="hljs-variable">$ROOTFS_DIR</span>&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># FULL æ¨¡å¼</span><br>sh offline-ubuntu-docker-sh.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--full my-ubuntu</span><br><br><span class="hljs-comment"># MINIMAL æ¨¡å¼</span><br>sh offline-ubuntu-docker-sh.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--minimal my-ubuntu</span><br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash   <span class="hljs-comment"># FULL æ¨¡å¼</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/sh     <span class="hljs-comment"># MINIMAL æ¨¡å¼</span><br><br></code></pre></td></tr></table></figure><h4 id="æ”¹è¿›8">æ”¹è¿›8</h4><p>container_linux.go:247: starting container process caused "exec:"/bin/sh": stat /bin/sh: no such file or directory" oci runtime error:container_linux.go:247: starting container process caused "exec:"/bin/sh": stat /bin/sh: no such file or directory"</p><p>è¿™è¯´æ˜ <strong>ä½ å¯¼å…¥çš„ rootfs æœ¬èº«æ²¡æœ‰<code>/bin/sh</code></strong>ï¼Œè¿™æ˜¯æœ€å°åŒ– cloud image çš„æ­£å¸¸ç°è±¡ã€‚å®˜æ–¹minimal rootfs é€šå¸¸åªåŒ…å«ï¼š</p><ul><li><code>/bin/dash</code> æˆ– <code>/usr/bin/sh</code></li><li>æ²¡æœ‰ <code>/bin/bash</code></li><li>æœ‰æ—¶ <code>/bin/sh</code> æ˜¯ç¬¦å·é“¾æ¥ï¼Œå¯èƒ½ç¼ºå¤±</li></ul><p>æ‰€ä»¥ç›´æ¥ç”¨ <code>/bin/sh</code> å¯åŠ¨å®¹å™¨ä¼šæŠ¥é”™ã€‚</p><p>ğŸ”¹ è§£å†³æ–¹æ¡ˆ</p><p>æ–¹æ³• 1ï¸âƒ£ ä½¿ç”¨ FULL æ¨¡å¼å®‰è£… bash</p><ol type="1"><li>FULL æ¨¡å¼æ„å»º Docker é•œåƒæ—¶ï¼Œè„šæœ¬ä¼šå®‰è£… bashï¼š</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span><br>apt-<span class="hljs-built_in">get</span> install -<span class="hljs-keyword">y</span> bash <span class="hljs-keyword">vim</span> curl wget net-tools iputils-ping less lsb-release <span class="hljs-keyword">ca</span>-certificates<br></code></pre></td></tr></table></figure><ol type="1"><li>æ„å»ºå®Œæˆåï¼Œå®¹å™¨å¯ä»¥ç›´æ¥ç”¨ <code>/bin/bash</code> å¯åŠ¨ï¼š</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash<br></code></pre></td></tr></table></figure><p>âœ… è¿™æ˜¯æœ€ç®€å•å¯é çš„æ–¹æ³•ã€‚</p><p>æ–¹æ³• 2ï¸âƒ£ æ‰‹åŠ¨æ£€æŸ¥ rootfs å¹¶åˆ›å»º <code>/bin/sh</code> ç¬¦å·é“¾æ¥</p><p>å¦‚æœä½ å¸Œæœ› MINIMAL æ¨¡å¼ä¹Ÿèƒ½ç”¨ <code>/bin/sh</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥ rootfs</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$ROOTFS_DIR</span><br><br><span class="hljs-comment"># æŸ¥çœ‹ç°æœ‰ shell</span><br><span class="hljs-built_in">ls</span> -l bin/ dash sh bash<br><br><span class="hljs-comment"># å¦‚æœåªæœ‰ /bin/dashï¼Œå¯ä»¥åˆ›å»ºç¬¦å·é“¾æ¥</span><br>sudo <span class="hljs-built_in">ln</span> -s dash /bin/sh<br></code></pre></td></tr></table></figure><p>ç„¶åå†å¯¼å…¥ Dockerï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">sudo tar -C <span class="hljs-string">&quot;<span class="hljs-subst">$ROOTFS_DIR</span>&quot;</span> -c . | docker <span class="hljs-keyword">import</span> - my-ubuntu:minimal<br></code></pre></td></tr></table></figure><p>å†è¿è¡Œï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:minimal /bin/sh<br></code></pre></td></tr></table></figure><p>æ–¹æ³• 3ï¸âƒ£ ç›´æ¥åœ¨ Dockerfile é‡Œå®‰è£… bash</p><p>åœ¨è„šæœ¬é‡Œ MINIMAL æ¨¡å¼ä¹Ÿå¯ä»¥åšï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> my-ubuntu-base:20.04<br><span class="hljs-built_in">RUN</span> apt-<span class="hljs-built_in">get</span> update &amp;&amp; apt-<span class="hljs-built_in">get</span> install -y bash<br>CMD [<span class="hljs-string">&quot;/bin/bash&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¿™æ ·æ— è®º minimal rootfs åŸæœ¬æœ‰æ²¡æœ‰ shellï¼Œéƒ½èƒ½å¯åŠ¨ã€‚</p><hr /><p>ğŸ’¡ <strong>ç»“è®º</strong>ï¼š</p><ul><li>Minimal cloud image æœ¬èº«å¯èƒ½æ²¡æœ‰ <code>/bin/sh</code>ï¼Œè¿™æ˜¯å®˜æ–¹æœ€å°rootfs çš„æ­£å¸¸ç°è±¡</li><li><strong>å¯é æ–¹æ³•</strong>ï¼šFULL æ¨¡å¼å®‰è£… bashï¼Œç„¶åç”¨<code>/bin/bash</code> å¯åŠ¨</li><li><strong>å¯é€‰æ–¹æ³•</strong>ï¼šæ‰‹åŠ¨ç”¨ <code>/bin/dash</code> åˆ›å»º<code>/bin/sh</code> ç¬¦å·é“¾æ¥</li></ul><hr /><p>æ”¹å†™ <strong>å®Œå…¨å…¼å®¹ minimal rootfs çš„ç¦»çº¿ Dockeræ„å»ºè„šæœ¬</strong>ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>FULL æ¨¡å¼ï¼šå®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</li><li>MINIMAL æ¨¡å¼ï¼šå¦‚æœ rootfs æ²¡æœ‰ <code>/bin/sh</code> æˆ–<code>/bin/bash</code>ï¼Œè‡ªåŠ¨åˆ›å»º <code>/bin/sh</code> æŒ‡å‘<code>/bin/dash</code>ï¼Œä¿è¯å®¹å™¨å¯ç”¨</li><li>å®Œå…¨å…¼å®¹ <code>/bin/sh</code> æ‰§è¡Œï¼Œä¸ä¾èµ– bash</li><li>æ”¯æŒ tar å’Œ ISO ä¸¤ç§ç±»å‹</li></ul><p>offline-ubuntu-docker-sh-auto.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒï¼Œè‡ªåŠ¨å¤„ç† minimal rootfs</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sh offline-ubuntu-docker-sh-auto.sh &lt;<span class="hljs-built_in">source</span>&gt; &lt;<span class="hljs-built_in">type</span>&gt; &lt;mode&gt; &lt;imagename&gt;</span><br><br>SOURCE_FILE=$1<br>TYPE=$2<br>MODE=$&#123;3:=--full&#125;<br>IMAGE_NAME=$&#123;4:=my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>CACHE_MAX_DAYS=30<br><br>if [ -z &quot;$SOURCE_FILE&quot; ] || [ -z &quot;$TYPE&quot; ]; then<br>    echo &quot;âŒ å‚æ•°é”™è¯¯ï¼è¯·æä¾› source æ–‡ä»¶è·¯å¾„å’Œç±»å‹ (tar/iso)&quot;<br>    exit 1<br>fi<br><br>mkdir -p &quot;$CACHE_DIR&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æå– Ubuntu ç‰ˆæœ¬</span><br>BASENAME=$(basename &quot;$SOURCE_FILE&quot;)<br>UBUNTU_CODENAME=$(echo &quot;$BASENAME&quot; | sed -n &#x27;s/ubuntu-\([a-z]\+\)-core.*/\1/p&#x27;)<br>case &quot;$UBUNTU_CODENAME&quot; in<br>    focal) UBUNTU_VERSION=&quot;20.04&quot; ;;<br>    jammy) UBUNTU_VERSION=&quot;22.04&quot; ;;<br>    bionic) UBUNTU_VERSION=&quot;18.04&quot; ;;<br>    *) UBUNTU_VERSION=&quot;latest&quot; ;;<br>esac<br><br>ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$UBUNTU_VERSION&quot;<br><br>echo &quot;====== ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æºæ–‡ä»¶       : $SOURCE_FILE&quot;<br>echo &quot;ç±»å‹         : $TYPE&quot;<br>echo &quot;Docker Tag   : $UBUNTU_VERSION&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå       : $IMAGE_NAME&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find &quot;$CACHE_DIR&quot; -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +&quot;$CACHE_MAX_DAYS&quot; -exec rm -rf &#123;&#125; \;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ rootfs</span><br>if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>    echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>else<br>    rm -rf &quot;$ROOTFS_DIR&quot;<br>    mkdir -p &quot;$ROOTFS_DIR&quot;<br><br>    if [ &quot;$TYPE&quot; = &quot;tar&quot; ]; then<br>        echo &quot;ğŸ‘‰ å¯¼å…¥ rootfs tar...&quot;<br>        sudo tar -C &quot;$ROOTFS_DIR&quot; -xf &quot;$SOURCE_FILE&quot;<br>    elif [ &quot;$TYPE&quot; = &quot;iso&quot; ]; then<br>        echo &quot;ğŸ‘‰ æŒ‚è½½ ISO æå– squashfs...&quot;<br>        MOUNT_DIR=&quot;$CACHE_DIR/iso-mount-$UBUNTU_VERSION&quot;<br>        mkdir -p &quot;$MOUNT_DIR&quot;<br>        sudo mount -o loop &quot;$SOURCE_FILE&quot; &quot;$MOUNT_DIR&quot;<br><br>        SQUASHFS_PATH=$(find &quot;$MOUNT_DIR&quot; -name &quot;filesystem.squashfs&quot; | head -n1)<br>        if [ -z &quot;$SQUASHFS_PATH&quot; ]; then<br>            echo &quot;âŒ ISO ä¸­æœªæ‰¾åˆ° filesystem.squashfs&quot;<br>            exit 1<br>        fi<br><br>        echo &quot;ğŸ‘‰ è§£å‹ squashfs åˆ° rootfs...&quot;<br>        sudo unsquashfs -d &quot;$ROOTFS_DIR&quot; &quot;$SQUASHFS_PATH&quot;<br>        sudo umount &quot;$MOUNT_DIR&quot;<br>        rm -rf &quot;$MOUNT_DIR&quot;<br>    else<br>        echo &quot;âŒ ç±»å‹å¿…é¡»æ˜¯ tar æˆ– iso&quot;<br>        exit 1<br>    fi<br>    echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ shellï¼ŒMINIMAL æ¨¡å¼å¤„ç†</span><br>if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>    SHELL_PATH=&quot;/bin/bash&quot;<br>elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>elif [ -f &quot;$ROOTFS_DIR/bin/dash&quot; ]; then<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>    # åˆ›å»º /bin/sh ç¬¦å·é“¾æ¥æŒ‡å‘ dash<br>    sudo ln -sf dash &quot;$ROOTFS_DIR/bin/sh&quot;<br>else<br>    echo &quot;âš ï¸ rootfs æ²¡æœ‰ shellï¼Œå°è¯•å®‰è£… dash&quot;<br>    sudo chroot &quot;$ROOTFS_DIR&quot; apt-get update<br>    sudo chroot &quot;$ROOTFS_DIR&quot; apt-get install -y dash<br>    SHELL_PATH=&quot;/bin/sh&quot;<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ</span><br>echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ...&quot;<br>sudo tar -C &quot;$ROOTFS_DIR&quot; -c . | docker import - &quot;$&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼å®‰è£…å·¥å…·</span><br>if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>    echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·...&quot;<br>    echo &quot;FROM $&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN apt-get update &amp;&amp; apt-get install -y bash vim curl wget net-tools iputils-ping less lsb-release ca-certificates &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [\&quot;/bin/bash\&quot;]&quot; &gt; Dockerfile<br><br>    docker build -t &quot;$IMAGE_NAME:$UBUNTU_VERSION&quot; .<br>    rm -f Dockerfile<br>else<br>    echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä½¿ç”¨ $SHELL_PATH&quot;<br>    docker tag &quot;$&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION&quot; &quot;$IMAGE_NAME:$UBUNTU_VERSION&quot;<br>fi<br><br>docker rmi &quot;$&#123;IMAGE_NAME&#125;-base:$UBUNTU_VERSION&quot; &gt;/dev/null 2&gt;&amp;1 || true<br><br>echo &quot;âœ… é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $IMAGE_NAME:$UBUNTU_VERSION $SHELL_PATH&quot;<br>echo &quot;ç¼“å­˜ rootfs è·¯å¾„: $ROOTFS_DIR&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># FULL æ¨¡å¼ï¼ˆå®‰è£… bash å’Œå¸¸ç”¨å·¥å…·ï¼‰</span><br>sh offline-ubuntu-docker-sh-auto.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--full my-ubuntu</span><br><br><span class="hljs-comment"># MINIMAL æ¨¡å¼ï¼ˆè‡ªåŠ¨åˆ›å»º /bin/sh ç¬¦å·é“¾æ¥ä¿è¯å¯ç”¨ï¼‰</span><br>sh offline-ubuntu-docker-sh-auto.sh ubuntu-focal-core-cloudimg-amd64-root.tar.gz tar <span class="hljs-comment">--minimal my-ubuntu</span><br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/bash   <span class="hljs-comment"># FULL æ¨¡å¼</span><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-keyword">my</span>-ubuntu:<span class="hljs-number">20.04</span> /bin/sh     <span class="hljs-comment"># MINIMAL æ¨¡å¼</span><br><br></code></pre></td></tr></table></figure><h4 id="æœ€ç»ˆç‰ˆæœ¬">æœ€ç»ˆç‰ˆæœ¬</h4><p>å¢åŠ  <strong>æ‰¹é‡æ„å»ºå¤šç‰ˆæœ¬ Ubuntu ç¦»çº¿ Docker é•œåƒ</strong>çš„åŠŸèƒ½ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>æ”¯æŒ 18.04ï¼ˆbionicï¼‰ã€20.04ï¼ˆfocalï¼‰ã€22.04ï¼ˆjammyï¼‰</li><li>è‡ªåŠ¨ä¸‹è½½å¯¹åº” cloud imageï¼ˆå¦‚æœæœ¬åœ°æ²¡æœ‰ï¼‰</li><li>FULL æ¨¡å¼ï¼šå®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</li><li>MINIMAL æ¨¡å¼ï¼šè‡ªåŠ¨åˆ›å»º <code>/bin/sh</code> æŒ‡å‘<code>/bin/dash</code> ç¬¦å·é“¾æ¥ï¼Œä¿è¯å®¹å™¨å¯ç”¨</li><li>å®Œå…¨å…¼å®¹ <code>/bin/sh</code> æ‰§è¡Œï¼Œä¸ä¾èµ– bash</li></ul><p>offline-ubuntu-docker-multi.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>set -e<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰¹é‡ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sh offline-ubuntu-docker-multi.sh &lt;æ¨¡å¼: --full/--minimal&gt; &lt;é•œåƒå‰ç¼€&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼š</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sh offline-ubuntu-docker-multi.sh --full my-ubuntu</span><br><br>MODE=$&#123;1:=--full&#125;<br>IMAGE_PREFIX=$&#123;2:=my-ubuntu&#125;<br>CACHE_DIR=&quot;$HOME/.offline-ubuntu-cache&quot;<br>CACHE_MAX_DAYS=30<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ”¯æŒç‰ˆæœ¬åˆ—è¡¨</span><br>VERSIONS=&quot;bionic focal jammy&quot;<br><br>echo &quot;====== æ‰¹é‡ç¦»çº¿æ„å»º Ubuntu Docker é•œåƒ ======&quot;<br>echo &quot;æ¨¡å¼         : $MODE&quot;<br>echo &quot;é•œåƒå‰ç¼€     : $IMAGE_PREFIX&quot;<br>echo &quot;ç¼“å­˜ç›®å½•     : $CACHE_DIR&quot;<br>echo<br><br>mkdir -p &quot;$CACHE_DIR&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†è¿‡æœŸç¼“å­˜</span><br>echo &quot;ğŸ‘‰ æ¸…ç†è¶…è¿‡ $CACHE_MAX_DAYS å¤©çš„ç¼“å­˜...&quot;<br>find &quot;$CACHE_DIR&quot; -maxdepth 1 -type d -name &quot;rootfs-*&quot; -mtime +&quot;$CACHE_MAX_DAYS&quot; -exec rm -rf &#123;&#125; \;<br><br>for codename in $VERSIONS; do<br>    case &quot;$codename&quot; in<br>        bionic) VERSION=&quot;18.04&quot;;;<br>        focal)  VERSION=&quot;20.04&quot;;;<br>        jammy)  VERSION=&quot;22.04&quot;;;<br>        *) VERSION=&quot;latest&quot;;;<br>    esac<br><br>    ROOTFS_DIR=&quot;$CACHE_DIR/rootfs-$VERSION&quot;<br>    TAR_FILE=&quot;$CACHE_DIR/ubuntu-$codename-core-cloudimg-amd64-root.tar.gz&quot;<br><br>    echo &quot;====== æ„å»º Ubuntu $VERSION ======&quot;<br><br>    # å¦‚æœæœ¬åœ°æ²¡æœ‰ tar æ–‡ä»¶ï¼Œå°è¯•æç¤ºç”¨æˆ·è‡ªè¡Œä¸‹è½½<br>    if [ ! -f &quot;$TAR_FILE&quot; ]; then<br>        echo &quot;âš ï¸ ç¼ºå°‘ $TAR_FILEï¼Œè¯·ä» Ubuntu å®˜æ–¹ä¸‹è½½ cloud image rootfs å¹¶æ”¾ç½®åˆ°ç¼“å­˜ç›®å½•&quot;<br>        continue<br>    fi<br><br>    # å¯¼å…¥ rootfs<br>    if [ -d &quot;$ROOTFS_DIR&quot; ]; then<br>        echo &quot;âœ… æ£€æµ‹åˆ°ç¼“å­˜ rootfsï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜...&quot;<br>    else<br>        rm -rf &quot;$ROOTFS_DIR&quot;<br>        mkdir -p &quot;$ROOTFS_DIR&quot;<br>        echo &quot;ğŸ‘‰ è§£å‹ $TAR_FILE åˆ° rootfs...&quot;<br>        sudo tar -C &quot;$ROOTFS_DIR&quot; -xf &quot;$TAR_FILE&quot;<br>        echo &quot;âœ… rootfs å·²ç¼“å­˜åˆ° $ROOTFS_DIR&quot;<br>    fi<br><br>    # æ£€æŸ¥ shell<br>    if [ -f &quot;$ROOTFS_DIR/bin/bash&quot; ]; then<br>        SHELL_PATH=&quot;/bin/bash&quot;<br>    elif [ -f &quot;$ROOTFS_DIR/bin/sh&quot; ]; then<br>        SHELL_PATH=&quot;/bin/sh&quot;<br>    elif [ -f &quot;$ROOTFS_DIR/bin/dash&quot; ]; then<br>        SHELL_PATH=&quot;/bin/sh&quot;<br>        sudo ln -sf dash &quot;$ROOTFS_DIR/bin/sh&quot;<br>    else<br>        echo &quot;âš ï¸ rootfs æ²¡æœ‰ shellï¼Œå°è¯•å®‰è£… dash&quot;<br>        sudo chroot &quot;$ROOTFS_DIR&quot; apt-get update<br>        sudo chroot &quot;$ROOTFS_DIR&quot; apt-get install -y dash<br>        SHELL_PATH=&quot;/bin/sh&quot;<br>    fi<br><br>    # å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ<br>    BASE_IMAGE=&quot;$&#123;IMAGE_PREFIX&#125;-base:$VERSION&quot;<br>    echo &quot;ğŸ‘‰ å¯¼å…¥ Docker ä¸´æ—¶é•œåƒ: $BASE_IMAGE ...&quot;<br>    sudo tar -C &quot;$ROOTFS_DIR&quot; -c . | docker import - &quot;$BASE_IMAGE&quot;<br><br>    # FULL æ¨¡å¼å®‰è£…å·¥å…·<br>    if [ &quot;$MODE&quot; = &quot;--full&quot; ]; then<br>        echo &quot;ğŸ‘‰ FULL æ¨¡å¼: å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·...&quot;<br>        echo &quot;FROM $BASE_IMAGE<br>ENV DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai<br>RUN apt-get update &amp;&amp; apt-get install -y bash vim curl wget net-tools iputils-ping less lsb-release ca-certificates &amp;&amp; rm -rf /var/lib/apt/lists/*<br>CMD [\&quot;/bin/bash\&quot;]&quot; &gt; Dockerfile<br><br>        docker build -t &quot;$&#123;IMAGE_PREFIX&#125;:$VERSION&quot; .<br>        rm -f Dockerfile<br>    else<br>        echo &quot;ğŸ‘‰ MINIMAL æ¨¡å¼: ä½¿ç”¨ $SHELL_PATH&quot;<br>        docker tag &quot;$BASE_IMAGE&quot; &quot;$&#123;IMAGE_PREFIX&#125;:$VERSION&quot;<br>    fi<br><br>    # æ¸…ç†ä¸´æ—¶é•œåƒ<br>    docker rmi &quot;$BASE_IMAGE&quot; &gt;/dev/null 2&gt;&amp;1 || true<br>    echo &quot;âœ… Ubuntu $VERSION é•œåƒæ„å»ºå®Œæˆï¼&quot;<br>done<br><br>echo &quot;ğŸ‰ æ‰€æœ‰ç‰ˆæœ¬æ„å»ºå®Œæˆï¼&quot;<br>echo &quot;è¿è¡Œç¤ºä¾‹: docker run -it $&#123;IMAGE_PREFIX&#125;:20.04 /bin/bash  # FULL æ¨¡å¼&quot;<br>echo &quot;æˆ– docker run -it $&#123;IMAGE_PREFIX&#125;:20.04 /bin/sh         # MINIMAL æ¨¡å¼&quot;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">FULL æ¨¡å¼ï¼ˆå®‰è£… bash å’Œå·¥å…·ï¼‰</span><br>sh offline-ubuntu-docker-multi.sh --full my-ubuntu<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">MINIMAL æ¨¡å¼ï¼ˆä¿ç•™ minimal rootfsï¼‰</span><br>sh offline-ubuntu-docker-multi.sh --minimal my-ubuntu<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿è¡Œå®¹å™¨</span><br>docker run -it my-ubuntu:20.04 /bin/bash   # FULL æ¨¡å¼<br>docker run -it my-ubuntu:20.04 /bin/sh     # MINIMAL æ¨¡å¼<br><br></code></pre></td></tr></table></figure><p>åŠŸèƒ½æ€»ç»“ï¼š</p><ol type="1"><li>æ”¯æŒæ‰¹é‡æ„å»º 18.04/20.04/22.04</li><li>FULL æ¨¡å¼è‡ªåŠ¨å®‰è£… bash å’Œå¸¸ç”¨å·¥å…·</li><li>MINIMAL æ¨¡å¼è‡ªåŠ¨åˆ›å»º <code>/bin/sh</code> ç¬¦å·é“¾æ¥ä¿è¯å®¹å™¨å¯ç”¨</li><li>å®Œå…¨å…¼å®¹ <code>/bin/sh</code> æ‰§è¡Œï¼Œä¸ä¾èµ– bash</li><li>æç¤ºç”¨æˆ·ä¸‹è½½ç¼ºå¤±çš„ cloud image rootfs</li></ol>]]></content>
    
    
    <categories>
      
      <category>æ•™ç¨‹</category>
      
      <category>docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ubuntuä»£ç ä¸ç‰ˆæœ¬å¯¹åº”å…³ç³»</title>
    <link href="/2025/09/08/ubuntu%E4%BB%A3%E7%A0%81%E4%B8%8E%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/"/>
    <url>/2025/09/08/ubuntu%E4%BB%A3%E7%A0%81%E4%B8%8E%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p>Ubuntu ç³»ç»Ÿçš„ç‰ˆæœ¬å·ä¸ä»£ç åç§°ï¼ˆCodeNameï¼‰éµå¾ªå›ºå®šçš„å‘½åè§„åˆ™ï¼Œé€šå¸¸ç”±ä¸¤ä¸ªè‹±æ–‡å•è¯ç»„æˆï¼ˆé¦–å­—æ¯å‡ä¸ºå¤§å†™ï¼‰ï¼Œä¸”è¿™ä¸¤ä¸ªå•è¯åˆ†åˆ«å¯¹åº”ä¸€ç§åŠ¨ç‰©å’Œä¸€ç§å½¢å®¹è¯ï¼ˆæˆ–ç›¸åï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ Ubuntu ä¸»è¦ç‰ˆæœ¬ä¸ä»£ç åç§°çš„å¯¹åº”å…³ç³»ï¼ˆåŒ…å«é•¿æœŸæ”¯æŒç‰ˆ LTSå’Œæ™®é€šç‰ˆï¼‰ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬å·</th><th>ä»£ç åç§°ï¼ˆCode Nameï¼‰</th><th>å‘å¸ƒæ—¶é—´</th><th>æ”¯æŒå‘¨æœŸ</th></tr></thead><tbody><tr><td>Ubuntu 4.10</td><td>Warty Warthogï¼ˆå¤šç–£çš„ç–£çŒªï¼‰</td><td>2004.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 5.04</td><td>Hoary Hedgehogï¼ˆç°ç™½çš„åˆºçŒ¬ï¼‰</td><td>2005.04</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 5.10</td><td>Breezy Badgerï¼ˆæ´»æ³¼çš„ç¾ï¼‰</td><td>2005.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 6.06 LTS</td><td>Dapper Drakeï¼ˆæ•´æ´çš„å…¬é¸­ï¼‰</td><td>2006.06</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/7 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 6.10</td><td>Edgy Eftï¼ˆæ€¥èºçš„å°èœ¥èœ´ï¼‰</td><td>2006.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 7.04</td><td>Feisty Fawnï¼ˆæš´èºçš„å°é¹¿ï¼‰</td><td>2007.04</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 7.10</td><td>Gutsy Gibbonï¼ˆå‹‡æ•¢çš„é•¿è‡‚çŒ¿ï¼‰</td><td>2007.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 8.04 LTS</td><td>Hardy Heronï¼ˆå¼ºå£®çš„è‹é¹­ï¼‰</td><td>2008.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/7 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 8.10</td><td>Intrepid Ibexï¼ˆæ— ç•çš„é‡å±±ç¾Šï¼‰</td><td>2008.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 9.04</td><td>Jaunty Jackalopeï¼ˆæ´»æ³¼çš„æ€€ä¿„æ˜é‡å…”ï¼‰</td><td>2009.04</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 9.10</td><td>Karmic Koalaï¼ˆå¹¸è¿çš„æ ‘è¢‹ç†Šï¼‰</td><td>2009.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 10.04 LTS</td><td>Lucid Lynxï¼ˆæ¸…é†’çš„çŒçŒï¼‰</td><td>2010.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/7 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 10.10</td><td>Maverick Meerkatï¼ˆç‰¹ç«‹ç‹¬è¡Œçš„çŒ«é¼¬ï¼‰</td><td>2010.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 11.04</td><td>Natty Narwhalï¼ˆæ•´æ´çš„ç‹¬è§’é²¸ï¼‰</td><td>2011.04</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 11.10</td><td>Oneiric Ocelotï¼ˆæ¢¦å¹»çš„è±¹çŒ«ï¼‰</td><td>2011.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 12.04 LTS</td><td>Precise Pangolinï¼ˆç²¾ç¡®çš„ç©¿å±±ç”²ï¼‰</td><td>2012.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/7 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 12.10</td><td>Quantal Quetzalï¼ˆé‡å­çš„ç»¿å’¬é¹ƒï¼‰</td><td>2012.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 13.04</td><td>Raring Ringtailï¼ˆæ¸´æœ›çš„ç¯å°¾çŒ«ï¼‰</td><td>2013.04</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 13.10</td><td>Saucy Salamanderï¼ˆè½æ’çš„ç«èœ¥èœ´ï¼‰</td><td>2013.10</td><td>18 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 14.04 LTS</td><td>Trusty Tahrï¼ˆå¯é çš„å¡”å°”ç¾Šï¼‰</td><td>2014.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 14.10</td><td>Utopic Unicornï¼ˆä¹Œæ‰˜é‚¦çš„ç‹¬è§’å…½ï¼‰</td><td>2014.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 15.04</td><td>Vivid Vervetï¼ˆæ´»æ³¼çš„é•¿å°¾çŒ´ï¼‰</td><td>2015.04</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 15.10</td><td>Wily Werewolfï¼ˆç‹¡çŒ¾çš„ç‹¼äººï¼‰</td><td>2015.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 16.04 LTS</td><td>Xenial Xerusï¼ˆå¥½å®¢çš„éæ´²åœ°æ¾é¼ ï¼‰</td><td>2016.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 16.10</td><td>Yakkety Yakï¼ˆå–‹å–‹ä¸ä¼‘çš„ç‰¦ç‰›ï¼‰</td><td>2016.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 17.04</td><td>Zesty Zapusï¼ˆçƒ­æƒ…çš„è·³é¼ ï¼‰</td><td>2017.04</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 17.10</td><td>Artful Aardvarkï¼ˆå·§å¦™çš„åœŸè±šï¼‰</td><td>2017.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 18.04 LTS</td><td>Bionic Beaverï¼ˆä»¿ç”Ÿæµ·ç‹¸ï¼‰</td><td>2018.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 18.10</td><td>Cosmic Cuttlefishï¼ˆå®‡å®™çš„ä¹Œè´¼ï¼‰</td><td>2018.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 19.04</td><td>Disco Dingoï¼ˆè¿ªæ–¯ç§‘çš„æ¾³æ´²é‡ç‹—ï¼‰</td><td>2019.04</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 19.10</td><td>Eoan Ermineï¼ˆä¼Šå¥¥å®‰çš„ç™½é¼¬ï¼‰</td><td>2019.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 20.04 LTS</td><td>Focal Fossaï¼ˆç„¦ç‚¹çš„é©¬è¾¾åŠ æ–¯åŠ ç‹¸çŒ«ï¼‰</td><td>2020.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 20.10</td><td>Groovy Gorillaï¼ˆæ¬¢å¿«çš„å¤§çŒ©çŒ©ï¼‰</td><td>2020.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 21.04</td><td>Hirsute Hippoï¼ˆå¤šæ¯›çš„æ²³é©¬ï¼‰</td><td>2021.04</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 21.10</td><td>Impish Indriï¼ˆé¡½çš®çš„å¤§ç‹çŒ´ï¼‰</td><td>2021.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 22.04 LTS</td><td>Jammy Jellyfishï¼ˆæ¬¢ä¹çš„æ°´æ¯ï¼‰</td><td>2022.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr><tr><td>Ubuntu 22.10</td><td>Kinetic Kuduï¼ˆè¿åŠ¨çš„æ»è§’ç¾šï¼‰</td><td>2022.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 23.04</td><td>Lunar Lobsterï¼ˆæœˆç¥çš„é¾™è™¾ï¼‰</td><td>2023.04</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 23.10</td><td>Mantic Minotaurï¼ˆé¢„è¨€çš„å¼¥è¯ºé™¶æ´›æ–¯ï¼‰</td><td>2023.10</td><td>9 ä¸ªæœˆ</td></tr><tr><td>Ubuntu 24.04 LTS</td><td>Noble Numbatï¼ˆé«˜è´µçš„è¢‹é£Ÿèšå…½ï¼‰</td><td>2024.04</td><td>5 å¹´ï¼ˆæ¡Œé¢ï¼‰/10 å¹´ï¼ˆæœåŠ¡å™¨ï¼‰</td></tr></tbody></table><h3 id="å‘½åè§„å¾‹è¯´æ˜">å‘½åè§„å¾‹è¯´æ˜ï¼š</h3><ol type="1"><li><p>ç‰ˆæœ¬å·æ ¼å¼ä¸º <code>å¹´ä»½.æœˆä»½</code>ï¼ˆå¦‚ 24.04 è¡¨ç¤º 2024 å¹´ 4æœˆå‘å¸ƒï¼‰ã€‚</p></li><li><p>æ¯ä¸¤å¹´å‘å¸ƒä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆï¼ˆLTSï¼Œ4 æœˆä»½å‘å¸ƒï¼‰ï¼Œæ”¯æŒå‘¨æœŸé•¿ï¼ˆæ¡Œé¢ 5å¹´ï¼ŒæœåŠ¡å™¨ 10 å¹´ï¼‰ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚</p></li><li><p>æ™®é€šç‰ˆæœ¬æ¯ 6 ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ï¼ˆ4 æœˆå’Œ 10 æœˆï¼‰ï¼Œä»…æ”¯æŒ 9ä¸ªæœˆï¼Œé€‚åˆå°é²œæ–°ç‰¹æ€§ã€‚</p></li><li><p>ä»£ç åç§°æŒ‰å­—æ¯é¡ºåºä¾æ¬¡é€’å¢ï¼ˆä» Ubuntu 4.10 çš„ W å¼€å§‹ï¼Œå¾ªç¯A-Zï¼‰ï¼Œä¾¿äºè®°å¿†å’ŒåŒºåˆ†ç‰ˆæœ¬ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>OS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ubuntu os</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såˆä½“éªŒ</title>
    <link href="/2024/10/06/k8s%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <url>/2024/10/06/k8s%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>zshrc command not found</title>
    <link href="/2024/10/06/zshrc-command-not-found/"/>
    <url>/2024/10/06/zshrc-command-not-found/</url>
    
    <content type="html"><![CDATA[<h3 id="èµ·å› ">èµ·å› </h3><p>å®‰è£…äº†iternåï¼Œshellå‡ºç°äº†æœ‰ç‚¹é—®é¢˜ï¼Œ å®‰è£…åçš„nodeå‘½ä»¤æ— æ³•æ‰§è¡Œï¼Œæç¤º â€œzshrc command not foundâ€</p><h3 id="è§£å†³">è§£å†³</h3><p>å› ä¸ºæ˜ç¡®çŸ¥é“å·²ç»å®‰è£…äº†node.jsï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥æ˜¯ç”±äºiternçš„shellçš„æœ‰é—®é¢˜ã€‚</p><p>æŸ¥çœ‹ ~/.nvm/ ç›®å½•ï¼Œæœ‰node.jså®‰è£…çš„æ–‡ä»¶ã€‚</p><p>æ‰§è¡Œ å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source ~/.nvm/nvm.sh<br></code></pre></td></tr></table></figure><p>å†æ‰§è¡Œ nvm npm ç­‰å‘½ä»¤å°±å‘ç°å·²ç»å¯ä»¥äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·æŠ€å·§</category>
      
      <category>shell</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ubuntu è®¾ç½®ä»£ç†</title>
    <link href="/2024/10/06/ubuntu-%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
    <url>/2024/10/06/ubuntu-%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3><p>å®¿ä¸»æœºæ˜¯Mac OS ï¼Œä½¿ç”¨parallels Desktop å®‰è£…äº†ubuntu desktop24.04.01ã€‚<img src="1.png" alt="ç½‘ç»œè®¾ç½®" /></p><p>ç½‘ç»œè®¾ç½®å¦‚å›¾æ‰€ç¤ºã€‚å®¿ä¸»æœºMacæœ‰VPNï¼Œåœ¨Ubuntuä¸Šä¹Ÿæƒ³ä½¿ç”¨å®¿ä¸»æœºçš„VPNä»£ç†ï¼Œè¯¥å¦‚ä½•è®¾ç½®å‘¢ã€‚</p><h3 id="è®¾ç½®ä»£ç†">è®¾ç½®ä»£ç†</h3><p>è®¾ç½®ä»£ç†æœ‰å¤šç§æ–¹å¼</p><ol type="1"><li><p>ä¸´æ—¶è®¾ç½®</p><p>é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export HTTPS_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export FTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=http://192.xxx.xxx.xxx:1234<br>export HTTPS_PROXY=http://192.xxx.xxx.xxx:1234<br>export FTP_PROXY=http://192.xxx.xxx.xxx:1234<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure><p>æ³¨æ„ HTTPS_PROXYï¼Œä¹Ÿéœ€è¦è®¾ç½®ä¸ºå’ŒHTTP_PROXYä¸€æ ·ã€‚å› ä¸ºå®¿ä¸»æœºMacæ²¡æœ‰https.</p><p>åŒæ · NO_PROXYé™¤äº† localhost127.0.0.1,::1ä»¥å¤–ï¼Œå¦‚æœUbuntuè¿˜æœ‰å…¶ä»–æœ¬åœ°çš„IPä¸éœ€è¦èµ°ä»£ç†ï¼Œæ¯”å¦‚å¦‚æœè¿˜è¦åœ¨Ubuntuä¸Šè£…äº†k8såï¼Œk8sæœ¬åœ°çš„IPä¹Ÿéœ€è¦åŠ ä¸Šï¼Œä¸èƒ½èµ°ä»£ç†ã€‚</p></li><li><p>æ°¸ä¹…è®¾ç½®</p><p>ç¼–è¾‘ ~/.bashrc</p><p>åœ¨æ–‡ä»¶é‡Œæ·»åŠ  å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export HTTPS_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export FTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æŠŠç¬¬ä¸€ç§æ–¹å¼çš„å†…å®¹æ”¾åœ¨äº† .bashrcé‡Œã€‚</p><p>æ·»åŠ ä¹‹åï¼Œè®°å¾—æ‰§è¡Œ source ~/.bashrc</p></li><li><p>ä¸º æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨ä»£ç†</p><p>ç¼–è¾‘/etc/environment</p><p>åœ¨æ–‡ä»¶é‡Œæ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export HTTPS_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export FTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure></li><li><p>ä¸ºaptè®¾ç½®ä»£ç†</p><p>æ–°å»ºæˆ–è€…ç¼–è¾‘ï¼ˆå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼‰/etc/apt/apt.confåœ¨æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export HTTPS_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export FTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure></li><li><p>ä¸ºwgetè®¾ç½®ä»£ç†</p><p>æ–°å»ºæˆ–è€…ç¼–è¾‘ï¼ˆå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼‰~/.wgetrc ,åœ¨æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HTTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export HTTPS_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export FTP_PROXY=[proxy-web-or-IP-address]:[port-number]<br>export NO_PROXY=localhost,127.0.0.1,::1<br></code></pre></td></tr></table></figure></li><li><p>ä¸ºdockerè®¾ç½®ä»£ç†</p><p>åˆ›å»ºï¼ˆå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼‰ docker.service.dç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /etc/systemd/system/docker.service.d<br></code></pre></td></tr></table></figure></li></ol><p>â€‹ åˆ›å»ºæˆ–è€…ç¼–è¾‘ http-proxy.conf ä»£ç†æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Service]<br>Environment=&quot;HTTP_PROXY=https://web-proxy.corp.xxxxxx.com:8080/&quot;<br>Environment=&quot;HTTPS_PROXY=http://web-proxy.corp.xxxxxx.com:8080/&quot;<br>Environment=&quot;NO_PROXY=localhost,127.0.0.1,localaddress,.localdomain.com&quot;<br>Environment=&quot;ALL_PROXY=socks5://web-proxy.corp.xxxxxx.com:8080&quot;<br></code></pre></td></tr></table></figure><p>é…ç½®åä¹‹åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br><br>systemctl restart docker<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹<ahref="https://docs.docker.com/engine/daemon/proxy/#httphttps-proxy">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>OS</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>matplotlibä¸­çš„ä¸­æ–‡å­—ä½“è®¾ç½®</title>
    <link href="/2024/08/15/matplotlib%E4%B8%AD%E7%9A%84%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E8%AE%BE%E7%BD%AE/"/>
    <url>/2024/08/15/matplotlib%E4%B8%AD%E7%9A%84%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æœºå™¨å­¦ä¹ æˆ–è€…æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¯è§†åŒ–æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œä¸€èˆ¬ä½¿ç”¨å›¾è¡¨å‘ˆç°ç»“æœï¼Œåœ¨å‘ˆç°ç»“æœçš„æ—¶å€™ï¼Œå‡ºç°ä¸­æ–‡ä¹±ç æ˜¯ç»å¸¸é‡è§çš„äº‹æƒ…ã€‚</p><p>æœ¬æ–‡æ˜¯åœ¨pythonè™šæ‹Ÿç¯å¢ƒä¸‹çš„ä¸­æ–‡ä¹±ç å¤„ç†ã€‚</p><h4id="æŸ¥çœ‹å­—ä½“è·¯å¾„é…ç½®å½“å‰æ”¯æŒçš„å­—ä½“å­—ä½“ç¼“å­˜">æŸ¥çœ‹å­—ä½“è·¯å¾„ã€é…ç½®ã€å½“å‰æ”¯æŒçš„å­—ä½“ã€å­—ä½“ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> matplotlib<br>a=<span class="hljs-built_in">sorted</span>([f.name <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> matplotlib.font_manager.fontManager.ttflist]) <span class="hljs-comment"># å½“å‰æ”¯æŒçš„å­—ä½“</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment">#è¾“å‡ºå­—ä½“</span><br><span class="hljs-built_in">print</span>(matplotlib.get_data_path()) <span class="hljs-comment">#å­—ä½“è·¯å¾„</span><br><span class="hljs-built_in">print</span>(matplotlib.matplotlib_fname()) <span class="hljs-comment">#matplotlib å­—ä½“é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">print</span>(matplotlib.get_cachedir()) <span class="hljs-comment"># å­—ä½“ç¼“å­˜è·¯å¾„</span><br></code></pre></td></tr></table></figure><h4 id="ä¸‹è½½å®‹ä½“å­—ä½“">ä¸‹è½½å®‹ä½“å­—ä½“</h4><p>å®‹ä½“å­—ä½“<ahref="https://github.com/SparksFly8/Stylify-Me/blob/master/.fonts/SimSun.ttf">ä¸‹è½½</a></p><h4 id="å­—ä½“é…ç½®">å­—ä½“é…ç½®</h4><p>å°†ä¸‹è½½çš„å­—ä½“æ–‡ä»¶å¤åˆ¶åˆ° ä¸Šæ–‡ä¸­è¾“å‡ºçš„<code>å­—ä½“è·¯å¾„</code>ä¸‹é¢çš„fonts/ttfç›®å½•ä¸‹ã€‚å¦‚:/root/.virtualenvs/venv3.9/lib/python3.9/site-packages/matplotlib/mpl-data/<strong>fonts/ttf</strong>ä¸‹é¢</p><h4 id="ä¿®æ”¹matplotlibrcæ–‡ä»¶">ä¿®æ”¹matplotlibrcæ–‡ä»¶</h4><p>æ‰“å¼€ä¸Šæ–‡è¾“å‡ºçš„matplotlibçš„å­—ä½“é…ç½®æ–‡ä»¶matplotlibrcï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">font.family         :</span> <span class="hljs-string">sans-serif</span>   <br><span class="hljs-comment"># å»æ‰å‰é¢çš„#     </span><br><span class="hljs-attr">font.sans-serif     :</span> <span class="hljs-string">SimSun,</span> <span class="hljs-string">DejaVu</span> <span class="hljs-string">Sans,</span> <span class="hljs-string">Bitstream</span> <span class="hljs-string">Vera</span> <span class="hljs-string">Sans,</span> <span class="hljs-string">Computer</span> <span class="hljs-string">Modern</span> <span class="hljs-string">Sans</span> <span class="hljs-string">Serif,</span> <span class="hljs-string">Lucida</span> <span class="hljs-string">Grande,</span> <span class="hljs-string">Verdana,</span> <span class="hljs-string">Geneva,</span> <span class="hljs-string">Lucid,</span> <span class="hljs-string">Arial,</span> <span class="hljs-string">Helvetica,</span> <span class="hljs-string">Avant</span> <span class="hljs-string">Garde,</span> <span class="hljs-string">sans-serif</span> <br><span class="hljs-comment"># å»æ‰å‰é¢çš„#ï¼Œå¹¶åœ¨å†’å·åé¢æ·»åŠ SimSun, æ˜¾ç¤ºçš„å­—ä½“å¯èƒ½ä¸å°½ç›¸åŒï¼Œåªéœ€è¦åŠ ä¸Šéœ€è¦çš„å­—ä½“å³å¯ï¼Œå¦‚SimSun.</span><br><span class="hljs-attr">axes.unicode_minus  :</span> <span class="hljs-literal">False</span><br><span class="hljs-comment"># å»æ‰å‰é¢çš„#ï¼Œå¹¶å°†Trueæ”¹ä¸ºFalse</span><br></code></pre></td></tr></table></figure><h4 id="æ¸…é™¤å­—ä½“ç¼“å­˜">æ¸…é™¤å­—ä½“ç¼“å­˜</h4><p>æ‰“å¼€ä¸Šæ–‡è¾“å‡ºçš„å­—ä½“ç¼“å­˜è·¯å¾„ï¼Œ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd å­—ä½“ç¼“å­˜ç›®å½•<br>rm -fr *<br><br>å¦‚ <br>cd /root/.cache/matplotlib<br>rm -fr *<br></code></pre></td></tr></table></figure><h4 id="æœ€å">æœ€å</h4><p>å¦‚æœæ˜¯è™šæ‹Ÿç¯å¢ƒï¼Œä½¿ç”¨jupyterçš„è¯ï¼Œé‡å¯å†…æ ¸å°±å¯ä»¥ã€‚å¦‚æœæ˜¯pycharmï¼Œé‡å¯è½¯ä»¶ï¼Œæˆ–è€…é‡å¯ç³»ç»Ÿå³å¯ã€‚</p><h4 id="è®¾ç½®å­—ä½“">è®¾ç½®å­—ä½“</h4><p>è®¾ç½®å­—ä½“ï¼Œæ€»ä½“æ¥è¯´æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å…¨å±€æ€§çš„ï¼Œä¸€ç§æ˜¯å±€éƒ¨æ€§çš„ã€‚å…¨å±€æ€§è®¾ç½®ä¼šå½±å“åˆ°å·²ç»è®¾ç½®çš„å­—ä½“ï¼Œå±€éƒ¨æ€§è®¾ç½®å­—ä½“æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ã€‚</p><p>å…¨å±€è®¾ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>plt.rcParams[<span class="hljs-string">&#x27;font.family&#x27;</span>] = [<span class="hljs-string">&#x27;sans-serif&#x27;</span>]  <br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;SimSun&#x27;</span>] <span class="hljs-comment"># æ­¥éª¤ä¸€ï¼ˆæ›¿æ¢å®‹ä½“ï¼‰</span><br>plt.rcParams[<span class="hljs-string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="hljs-literal">False</span>   <span class="hljs-comment"># è§£å†³åæ ‡è½´è´Ÿæ•°çš„è´Ÿå·æ˜¾ç¤ºé—®é¢˜</span><br><br></code></pre></td></tr></table></figure><p>å±€éƒ¨è®¾ç½®:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># ...</span><br><br>plt.xlabel(<span class="hljs-string">&quot;xè½´&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;yè½´&quot;</span>, fontproperties=<span class="hljs-string">&quot;SimSun&quot;</span>) <span class="hljs-comment"># ï¼ˆå®‹ä½“ï¼‰</span><br>plt.title(<span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>, fontproperties=<span class="hljs-string">&quot;SimSun&quot;</span>) <span class="hljs-comment"># ï¼ˆå®‹ä½“ï¼‰</span><br>plt.show()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>æ·±åº¦å­¦ä¹ </category>
      
      <category>pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchä½¿ç”¨GPUè®­ç»ƒæ¨¡å‹</title>
    <link href="/2024/08/14/pytorch%E4%BD%BF%E7%94%A8GPU%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
    <url>/2024/08/14/pytorch%E4%BD%BF%E7%94%A8GPU%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œä½¿ç”¨GPUè¿›è¡Œè®­ç»ƒæ¨¡å‹æ˜¯å¿…ä¸å¯å°‘ã€‚ä½¿ç”¨GPUè®­ç»ƒæ¨¡å‹çš„ä¸»è¦åŸå› æ˜¯GPUçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›å’Œé«˜ååé‡ï¼Œä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶å¦‚Tensorflowã€pytorchç­‰éƒ½å¯¹GPUè¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><h4 id="cuda">CUDA</h4><hr /><p>CUDAï¼ˆCompute Unified DeviceArchitectureï¼‰æ˜¯ç”±NVIDIAå¼€å‘çš„ç”¨äºå¹¶è¡Œè®¡ç®—çš„å¹³å°å’Œç¼–ç¨‹æ¨¡å‹ã€‚CUDAæ—¨åœ¨åˆ©ç”¨NVIDIAGPUï¼ˆå›¾å½¢å¤„ç†å•å…ƒï¼‰çš„å¼ºå¤§è®¡ç®—èƒ½åŠ›æ¥åŠ é€Ÿå„ç§ç§‘å­¦è®¡ç®—ã€æ•°å€¼æ¨¡æ‹Ÿå’Œæ·±åº¦å­¦ä¹ ä»»åŠ¡ã€‚</p><p>CUDAçš„è½¯ä»¶å †æ ˆç”±é©±åŠ¨å±‚ã€è¿è¡Œæ—¶å±‚å’Œå‡½æ•°åº“å±‚æ„æˆã€‚CUDAè½¯ä»¶å †æ ˆä¸­æ¶‰åŠçš„APIåŒ…æ‹¬é©±åŠ¨å±‚APIå’Œè¿è¡Œæ—¶å±‚APIã€‚</p><p>CUDAæ˜¯æ˜¾å¡å‚å•†NVIDIAåœ¨2007å¹´æ¨å‡ºçš„å¹¶è¡Œè®¡ç®—å¹³å°å’Œç¼–ç¨‹æ¨¡å‹ã€‚CUDAåˆ©ç”¨å›¾å½¢å¤„ç†å™¨GPUï¼ˆGraphicsProcessing Unitï¼‰ï¼Œå¯æ˜¾è‘—æé«˜è®¡ç®—æ€§èƒ½ã€‚</p><p>ä¸‹å›¾å±•ç¤ºCUDAçš„æ¶æ„ä½“ç³»ã€‚CUDAè½¯ä»¶å †æ ˆä¸­çš„é©±åŠ¨å±‚APIå’Œè¿è¡Œæ—¶å±‚APIçš„åŒºåˆ«å¦‚ä¸‹ã€‚</p><ul><li>é©±åŠ¨å±‚APIï¼ˆDriver APIï¼‰ï¼šåŠŸèƒ½è¾ƒå®Œæ•´ï¼Œä½†æ˜¯ä½¿ç”¨å¤æ‚ã€‚</li><li>è¿è¡Œæ—¶APIï¼ˆCUDA RuntimeAPIï¼‰ï¼šå°è£…äº†éƒ¨åˆ†é©±åŠ¨çš„APIï¼Œå°†æŸäº›é©±åŠ¨åˆå§‹åŒ–æ“ä½œéšè—ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚</li></ul><p>CUDAçš„Driver APIç”±<ahref="https://www.nvidia.com/Download/index.aspx">NVIDIADriver</a>åŒ…æä¾›ï¼Œè€ŒCUDA Libraryå’ŒCUDA Runtimeç”±<ahref="https://developer.nvidia.com/cuda-toolkit">CUDAToolkit</a>åŒ…æä¾›ã€‚</p><p><img src="cuda-gpu.png" style="zoom:50%;" /></p><p><strong>CUDAçš„ä½œç”¨å’Œç‰¹ç‚¹:</strong></p><ol type="1"><li><strong>ã€ŒGPUå¹¶è¡Œè®¡ç®—ã€</strong>ï¼šCUDAä½¿GPUèƒ½å¤Ÿæ‰§è¡Œå¹¶è¡Œè®¡ç®—ä»»åŠ¡ï¼Œä»è€Œå¤§å¹…æé«˜äº†è®¡ç®—æ€§èƒ½ã€‚GPUç”±è®¸å¤šå°å‹å¤„ç†å•å…ƒç»„æˆï¼Œæ¯ä¸ªå¤„ç†å•å…ƒéƒ½èƒ½å¤Ÿæ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œè¿™æ„å‘³ç€GPUå¯ä»¥åŒæ—¶å¤„ç†å¤§é‡çš„è®¡ç®—ä»»åŠ¡ã€‚</li><li><strong>ã€ŒCUDAç¼–ç¨‹æ¨¡å‹ã€</strong>ï¼šCUDAæä¾›äº†ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œå…è®¸å¼€å‘äººå‘˜ç¼–å†™C/C++ä»£ç ï¼Œåˆ©ç”¨GPUçš„å¹¶è¡Œæ€§æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¼€å‘äººå‘˜å¯ä»¥ç¼–å†™ç§°ä¸º"æ ¸å‡½æ•°"ï¼ˆkernelï¼‰çš„ä»£ç ï¼Œè¿™äº›æ ¸å‡½æ•°åœ¨GPUä¸Šå¹¶è¡Œæ‰§è¡Œã€‚CUDAç¼–ç¨‹æ¨¡å‹è¿˜æä¾›äº†ä¸€ç»„APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰æ¥ç®¡ç†GPUå†…å­˜ã€æ§åˆ¶GPUè®¾å¤‡å’Œè°ƒåº¦æ ¸å‡½æ•°çš„æ‰§è¡Œã€‚</li><li>ã€Œå¹¶è¡Œè®¡ç®—åº”ç”¨ã€ï¼šCUDAå¹¿æ³›ç”¨äºå„ç§é¢†åŸŸçš„ç§‘å­¦è®¡ç®—å’Œé«˜æ€§èƒ½è®¡ç®—åº”ç”¨ï¼ŒåŒ…æ‹¬ï¼š<ul><li><strong>ã€Œæ•°å€¼æ¨¡æ‹Ÿã€</strong>ï¼šCUDAå¯ç”¨äºæ¨¡æ‹Ÿç‰©ç†ç°è±¡ã€å¤©æ°”æ¨¡å‹ã€æµä½“åŠ›å­¦ç­‰é¢†åŸŸçš„æ•°å€¼æ¨¡æ‹Ÿã€‚</li><li><strong>ã€Œæ·±åº¦å­¦ä¹ ã€</strong>ï¼šæ·±åº¦å­¦ä¹ æ¡†æ¶å¦‚TensorFlowå’ŒPyTorchéƒ½æ”¯æŒCUDAï¼Œå¯ç”¨äºè®­ç»ƒå’Œæ¨ç†æ·±åº¦ç¥ç»ç½‘ç»œï¼ŒåŠ é€Ÿå›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ä»»åŠ¡ã€‚</li><li><strong>ã€Œåˆ†å­åŠ¨åŠ›å­¦ã€</strong>ï¼šç”¨äºæ¨¡æ‹Ÿåˆ†å­ä¹‹é—´ç›¸äº’ä½œç”¨ï¼Œæœ‰åŠ©äºè¯ç‰©è®¾è®¡å’Œææ–™ç§‘å­¦ç ”ç©¶ã€‚</li><li><strong>ã€Œåœ°çƒç§‘å­¦ã€</strong>ï¼šç”¨äºåœ°éœ‡æ¨¡æ‹Ÿã€æ°”è±¡å­¦ã€åœ°çƒç‰©ç†å­¦ç­‰é¢†åŸŸçš„å¤§è§„æ¨¡æ•°å€¼æ¨¡æ‹Ÿã€‚</li></ul></li><li><strong>ã€ŒNVIDIA GPUæ”¯æŒã€</strong>ï¼š CUDAä»…é€‚ç”¨äºNVIDIAGPUã€‚ä¸åŒç‰ˆæœ¬çš„CUDAé€šå¸¸ä¸ç‰¹å®šå‹å·çš„NVIDIAGPUå…¼å®¹ï¼Œå› æ­¤éœ€è¦ç¡®ä¿ä½ çš„GPUæ”¯æŒæ‰€é€‰ç‰ˆæœ¬çš„CUDAã€‚</li><li><strong>ã€ŒCUDAå·¥å…·å’Œåº“ã€</strong>ï¼šNVIDIAæä¾›äº†ä¸€å¥—ç”¨äºCUDAå¼€å‘çš„å·¥å…·å’Œåº“ï¼ŒåŒ…æ‹¬CUDAToolkitã€cuDNNï¼ˆCUDAæ·±åº¦ç¥ç»ç½‘ç»œåº“ï¼‰ã€cuBLASï¼ˆCUDAåŸºç¡€çº¿æ€§ä»£æ•°åº“ï¼‰ç­‰ã€‚è¿™äº›å·¥å…·å’Œåº“ç®€åŒ–äº†CUDAåº”ç”¨ç¨‹åºçš„å¼€å‘å’Œä¼˜åŒ–è¿‡ç¨‹ã€‚</li></ol><h4 id="cudnn">cuDNN</h4><hr /><p>cuDNNï¼ˆCUDA Deep Neural NetworkLibraryï¼‰æ˜¯ç”±NVIDIAå¼€å‘çš„ç”¨äºæ·±åº¦å­¦ä¹ çš„åŠ é€Ÿåº“ã€‚cuDNNæ—¨åœ¨ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­è¿‡ç¨‹ï¼Œä»¥åˆ©ç”¨NVIDIAGPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œä»è€ŒåŠ é€Ÿæ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚</p><p><strong>cuDNNçš„ä½œç”¨ç‰¹ç‚¹ï¼š</strong></p><ol type="1"><li><strong>ã€Œæ·±åº¦å­¦ä¹ åŠ é€Ÿã€</strong>ï¼šcuDNNæ˜¯ä¸“é—¨ä¸ºæ·±åº¦å­¦ä¹ ä»»åŠ¡è€Œè®¾è®¡çš„ï¼Œæ—¨åœ¨åŠ é€Ÿç¥ç»ç½‘ç»œçš„è®­ç»ƒå’Œæ¨ç†ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—é«˜åº¦ä¼˜åŒ–çš„ç®—æ³•å’Œå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œç¥ç»ç½‘ç»œå±‚çš„å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œæƒé‡æ›´æ–°ã€‚</li><li><strong>ã€ŒGPUåŠ é€Ÿã€</strong>ï¼š cuDNNå……åˆ†åˆ©ç”¨NVIDIAGPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œä»¥é«˜æ•ˆåœ°æ‰§è¡Œæ·±åº¦å­¦ä¹ æ“ä½œã€‚è¿™ä½¿å¾—è®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œæ›´å¿«é€Ÿï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ¨¡å‹å’Œå¤§è§„æ¨¡æ•°æ®é›†ã€‚</li><li><strong>ã€Œæ·±åº¦å­¦ä¹ æ¡†æ¶æ”¯æŒã€</strong>ï¼šcuDNNè¢«å¹¿æ³›ç”¨äºå¤šä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ŒåŒ…æ‹¬TensorFlowã€PyTorchã€Caffeã€MXNetç­‰ã€‚è¿™äº›æ¡†æ¶é€šè¿‡cuDNNæ¥åŠ é€Ÿæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ï¼Œä½¿å¾—æ·±åº¦å­¦ä¹ ç ”ç©¶å’Œå¼€å‘æ›´åŠ é«˜æ•ˆã€‚</li><li><strong>ã€Œæé«˜æ€§èƒ½ã€</strong>ï¼šcuDNNé€šè¿‡ä½¿ç”¨é«˜åº¦ä¼˜åŒ–çš„å·ç§¯å’Œæ± åŒ–ç®—æ³•ã€è‡ªåŠ¨æ··åˆç²¾åº¦è®¡ç®—ã€å†…å­˜ç®¡ç†å’Œå¤šGPUæ”¯æŒç­‰æŠ€æœ¯ï¼Œæ˜¾è‘—æé«˜äº†æ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ€§èƒ½ã€‚è¿™äº›ä¼˜åŒ–å¯ä»¥åŠ é€Ÿå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ã€å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ã€ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ç­‰å„ç§ç±»å‹çš„ç¥ç»ç½‘ç»œã€‚</li><li><strong>ã€Œç‰ˆæœ¬å…¼å®¹æ€§ã€</strong>ï¼š cuDNNçš„ä¸åŒç‰ˆæœ¬ä¸NVIDIAGPUæ¶æ„å’Œæ·±åº¦å­¦ä¹ æ¡†æ¶çš„ç‰ˆæœ¬å…¼å®¹ã€‚å› æ­¤ï¼Œä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œä½ éœ€è¦é€‰æ‹©é€‚ç”¨äºä½ çš„GPUå‹å·å’Œæ·±åº¦å­¦ä¹ æ¡†æ¶ç‰ˆæœ¬çš„cuDNNç‰ˆæœ¬ã€‚</li><li><strong>ã€Œå…è´¹ä½¿ç”¨ã€</strong>ï¼šcuDNNæ˜¯å…è´¹çš„ï¼Œå¯ä»¥åœ¨NVIDIAçš„å®˜æ–¹ç½‘ç«™ä¸Šä¸‹è½½å’Œä½¿ç”¨ã€‚</li></ol><h4 id="pytorch">Pytorch</h4><hr /><p>PyTorchæ˜¯ä¸€ä¸ªå¼€æºçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œç”±Facebookçš„äººå·¥æ™ºèƒ½ç ”ç©¶å›¢é˜Ÿå¼€å‘å’Œç»´æŠ¤ã€‚å®ƒæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p><p><strong>pytorchçš„ä½œç”¨å’Œç‰¹ç‚¹:</strong></p><ol type="1"><li><strong>ã€ŒåŠ¨æ€è®¡ç®—å›¾ã€</strong>ï¼š PyTorch é‡‡ç”¨åŠ¨æ€è®¡ç®—å›¾ï¼ˆDynamicComputationalGraphï¼‰çš„æ–¹å¼æ¥å®šä¹‰å’Œæ‰§è¡Œç¥ç»ç½‘ç»œã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åƒç¼–å†™å¸¸è§„Pythonä»£ç ä¸€æ ·ç¼–å†™ç¥ç»ç½‘ç»œï¼ŒåŒæ—¶ä¿ç•™äº†è®¡ç®—å›¾çš„ä¼˜åŠ¿ï¼Œä½¿æ¨¡å‹çš„æ„å»ºå’Œè°ƒè¯•æ›´åŠ ç›´è§‚å’Œçµæ´»ã€‚</li><li><strong>ã€Œçµæ´»æ€§ã€</strong>ï¼š PyTorchæä¾›äº†ä¸°å¯Œçš„å¼ é‡æ“ä½œï¼Œä»¥åŠå„ç§ä¼˜åŒ–å·¥å…·å’Œæ¨¡å—ï¼Œå¯ä»¥è½»æ¾æ„å»ºå„ç§ç±»å‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ŒåŒ…æ‹¬å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ã€å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ã€ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ç­‰ã€‚å®ƒè¿˜æ”¯æŒè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚å’ŒæŸå¤±å‡½æ•°ï¼Œå…è®¸ä½ åˆ›å»ºé«˜åº¦å®šåˆ¶çš„æ¨¡å‹ã€‚</li><li><strong>ã€ŒGPUåŠ é€Ÿã€</strong>ï¼šPyTorchå¤©ç„¶æ”¯æŒGPUåŠ é€Ÿï¼Œä½ å¯ä»¥åœ¨GPUä¸Šè®­ç»ƒå’Œæ‰§è¡Œç¥ç»ç½‘ç»œï¼Œå¤§å¹…æé«˜äº†è®¡ç®—æ€§èƒ½ã€‚PyTorchçš„GPUå¼ é‡æ“ä½œä¸CPUå¼ é‡æ“ä½œéå¸¸ç›¸ä¼¼ï¼Œä½¿å¾—å°†è®¡ç®—ä»CPUè¿ç§»åˆ°GPUå˜å¾—ç›¸å¯¹å®¹æ˜“ã€‚</li><li><strong>ã€ŒåŠ¨æ€è°ƒè¯•ã€</strong>ï¼šç”±äºé‡‡ç”¨åŠ¨æ€è®¡ç®—å›¾ï¼ŒPyTorchå…è®¸ä½ åœ¨æ¨¡å‹æ„å»ºå’Œè®­ç»ƒè¿‡ç¨‹ä¸­è½»æ¾è¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œæ£€æŸ¥æ¢¯åº¦ã€æŸ¥çœ‹ä¸­é—´å˜é‡ç­‰ã€‚è¿™å¯¹äºç†è§£å’Œè¯Šæ–­æ¨¡å‹è¡Œä¸ºéå¸¸æœ‰å¸®åŠ©ã€‚</li><li><strong>ã€Œä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿã€</strong>ï¼šPyTorchæ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¤¾åŒºï¼Œæœ‰è®¸å¤šå¼€æºé¡¹ç›®ã€åº“å’Œå·¥å…·ï¼Œå¯ä»¥æ‰©å±•å…¶åŠŸèƒ½ã€‚è¿™äº›åŒ…æ‹¬æ¨¡å‹éƒ¨ç½²å·¥å…·ã€è¿ç§»å­¦ä¹ åº“ã€è‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·å’Œè®¡ç®—æœºè§†è§‰å·¥å…·ï¼Œä»¥åŠä¸å…¶ä»–æ·±åº¦å­¦ä¹ æ¡†æ¶çš„é›†æˆã€‚</li><li><strong>ã€Œæ·±åº¦å­¦ä¹ ç ”ç©¶å’Œæ•™è‚²ã€</strong>ï¼šPyTorchåœ¨æ·±åº¦å­¦ä¹ ç ”ç©¶å’Œæ•™è‚²ä¸­éå¸¸æµè¡Œï¼Œå› ä¸ºå®ƒæ˜“äºå­¦ä¹ ã€æ˜“äºä½¿ç”¨ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„æ•™ç¨‹å’Œæ–‡æ¡£èµ„æºã€‚å®ƒè¿˜è¢«è®¸å¤šå¤§å­¦å’Œç ”ç©¶æœºæ„ç”¨äºæ·±åº¦å­¦ä¹ è¯¾ç¨‹å’Œç ”ç©¶é¡¹ç›®ã€‚</li><li><strong>ã€Œè·¨å¹³å°æ”¯æŒã€</strong>ï¼šPyTorchæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬Linuxã€macOSå’ŒWindowsï¼Œä»¥åŠå¤šç§ç¼–ç¨‹è¯­è¨€æ¥å£ï¼Œå¦‚Pythonã€C++ç­‰ã€‚è¿™ä½¿å¾—å®ƒé€‚ç”¨äºå„ç§åº”ç”¨åœºæ™¯ã€‚</li></ol><h4 id="cudacudnnpytorchçš„å…³ç³»">CUDAã€cuDNNã€Pytorchçš„å…³ç³»</h4><hr /><p>CUDAã€cuDNN å’Œ PyTorchæ˜¯ä¸‰ä¸ªä¸åŒä½†ç›¸å…³çš„ç»„ä»¶ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›ä¾èµ–å…³ç³»ï¼Œ</p><ol type="1"><li>ã€ŒCUDAï¼ˆCompute Unified Device Architectureï¼‰ã€:<ul><li><strong>ã€ŒCUDAæ˜¯GPUå¹¶è¡Œè®¡ç®—å¹³å°ã€</strong>ï¼šCUDA æ˜¯ç”± NVIDIAå¼€å‘çš„ç”¨äºå¹¶è¡Œè®¡ç®—çš„å¹³å°å’Œç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜åˆ©ç”¨ NVIDIA GPUçš„å¼ºå¤§è®¡ç®—èƒ½åŠ›æ¥åŠ é€Ÿå„ç§ç§‘å­¦è®¡ç®—ã€æ•°å€¼æ¨¡æ‹Ÿå’Œæ·±åº¦å­¦ä¹ ä»»åŠ¡ã€‚</li><li><strong>ã€ŒPyTorchä¾èµ–CUDAã€</strong>ï¼šPyTorch ä½¿ç”¨ CUDAæ¥åŠ é€Ÿç¥ç»ç½‘ç»œçš„è®­ç»ƒå’Œæ¨ç†ã€‚åœ¨ PyTorch ä¸­ï¼Œå¼ é‡ï¼ˆTensorï¼‰å¯ä»¥åœ¨ CPU æˆ–GPU ä¸Šè¿›è¡Œè®¡ç®—ã€‚å¦‚æœä½ æƒ³åœ¨ GPU ä¸Šè®­ç»ƒç¥ç»ç½‘ç»œï¼Œä½ éœ€è¦ç¡®ä¿ CUDAå·²ç»æ­£ç¡®å®‰è£…å¹¶é…ç½®ã€‚</li><li><strong>ã€Œç‰ˆæœ¬å…¼å®¹æ€§ã€</strong>ï¼šä¸åŒç‰ˆæœ¬çš„ PyTorchå¯èƒ½éœ€è¦ç‰¹å®šç‰ˆæœ¬çš„ CUDAã€‚ä½ éœ€è¦æ ¹æ®æ‰€ä½¿ç”¨çš„ PyTorch ç‰ˆæœ¬æ¥é€‰æ‹©åˆé€‚çš„CUDA ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿å…¼å®¹æ€§ã€‚</li></ul></li><li>ã€ŒcuDNNï¼ˆCUDA Deep Neural Network Libraryï¼‰ã€:<ul><li><strong>ã€ŒcuDNNç”¨äºæ·±åº¦å­¦ä¹ åŠ é€Ÿã€</strong>ï¼šcuDNN æ˜¯ NVIDIAå¼€å‘çš„ä¸“é—¨ç”¨äºæ·±åº¦å­¦ä¹ çš„åŠ é€Ÿåº“ã€‚å®ƒæä¾›äº†é«˜åº¦ä¼˜åŒ–çš„å·ç§¯å’Œå…¶ä»–æ·±åº¦ç¥ç»ç½‘ç»œå±‚çš„æ“ä½œï¼Œä»¥æé«˜æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ€§èƒ½ã€‚</li><li><strong>ã€ŒPyTorchä¾èµ–cuDNNã€</strong>ï¼šPyTorch ä½¿ç”¨ cuDNNæ¥æ‰§è¡Œæ·±åº¦å­¦ä¹ æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ä¸­ã€‚cuDNNæä¾›äº†é«˜æ€§èƒ½çš„å·ç§¯æ“ä½œï¼Œä½¿ PyTorch èƒ½å¤Ÿåœ¨ GPUä¸Šé«˜æ•ˆåœ°è¿›è¡Œå‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ã€‚</li><li><strong>ã€Œç‰ˆæœ¬å…¼å®¹æ€§ã€</strong>ï¼šä¸åŒç‰ˆæœ¬çš„ PyTorch éœ€è¦ç‰¹å®šç‰ˆæœ¬çš„cuDNNã€‚ä½ éœ€è¦ç¡®ä¿æ‰€ä½¿ç”¨çš„ cuDNN ç‰ˆæœ¬ä¸ PyTorch ç‰ˆæœ¬å…¼å®¹ã€‚</li></ul></li><li>ã€ŒPyTorchã€:<ul><li><strong>ã€ŒPyTorchæ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶ã€</strong>ï¼šPyTorchæ˜¯ä¸€ä¸ªå¼€æºçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œç”¨äºæ„å»ºã€è®­ç»ƒå’Œéƒ¨ç½²ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å®ƒæä¾›äº†å¼ é‡æ“ä½œã€è‡ªåŠ¨æ±‚å¯¼ã€ä¼˜åŒ–å™¨ã€æŸå¤±å‡½æ•°ç­‰å·¥å…·ï¼Œä½¿æ·±åº¦å­¦ä¹ ä»»åŠ¡æ›´åŠ ä¾¿æ·ã€‚</li><li><strong>ã€ŒPyTorchä¾èµ–CUDAå’ŒcuDNNã€</strong>ï¼šPyTorch å¯ä»¥åœ¨ CPU æˆ–GPU ä¸Šè¿è¡Œï¼Œä½†ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§è§„æ¨¡æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œä½ é€šå¸¸ä¼šå°†PyTorch é…ç½®ä¸ºåœ¨ GPU ä¸Šè¿è¡Œã€‚è¿™å°±éœ€è¦ç¡®ä¿ CUDA å’Œ cuDNNå·²æ­£ç¡®å®‰è£…å’Œé…ç½®ã€‚</li></ul></li></ol><h4 id="æŸ¥çœ‹cuda">æŸ¥çœ‹CUDA</h4><hr /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-built_in">print</span>(torch.cuda.is_available())<br><span class="hljs-built_in">print</span>(torch.cuda.get_arch_list())<br>torch.zeros(<span class="hljs-number">1</span>).cuda()<br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">True<br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;sm_37&#x27;</span>, <span class="hljs-string">&#x27;sm_50&#x27;</span>, <span class="hljs-string">&#x27;sm_60&#x27;</span>, <span class="hljs-string">&#x27;sm_70&#x27;</span>, <span class="hljs-string">&#x27;sm_75&#x27;</span>, <span class="hljs-string">&#x27;sm_80&#x27;</span>, <span class="hljs-string">&#x27;sm_86&#x27;</span>]</span><br><span class="hljs-function"><span class="hljs-title">tensor</span><span class="hljs-params">([<span class="hljs-number">0</span>.], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>)</span></span><br></code></pre></td></tr></table></figure><p>torch.cuda.is_available() ä¸ºTrue è¯´æ˜CUDAæ˜¯å¯ç”¨çš„ï¼Œå¦‚æœä¸ºFalseå°±è¦æ£€æŸ¥pytorchçš„ç‰ˆæœ¬ä¸CUDAçš„ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ä¸€è‡´ã€‚</p><p>torch.cuda.get_arch_list() è¿”å›çš„æ˜¯CUDAæ¶æ„åˆ—è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´CUDAèƒ½æ”¯æŒçš„GPUçš„æ¶æ„ï¼Œä¸åŒç‰ˆæœ¬çš„CUDAæ”¯æŒçš„GPUæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦æ ¹æ®GPUçš„å‹å·/æ¶æ„æ¥é€‰æ‹©è¦å®‰è£…çš„CUDAç‰ˆæœ¬.</p><p>å¦‚æœcudaç‰ˆæœ¬å’ŒGPUå…¼å®¹ï¼Œåˆ™<code>torch.zeros(1).cuda()</code>åœ¨GPUä¸Šè¿ç®—å°±ä¼šæˆåŠŸï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p><p>å¦‚æœå®‰è£…äº†GPUæ˜¾å¡é©±åŠ¨ï¼šåœ¨å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nvidia-smi</span><br></code></pre></td></tr></table></figure><p><img src="nvidia-smi.png" alt="nvidia-smi" style="zoom:50%;" /></p><p>ä»ä¸Šå›¾å¯ä»¥çŸ¥é“å®‰è£…çš„é©±åŠ¨ç‰ˆæœ¬ä¸º550.78ï¼Œé©±åŠ¨APIç‰ˆæœ¬ä¸º12.4ï¼Œè¡¨ç¤ºè¯¥é©±åŠ¨æœ€é«˜æ”¯æŒCUDAè¿è¡Œæ—¶APIç‰ˆæœ¬ä¸º12.4ã€‚æ˜¾å¡æ˜¯GeForceRTX 3090,24Gæ˜¾å­˜ã€‚</p><p>æ ¹æ®ä¸Šè¿°ä¿¡æ¯ï¼Œä»nvidiaçš„ç½‘ç«™ä¸Šå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„<ahref="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html?spm=a2c4g.207292.0.0.62f2778erY9RgV">CUDAç‰ˆæœ¬</a>ã€‚</p><h4 id="pytorchçš„å®‰è£…">PyTorchçš„å®‰è£…</h4><hr /><p>åœ¨pytorchçš„<ahref="https://pytorch.org/">å®˜æ–¹ç½‘ç«™</a>ä¸Šå¯ä»¥æ‰¾åˆ°pytorchçš„å®‰è£…è¯´æ˜ã€‚å¦‚æœéœ€è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬pytorchå’Œå¯¹åº”çš„cudaç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨<ahref="https://pytorch.org/get-started/previous-versions/">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚ä»è¿™ä¸ªé¡µé¢æ‰¾åˆ°å¯¹åº”çš„pytorchç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿï¼Œæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤å³å¯ã€‚</p><p>å¦‚éœ€è¦å®‰è£…cuda=11.6 pytorch=1.12.0 torchvision=0.13.0torchaudio=0.12.0å°±å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install torch==1.12.0+cu116 torchvision==0.13.0+cu116 torchaudio==0.12.0 --extra-index-url https://download.pytorch.org/whl/cu116<br></code></pre></td></tr></table></figure><p>å…³äºGPUæ¶æ„å’ŒCUDAç®—åŠ›çš„å…³ç³»,å¯ä»¥æŸ¥çœ‹<ahref="https://cuiyuhao.com/posts/8a630bae/">è¿™ç¯‡æ–‡ç« </a></p><h4 id="pytorchåœ¨gpuä¸Šè®­ç»ƒçš„æ–¹æ³•">pytorchåœ¨GPUä¸Šè®­ç»ƒçš„æ–¹æ³•</h4><hr /><p>æ–¹æ³•ä¸€ .cuda()</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ç½‘ç»œæ¨¡å‹ï¼Œæ•°æ®ï¼ŒæŸå¤±å‡½æ•°è¿™ä¸‰ç§å˜é‡è°ƒç”¨ .cuda()æ¥åœ¨GPUä¸Šè¿›è¡Œè®­ç»ƒ.</p><p><img src="cuda.png" style="zoom:50%;" /></p><p>æ¯”å¦‚:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å°†ç½‘ç»œæ¨¡å‹åœ¨gpuä¸Šè®­ç»ƒ</span><br>model = Model()<br><span class="hljs-keyword">if</span> torch.cuda.is_available(): <span class="hljs-comment"># åˆ¤æ–­ cuda æ˜¯å¦å¯ç”¨</span><br>model = model.cuda()<br><br><span class="hljs-comment"># æŸå¤±å‡½æ•°åœ¨gpuä¸Šè®­ç»ƒ</span><br>loss_fn = nn.CrossEntropyLoss()<br><span class="hljs-keyword">if</span> torch.cuda.is_available(): <span class="hljs-comment"># åˆ¤æ–­ cuda æ˜¯å¦å¯ç”¨</span><br>loss_fn = loss_fn.cuda()<br><br><span class="hljs-comment"># æ•°æ®åœ¨gpuä¸Šè®­ç»ƒ</span><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:                        <br>imgs, targets = data<br>    <span class="hljs-keyword">if</span> torch.cuda.is_available(): <span class="hljs-comment"># åˆ¤æ–­ cuda æ˜¯å¦å¯ç”¨</span><br>        imgs = imgs.cuda()<br>        targets = targets.cuda()<br><br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ .to(device)</p><p>æŒ‡å®šè®­ç»ƒè®¾å¤‡:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<span class="hljs-comment"># ä½¿ç”¨cpuè®­ç»ƒ</span><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>)<span class="hljs-comment"># ä½¿ç”¨gpuè®­ç»ƒ </span><br>device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span>)<span class="hljs-comment"># å½“ç”µè„‘ä¸­æœ‰å¤šå¼ æ˜¾å¡æ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€å¼ æ˜¾å¡</span><br>device = torch.device(<span class="hljs-string">&quot;cuda:1&quot;</span>)<span class="hljs-comment"># å½“ç”µè„‘ä¸­æœ‰å¤šå¼ æ˜¾å¡æ—¶ï¼Œä½¿ç”¨ç¬¬äºŒå¼ æ˜¾å¡</span><br><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨GPUè®­ç»ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">model = model.to(device)<br><br>loss_fn = loss_fn.to(device)<br><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> train_dataloader:<br>    imgs, targets = data<br>    imgs = imgs.to(device)<br>    targets = targets.to(device)<br><br></code></pre></td></tr></table></figure><h4 id="qa">Q&amp;A</h4><ol type="1"><li><p>CUDA error: no kernel image is available for execution on thedevice</p><p>å½“å‰GPUçš„ç®—åŠ›ä¸å½“å‰ç‰ˆæœ¬çš„Pytorchä¾èµ–çš„CUDAç®—åŠ›ä¸åŒ¹é…ã€‚</p><p>è§£å†³ï¼šéœ€è¦æ ¹æ®æ˜¾å¡çš„cudaç‰ˆæœ¬ï¼Œé‡æ–°å®‰è£…pytorchçš„ç‰ˆæœ¬.</p></li><li><p>Expected all tensors to be on the same device, but found at leasttwo devices, cuda:0 and cpu! (when checking argument for argument indexin method wrapper__index_select)</p><p>åŸå› ï¼šå‚ä¸è¿ç®—çš„ä¸¤ä¸ªæˆ–å¤šä¸ªå˜é‡ï¼Œæœ‰çš„åœ¨CPUä¸Šï¼Œæœ‰çš„åœ¨GPUä¸Š</p><p>è§£å†³æ–¹æ¡ˆ:å…ˆæ‰¾åˆ°æŠ¥é”™çš„è¡Œï¼Œçœ‹çœ‹è®¡ç®—æ—¶éƒ½ç”¨åˆ°å“ªäº›å˜é‡æˆ–è€…æ•°æ®ï¼Œç„¶ååœ¨è°ƒè¯•æ¨¡å¼ä¸‹ä½¿ç”¨.is_cudaè¿™ä¸ªå±æ€§å»æŸ¥çœ‹åˆ°åº•å“ªäº›æ˜¯åœ¨GPUä¸Šï¼Œå“ªäº›æ˜¯åœ¨CPUä¸Šï¼Œç„¶åæŠŠå®ƒä»¬ç»Ÿä¸€éƒ½æ”¾åœ¨CPUï¼Œæˆ–è€…ç»Ÿä¸€æ”¾åœ¨GPUä¸Šå°±å¯ä»¥ã€‚å¦‚æœå¢åŠ äº†å˜é‡ï¼Œéœ€è¦å°†æ–°å¢åŠ çš„å˜é‡ä¹Ÿæ¬åˆ°GPUä¸Šå»ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>æ·±åº¦å­¦ä¹ </category>
      
      <category>pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchçš„model.train()ä¸model.eval()</title>
    <link href="/2024/08/07/pytorch%E7%9A%84model-train-%E4%B8%8Emodel-eval/"/>
    <url>/2024/08/07/pytorch%E7%9A%84model-train-%E4%B8%8Emodel-eval/</url>
    
    <content type="html"><![CDATA[<p>åœ¨pytorchçš„æ·±åº¦å­¦ä¹ ä»£ç ä¸­ï¼Œç»å¸¸é‡åˆ°model.train() å’Œ model.eval()ï¼Œè¿™ä¸¤å¥ä»£ç æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç©¶ç«Ÿæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>å…ˆçœ‹<ahref="https://pytorch.org/docs/stable/generated/torch.nn.Module.html">æ–‡æ¡£</a>ã€‚</p><figure><img src="train.png" alt="train" /><figcaption aria-hidden="true">train</figcaption></figure><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œtrain()å°±æ˜¯æŠŠmoduleè®¾ç½®ä¸ºè®­ç»ƒ(training)æ¨¡å¼ã€‚</p><figure><img src="eval.png" alt="eval" /><figcaption aria-hidden="true">eval</figcaption></figure><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œeval()å°±æ˜¯æŠŠmoduleè®¾ç½®ä¸ºè¯„ä»·(evaluation)æ¨¡å¼ã€‚</p><p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šå¯¹æ¨¡å‹æœ‰ä¸€å®šå½±å“ï¼Œæ¯”å¦‚å¯¹BNå’Œdropoutçš„å½±å“ã€‚é‚£å…·ä½“åœ¨ä½¿ç”¨ä¸­æ˜¯æ€ä¹ˆå½±å“çš„å‘¢ï¼Ÿ</p><h4 id="train">train</h4><p>å¦‚æœæ¨¡å‹ä¸­æœ‰BNå±‚ï¼ˆBatch Normalizationï¼‰å’Œ Dropout ï¼Œéœ€è¦åœ¨ è®­ç»ƒæ—¶æ·»åŠ  model.train()ã€‚</p><p>model.train() æ˜¯ä¿è¯ BN å±‚èƒ½å¤Ÿç”¨åˆ° æ¯ä¸€æ‰¹æ•°æ® çš„å‡å€¼å’Œæ–¹å·®ã€‚å¯¹äºDropoutï¼Œmodel.train() æ˜¯ éšæœºå–ä¸€éƒ¨åˆ† ç½‘ç»œè¿æ¥æ¥è®­ç»ƒæ›´æ–°å‚æ•°ã€‚</p><p>è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šåœ¨ç¨‹åºä¸Šæ–¹æ·»åŠ ä¸€å¥model.train()ï¼Œä½œç”¨æ˜¯ <strong>å¯ç”¨batch normalization (BN)å’Œ dropout</strong> ã€‚</p><h4 id="eval">eval</h4><p>å¦‚æœæ¨¡å‹ä¸­æœ‰ BN å±‚ï¼ˆBatch Normalizationï¼‰å’Œ Dropoutï¼Œåœ¨ æµ‹è¯•æ—¶ æ·»åŠ model.eval()ã€‚</p><p>model.eval() æ˜¯ä¿è¯ BN å±‚èƒ½å¤Ÿç”¨ å…¨éƒ¨è®­ç»ƒæ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼Œå³æµ‹è¯•è¿‡ç¨‹ä¸­è¦ä¿è¯ BN å±‚çš„å‡å€¼å’Œæ–¹å·®ä¸å˜ã€‚å¯¹äºDropoutï¼Œmodel.eval() æ˜¯åˆ©ç”¨åˆ°äº† æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼Œå³ä¸è¿›è¡Œéšæœºèˆå¼ƒç¥ç»å…ƒã€‚</p><p>model.eval()çš„ä½œç”¨æ˜¯ <strong>ä¸å¯ç”¨ Batch Normalization å’ŒDropout</strong>ã€‚</p><h4 id="ä¸ºä»€ä¹ˆæµ‹è¯•è¦ç”¨eval">ä¸ºä»€ä¹ˆæµ‹è¯•è¦ç”¨eval</h4><p>è®­ç»ƒå®Œ train æ ·æœ¬åï¼Œç”Ÿæˆçš„æ¨¡å‹ model è¦ç”¨æ¥æµ‹è¯•æ ·æœ¬äº†ã€‚åœ¨model(test)ä¹‹å‰ï¼Œéœ€è¦åŠ ä¸Šmodel.eval()ï¼Œå¦åˆ™çš„è¯ï¼Œæœ‰è¾“å…¥æ•°æ®ï¼Œå³ä½¿ä¸è®­ç»ƒï¼Œå®ƒä¹Ÿä¼šæ”¹å˜æƒå€¼ã€‚è¿™æ˜¯model ä¸­å«æœ‰ BN å±‚å’Œ Dropout æ‰€å¸¦æ¥çš„çš„æ€§è´¨ã€‚</p><p>eval() æ—¶ï¼Œpytorch ä¼šè‡ªåŠ¨æŠŠ BN å’Œ DropOutå›ºå®šä½ï¼Œä¸ä¼šå–å¹³å‡ï¼Œè€Œæ˜¯ç”¨è®­ç»ƒå¥½çš„å€¼ã€‚ ä¸ç„¶çš„è¯ï¼Œä¸€æ—¦ test çš„ batch_sizeè¿‡å°ï¼Œå¾ˆå®¹æ˜“å°±ä¼šè¢« BN å±‚å¯¼è‡´ç”Ÿæˆå›¾ç‰‡é¢œè‰²å¤±çœŸæå¤§ã€‚ eval()åœ¨éè®­ç»ƒçš„æ—¶å€™æ˜¯éœ€è¦åŠ çš„ï¼Œæ²¡æœ‰è¿™å¥ä»£ç ï¼Œä¸€äº›ç½‘ç»œå±‚çš„å€¼ä¼šå‘ç”Ÿå˜åŠ¨ï¼Œä¸ä¼šå›ºå®šï¼Œä½ ç¥ç»ç½‘ç»œæ¯ä¸€æ¬¡ç”Ÿæˆçš„ç»“æœä¹Ÿæ˜¯ä¸å›ºå®šçš„ï¼Œç”Ÿæˆè´¨é‡å¯èƒ½å¥½ä¹Ÿå¯èƒ½ä¸å¥½ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨model.eval()ï¼Œè¿™æ—¶ç¥ç»ç½‘ç»œä¼š æ²¿ç”¨ batchnormalization çš„å€¼ï¼Œè€Œå¹¶ ä¸ä½¿ç”¨ dropoutã€‚</p><p>åœ¨PyTorchä¸­è¿›è¡Œvalidation/testæ—¶ï¼Œä¼šä½¿ç”¨model.eval()åˆ‡æ¢åˆ°æµ‹è¯•æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼š</p><p>1.ä¸»è¦ç”¨äºé€šçŸ¥dropoutå±‚å’ŒBNå±‚åœ¨trainingå’Œvalidation/testæ¨¡å¼é—´åˆ‡æ¢ï¼š</p><p>åœ¨trainæ¨¡å¼ä¸‹ï¼Œdropoutç½‘ç»œå±‚ä¼šæŒ‰ç…§è®¾å®šçš„å‚æ•°pï¼Œè®¾ç½®ä¿ç•™æ¿€æ´»å•å…ƒçš„æ¦‚ç‡ï¼ˆä¿ç•™æ¦‚ç‡=p)ã€‚BNå±‚ä¼šç»§ç»­è®¡ç®—æ•°æ®çš„meanå’Œvarç­‰å‚æ•°å¹¶æ›´æ–°ã€‚åœ¨evalæ¨¡å¼ä¸‹ï¼Œdropoutå±‚ä¼šè®©æ‰€æœ‰çš„æ¿€æ´»å•å…ƒéƒ½é€šè¿‡ï¼Œè€ŒBNå±‚ä¼šåœæ­¢è®¡ç®—å’Œæ›´æ–°meanå’Œvarï¼Œç›´æ¥ä½¿ç”¨åœ¨è®­ç»ƒé˜¶æ®µå·²ç»å­¦å‡ºçš„meanå’Œvarå€¼ã€‚</p><p>2.evalæ¨¡å¼ä¸ä¼šå½±å“å„å±‚çš„gradientè®¡ç®—è¡Œä¸ºï¼Œå³gradientè®¡ç®—å’Œå­˜å‚¨ä¸trainingæ¨¡å¼ä¸€æ ·ï¼Œåªæ˜¯ä¸è¿›è¡Œåå‘ä¼ æ’­ï¼ˆbackprobagation)ã€‚</p><p>è€Œ<strong>withtorch.no_grad()</strong>åˆ™ä¸»è¦æ˜¯ç”¨äºåœæ­¢autogradæ¨¡å—çš„å·¥ä½œï¼Œä»¥èµ·åˆ°åŠ é€Ÿå’ŒèŠ‚çœæ˜¾å­˜çš„ä½œç”¨ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†è¯¥withè¯­å¥åŒ…è£¹èµ·æ¥çš„éƒ¨åˆ†åœæ­¢æ¢¯åº¦çš„æ›´æ–°ï¼Œä»è€ŒèŠ‚çœäº†GPUç®—åŠ›å’Œæ˜¾å­˜ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå½±å“dropoutå’ŒBNå±‚çš„è¡Œä¸ºã€‚</p><p>å¦‚æœä¸åœ¨æ„æ˜¾å­˜å¤§å°å’Œè®¡ç®—æ—¶é—´çš„è¯ï¼Œä»…ä»…ä½¿ç”¨model.eval()å·²è¶³å¤Ÿå¾—åˆ°æ­£ç¡®çš„validation/testçš„ç»“æœï¼›è€Œwithtorch.no_grad()åˆ™æ˜¯æ›´è¿›ä¸€æ­¥åŠ é€Ÿå’ŒèŠ‚çœgpuç©ºé—´ï¼ˆå› ä¸ºä¸ç”¨è®¡ç®—å’Œå­˜å‚¨æ¢¯åº¦ï¼‰ï¼Œä»è€Œå¯ä»¥æ›´å¿«è®¡ç®—ï¼Œä¹Ÿå¯ä»¥è·‘æ›´å¤§çš„batchæ¥æµ‹è¯•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>æ·±åº¦å­¦ä¹ </category>
      
      <category>pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ å…¥é—¨</title>
    <link href="/2024/07/26/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/"/>
    <url>/2024/07/26/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="æ„ŸçŸ¥æœº">æ„ŸçŸ¥æœº</h3><hr /><p><strong>æ„ŸçŸ¥æœº</strong> (perception) æ˜¯ç¾å›½å­¦è€…FrankRosenblattæå‡ºæ¥çš„ï¼ˆ1957å¹´ï¼‰ã€‚äº†è§£æ„ŸçŸ¥æœºå¯ä»¥æ›´å¥½çš„å­¦ä¹ ç¥ç»ç½‘ç»œï¼ˆæ·±åº¦å­¦ä¹ ï¼‰çš„é‡è¦æ€æƒ³ã€‚æ„ŸçŸ¥æœºæ˜¯ä¸€ç§æœ€ç®€å•å½¢å¼çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§äºŒå…ƒçº¿æ€§åˆ†ç±»å™¨ã€‚</p><center><img src="2LP.png" alt="æœ‰ä¸¤ä¸ªè¾“å…¥çš„æ„ŸçŸ¥æœº" style="zoom:33%;" /><br/><br/> å›¾ï¼šæœ‰ä¸¤ä¸ªè¾“å…¥çš„æ„ŸçŸ¥æœº</center><p>å›¾ä¸­çš„<span class="math inline">\(x_1,x_2\)</span> æ˜¯è¾“å…¥ä¿¡å·ï¼Œ<spanclass="math inline">\(y\)</span>æ˜¯è¾“å‡ºä¿¡å·ï¼Œ<spanclass="math inline">\(w_1, w_2\)</span> æ˜¯æƒé‡(weight)ï¼Œ<spanclass="math inline">\(\bigcirc\)</span>æ˜¯ç¥ç»å…ƒ(èŠ‚ç‚¹)ï¼Œè¾“å…¥ä¿¡å·è¢«é€å¾€ç¥ç»å…ƒæ—¶ï¼Œä¼šè¢«åˆ†åˆ«ä¹˜ä»¥å›ºå®šçš„æƒé‡<spanclass="math inline">\((w_1x_1, w_2x_2)\)</span>ã€‚ç¥ç»å…ƒè®¡ç®—ä¼ é€’è¿‡æ¥çš„ä¿¡å·æ€»å’Œï¼Œå½“æ€»å’Œè¶…è¿‡æŸä¸ªç•Œé™å€¼ï¼ˆé˜ˆå€¼ï¼‰ï¼Œè¾“å‡º1ï¼Œå°±ç§°ä¸ºâ€œç¥ç»å…ƒè¢«æ¿€æ´»â€ã€‚ç•Œé™å€¼ï¼ˆé˜ˆå€¼ï¼‰ç”¨<spanclass="math inline">\(\theta\)</span> è¡¨ç¤ºã€‚</p><p>æ„ŸçŸ¥æœºçš„è¿è¡ŒåŸç†ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š <span class="math display">\[y=\begin{cases}0 &amp;&amp;(w_1x_1+w_2x_2 \leq \theta) \\1 &amp;&amp;(w_1x_1+w_2x_2 &gt; \theta)\end{cases}\]</span>æ„ŸçŸ¥æœºä¸­è¾“å…¥ä¿¡å·çš„æƒé‡è¶Šå¤§ï¼Œè¯´æ˜ä¿¡å·çš„é‡è¦æ€§å°±è¶Šé«˜ã€‚å¦‚æœæŠŠ<spanclass="math inline">\(\theta\)</span> æ¢æˆ <spanclass="math inline">\(-b\)</span> ï¼Œæ„ŸçŸ¥æœºçš„è¡¨ç¤ºå°±å¯ä»¥å˜æˆå¦å¤–ä¸€ç§å½¢å¼ï¼š <span class="math display">\[y=\begin{cases}0 &amp;&amp;(b+w_1x_1+w_2x_2 \leq 0) \\1 &amp;&amp;(b+w_1x_1+w_2x_2 &gt; 0)\end{cases}\]</span> ç°åœ¨<span class="math inline">\(b\)</span> è¢«ç§°ä¸ºåç½®ï¼Œ<spanclass="math inline">\(w_1,w_2\)</span>æ˜¯æƒé‡ï¼Œ<spanclass="math inline">\(x_1,x_2\)</span>æ˜¯è¾“å…¥ã€‚</p><h4 id="å•å±‚æ„ŸçŸ¥æœºçš„å±€é™æ€§">å•å±‚æ„ŸçŸ¥æœºçš„å±€é™æ€§</h4><p>å•å±‚æ„ŸçŸ¥æœºçš„å±€é™æ€§åœ¨äºåªèƒ½è¡¨ç¤ºç”±ä¸€æ¡ç›´çº¿åˆ†å‰²çš„ç©ºé—´ï¼ˆçº¿æ€§ç©ºé—´ï¼‰ã€‚å¦‚æœè¦è¡¨ç¤ºéçº¿æ€§ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ç»„åˆï¼ˆå åŠ ï¼‰å•å±‚æ„ŸçŸ¥æœºï¼Œå®ç°å¤šå±‚æ„ŸçŸ¥æœºï¼Œé€šè¿‡å¤šå±‚æ„ŸçŸ¥æœºè¡¨ç¤ºéçº¿æ€§ç©ºé—´ã€‚</p><h5 id="å¤šå±‚æ„ŸçŸ¥æœº">å¤šå±‚æ„ŸçŸ¥æœº</h5><p>å¤šå±‚æ„ŸçŸ¥æœº(multi-layer perception, MLP)æ˜¯å åŠ äº†å¤šå±‚æ„ŸçŸ¥æœº(å•å±‚æ„ŸçŸ¥æœº)çš„æ„ŸçŸ¥æœºã€‚</p><center><img src="MLP.png" alt="å¤šå±‚æ„ŸçŸ¥æœº" style="zoom:33%;" /> <br/><br/>å›¾ï¼šå¤šå±‚æ„ŸçŸ¥æœº</center><p>ç¬¬0å±‚æ˜¯è¾“å…¥ï¼Œç¬¬2å±‚æ˜¯è¾“å‡ºã€‚ä¸Šå›¾ä¸­çš„æ„ŸçŸ¥æœºï¼Œå¦‚æœæ˜¯æŒ‰ç…§æ‹¥æœ‰æƒé‡çš„å±‚ï¼Œæ˜¯2å±‚æ„ŸçŸ¥æœºï¼Œå¦‚æœæ˜¯æŒ‰ç…§æ‹¥æœ‰ç¥ç»å…ƒçš„å±‚ï¼Œæ˜¯3å±‚æ„ŸçŸ¥æœºã€‚</p><h4 id="ç¥ç»ç½‘ç»œ">ç¥ç»ç½‘ç»œ</h4><hr /><p>æ—¢ç„¶æ„ŸçŸ¥æœºï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰å¯ä»¥è¿›è¡Œå¤æ‚ä»»åŠ¡çš„å¤„ç†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ç¥ç»ç½‘ç»œå‘¢ï¼Ÿå› ä¸ºè®¾ç½®åˆé€‚çš„ã€å¯ä»¥ç¬¦åˆé¢„æœŸçš„æ„ŸçŸ¥æœºçš„æƒé‡æ˜¯ä¸€ä¸ªéº»çƒ¦çš„å·¥ä½œï¼Œè€Œä¸”ä¸»è¦æ˜¯æœ‰äººå·¥è¿›è¡Œè®¾ç½®ã€‚ç¥ç»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦æ€§è´¨å°±æ˜¯å¯ä»¥è‡ªåŠ¨åœ°ä»æ•°æ®ä¸­å­¦ä¹ åˆ°åˆé€‚çš„æƒé‡å‚æ•°ã€‚</p><center><img src="network.png" alt="ç¥ç»ç½‘ç»œ" style="zoom:33%;" /> <br/><br/>å›¾ï¼šç¥ç»ç½‘ç»œ</center><p>å¦‚å›¾æ‰€ç¤ºï¼Œæœ€å·¦è¾¹çš„ä¸€åˆ—æ˜¯è¾“å…¥å±‚ï¼Œæœ€å³è¾¹ä¸€åˆ—æ˜¯è¾“å‡ºå±‚ï¼Œä¸­é—´ä¸€åˆ—çš„ä¸­é—´å±‚ä¹Ÿç§°ä¸ºéšè—å±‚ã€‚è¿™ä¸ªç¥ç»ç½‘ç»œå’Œå¤šå±‚æ„ŸçŸ¥æœºéå¸¸åƒã€‚</p><p>åœ¨ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºæ„ŸçŸ¥æœºæ—¶ï¼Œæˆ‘ä»¬ç”¨äº†åç½®<spanclass="math inline">\(b\)</span>ï¼Œä½†æ˜¯åœ¨å›¾ä¸­çš„ç¥ç»å…ƒä¸­å¹¶æ²¡æœ‰åç½®é¡¹<spanclass="math inline">\(b\)</span>ã€‚åœ¨ç¥ç»ç½‘ç»œçš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåç½®é¡¹è¡¨ç¤ºå‡ºæ¥ï¼Œå¹¶ç”¨<spanclass="math inline">\(y=h(\boldsymbol b+\boldsymbol w\boldsymbolx)\)</span>çš„å½¢å¼å†™å‡ºç¥ç»ç½‘ç»œçš„è¡¨è¾¾å¼ã€‚</p><center><img src="bias.png" alt="ç¥ç»ç½‘ç»œçš„åç½®é¡¹" style="zoom:33%;" /><br/><br/> å›¾ï¼šç¥ç»ç½‘ç»œçš„åç½®é¡¹</center><p><span class="math display">\[h(x)=\begin{cases}0 &amp;&amp;(x \leq 0) \\1 &amp;&amp;(x &gt; 0)\end{cases}\]</span></p><h5 id="æ¿€æ´»å‡½æ•°">æ¿€æ´»å‡½æ•°</h5><p>åƒ<spanclass="math inline">\(h(x)\)</span>è¿™æ ·æŠŠè¾“å…¥ä¿¡å·è½¬ä¸ºè¾“å‡ºä¿¡å·çš„å‡½æ•°ç§°ä¸º<strong>æ¿€æ´»å‡½æ•°</strong>(activationfuncation)ã€‚æ¯”å¦‚ <span class="math inline">\(a=b+w_1x_1 +w_2x_2\)</span> , <span class="math inline">\(y=h(a)\)</span> , <spanclass="math inline">\(h()\)</span>å‡½æ•°å°†<spanclass="math inline">\(a\)</span>è½¬åŒ–ä¸º<spanclass="math inline">\(y\)</span> ã€‚</p><center><img src="af.png" alt="æ¿€æ´»å‡½æ•°çš„è®¡ç®—è¿‡ç¨‹" style="zoom:33%;" /><br/><br/> å›¾ï¼šæ¿€æ´»å‡½æ•°å·¥ä½œè¿‡ç¨‹</center><p>å¦‚å›¾æ‰€ç¤ºï¼Œçº¢çº¿æ¡†ä¸­æ ‡è¯†çš„ç¥ç»å…ƒ<spanclass="math inline">\(\bigcirc\)</span>æ˜¾ç¤ºäº†æ¿€æ´»å‡½æ•°çš„è®¡ç®—è¿‡ç¨‹ã€‚åœ¨ç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°æœ‰Reluã€sigmoidç­‰ã€‚åœ¨æ„ŸçŸ¥æœºä¸­ï¼Œæ¿€æ´»å‡½æ•°æ˜¯é˜¶è·ƒå‡½æ•°ã€‚é˜¶è·ƒå‡½æ•°ä»¥0ä¸ºç•Œï¼Œè¾“å‡ºä»0åˆ‡æ¢ä¸º1ï¼ˆæˆ–è€…ä»1åˆ‡æ¢ä¸º0ï¼‰ã€‚å®ƒçš„å€¼å‘ˆé˜¶æ¢¯å¼å˜åŒ–ï¼Œæ‰€ä»¥ç§°ä¸ºé˜¶è·ƒå‡½æ•°ã€‚</p><h6 id="sigmoidå‡½æ•°">sigmoidå‡½æ•°</h6><p>sigmoidå‡½æ•°(sigmoid function) çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š <spanclass="math display">\[h(x) = {1\over 1+e^{-x}}\]</span></p><p><span class="math inline">\(e^{-x}\)</span> ä¸­çš„<spanclass="math inline">\(e\)</span>æ˜¯è‡ªç„¶å¸¸æ•°ï¼Œæ˜¯æ— çº¿ä¸å¾ªç¯å°æ•°ï¼Œå…¶å€¼ç­‰äº2.71828â€¦.. è¿‘ä¼¼å€¼ä¸º<spanclass="math inline">\(271801\over 99990\)</span>ã€‚</p><p>sigmoidå‡½æ•°å›¾åƒå¦‚ä¸‹æ‰€ç¤º:</p><center><img src="sigmoid-1.png" alt="sigmoidå‡½æ•°å›¾åƒ" style="zoom:33%;" /><br/><br/> å›¾ï¼šsigmoidå‡½æ•°å›¾åƒ</center><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œsigmoidå‡½æ•°æ˜¯ä¸€æ¡å¹³æ»‘çš„æ›²çº¿ï¼Œè¾“å‡ºéšç€è¾“å…¥å‘ç”Ÿè¿ç»­æ€§çš„å˜åŒ–ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­æµåŠ¨çš„æ˜¯è¿ç»­çš„å®æ•°å€¼ä¿¡å·ã€‚sigmoidå‡½æ•°çš„å¹³æ»‘æ€§å¯¹ç¥ç»ç½‘ç»œçš„å­¦ä¹ å…·æœ‰é‡è¦æ„ä¹‰ã€‚sigmoidå‡½æ•°çš„å–å€¼è§„å¾‹æ˜¯ï¼šè¾“å…¥å°æ—¶ï¼Œè¾“å‡ºæ¥è¿‘0ï¼ˆä¸º0ï¼‰ï¼›éšç€è¾“å…¥å¢å¤§ï¼Œè¾“å‡ºå‘1é è¿‘ï¼ˆå˜æˆ1ï¼‰â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¾“å…¥ä¿¡å·ä¸ºé‡è¦ä¿¡æ¯æ—¶ï¼Œé˜¶è·ƒå‡½æ•°å’Œsigmoidå‡½æ•°éƒ½ä¼šè¾“å‡ºè¾ƒå¤§çš„å€¼ï¼›å½“è¾“å…¥ä¿¡å·ä¸ºä¸é‡è¦çš„ä¿¡æ¯æ—¶ï¼Œä¸¤è€…éƒ½è¾“å‡ºè¾ƒå°çš„å€¼ï¼›ä¸ç®¡è¾“å…¥ä¿¡å·æœ‰å¤šå°ï¼Œæˆ–è€…æœ‰å¤šå¤§ï¼Œè¾“å‡ºä¿¡å·çš„å€¼åœ¨0åˆ°1ä¹‹é—´ã€‚sigmoidå‡½æ•°æ˜¯éçº¿æ€§å‡½æ•°ã€‚</p><p>ä¸ºä»€ä¹ˆç¥ç»ç½‘ç»œè¦ä½¿ç”¨éçº¿æ€§å‡½æ•°å‘¢ï¼Ÿå› ä¸ºçº¿æ€§å‡½æ•°ä½¿å¾—åŠ æ·±ç¥ç»ç½‘ç»œçš„å±‚æ•°æ²¡æœ‰æ„ä¹‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ<spanclass="math inline">\(h=cx\)</span>æ˜¯ä¸€ä¸ªçº¿æ€§å‡½æ•°ï¼Œå‡è®¾æŠŠè¿™ä¸ªçº¿æ€§å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œ<spanclass="math inline">\(y=h(h(h(x)))\)</span>çš„å‡½æ•°è¿ç®—å¯¹åº”çš„æ˜¯3å±‚ç¥ç»ç½‘ç»œï¼Œ<spanclass="math inline">\(y=c\times c\times c \times x\)</span>ï¼Œ<spanclass="math inline">\(y=c^3x\)</span> ï¼Œ <spanclass="math inline">\(c^3\)</span>æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œä»¤<spanclass="math inline">\(a=c^3\)</span>, å¾—åˆ° <spanclass="math inline">\(y=ax\)</span> ,æ¿€æ´»å‡½æ•°çš„æ•ˆæœä¸åŸæ¥æ²¡æœ‰åŒºåˆ«ï¼Œæ— æ³•å‘æŒ¥å¤šå±‚ç½‘ç»œå¸¦æ¥çš„ä¼˜åŠ¿ã€‚å› æ­¤ï¼Œä¸ºäº†å‘æŒ¥å åŠ å±‚æ‰€å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œæ¿€æ´»å‡½æ•°å¿…é¡»ä½¿ç”¨éçº¿æ€§å‡½æ•°ã€‚</p><h6 id="reluå‡½æ•°">ReLuå‡½æ•°</h6><p>ReLu(Rectified Linear Unit)å‡½æ•°åœ¨è¾“å…¥å¤§äº0æ—¶ï¼Œç›´æ¥è¾“å‡ºè¯¥å€¼ï¼›åœ¨è¾“å…¥å°äºç­‰äº0æ—¶ï¼Œè¾“å‡º0ã€‚Reluå‡½æ•°çš„å‡½æ•°è¡¨è¾¾å¼å¦‚ä¸‹ï¼š<span class="math display">\[h(x)=\begin{cases}x &amp;&amp;(x &gt; 0) \\0 &amp;&amp;(x \leq 0)\end{cases}\]</span> ReLU å‡½æ•°æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å‡½æ•°ã€‚å‡½æ•°å›¾åƒå¦‚ä¸‹ï¼š</p><center><img src="ReLu.png" alt="ReLuå‡½æ•°å›¾åƒ" style="zoom:33%;" /> <br/><br/>å›¾ï¼šReLuå‡½æ•°å›¾åƒ</center><h5 id="softmaxå‡½æ•°">softmaxå‡½æ•°</h5><p>æœºå™¨å­¦ä¹ çš„é—®é¢˜å¤§è‡´å¯ä»¥åˆ†ä¸ºåˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜ã€‚åˆ†ç±»é—®é¢˜æ˜¯æ•°æ®å±äºå“ªä¸€ä¸ªç±»åˆ«çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼ŒåŒºåˆ†å›¾åƒä¸­çš„äººæ˜¯ç”·æ€§è¿˜æ˜¯å¥³æ€§çš„é—®é¢˜å°±æ˜¯åˆ†ç±»é—®é¢˜ã€‚è€Œå›å½’é—®é¢˜æ˜¯æ ¹æ®æŸä¸ªè¾“å…¥é¢„æµ‹ä¸€ä¸ªï¼ˆè¿ç»­çš„ï¼‰æ•°å€¼çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ ¹æ®ä¸€ä¸ªäººçš„å›¾åƒé¢„æµ‹è¿™ä¸ªäººçš„ä½“é‡çš„é—®é¢˜å°±æ˜¯å›å½’é—®é¢˜ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œå›å½’é—®é¢˜ç”¨æ’ç­‰å‡½æ•°ï¼Œåˆ†ç±»é—®é¢˜ç”¨softmaxå‡½æ•°ã€‚</p><p>åˆ†ç±»é—®é¢˜ä¸­ä½¿ç”¨çš„softmaxå‡½æ•°çš„æ•°å­¦è¡¨è¾¾å¼å¦‚ä¸‹æ‰€ç¤ºï¼š <spanclass="math display">\[y_k = {e^{a_k} \over \displaystyle\sum_{i=1}^n{e^{x_i}}}\]</span>å…¬å¼è¡¨è¾¾çš„æ˜¯å‡è®¾è¾“å‡ºå±‚å…±æœ‰nä¸ªç¥ç»å…ƒï¼Œè®¡ç®—ç¬¬kä¸ªç¥ç»å…ƒçš„è¾“å‡º<spanclass="math inline">\(y_k\)</span>ã€‚softmaxå‡½æ•°çš„åˆ†å­æ˜¯è¾“å…¥ä¿¡å·<spanclass="math inline">\(a_k\)</span>çš„æŒ‡æ•°å‡½æ•°ï¼Œåˆ†æ¯æ˜¯æ‰€æœ‰è¾“å…¥ä¿¡å·çš„æŒ‡æ•°å‡½æ•°çš„å’Œã€‚softmaxå‡½æ•°çš„è¾“å‡ºæ˜¯0.0åˆ°1.0ä¹‹é—´çš„å®æ•°ã€‚å¹¶ä¸”ï¼Œsoftmaxå‡½æ•°çš„è¾“å‡ºå€¼çš„æ€»å’Œæ˜¯1ã€‚è¾“å‡ºæ€»å’Œä¸º1æ˜¯softmaxå‡½æ•°çš„ä¸€ä¸ªé‡è¦æ€§è´¨ã€‚æ­£å› ä¸ºæœ‰äº†è¿™ä¸ªæ€§è´¨ï¼Œæˆ‘ä»¬æ‰å¯ä»¥æŠŠsoftmaxå‡½æ•°çš„è¾“å‡ºè§£é‡Šä¸ºâ€œæ¦‚ç‡â€ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç¥ç»ç½‘ç»œåªæŠŠè¾“å‡ºå€¼æœ€å¤§çš„ç¥ç»å…ƒæ‰€å¯¹åº”çš„ç±»åˆ«ä½œä¸ºè¯†åˆ«ç»“æœã€‚</p><h5 id="æ’ç­‰å‡½æ•°">æ’ç­‰å‡½æ•°</h5><p>æ’ç­‰å‡½æ•°ä¼šå°†è¾“å…¥æŒ‰åŸæ ·è¾“å‡ºï¼Œå¯¹äºè¾“å…¥çš„ä¿¡æ¯ï¼Œä¸åŠ ä»¥ä»»ä½•æ”¹åŠ¨åœ°ç›´æ¥è¾“å‡ºã€‚å› æ­¤ï¼Œåœ¨è¾“å‡ºå±‚ä½¿ç”¨æ’ç­‰å‡½æ•°æ—¶ï¼Œè¾“å…¥ä¿¡å·ä¼šåŸå°ä¸åŠ¨åœ°è¢«è¾“å‡ºã€‚</p><h3 id="ç¥ç»ç½‘ç»œçš„å­¦ä¹ ">ç¥ç»ç½‘ç»œçš„å­¦ä¹ </h3><p>ç¥ç»ç½‘ç»œçš„â€œå­¦ä¹ â€æ˜¯æŒ‡ä»è®­ç»ƒæ•°æ®ä¸­è‡ªåŠ¨è·å–æœ€ä¼˜æƒé‡å‚æ•°çš„è¿‡ç¨‹ã€‚å­¦ä¹ çš„ç›®çš„å°±æ˜¯ä»¥æŸå¤±å‡½æ•°ä¸ºåŸºå‡†ï¼Œæ‰¾å‡ºèƒ½ä½¿å®ƒçš„å€¼è¾¾åˆ°æœ€å°çš„æƒé‡å‚æ•°ã€‚</p><p>æ·±åº¦å­¦ä¹ æœ‰æ—¶ä¹Ÿç§°ä¸ºç«¯åˆ°ç«¯æœºå™¨å­¦ä¹ ï¼ˆend-to-endâ€‚machinelearningï¼‰ã€‚è¿™é‡Œæ‰€è¯´çš„ç«¯åˆ°ç«¯æ˜¯æŒ‡ä»ä¸€ç«¯åˆ°å¦ä¸€ç«¯çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ä»åŸå§‹æ•°æ®ï¼ˆè¾“å…¥ï¼‰ä¸­è·å¾—ç›®æ ‡ç»“æœï¼ˆè¾“å‡ºï¼‰çš„æ„æ€ã€‚</p><h4 id="è®­ç»ƒæ•°æ®ä¸æµ‹è¯•æ•°æ®">è®­ç»ƒæ•°æ®ä¸æµ‹è¯•æ•°æ®</h4><p>æœºå™¨å­¦ä¹ ä¸­ï¼Œä¸€èˆ¬å°†æ•°æ®åˆ†ä¸º<strong>è®­ç»ƒæ•°æ®</strong>å’Œ<strong>æµ‹è¯•æ•°æ®</strong>ä¸¤éƒ¨åˆ†æ¥è¿›è¡Œå­¦ä¹ å’Œå®éªŒç­‰ã€‚é¦–å…ˆï¼Œä½¿ç”¨<strong>è®­ç»ƒæ•°æ®</strong>è¿›è¡Œå­¦ä¹ ï¼Œå¯»æ‰¾æœ€ä¼˜çš„å‚æ•°ï¼›ç„¶åï¼Œä½¿ç”¨<strong>æµ‹è¯•æ•°æ®</strong>è¯„ä»·è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹çš„å®é™…èƒ½åŠ›ã€‚</p><p>å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®æ˜¯å› ä¸ºæˆ‘ä»¬è¿½æ±‚çš„æ˜¯æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚<strong>æ³›åŒ–èƒ½åŠ›</strong>æ˜¯æŒ‡å¤„ç†æœªè¢«è§‚å¯Ÿè¿‡çš„æ•°æ®ï¼ˆä¸åŒ…å«åœ¨è®­ç»ƒæ•°æ®ä¸­çš„æ•°æ®ï¼‰çš„èƒ½åŠ›ã€‚è·å¾—æ³›åŒ–èƒ½åŠ›æ˜¯æœºå™¨å­¦ä¹ çš„æœ€ç»ˆç›®æ ‡ã€‚</p><p>ä»…ä»…ç”¨ä¸€ä¸ªæ•°æ®é›†å»å­¦ä¹ å’Œè¯„ä»·å‚æ•°,å¯ä»¥é¡ºåˆ©åœ°å¤„ç†æŸä¸ªæ•°æ®é›†ï¼Œä½†æ— æ³•å¤„ç†å…¶ä»–æ•°æ®é›†çš„æƒ…å†µï¼Œè¿™ç§åªå¯¹æŸä¸ªæ•°æ®é›†è¿‡åº¦æ‹Ÿåˆçš„çŠ¶æ€ç§°ä¸º<strong>è¿‡æ‹Ÿåˆ</strong>ï¼ˆoverfittingï¼‰ã€‚</p><h4 id="one-hotè¡¨ç¤ºæ³•">One-hotè¡¨ç¤ºæ³•</h4><p>å°†æ­£ç¡®è§£æ ‡ç­¾è¡¨ç¤ºä¸º1ï¼Œå…¶ä»–æ ‡ç­¾è¡¨ç¤ºä¸º0çš„è¡¨ç¤ºæ–¹æ³•ç§°ä¸ºone-hotè¡¨ç¤ºã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">t</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><h4 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°</h4><p><strong>æŸå¤±å‡½æ•°</strong>ï¼ˆlossfunctionï¼‰æ˜¯è¡¨ç¤º"ç¥ç»ç½‘ç»œæ€§èƒ½æœ‰å¤šå¥½"çš„æŒ‡æ ‡ï¼Œå³å½“å‰çš„ç¥ç»ç½‘ç»œå¯¹ç›‘ç£æ•°æ®åœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¸æ‹Ÿåˆï¼Œåœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¸ä¸€è‡´ã€‚æŸå¤±å‡½æ•°å¯ä»¥ä½¿ç”¨ä»»æ„å‡½æ•°ï¼Œä½†ä¸€èˆ¬ç”¨<strong>å‡æ–¹è¯¯å·®</strong>å’Œ<strong>äº¤å‰ç†µè¯¯å·®</strong>ç­‰ã€‚</p><h5 id="å‡æ–¹è¯¯å·®">å‡æ–¹è¯¯å·®</h5><p><strong>å‡æ–¹è¯¯å·®</strong>ï¼ˆmean squared errorï¼‰ã€‚å‡æ–¹è¯¯å·®å¦‚ä¸‹å¼æ‰€ç¤ºï¼š<span class="math display">\[E={1\over 2}{\displaystyle \sum_k{(y_k-t_k)^2}}\]</span></p><p>è¿™é‡Œï¼Œ<spanclass="math inline">\(y_k\)</span>æ˜¯è¡¨ç¤ºç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œ<spanclass="math inline">\(t_k\)</span>è¡¨ç¤ºç›‘ç£æ•°æ®ï¼Œ<spanclass="math inline">\(k\)</span>è¡¨ç¤ºæ•°æ®çš„ç»´æ•°ã€‚</p><h5 id="äº¤å‰ç†µè¯¯å·®">äº¤å‰ç†µè¯¯å·®</h5><p><strong>äº¤å‰ç†µè¯¯å·®</strong>ï¼ˆcross entropyerrorï¼‰ä¹Ÿç»å¸¸è¢«ç”¨ä½œæŸå¤±å‡½æ•°ã€‚äº¤å‰ç†µè¯¯å·®å¦‚ä¸‹å¼æ‰€ç¤ºã€‚ <spanclass="math display">\[E=-\displaystyle \sum_k{t_k\log y_k}\]</span> è¿™é‡Œï¼Œlogè¡¨ç¤ºä»¥eä¸ºåº•æ•°çš„è‡ªç„¶å¯¹æ•°ï¼ˆlog eï¼‰ã€‚<spanclass="math inline">\(y_k\)</span>æ˜¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œ<spanclass="math inline">\(t_k\)</span>æ˜¯æ­£ç¡®è§£æ ‡ç­¾</p><center><img src="cee.png" alt="äº¤å‰ç†µæŸå¤±å‡½æ•°å›¾åƒ" style="zoom:33%;" /><br/><br/> å›¾ï¼šäº¤å‰ç†µæŸå¤±å‡½æ•°å›¾åƒ</center><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œï¼Œxç­‰äº1æ—¶ï¼Œyä¸º0ï¼›éšç€xå‘0é è¿‘ï¼Œyé€æ¸å˜å°ã€‚å› æ­¤ï¼Œæ­£ç¡®è§£æ ‡ç­¾å¯¹åº”çš„è¾“å‡ºè¶Šå¤§ï¼ˆä¹Ÿå°±æ˜¯äº¤å‰ç†µè¯¯å·®å…¬å¼ä¸­çš„<spanclass="math inline">\(y_k\)</span>è¶Šå¤§ï¼Œå¯¹åº”çš„æ˜¯å›¾ä¸­çš„xåæ ‡ï¼‰ï¼Œè¯¯å·®å…¬å¼çš„å€¼è¶Šæ¥è¿‘0ï¼ˆè¯¯å·®è¶Šå°,å¯¹åº”å›¾ä¸­çš„yåæ ‡ï¼‰ï¼›å½“è¾“å‡ºä¸º1æ—¶ï¼Œäº¤å‰ç†µè¯¯å·®ä¸º0ã€‚æ­¤å¤–ï¼Œå¦‚æœæ­£ç¡®è§£æ ‡ç­¾å¯¹åº”çš„è¾“å‡ºè¾ƒå°ï¼ˆä¹Ÿå°±æ˜¯äº¤å‰ç†µè¯¯å·®å…¬å¼ä¸­çš„<spanclass="math inline">\(y_k\)</span>è¶Šå°ï¼‰è¯¯å·®å…¬å¼çš„å€¼å€¼è¾ƒå¤§(è¯¯å·®è¶Šå¤§)ã€‚</p><p>æ³¨æ„ï¼šå› ä¸ºäº¤å‰ç†µè¯¯å·®å…¬å¼æœ‰è´Ÿå·(<spanclass="math inline">\(-\)</span>)ã€‚è¯¥å›¾<spanclass="math inline">\(y_k\)</span>çš„è¾“å‡ºæ˜¯0-1ä¹‹é—´çš„æ•°ï¼Œå¯ä»¥çœ‹ä¼¼æ˜¯æ¦‚ç‡è¾“å‡ºï¼Œæ‰€ä»¥<spanclass="math inline">\(\log x \le0\)</span>ï¼Œå…¬å¼åŠ è´Ÿå·å¯ä»¥å˜ä¸ºæ­£æ•°ã€‚ä¹Ÿå°±æ˜¯å˜æˆè¾“å‡ºçš„æ­£ç¡®æ¦‚ç‡è¶Šå°ï¼Œè¯¯å·®è¶Šå¤§ï¼Œè¾“å‡ºçš„æ­£ç¡®æ¦‚ç‡è¶Šå¤§ï¼Œè¯¯å·®è¶Šå°ã€‚</p><h5 id="mini-batchå­¦ä¹ ">mini-batchå­¦ä¹ </h5><p>å¦‚æœé‡åˆ°å¤§æ•°æ®ï¼Œæ•°æ®é‡éå¸¸å¤šï¼Œä»¥å…¨éƒ¨æ•°æ®ä¸ºå¯¹è±¡æ±‚æŸå¤±å‡½æ•°çš„å’Œï¼Œåˆ™è®¡ç®—è¿‡ç¨‹éœ€è¦èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œè¿™ç§æƒ…å†µä¸‹ä»¥å…¨éƒ¨æ•°æ®ä¸ºå¯¹è±¡è®¡ç®—æŸå¤±å‡½æ•°æ˜¯ä¸ç°å®çš„ã€‚å› æ­¤ï¼Œä»å…¨éƒ¨æ•°æ®ä¸­é€‰å‡ºä¸€éƒ¨åˆ†ï¼Œä½œä¸ºå…¨éƒ¨æ•°æ®çš„â€œè¿‘ä¼¼â€ã€‚è¿™ç§ä»è®­ç»ƒæ•°æ®ä¸­é€‰å‡ºä¸€æ‰¹æ•°æ®ï¼ˆç§°ä¸ºmini-batch,å°æ‰¹é‡ï¼‰ï¼Œç„¶åå¯¹æ¯ä¸ªmini-batchè¿›è¡Œå­¦ä¹ çš„æ–¹å¼ç§°ä¸º<strong>mini-baatchå­¦ä¹ </strong>ã€‚</p><p>æŸå¤±å‡½æ•° äº¤å‰ç†µè¯¯å·®å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š <span class="math display">\[E=-{1\over N}{\displaystyle \sum_n\sum_k{y_{nk}\log {t_{nk}}}}\]</span> è¿™é‡Œ,å‡è®¾æ•°æ®æœ‰<span class="math inline">\(N\)</span>ä¸ªï¼Œ<spanclass="math inline">\(t_{nk}\)</span>è¡¨ç¤ºç¬¬<spanclass="math inline">\(n\)</span>ä¸ªæ•°æ®çš„ç¬¬<spanclass="math inline">\(k\)</span>ä¸ªå…ƒç´ çš„å€¼ï¼ˆ<spanclass="math inline">\(y_{nk}\)</span>æ˜¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œ<spanclass="math inline">\(t_{nk}\)</span>æ˜¯ç›‘ç£æ•°æ®ï¼‰ã€‚è¿™ä¸ªå…¬å¼åªæ˜¯æŠŠæ±‚å•ä¸ªæ•°æ®çš„æŸå¤±å‡½æ•°çš„å…¬å¼æ‰©å¤§åˆ°äº†Nä»½æ•°æ®ï¼Œä¸è¿‡æœ€åè¿˜è¦é™¤ä»¥Nè¿›è¡Œæ­£è§„åŒ–ã€‚é€šè¿‡é™¤ä»¥Nï¼Œå¯ä»¥æ±‚å•ä¸ªæ•°æ®çš„â€œå¹³å‡æŸå¤±å‡½æ•°â€ã€‚é€šè¿‡è¿™æ ·çš„å¹³å‡åŒ–ï¼Œå¯ä»¥è·å¾—å’Œè®­ç»ƒæ•°æ®çš„æ•°é‡æ— å…³çš„ç»Ÿä¸€æŒ‡æ ‡ã€‚</p><h5 id="ä¸ºä»€ä¹ˆè¦ç”¨æŸå¤±å‡½æ•°">ä¸ºä»€ä¹ˆè¦ç”¨æŸå¤±å‡½æ•°</h5><p>åœ¨è¿›è¡Œç¥ç»ç½‘ç»œçš„å­¦ä¹ æ—¶ï¼Œä¸èƒ½å°†è¯†åˆ«ç²¾åº¦ï¼ˆæˆ–è€…é¢„æµ‹å‡†ç¡®ç‡ç­‰ï¼‰ä½œä¸ºæŒ‡æ ‡ã€‚å› ä¸ºå¦‚æœä»¥è¯†åˆ«ç²¾åº¦ä¸ºæŒ‡æ ‡ï¼Œåˆ™å‚æ•°çš„å¯¼æ•°åœ¨ç»å¤§å¤šæ•°åœ°æ–¹éƒ½ä¼šå˜ä¸º0ã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾æŸä¸ªç¥ç»ç½‘ç»œæ­£ç¡®è¯†åˆ«å‡ºäº†100ç¬”è®­ç»ƒæ•°æ®ä¸­çš„32ç¬”ï¼Œæ­¤æ—¶è¯†åˆ«ç²¾åº¦ä¸º32%ã€‚å¦‚æœä»¥è¯†åˆ«ç²¾åº¦ä¸ºæŒ‡æ ‡ï¼Œå³ä½¿ç¨å¾®æ”¹å˜æƒé‡å‚æ•°çš„å€¼ï¼Œè¯†åˆ«ç²¾åº¦ä¹Ÿä»å°†ä¿æŒåœ¨32%ï¼Œä¸ä¼šå‡ºç°å˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»…ä»…å¾®è°ƒå‚æ•°ï¼Œæ˜¯æ— æ³•æ”¹å–„è¯†åˆ«ç²¾åº¦çš„ã€‚å³ä¾¿è¯†åˆ«ç²¾åº¦æœ‰æ‰€æ”¹å–„ï¼Œå®ƒçš„å€¼ä¹Ÿä¸ä¼šåƒ32.0123... %è¿™æ ·è¿ç»­å˜åŒ–ï¼Œè€Œæ˜¯å˜ä¸º33 %ã€34%è¿™æ ·çš„ä¸è¿ç»­çš„ã€ç¦»æ•£çš„å€¼ã€‚è€Œå¦‚æœæŠŠæŸå¤±å‡½æ•°ä½œä¸ºæŒ‡æ ‡ï¼Œåˆ™å½“å‰æŸå¤±å‡½æ•°çš„å€¼å¯ä»¥è¡¨ç¤ºä¸º0.92543...è¿™æ ·çš„å€¼ã€‚å¹¶ä¸”ï¼Œå¦‚æœç¨å¾®æ”¹å˜ä¸€ä¸‹å‚æ•°çš„å€¼ï¼Œå¯¹åº”çš„æŸå¤±å‡½æ•°ä¹Ÿä¼šåƒ0.93432... è¿™æ ·å‘ç”Ÿè¿ç»­æ€§çš„å˜åŒ–ã€‚</p><p>è¯†åˆ«ç²¾åº¦å¯¹å¾®å°çš„å‚æ•°å˜åŒ–åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆååº”ï¼Œå³ä¾¿æœ‰ååº”ï¼Œå®ƒçš„å€¼ä¹Ÿæ˜¯ä¸è¿ç»­åœ°ã€çªç„¶åœ°å˜åŒ–ã€‚ä½œä¸ºæ¿€æ´»å‡½æ•°çš„é˜¶è·ƒå‡½æ•°ä¹Ÿæœ‰åŒæ ·çš„æƒ…å†µã€‚å‡ºäºç›¸åŒçš„åŸå› ï¼Œå¦‚æœä½¿ç”¨é˜¶è·ƒå‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œç¥ç»ç½‘ç»œçš„å­¦ä¹ å°†æ— æ³•è¿›è¡Œã€‚</p><center><img src="diff.png" alt=" é˜¶è·ƒå‡½æ•°å’Œsigmoidå‡½æ•°" style="zoom:33%;" /><br/><br/> å›¾ï¼š é˜¶è·ƒå‡½æ•°å’Œsigmoidå‡½æ•°</center><p>é˜¶è·ƒå‡½æ•°çš„æ–œç‡åœ¨ç»å¤§å¤šæ•°åœ°æ–¹éƒ½ä¸º0ï¼Œè€Œsigmoidå‡½æ•°çš„æ–œç‡ï¼ˆåˆ‡çº¿ï¼‰ä¸ä¼šä¸º0</p><h4 id="æ¢¯åº¦">æ¢¯åº¦</h4><p>åƒ<span class="math inline">\(( \frac {\partial f}{\partial x_0},\frac { \partial f}{\partialx_1})\)</span>è¿™æ ·çš„ç”±å…¨éƒ¨å˜é‡çš„åå¯¼æ•°æ±‡æ€»è€Œæˆçš„å‘é‡ç§°ä¸º<strong>æ¢¯åº¦</strong>ï¼ˆgradientï¼‰ã€‚</p><h3 id="è¯¯å·®çš„åå‘ä¼ æ’­">è¯¯å·®çš„åå‘ä¼ æ’­</h3><p>è¦æ­£ç¡®ç†è§£è¯¯å·®åå‘ä¼ æ’­æ³•ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯åŸºäºæ•°å­¦å¼ï¼›å¦ä¸€ç§æ˜¯åŸºäºè®¡ç®—å›¾ï¼ˆcomputationalgraphï¼‰ã€‚åŸºäºæ•°å­¦å¼çš„æ–¹æ³•ä¸¥å¯†ä¸”ç®€æ´ï¼Œè®¡ç®—å›¾ï¼Œç›´è§‚ä¸”æ˜“ç†è§£ã€‚</p><h4 id="è®¡ç®—å›¾">è®¡ç®—å›¾</h4><p>è®¡ç®—å›¾å°†è®¡ç®—è¿‡ç¨‹ç”¨å›¾å½¢è¡¨ç¤ºå‡ºæ¥ã€‚è®¡ç®—å›¾é€šè¿‡èŠ‚ç‚¹å’Œç®­å¤´è¡¨ç¤ºè®¡ç®—è¿‡ç¨‹ã€‚èŠ‚ç‚¹ç”¨<spanclass="math inline">\(\bigcirc\)</span>è¡¨ç¤ºï¼Œ<spanclass="math inline">\(\bigcirc\)</span>ä¸­æ˜¯è®¡ç®—çš„å†…å®¹ã€‚å°†è®¡ç®—çš„ä¸­é—´ç»“æœå†™åœ¨ç®­å¤´çš„ä¸Šæ–¹ï¼Œè¡¨ç¤ºå„ä¸ªèŠ‚ç‚¹çš„è®¡ç®—ç»“æœä»å·¦å‘å³ä¼ é€’ã€‚</p><center><img src="jst.png" alt="è®¡ç®—å›¾ç¤ºä¾‹" style="zoom:33%;" /> <br/><br/> å›¾ï¼šè®¡ç®—å›¾ç¤ºä¾‹</center><h4 id="æ­£å‘ä¼ æ’­">æ­£å‘ä¼ æ’­</h4><p><strong>æ­£å‘ä¼ æ’­</strong>ï¼ˆforwardpropagationï¼‰æ˜¯ä»è®¡ç®—å›¾å‡ºå‘ç‚¹åˆ°ç»“æŸç‚¹çš„ä¼ æ’­ã€‚</p><h4 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­</h4><p><strong>åå‘ä¼ æ’­</strong>ï¼ˆbackwardpropagationï¼‰ä»è®¡ç®—å›¾ç»“æŸç‚¹åˆ°å‡ºå‘ç‚¹çš„ä¼ æ’­ï¼ˆä»å›¾ä¸Šçœ‹çš„è¯ï¼Œå°±æ˜¯ä»å³å‘å·¦çš„è½¬æ’­ï¼‰ã€‚åå‘ä¼ æ’­å°†å±€éƒ¨å¯¼æ•°å‘æ­£æ–¹å‘çš„åæ–¹å‘ï¼ˆä»å³åˆ°å·¦ï¼‰ä¼ é€’ã€‚ä¼ é€’è¿™ä¸ªå±€éƒ¨å¯¼æ•°çš„åŸç†ï¼Œæ˜¯åŸºäº<strong>é“¾å¼æ³•åˆ™</strong>ï¼ˆchainruleï¼‰ã€‚</p><h4 id="é“¾å¼æ³•åˆ™">é“¾å¼æ³•åˆ™</h4><p>é“¾å¼æ³•åˆ™æ˜¯å¤åˆå‡½æ•°çš„å¯¼æ•°çš„æ€§è´¨ï¼Œå¦‚æœæŸä¸ªå‡½æ•°ç”±å¤åˆå‡½æ•°è¡¨ç¤ºï¼Œåˆ™è¯¥å¤åˆå‡½æ•°çš„å¯¼æ•°å¯ä»¥ç”¨æ„æˆå¤åˆå‡½æ•°çš„å„ä¸ªå‡½æ•°çš„å¯¼æ•°çš„ä¹˜ç§¯è¡¨ç¤ºã€‚</p><h4 id="å±€éƒ¨è®¡ç®—">å±€éƒ¨è®¡ç®—</h4><p>å±€éƒ¨è®¡ç®—æ˜¯æŒ‡ï¼Œæ— è®ºå…¨å±€å‘ç”Ÿäº†ä»€ä¹ˆï¼Œéƒ½åªæ ¹æ®ä¸è‡ªå·±ç›¸å…³çš„ä¿¡æ¯è¾“å‡ºæ¥ä¸‹æ¥çš„ç»“æœã€‚</p><h3 id="æ·±åº¦å­¦ä¹ çš„æŠ€å·§">æ·±åº¦å­¦ä¹ çš„æŠ€å·§</h3><p>ç¥ç»ç½‘ç»œçš„å­¦ä¹ çš„ç›®çš„æ˜¯æ‰¾åˆ°ä½¿æŸå¤±å‡½æ•°çš„å€¼å°½å¯èƒ½å°çš„å‚æ•°ã€‚è¿™æ˜¯å¯»æ‰¾æœ€ä¼˜å‚æ•°çš„é—®é¢˜ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„è¿‡ç¨‹ç§°ä¸ºæœ€ä¼˜åŒ–ï¼ˆoptimizationï¼‰ã€‚</p><h4 id="å‚æ•°æ›´æ–°">å‚æ•°æ›´æ–°</h4><h5 id="éšæœºæ¢¯åº¦ä¸‹é™æ³•">éšæœºæ¢¯åº¦ä¸‹é™æ³•</h5><p>ä¸ºäº†æ‰¾åˆ°æœ€ä¼˜å‚æ•°ï¼Œæˆ‘ä»¬å°†å‚æ•°çš„æ¢¯åº¦ï¼ˆå¯¼æ•°ï¼‰ä½œä¸ºäº†çº¿ç´¢ã€‚ä½¿ç”¨å‚æ•°çš„æ¢¯åº¦ï¼Œæ²¿æ¢¯åº¦æ–¹å‘æ›´æ–°å‚æ•°ï¼Œå¹¶é‡å¤è¿™ä¸ªæ­¥éª¤å¤šæ¬¡ï¼Œä»è€Œé€æ¸é è¿‘æœ€ä¼˜å‚æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>éšæœºæ¢¯åº¦ä¸‹é™æ³•</strong>ï¼ˆstochasticgradient descentï¼‰ï¼Œç®€ç§°<strong>SGD</strong>ã€‚SGDçš„æ•°å­¦è¡¨è¾¾å¦‚ä¸‹æ‰€ç¤ºï¼š<span class="math display">\[\boldsymbol W\leftarrow \boldsymbol W-\eta \frac{\partial L}{\partial\boldsymbol W}\]</span> è¿™é‡ŒæŠŠéœ€è¦æ›´æ–°çš„æƒé‡å‚æ•°è®°ä¸º<spanclass="math inline">\(\boldsymbol W\)</span>ï¼ŒæŠŠæŸå¤±å‡½æ•°å…³äº<spanclass="math inline">\(\boldsymbol W\)</span>çš„æ¢¯åº¦è®°ä¸º<spanclass="math inline">\(\frac{\partial L}{\partial \boldsymbolW}\)</span>, <spanclass="math inline">\(\eta\)</span>è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œå®é™…ä¸Šä¼šå–0.01æˆ–0.001è¿™äº›äº‹å…ˆå†³å®šå¥½çš„å€¼ã€‚å¼å­ä¸­çš„â†è¡¨ç¤ºç”¨å³è¾¹çš„å€¼æ›´æ–°å·¦è¾¹çš„å€¼ã€‚</p><h6 id="sgdçš„ç¼ºç‚¹">SGDçš„ç¼ºç‚¹ï¼š</h6><p>å¦‚æœå‡½æ•°çš„å½¢çŠ¶éå‡å‘ï¼ˆanisotropicï¼‰ï¼Œæ¯”å¦‚å‘ˆå»¶ä¼¸çŠ¶ï¼Œæœç´¢çš„è·¯å¾„å°±ä¼šéå¸¸ä½æ•ˆã€‚SGDä½æ•ˆçš„æ ¹æœ¬åŸå› æ˜¯ï¼Œæ¢¯åº¦çš„æ–¹å‘å¹¶æ²¡æœ‰æŒ‡å‘æœ€å°å€¼çš„æ–¹å‘ã€‚</p><h5 id="monentum">Monentum</h5><p>Monentum æ˜¯åŠ¨é‡çš„æ„æ€ï¼Œæ•°å­¦å¼è¡¨ç¤ºMomentumæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º: <spanclass="math display">\[\displaylines{\boldsymbol {\upsilon} \leftarrow \alpha \boldsymbol\upsilon - \eta \frac {\partial L}{\partial \boldsymbol W}\\\boldsymbol W = \boldsymbol W + \boldsymbol  \upsilon}\]</span> è¿™é‡Œæ–°å‡ºç°äº†ä¸€ä¸ªå˜é‡<spanclass="math inline">\(\upsilon\)</span>ï¼Œå¯¹åº”ç‰©ç†ä¸Šçš„é€Ÿåº¦ã€‚Momentumæ–¹æ³•ç»™äººçš„æ„Ÿè§‰å°±åƒæ˜¯å°çƒåœ¨åœ°é¢ä¸Šæ»šåŠ¨ã€‚é€šè¿‡å¢åŠ åŠ¨é‡åï¼Œå¯ä»¥æœ‰æ•ˆæ”¹å–„æ›´æ–°ä¸ç¨³å®šçš„æƒ…å†µã€‚</p><center><img src="momentum.png" alt="Momentumçš„æœ€ä¼˜åŒ–çš„æ›´æ–°è·¯å¾„" style="zoom:33%;" /><br/><br/> å›¾ï¼š Momentumçš„æœ€ä¼˜åŒ–çš„æ›´æ–°è·¯å¾„</center><h5 id="å­¦ä¹ ç‡">å­¦ä¹ ç‡</h5><p>åœ¨ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ï¼Œå­¦ä¹ ç‡ï¼ˆæ•°å­¦å¼ä¸­è®°ä¸º<spanclass="math inline">\(\eta\)</span>ï¼‰çš„å€¼å¾ˆé‡è¦ã€‚å­¦ä¹ ç‡è¿‡å°ï¼Œä¼šå¯¼è‡´å­¦ä¹ èŠ±è´¹è¿‡å¤šæ—¶é—´ï¼›åè¿‡æ¥ï¼Œå­¦ä¹ ç‡è¿‡å¤§ï¼Œåˆ™ä¼šå¯¼è‡´å­¦ä¹ å‘æ•£è€Œä¸èƒ½æ­£ç¡®è¿›è¡Œã€‚</p><h5 id="å­¦ä¹ ç‡è¡°å‡">å­¦ä¹ ç‡è¡°å‡</h5><p><strong>å­¦ä¹ ç‡è¡°å‡</strong>ï¼ˆlearning ratedecayï¼‰ï¼Œå³éšç€å­¦ä¹ çš„è¿›è¡Œï¼Œä½¿å­¦ä¹ ç‡é€æ¸å‡å°ã€‚ä¸€å¼€å§‹â€œå¤šâ€å­¦ï¼Œç„¶åé€æ¸â€œå°‘â€å­¦çš„æ–¹æ³•ï¼Œåœ¨ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ç»å¸¸è¢«ä½¿ç”¨ã€‚é€æ¸å‡å°å­¦ä¹ ç‡çš„æƒ³æ³•ï¼Œç›¸å½“äºå°†â€œå…¨ä½“â€å‚æ•°çš„å­¦ä¹ ç‡å€¼ä¸€èµ·é™ä½ã€‚</p><h5 id="adagrad">AdaGrad</h5><p>AdaGradä¼šä¸ºå‚æ•°çš„æ¯ä¸ªå…ƒç´ é€‚å½“åœ°è°ƒæ•´å­¦ä¹ ç‡ï¼Œä¸æ­¤åŒæ—¶è¿›è¡Œå­¦ä¹ ã€‚æ•°å­¦è¡¨ç¤ºå¦‚ä¸‹ï¼š<span class="math display">\[\displaylines{\boldsymbol h \leftarrow \boldsymbol h + \frac {\partial L}{\partial\boldsymbol W} \odot \frac {\partial L}{\partial \boldsymbol W}\\\boldsymbol W = \boldsymbol W - \eta \frac{1}{\sqrt {\boldsymbol h}}\frac {\partial L}{\partial \boldsymbol W}}\]</span> è¿™é‡Œæ–°å‡ºç°äº†å˜é‡<span class="math inline">\(\boldsymbolh\)</span>ï¼Œå®ƒä¿å­˜äº†ä»¥å‰çš„æ‰€æœ‰æ¢¯åº¦å€¼çš„å¹³æ–¹å’Œï¼Œç„¶åï¼Œåœ¨æ›´æ–°å‚æ•°æ—¶ï¼Œé€šè¿‡ä¹˜ä»¥$$ï¼Œå°±å¯ä»¥è°ƒæ•´å­¦ä¹ çš„å°ºåº¦ã€‚è¿™æ„å‘³ç€ï¼Œå‚æ•°çš„å…ƒç´ ä¸­å˜åŠ¨è¾ƒå¤§ï¼ˆè¢«å¤§å¹…æ›´æ–°ï¼‰çš„å…ƒç´ çš„å­¦ä¹ ç‡å°†å˜å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æŒ‰å‚æ•°çš„å…ƒç´ è¿›è¡Œå­¦ä¹ ç‡è¡°å‡ï¼Œä½¿å˜åŠ¨å¤§çš„å‚æ•°çš„å­¦ä¹ ç‡é€æ¸å‡å°ã€‚</p><h5 id="adam">Adam</h5><p>Adamæ˜¯2015å¹´æå‡ºçš„ï¼Œç›´è§‚åœ°è®²ï¼Œå°±æ˜¯èåˆäº†Momentumå’ŒAdaGradçš„æ–¹æ³•ã€‚é€šè¿‡ç»„åˆå‰é¢ä¸¤ä¸ªæ–¹æ³•çš„ä¼˜ç‚¹ï¼Œæœ‰æœ›å®ç°å‚æ•°ç©ºé—´çš„é«˜æ•ˆæœç´¢ã€‚æ­¤å¤–ï¼Œè¿›è¡Œè¶…å‚æ•°çš„â€œåç½®æ ¡æ­£â€ä¹Ÿæ˜¯Adamçš„ç‰¹å¾ã€‚</p><p>Adamä¼šè®¾ç½® 3ä¸ªè¶…å‚æ•°ã€‚ä¸€ä¸ªæ˜¯å­¦ä¹ ç‡ï¼ˆè®ºæ–‡ä¸­ä»¥<spanclass="math inline">\(\alpha\)</span>å‡ºç°ï¼‰ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ä¸€æ¬¡momentumç³»æ•°<spanclass="math inline">\(\beta_1\)</span>å’ŒäºŒæ¬¡momentumç³»æ•°<spanclass="math inline">\(\beta_2\)</span>ã€‚æ ¹æ®è®ºæ–‡ï¼Œæ ‡å‡†çš„è®¾å®šå€¼æ˜¯<spanclass="math inline">\(\beta_1\)</span>ä¸º 0.9ï¼Œ<spanclass="math inline">\(\beta_2\)</span> ä¸º 0.999ã€‚</p><center><img src="adam.png" alt="Adam" style="zoom:33%;" /> <br/><br/> å›¾ï¼šAdamçš„æœ€ä¼˜åŒ–çš„æ›´æ–°è·¯å¾„</center><h4 id="æƒé‡çš„åˆå§‹å€¼">æƒé‡çš„åˆå§‹å€¼</h4><p>åœ¨ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ï¼Œæƒé‡çš„åˆå§‹å€¼ç‰¹åˆ«é‡è¦ã€‚å®é™…ä¸Šï¼Œè®¾å®šä»€ä¹ˆæ ·çš„æƒé‡åˆå§‹å€¼ï¼Œç»å¸¸å…³ç³»åˆ°ç¥ç»ç½‘ç»œçš„å­¦ä¹ èƒ½å¦æˆåŠŸã€‚</p><h5 id="æƒé‡çš„åˆå§‹å€¼æ˜¯å¦å¯ä»¥ä¸º0">æƒé‡çš„åˆå§‹å€¼æ˜¯å¦å¯ä»¥ä¸º0</h5><p>ä»ç»“è®ºæ¥è¯´ï¼Œå°†æƒé‡åˆå§‹å€¼è®¾ä¸º0ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚äº‹å®ä¸Šï¼Œå°†æƒé‡åˆå§‹å€¼è®¾ä¸º0çš„è¯ï¼Œå°†æ— æ³•æ­£ç¡®è¿›è¡Œå­¦ä¹ ã€‚</p><p>æ˜¯å› ä¸ºåœ¨è¯¯å·®åå‘ä¼ æ’­æ³•ä¸­ï¼Œæ‰€æœ‰çš„æƒé‡å€¼éƒ½ä¼šè¿›è¡Œç›¸åŒçš„æ›´æ–°ã€‚æ¯”å¦‚ï¼Œåœ¨2å±‚ç¥ç»ç½‘ç»œä¸­ï¼Œå‡è®¾ç¬¬1å±‚å’Œç¬¬2å±‚çš„æƒé‡ä¸º0ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ­£å‘ä¼ æ’­æ—¶ï¼Œå› ä¸ºè¾“å…¥å±‚çš„æƒé‡ä¸º0ï¼Œæ‰€ä»¥ç¬¬2å±‚çš„ç¥ç»å…ƒå…¨éƒ¨ä¼šè¢«ä¼ é€’ç›¸åŒçš„å€¼ã€‚ç¬¬2å±‚çš„ç¥ç»å…ƒä¸­å…¨éƒ¨è¾“å…¥ç›¸åŒçš„å€¼ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ—¶ç¬¬2å±‚çš„æƒé‡å…¨éƒ¨éƒ½ä¼šè¿›è¡Œç›¸åŒçš„æ›´æ–°ã€‚å› æ­¤ï¼Œæƒé‡è¢«æ›´æ–°ä¸ºç›¸åŒçš„å€¼ï¼Œå¹¶æ‹¥æœ‰äº†å¯¹ç§°çš„å€¼ï¼ˆé‡å¤çš„å€¼ï¼‰ã€‚è¿™ä½¿å¾—ç¥ç»ç½‘ç»œæ‹¥æœ‰è®¸å¤šä¸åŒçš„æƒé‡çš„æ„ä¹‰ä¸§å¤±äº†ã€‚ä¸ºäº†é˜²æ­¢â€œæƒé‡å‡ä¸€åŒ–â€ï¼ˆä¸¥æ ¼åœ°è®²ï¼Œæ˜¯ä¸ºäº†ç“¦è§£æƒé‡çš„å¯¹ç§°ç»“æ„ï¼‰ï¼Œå¿…é¡»éšæœºç”Ÿæˆåˆå§‹å€¼ã€‚</p><h5 id="æ¢¯åº¦æ¶ˆå¤±">æ¢¯åº¦æ¶ˆå¤±</h5><p>æ¢¯åº¦æ¶ˆå¤±ï¼ˆgradientvanishingï¼‰ï¼Œéšç€è¾“å‡ºä¸æ–­åœ°é è¿‘0ï¼ˆæˆ–è€…é è¿‘1ï¼‰ï¼Œå®ƒçš„å¯¼æ•°çš„å€¼é€æ¸æ¥è¿‘0ã€‚å› æ­¤ï¼Œåå‘0å’Œ1çš„æ•°æ®åˆ†å¸ƒä¼šé€ æˆåå‘ä¼ æ’­ä¸­æ¢¯åº¦çš„å€¼ä¸æ–­å˜å°ï¼Œæœ€åæ¶ˆå¤±ã€‚è¿™ä¸ªé—®é¢˜ç§°ä¸ºæ¢¯åº¦æ¶ˆå¤±ã€‚</p><h5 id="æƒé‡å€¼çš„è¦æ±‚">æƒé‡å€¼çš„è¦æ±‚</h5><p>ç¥ç»ç½‘ç»œå„å±‚çš„æ¿€æ´»å€¼çš„åˆ†å¸ƒéƒ½è¦æ±‚æœ‰é€‚å½“çš„å¹¿åº¦ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºé€šè¿‡åœ¨å„å±‚é—´ä¼ é€’å¤šæ ·æ€§çš„æ•°æ®ï¼Œç¥ç»ç½‘ç»œå¯ä»¥è¿›è¡Œé«˜æ•ˆçš„å­¦ä¹ ã€‚åè¿‡æ¥ï¼Œå¦‚æœä¼ é€’çš„æ˜¯æœ‰æ‰€åå‘çš„æ•°æ®ï¼Œå°±ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±æˆ–è€…â€œè¡¨ç°åŠ›å—é™â€çš„é—®é¢˜ï¼Œå¯¼è‡´å­¦ä¹ å¯èƒ½æ— æ³•é¡ºåˆ©è¿›è¡Œã€‚</p><h5 id="ä¸€äº›æ¨èçš„æƒé‡åˆå§‹å€¼">ä¸€äº›æ¨èçš„æƒé‡åˆå§‹å€¼</h5><h6 id="xavieråˆå§‹å€¼">Xavieråˆå§‹å€¼</h6><p><strong>Xavieråˆå§‹å€¼</strong>æ˜¯XavierGlorotç­‰äººçš„è®ºæ–‡ä¸­æ¨èçš„æƒé‡åˆå§‹å€¼ï¼ŒXavierçš„è®ºæ–‡ä¸­ï¼Œä¸ºäº†ä½¿å„å±‚çš„æ¿€æ´»å€¼å‘ˆç°å‡ºå…·æœ‰ç›¸åŒå¹¿åº¦çš„åˆ†å¸ƒï¼Œæ¨å¯¼äº†åˆé€‚çš„æƒé‡å°ºåº¦ã€‚æ¨å¯¼å‡ºçš„ç»“è®ºæ˜¯ï¼Œå¦‚æœå‰ä¸€å±‚çš„èŠ‚ç‚¹æ•°ä¸º<spanclass="math inline">\(n\)</span>ï¼Œåˆ™åˆå§‹å€¼ä½¿ç”¨æ ‡å‡†å·®ä¸º<spanclass="math inline">\(\frac{1}{\sqrt n}\)</span>çš„åˆ†å¸ƒã€‚</p><p><strong>Xavieråˆå§‹å€¼</strong>æ˜¯ä»¥æ¿€æ´»å‡½æ•°æ˜¯çº¿æ€§å‡½æ•°ä¸ºå‰æè€Œæ¨å¯¼å‡ºæ¥çš„ã€‚å› ä¸ºsigmoidå‡½æ•°å’Œtanhå‡½æ•°å·¦å³å¯¹ç§°ï¼Œä¸”ä¸­å¤®é™„è¿‘å¯ä»¥è§†ä½œçº¿æ€§å‡½æ•°ï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨Xavieråˆå§‹å€¼ã€‚</p><h6 id="reluåˆå§‹å€¼">ReLuåˆå§‹å€¼</h6><p>å½“æ¿€æ´»å‡½æ•°ä½¿ç”¨ReLUæ—¶ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ReLUä¸“ç”¨çš„åˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯KaimingHeç­‰äººæ¨èçš„åˆå§‹å€¼ï¼Œä¹Ÿç§°ä¸ºâ€œHeåˆå§‹å€¼â€ã€‚å½“å‰ä¸€å±‚çš„èŠ‚ç‚¹æ•°ä¸ºnæ—¶ï¼ŒHeåˆå§‹å€¼ä½¿ç”¨æ ‡å‡†å·®ä¸º<spanclass="math inline">\(\sqrt \frac{2}{n}\)</span>çš„é«˜æ–¯åˆ†å¸ƒã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼Œå½“æ¿€æ´»å‡½æ•°ä½¿ç”¨ReLUæ—¶ï¼Œæƒé‡åˆå§‹å€¼ä½¿ç”¨Heåˆå§‹å€¼ï¼Œå½“æ¿€æ´»å‡½æ•°ä¸ºsigmoidæˆ–tanhç­‰Så‹æ›²çº¿å‡½æ•°æ—¶ï¼Œåˆå§‹å€¼ä½¿ç”¨Xavieråˆå§‹å€¼ã€‚è¿™æ˜¯ç›®å‰çš„æœ€ä½³å®è·µã€‚</p><h4 id="batch-normalization">Batch Normalization</h4><p><strong>BatchNorm</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œä»¥è¿›è¡Œå­¦ä¹ æ—¶çš„mini-batchä¸ºå•ä½ï¼ŒæŒ‰mini-batchè¿›è¡Œæ­£è§„åŒ–ã€‚å…·ä½“è€Œè¨€ï¼Œå°±æ˜¯è¿›è¡Œä½¿æ•°æ®åˆ†å¸ƒçš„å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1çš„æ­£è§„åŒ–ã€‚ç”¨æ•°å­¦å¼è¡¨ç¤ºçš„è¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚<span class="math display">\[\displaylines{\mu_B \leftarrow \frac{1}{m} \displaystyle \sum_{i=1}^m{x_i}\\\sigma^2_B \leftarrow \frac{1}{m} \displaystyle\sum_{i=1}^m(x_i-\mu_B)^2\\\hat x_i \leftarrow \frac{x_i-\mu_B}{\sqrt {\sigma^2_B + \varepsilon}}}\]</span></p><p>Batch Normçš„ä¼˜ç‚¹:</p><ol type="1"><li>å¯ä»¥ä½¿å­¦ä¹ å¿«é€Ÿè¿›è¡Œï¼ˆå¯ä»¥å¢å¤§å­¦ä¹ ç‡ï¼‰ã€‚</li><li>ä¸é‚£ä¹ˆä¾èµ–åˆå§‹å€¼ï¼ˆå¯¹äºåˆå§‹å€¼ä¸ç”¨é‚£ä¹ˆç¥ç»è´¨ï¼‰ã€‚</li><li>æŠ‘åˆ¶è¿‡æ‹Ÿåˆï¼ˆé™ä½Dropoutç­‰çš„å¿…è¦æ€§ï¼‰ã€‚</li></ol><h4 id="æ­£åˆ™åŒ–">æ­£åˆ™åŒ–</h4><p>æœºå™¨å­¦ä¹ çš„é—®é¢˜ä¸­ï¼Œè¿‡æ‹Ÿåˆæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚</p><h5 id="è¿‡æ‹Ÿåˆ">è¿‡æ‹Ÿåˆ</h5><p><strong>è¿‡æ‹Ÿåˆ</strong>æŒ‡çš„æ˜¯åªèƒ½æ‹Ÿåˆè®­ç»ƒæ•°æ®ï¼Œä½†ä¸èƒ½å¾ˆå¥½åœ°æ‹Ÿåˆä¸åŒ…å«åœ¨è®­ç»ƒæ•°æ®ä¸­çš„å…¶ä»–æ•°æ®çš„çŠ¶æ€ã€‚</p><p>å‘ç”Ÿè¿‡æ‹Ÿåˆçš„åŸå› ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ª:</p><ol type="1"><li>æ¨¡å‹æ‹¥æœ‰å¤§é‡å‚æ•°ã€è¡¨ç°åŠ›å¼ºã€‚</li><li>è®­ç»ƒæ•°æ®å°‘ã€‚</li></ol><h5 id="æƒé‡è¡°å‡">æƒé‡è¡°å‡</h5><p><strong>æƒå€¼è¡°å‡</strong>ï¼ˆweightdecayï¼‰å°±æ˜¯ä¸€ç§ä»¥å‡å°æƒé‡å‚æ•°çš„å€¼ä¸ºç›®çš„è¿›è¡Œå­¦ä¹ çš„æ–¹æ³•ã€‚é€šè¿‡å‡å°æƒé‡å‚æ•°çš„å€¼æ¥æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„å‘ç”Ÿï¼Œæé«˜æ³›åŒ–èƒ½åŠ›ã€‚è¯¥æ–¹æ³•é€šè¿‡åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯¹å¤§çš„æƒé‡è¿›è¡Œæƒ©ç½šï¼Œæ¥æŠ‘åˆ¶è¿‡æ‹Ÿåˆã€‚</p><h5 id="l1èŒƒæ•°">L1èŒƒæ•°</h5><p>L1èŒƒæ•°æ˜¯å„ä¸ªå…ƒç´ çš„ç»å¯¹å€¼ä¹‹å’Œï¼Œå³<spanclass="math inline">\(|w_1|+|w_2|+\cdots+|w_n|\)</span></p><h5 id="l2èŒƒæ•°">L2èŒƒæ•°</h5><p>L2èŒƒæ•°ç›¸å½“äºå„ä¸ªå…ƒç´ çš„å¹³æ–¹å’Œã€‚ç”¨æ•°å­¦å¼è¡¨ç¤ºçš„è¯ï¼Œå‡è®¾æœ‰æƒé‡<spanclass="math inline">\(W = (w_,w_2, ... ,w_n)\)</span>ï¼Œåˆ™L2èŒƒæ•°ä¸º<spanclass="math inline">\(\sqrt{w_1^2+w_2^2+\cdots+w_n^2}\)</span>ã€‚L2æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ èŒƒæ•°ã€‚</p><h5 id="lèŒƒæ•°">LâˆèŒƒæ•°</h5><p>Lâˆä¹Ÿç§°ä¸ºMaxèŒƒæ•°ï¼Œç›¸å½“äºå„ä¸ªå…ƒç´ çš„ç»å¯¹å€¼ä¸­æœ€å¤§çš„é‚£ä¸€ä¸ªã€‚</p><h5 id="dropout">DropOut</h5><p>Dropoutæ˜¯ä¸€ç§åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­éšæœºåˆ é™¤ç¥ç»å…ƒçš„æ–¹æ³•ã€‚è®­ç»ƒæ—¶ï¼Œéšæœºé€‰å‡ºéšè—å±‚çš„ç¥ç»å…ƒï¼Œç„¶åå°†å…¶åˆ é™¤ã€‚è¢«åˆ é™¤çš„ç¥ç»å…ƒä¸å†è¿›è¡Œä¿¡å·çš„ä¼ é€’ã€‚</p><h4 id="è¶…å‚æ•°åŠæœ€ä¼˜åŒ–">è¶…å‚æ•°åŠæœ€ä¼˜åŒ–</h4><p><strong>è¶…å‚æ•°</strong>ï¼ˆhyper-parameterï¼‰æ˜¯æŒ‡ï¼Œæ¯”å¦‚å„å±‚çš„ç¥ç»å…ƒæ•°é‡ã€batchå¤§å°ã€å‚æ•°æ›´æ–°æ—¶çš„å­¦ä¹ ç‡æˆ–æƒå€¼è¡°å‡ç­‰ã€‚å¦‚æœè¿™äº›è¶…å‚æ•°æ²¡æœ‰è®¾ç½®åˆé€‚çš„å€¼ï¼Œæ¨¡å‹çš„æ€§èƒ½å°±ä¼šå¾ˆå·®ã€‚</p><h5 id="è¶…å‚æ•°çš„æœ€ä¼˜åŒ–">è¶…å‚æ•°çš„æœ€ä¼˜åŒ–</h5><p>è¿›è¡Œè¶…å‚æ•°çš„æœ€ä¼˜åŒ–æ—¶ï¼Œé€æ¸ç¼©å°è¶…å‚æ•°çš„â€œå¥½å€¼â€çš„å­˜åœ¨èŒƒå›´éå¸¸é‡è¦ã€‚æ‰€è°“é€æ¸ç¼©å°èŒƒå›´ï¼Œæ˜¯æŒ‡ä¸€å¼€å§‹å…ˆå¤§è‡´è®¾å®šä¸€ä¸ªèŒƒå›´ï¼Œä»è¿™ä¸ªèŒƒå›´ä¸­éšæœºé€‰å‡ºä¸€ä¸ªè¶…å‚æ•°ï¼ˆé‡‡æ ·ï¼‰ï¼Œç”¨è¿™ä¸ªé‡‡æ ·åˆ°çš„å€¼è¿›è¡Œè¯†åˆ«ç²¾åº¦çš„è¯„ä¼°ï¼›ç„¶åï¼Œå¤šæ¬¡é‡å¤è¯¥æ“ä½œï¼Œè§‚å¯Ÿè¯†åˆ«ç²¾åº¦çš„ç»“æœï¼Œæ ¹æ®è¿™ä¸ªç»“æœç¼©å°è¶…å‚æ•°çš„â€œå¥½å€¼â€çš„èŒƒå›´ã€‚é€šè¿‡é‡å¤è¿™ä¸€æ“ä½œï¼Œå°±å¯ä»¥é€æ¸ç¡®å®šè¶…å‚æ•°çš„åˆé€‚èŒƒå›´ã€‚</p><h4 id="éªŒè¯æ•°æ®">éªŒè¯æ•°æ®</h4><p>éªŒè¯æ•°æ®ï¼ˆvalidationdataï¼‰ç”¨äºè°ƒæ•´è¶…å‚æ•°çš„æ•°æ®ã€‚ä½¿ç”¨è¿™ä¸ªéªŒè¯æ•°æ®æ¥è¯„ä¼°è¶…å‚æ•°çš„å¥½åã€‚</p><p>è®­ç»ƒæ•°æ®ç”¨äºå‚æ•°ï¼ˆæƒé‡å’Œåç½®ï¼‰çš„å­¦ä¹ ï¼ŒéªŒè¯æ•°æ®ç”¨äºè¶…å‚æ•°çš„æ€§èƒ½è¯„ä¼°ã€‚ä¸ºäº†ç¡®è®¤æ³›åŒ–èƒ½åŠ›ï¼Œè¦åœ¨æœ€åä½¿ç”¨ï¼ˆæ¯”è¾ƒç†æƒ³çš„æ˜¯åªç”¨ä¸€æ¬¡ï¼‰æµ‹è¯•æ•°æ®ã€‚</p><h3 id="å·ç§¯ç¥ç»ç½‘ç»œ">å·ç§¯ç¥ç»ç½‘ç»œ</h3><p><strong>å·ç§¯ç¥ç»ç½‘ç»œ</strong>ï¼ˆConvolutional Neural Networkï¼ŒCNNï¼‰ä¸­æ–°å¢äº† Convolution å±‚å’Œ Pooling å±‚ã€‚CNN çš„å±‚çš„è¿æ¥é¡ºåºæ˜¯â€œConvolution -ReLU -ï¼ˆPoolingï¼‰ â€</p><h4 id="å·ç§¯å±‚">å·ç§¯å±‚</h4><h5 id="ç‰¹å¾å›¾">ç‰¹å¾å›¾</h5><p>å·ç§¯å±‚çš„è¾“å…¥è¾“å‡ºæ•°æ®ç§°ä¸º<strong>ç‰¹å¾å›¾</strong>ï¼ˆfeaturemapï¼‰ã€‚å…¶ä¸­ï¼Œå·ç§¯å±‚çš„è¾“å…¥æ•°æ®ç§°ä¸º<strong>è¾“å…¥ç‰¹å¾å›¾</strong>ï¼ˆinputfeature mapï¼‰ï¼Œ è¾“ å‡ºæ•°æ®ç§°ä¸º<strong>è¾“å‡ºç‰¹å¾å›¾</strong>ï¼ˆoutput featuremapï¼‰ã€‚</p><h5 id="å·ç§¯è¿ç®—">å·ç§¯è¿ç®—</h5><p>å·ç§¯å±‚è¿›è¡Œçš„å¤„ç†å°±æ˜¯å·ç§¯è¿ç®—ã€‚å·ç§¯è¿ç®—ç›¸å½“äºå›¾åƒå¤„ç†ä¸­çš„â€œæ»¤æ³¢å™¨è¿ç®—â€ã€‚</p><center><img src="cnn_calc.png" alt="å·ç§¯è¿ç®—" style="zoom:33%;" /> <br/><br/>å›¾ï¼š å·ç§¯è¿ç®—</center><h5 id="å¡«å……">å¡«å……</h5><p>åœ¨è¿›è¡Œå·ç§¯å±‚çš„å¤„ç†ä¹‹å‰ï¼Œæœ‰æ—¶è¦å‘è¾“å…¥æ•°æ®çš„å‘¨å›´å¡«å…¥å›ºå®šçš„æ•°æ®ï¼ˆæ¯”å¦‚0ç­‰ï¼‰ï¼Œè¿™ç§°ä¸º<strong>å¡«å……</strong>ï¼ˆpaddingï¼‰ï¼Œä½¿ç”¨å¡«å……ä¸»è¦æ˜¯ä¸ºäº†è°ƒæ•´è¾“å‡ºçš„å¤§å°ã€‚</p><h5 id="æ­¥å¹…">æ­¥å¹…</h5><p>åº”ç”¨æ»¤æ³¢å™¨çš„ä½ç½®é—´éš”ç§°ä¸º<strong>æ­¥å¹…</strong>ï¼ˆstrideï¼‰ã€‚å¢å¤§æ­¥å¹…åï¼Œè¾“å‡ºå¤§å°ä¼šå˜å°ã€‚è€Œå¢å¤§å¡«å……åï¼Œè¾“å‡ºå¤§å°ä¼šå˜å¤§ã€‚</p><p>å‡è®¾è¾“å…¥å¤§å°ä¸º(H, W)ï¼Œæ»¤æ³¢å™¨å¤§å°ä¸º(FH, FW)ï¼Œè¾“å‡ºå¤§å°ä¸º(OH,OW)ï¼Œå¡«å……ä¸ºPï¼Œæ­¥å¹…ä¸ºSã€‚æ­¤æ—¶ï¼Œè¾“å‡ºå¤§å°å¯é€šè¿‡ä¸‹åˆ—å…¬å¼è¿›è¡Œè®¡ç®—ã€‚ <spanclass="math display">\[\displaylines {OH = \frac{H+2P-FH}{S} + 1\\OW = \frac{W+2P-FW}{S} + 1}\]</span></p><h5 id="æ‰¹å¤„ç†">æ‰¹å¤„ç†</h5><p>ç¥ç»ç½‘ç»œçš„å¤„ç†ä¸­è¿›è¡Œäº†å°†è¾“å…¥æ•°æ®æ‰“åŒ…çš„æ‰¹å¤„ç†ã€‚</p><center><img src="cnn_bat.png" alt="å·ç§¯è¿ç®—çš„æ‰¹å¤„ç†" style="zoom:33%;" /><br/><br/> å›¾ï¼š å·ç§¯è¿ç®—çš„æ‰¹å¤„ç†</center><h4 id="æ± åŒ–å±‚">æ± åŒ–å±‚</h4><p>æ± åŒ–æ˜¯ç¼©å°é«˜ã€é•¿æ–¹å‘ä¸Šçš„ç©ºé—´çš„è¿ç®—ã€‚</p><p>å¸¸ç”¨çš„æ± åŒ–æ–¹æ³•æœ‰Maxæ± åŒ–ã€Averageæ± åŒ–ç­‰ã€‚</p><h5 id="maxæ± åŒ–">Maxæ± åŒ–</h5><p>Maxæ± åŒ–æ˜¯ä»ç›®æ ‡åŒºåŸŸä¸­å–å‡ºæœ€å¤§å€¼ã€‚</p><h5 id="averageæ± åŒ–">Averageæ± åŒ–</h5><p>Averageæ± åŒ–åˆ™æ˜¯è®¡ç®—ç›®æ ‡åŒºåŸŸçš„å¹³å‡å€¼ã€‚</p><h5 id="æ± åŒ–å±‚çš„ç‰¹å¾">æ± åŒ–å±‚çš„ç‰¹å¾</h5><ol type="1"><li>æ²¡æœ‰è¦å­¦ä¹ çš„å‚æ•°æ± åŒ–å±‚å’Œå·ç§¯å±‚ä¸åŒï¼Œæ²¡æœ‰è¦å­¦ä¹ çš„å‚æ•°ã€‚æ± åŒ–åªæ˜¯ä»ç›®æ ‡åŒºåŸŸä¸­å–æœ€å¤§å€¼ï¼ˆæˆ–è€…å¹³å‡å€¼ï¼‰ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¦å­¦ä¹ çš„å‚æ•°ã€‚</li><li>é€šé“æ•°ä¸å‘ç”Ÿå˜åŒ–ç»è¿‡æ± åŒ–è¿ç®—ï¼Œè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®çš„é€šé“æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è®¡ç®—æ˜¯æŒ‰é€šé“ç‹¬ç«‹è¿›è¡Œçš„ã€‚</li><li>å¯¹å¾®å°çš„ä½ç½®å˜åŒ–å…·æœ‰é²æ£’æ€§ï¼ˆå¥å£®ï¼‰è¾“å…¥æ•°æ®å‘ç”Ÿå¾®å°åå·®æ—¶ï¼Œæ± åŒ–ä»ä¼šè¿”å›ç›¸åŒçš„ç»“æœã€‚å› æ­¤ï¼Œæ± åŒ–å¯¹è¾“å…¥æ•°æ®çš„å¾®å°åå·®å…·æœ‰é²æ£’æ€§ã€‚</li></ol><h4 id="ä»£è¡¨æ€§çš„cnnç½‘ç»œç»“æ„">ä»£è¡¨æ€§çš„CNNç½‘ç»œç»“æ„</h4><h5 id="lenet">LeNet</h5><p>LeNetåœ¨1998å¹´è¢«æå‡ºï¼Œæ˜¯è¿›è¡Œæ‰‹å†™æ•°å­—è¯†åˆ«çš„ç½‘ç»œï¼Œå®ƒæœ‰è¿ç»­çš„å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼ˆæ­£ç¡®åœ°è®²ï¼Œæ˜¯åªâ€œæŠ½é€‰å…ƒç´ â€çš„å­é‡‡æ ·å±‚ï¼‰ï¼Œæœ€åç»å…¨è¿æ¥å±‚è¾“å‡ºç»“æœã€‚LeNetä¸­ä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°</p><h5 id="alexnet">AlexNet</h5><p>AlexNetå æœ‰å¤šä¸ªå·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œæœ€åç»ç”±å…¨è¿æ¥å±‚è¾“å‡ºç»“æœã€‚AlexNetçš„ç‰¹ç‚¹ï¼š</p><ol type="1"><li>æ¿€æ´»å‡½æ•°ä½¿ç”¨ReLUã€‚</li><li>ä½¿ç”¨è¿›è¡Œå±€éƒ¨æ­£è§„åŒ–çš„LRNï¼ˆLocal Response Normalizationï¼‰å±‚ ã€‚</li><li>ä½¿ç”¨Dropoutã€‚</li></ol><h3 id="æ·±åº¦å­¦ä¹ ">æ·±åº¦å­¦ä¹ </h3><h4 id="ä¸ºä»€ä¹ˆè¦åŠ æ·±å±‚">ä¸ºä»€ä¹ˆè¦åŠ æ·±å±‚?</h4><ol type="1"><li>å±‚è¶Šæ·±ï¼Œè¯†åˆ«æ€§èƒ½ä¹Ÿè¶Šé«˜ã€‚</li><li>å¯ä»¥å‡å°‘ç½‘ç»œçš„å‚æ•°æ•°é‡ã€‚</li><li>å åŠ å°å‹æ»¤æ³¢å™¨æ¥åŠ æ·±ç½‘ç»œçš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘å‚æ•°çš„æ•°é‡ï¼Œæ‰©å¤§æ„Ÿå—é‡ï¼ˆreceptiveâ€‚fieldï¼Œç»™ç¥ç»å…ƒæ–½åŠ å˜åŒ–çš„æŸä¸ªå±€éƒ¨ç©ºé—´åŒºåŸŸï¼‰ã€‚å¹¶ä¸”ï¼Œé€šè¿‡å åŠ å±‚ï¼Œå°†ReLUç­‰æ¿€æ´»å‡½æ•°å¤¹åœ¨å·ç§¯å±‚çš„ä¸­é—´ï¼Œè¿›ä¸€æ­¥æé«˜äº†ç½‘ç»œçš„è¡¨ç°åŠ›ã€‚è¿™æ˜¯å› ä¸ºå‘ç½‘ç»œæ·»åŠ äº†åŸºäºæ¿€æ´»å‡½æ•°çš„â€œéçº¿æ€§â€è¡¨ç°åŠ›ï¼Œé€šè¿‡éçº¿æ€§å‡½æ•°çš„å åŠ ï¼Œå¯ä»¥è¡¨ç°æ›´åŠ å¤æ‚çš„ä¸œè¥¿ã€‚</li><li>åŠ æ·±å±‚çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯ä½¿å­¦ä¹ æ›´åŠ é«˜æ•ˆã€‚</li></ol><h4 id="å…¶ä»–çš„ç½‘ç»œç»“æ„">å…¶ä»–çš„ç½‘ç»œç»“æ„</h4><h5 id="vgg">VGG</h5><p>VGGæ˜¯ç”±å·ç§¯å±‚å’Œæ± åŒ–å±‚æ„æˆçš„åŸºç¡€çš„CNNã€‚</p><h5 id="googlenet">GoogleNet</h5><p>GoogleNetçš„ç‰¹å¾æ˜¯ï¼Œç½‘ç»œä¸ä»…åœ¨çºµå‘ä¸Šæœ‰æ·±åº¦ï¼Œåœ¨æ¨ªå‘ä¸Šä¹Ÿæœ‰æ·±åº¦ï¼ˆå¹¿åº¦ï¼‰ã€‚GoogleNetåœ¨æ¨ªå‘ä¸Šæœ‰â€œå®½åº¦â€ï¼Œè¿™ç§°ä¸ºâ€œInceptionç»“æ„â€ã€‚</p><h5 id="resnet">ResNet</h5><p>ResNetæ˜¯å¾®è½¯å›¢é˜Ÿå¼€å‘çš„ç½‘ç»œã€‚å®ƒçš„ç‰¹å¾åœ¨äºå…·æœ‰æ¯”ä»¥å‰çš„ç½‘ç»œæ›´æ·±çš„ç»“æ„ã€‚</p><p>ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäºPythonçš„ç†è®ºä¸å®ç°ã€‹æ˜¯ä¸€æœ¬éå¸¸å¥½çš„å…¥é—¨ä¹¦ï¼Œæœ¬æ–‡çš„å†…å®¹å°±æ¥è‡ªäºå¯¹è¿™æœ¬ä¹¦çš„æ•´ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>æ·±åº¦å­¦ä¹ </category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pythonçŸ¥è¯†ç‚¹</title>
    <link href="/2024/07/16/python%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <url>/2024/07/16/python%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h3 id="pythonå‡½æ•°çš„å‚æ•°">Pythonå‡½æ•°çš„å‚æ•°</h3><hr /><p>pythonå‡½æ•°çš„ä¸»è¦å‚æ•°ç±»å‹æœ‰ï¼šé»˜è®¤å‚æ•°ã€å…³é”®å­—å‚æ•°ï¼ˆä½ç½®å‚æ•°ï¼‰ã€ä¸å®šé•¿å‚æ•°ã€‚</p><h5 id="é»˜è®¤å‚æ•°">é»˜è®¤å‚æ•°</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , b , c = <span class="hljs-number">0</span> </span>):<br>    <span class="hljs-comment"># æ‰“å°å‚æ•°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°aï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(a) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°bï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°cï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c))<br>    <span class="hljs-keyword">return</span>;<br><br><span class="hljs-comment"># è°ƒç”¨ func å‡½æ•°</span><br>func( <span class="hljs-string">&#x27;a&#x27;</span> , <span class="hljs-number">10</span> , <span class="hljs-number">12</span>)<br>func( <span class="hljs-string">&#x27;b&#x27;</span> , <span class="hljs-number">100</span> )<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">a</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">10</span> å‚æ•°cï¼š<span class="hljs-number">12</span><br>&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">b</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">100</span> å‚æ•°cï¼š<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></blockquote><p>å½“è®¾ç½®äº†é»˜è®¤å‚æ•°çš„æ—¶å€™ï¼Œåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œä¸ä¼ è¯¥å‚æ•°ï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤å€¼</p><p><strong>åªæœ‰åœ¨å½¢å‚è¡¨æœ«å°¾çš„é‚£äº›å‚æ•°å¯ä»¥æœ‰é»˜è®¤å‚æ•°å€¼</strong>ï¼Œdeffunc(a, b=1) æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ def func(a=1, b) æ˜¯ æ— æ•ˆ çš„ã€‚</p><p>å¦‚æœæƒ³åˆ¤æ–­é»˜è®¤å‚æ•°æœ‰æ²¡æœ‰å€¼ä¼ é€’è¿›æ¥ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br>_no_value =<span class="hljs-built_in">object</span>()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , b = _no_value </span>):<br>    <span class="hljs-keyword">if</span> b <span class="hljs-keyword">is</span> _no_value :<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;b æ²¡æœ‰èµ‹å€¼&#x27;</span>)<br>    <span class="hljs-keyword">return</span>;<br>func(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">&gt;<span class="hljs-keyword">b</span> æ²¡æœ‰èµ‹å€¼<br></code></pre></td></tr></table></figure></blockquote><h5 id="å…³é”®å­—å‚æ•°ä½ç½®å‚æ•°">å…³é”®å­—å‚æ•°ï¼ˆä½ç½®å‚æ•°ï¼‰</h5><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å‡½æ•°ä¼ å‚çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§é¡ºåºä¼ é€’å‚æ•°çš„ï¼Œå¦‚æœä¸å¯¹åº”é¡ºåºï¼Œå°±ä¼šä¼ é”™å€¼ã€‚</p><p>ä¸è¿‡åœ¨ Pythonä¸­ï¼Œå¯ä»¥é€šè¿‡å‚æ•°åæ¥ç»™å‡½æ•°ä¼ é€’å‚æ•°ï¼Œè€Œä¸ç”¨å…³å¿ƒå‚æ•°åˆ—è¡¨å®šä¹‰æ—¶çš„é¡ºåºï¼Œè¿™è¢«ç§°ä¹‹ä¸ºå…³é”®å­—å‚æ•°ã€‚</p><p>ä½¿ç”¨å…³é”®å‚æ•°æœ‰ä¸¤ä¸ªä¼˜åŠ¿ ï¼š</p><ul><li>ç”±äºæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒå‚æ•°çš„é¡ºåºï¼Œä½¿ç”¨å‡½æ•°å˜å¾—æ›´åŠ ç®€å•äº†ã€‚</li><li>å‡è®¾å…¶ä»–å‚æ•°éƒ½æœ‰é»˜è®¤å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åªç»™æˆ‘ä»¬æƒ³è¦çš„é‚£äº›å‚æ•°èµ‹å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , b , c = <span class="hljs-number">0</span> </span>):<br>    <span class="hljs-comment"># æ‰“å°å‚æ•°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°aï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(a) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°bï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°cï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c))<br>    <span class="hljs-keyword">return</span>;<br><br><span class="hljs-comment"># è°ƒç”¨ func å‡½æ•°</span><br>func( a=<span class="hljs-string">&#x27;a&#x27;</span> , b=<span class="hljs-number">10</span> , c=<span class="hljs-number">12</span>)<br>func( a=<span class="hljs-string">&#x27;b&#x27;</span> , c=<span class="hljs-number">100</span>, b=<span class="hljs-number">1000</span> )<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">a</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">10</span> å‚æ•°cï¼š<span class="hljs-number">12</span><br>&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">b</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">1000</span> å‚æ•°cï¼š<span class="hljs-number">100</span><br></code></pre></td></tr></table></figure></blockquote><p>ä»è¾“å‡ºç»“æœçœ‹ï¼Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œå³ä½¿ç”¨ func( a='b' , c=100, b=1000) ä¹Ÿå¯ä»¥æŠŠå‚æ•°ä¼ é€’åˆ°å‡½æ•°æ‰§è¡Œä½“ã€‚</p><h5 id="ä¸å®šé•¿å‚æ•°">ä¸å®šé•¿å‚æ•°</h5><p>æœ‰äº›æ—¶å€™ï¼Œåœ¨è®¾è®¡å‡½æ•°çš„æ—¶å€™ï¼Œæ— æ³•ç¡®å®šä¼ å…¥çš„å‚æ•°ä¸ªæ•°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸å®šé•¿å‚æ•°ã€‚</p><p>Pythonæä¾›äº†ä¸€ç§å…ƒç»„çš„æ–¹å¼æ¥æ¥å—æ²¡æœ‰ç›´æ¥å®šä¹‰çš„å‚æ•°ã€‚è¿™ç§æ–¹å¼åœ¨å‚æ•°å‰è¾¹åŠ æ˜Ÿå·<code>*</code> ã€‚</p><p>å¦‚æœåœ¨å‡½æ•°è°ƒç”¨æ—¶æ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸å‘å‡½æ•°ä¼ é€’æœªå‘½åçš„å˜é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , b , c=<span class="hljs-number">0</span>, *args</span>):<br>    <span class="hljs-comment"># æ‰“å°å‚æ•°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°aï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(a) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°bï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°cï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°argsï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(args))<br>    <span class="hljs-keyword">return</span>;<br><br><span class="hljs-comment"># è°ƒç”¨ func å‡½æ•°</span><br>func( <span class="hljs-string">&#x27;a&#x27;</span> , <span class="hljs-number">10</span> , <span class="hljs-number">12</span>, <span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-string">&quot;345&quot;</span>,<span class="hljs-number">789</span>)<br>func( a=<span class="hljs-string">&#x27;b&#x27;</span> , c=<span class="hljs-number">100</span>, b=<span class="hljs-number">1000</span> )<br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less">&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">a</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">10</span> å‚æ•°<span class="hljs-selector-tag">c</span>ï¼š<span class="hljs-number">12</span><br>&gt;å‚æ•°<span class="hljs-selector-tag">args</span>ï¼š(<span class="hljs-string">&#x27;123&#x27;</span>, <span class="hljs-string">&#x27;345&#x27;</span>, <span class="hljs-number">789</span>)<br>&gt;å‚æ•°<span class="hljs-selector-tag">a</span>ï¼š<span class="hljs-selector-tag">b</span> å‚æ•°<span class="hljs-selector-tag">b</span>ï¼š<span class="hljs-number">1000</span> å‚æ•°<span class="hljs-selector-tag">c</span>ï¼š<span class="hljs-number">100</span><br>&gt;å‚æ•°<span class="hljs-selector-tag">args</span>ï¼š()<br></code></pre></td></tr></table></figure></blockquote><p>å¦‚æœéœ€è¦ä¼ ä¸å®šé•¿çš„å‚æ•°<code>*args</code>ï¼Œé‚£ä¹ˆå°±ä¸è¦ä½¿ç”¨ä½ç½®å‚æ•°ä¼ é€’ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœéœ€è¦é€šè¿‡ä½ç½®å‚æ•°çš„æ–¹å¼ä¼ é€’ä¸å®šé•¿å‚æ•°ï¼Œå°±éœ€è¦ç”¨<code>**args</code>çš„æ–¹å¼ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , b , c=<span class="hljs-number">0</span>, **args</span>):<br>    <span class="hljs-comment"># æ‰“å°å‚æ•°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°aï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(a) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°bï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°cï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°argsï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(args))<br>    <span class="hljs-keyword">return</span>;<br><br><span class="hljs-comment"># è°ƒç”¨ func å‡½æ•°</span><br>func( a=<span class="hljs-string">&#x27;a&#x27;</span> , b=<span class="hljs-number">10</span> , c=<span class="hljs-number">12</span>, args=(<span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-string">&quot;345&quot;</span>,<span class="hljs-number">789</span>))<br>func( a=<span class="hljs-string">&#x27;b&#x27;</span> , c=<span class="hljs-number">100</span>, b=<span class="hljs-number">1000</span> )<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å‚æ•°aï¼ša å‚æ•°bï¼š10 å‚æ•°cï¼š12</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å‚æ•°argsï¼š&#123;<span class="hljs-string">&#x27;args&#x27;</span>: (<span class="hljs-string">&#x27;123&#x27;</span>, <span class="hljs-string">&#x27;345&#x27;</span>, 789)&#125;</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å‚æ•°aï¼šb å‚æ•°bï¼š1000 å‚æ•°cï¼š100</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å‚æ•°argsï¼š&#123;&#125;</span><br></code></pre></td></tr></table></figure></blockquote><p>é€šè¿‡å¯¹æ¯”ä¸¤ä¸ªä¾‹å­ï¼Œå¯ä»¥çŸ¥é“ï¼Œ<code>*args</code>æ˜¯å¯å˜å‚æ•°ï¼Œä¸”argså…¶å®å°±æ˜¯ä¸€ä¸ª tuple ï¼ˆå…ƒç»„ï¼‰ï¼Œ<code>**args</code>æ˜¯å…³é”®å­—å‚æ•°ï¼Œä¸”args å°±æ˜¯ä¸€ä¸ª dict ï¼ˆå­—å…¸ï¼‰</p><h5 id="åªæ¥å—å…³é”®å­—å‚æ•°">åªæ¥å—å…³é”®å­—å‚æ•°</h5><p>å…³é”®å­—å‚æ•°ä½¿ç”¨ç®€å•ï¼Œä¸å®¹æ˜“å‡ºé”™ï¼Œå¦‚æœå¸Œæœ›æŸäº›å‚æ•°å¼ºåˆ¶ä½¿ç”¨å…³é”®å­—å‚æ•°ä¼ é€’ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å°†å¼ºåˆ¶å…³é”®å­—å‚æ•°æ”¾åˆ°æŸä¸ª<code>*</code>å‚æ•°æˆ–è€…å•ä¸ª<code>*</code>åé¢å°±èƒ½è¾¾åˆ°è¿™ç§æ•ˆæœ,æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"> a , *, b , c=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-comment"># æ‰“å°å‚æ•°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°aï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(a) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°bï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) , end = <span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å‚æ•°cï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c))<br>    <span class="hljs-keyword">return</span>;<br><br><span class="hljs-comment"># è°ƒç”¨ func å‡½æ•°</span><br>func( a=<span class="hljs-string">&#x27;a&#x27;</span> , b=<span class="hljs-number">10</span> , c=<span class="hljs-number">12</span>)<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œå‡½æ•°çš„å‚æ•°ä¸­ï¼Œåœ¨å‚æ•°<code>a</code>çš„åé¢åŠ äº†<code>*</code>,é‚£ä¹ˆå‚æ•°<code>b</code>å’Œå‚æ•°<code>c</code>å°±è¦ä½¿ç”¨å…³é”®å­—å‚æ•°ã€‚å¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p><p>func( 'a' , 10 ) æˆ–è€… func( 'a' , b=10,100) è¿™æ ·çš„ä¼ å‚è°ƒç”¨å°±ä¼šæŠ¥é”™ï¼Œfunc( 'a' , b=10 ) æˆ–è€… func( a='a' , b=10,c=a00 )åˆ™æ²¡æœ‰é—®é¢˜ã€‚</p><p>åŸå› å°±åœ¨äº *ä¹‹åçš„å‚æ•°å¿…é¡»ç”¨å…³é”®å­—å‚æ•°ä¼ é€’ï¼Œå¦‚æœæœ€åä¸€ä¸ªæœ‰é»˜è®¤å€¼åˆ™å¯ä»¥ä¸ä¼ é€’ã€‚</p><h3 id="ç±»ä¸å¯¹è±¡">ç±»ä¸å¯¹è±¡</h3><hr /><p>é¢å‘å¯¹è±¡æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ç±»å’Œå¯¹è±¡ã€‚é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿæœ‰ä¸‰å¤§ç‰¹æ€§ï¼Œç»§æ‰¿ï¼Œå¤šæ€å’Œå°è£…æ€§ã€‚</p><h5 id="æ–°å¼ç±»ä¸æ—§å¼ç±»ç»å…¸ç±»">æ–°å¼ç±»ä¸æ—§å¼ç±»ï¼ˆç»å…¸ç±»ï¼‰</h5><p>Python2.xä¸­ï¼Œé»˜è®¤éƒ½æ˜¯ç»å…¸ç±»ï¼Œåªæœ‰æ˜¾å¼ç»§æ‰¿äº†objectçš„æ‰æ˜¯æ–°å¼ç±»ï¼Œå³ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">Person</span>(<span class="hljs-symbol">object</span>):<span class="hljs-symbol">pass</span>    æ–°å¼ç±»<br><span class="hljs-symbol">class</span> <span class="hljs-symbol">Person</span>():<span class="hljs-symbol">pass</span>    ç»å…¸ç±»<br></code></pre></td></tr></table></figure><p>åœ¨<ahref="https://so.csdn.net/so/search?q=Python&amp;spm=1001.2101.3001.7020">Python</a>3.xä¸­å–æ¶ˆäº†ç»å…¸ç±»ï¼Œé»˜è®¤éƒ½æ˜¯æ–°å¼ç±»ï¼Œå¹¶ä¸”ä¸å¿…æ˜¾å¼çš„ç»§æ‰¿objectï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">Person</span>(<span class="hljs-symbol">object</span>):<span class="hljs-symbol">pass</span>    æ–°å¼ç±»<br><span class="hljs-symbol">class</span> <span class="hljs-symbol">Person</span>():<span class="hljs-symbol">pass</span>     æ–°å¼ç±»<br></code></pre></td></tr></table></figure><p><code>æ–°å¼ç±»</code>å’Œ<code>ç»å…¸ç±»ï¼ˆæ—§å¼ç±»ï¼‰</code>çš„<code>åŒºåˆ«</code>çš„åœ¨äº<code>å­ç±»å¤šç»§æ‰¿</code>çš„æƒ…å†µä¸‹ï¼Œ<code>ç»å…¸ç±»</code>å¤šç»§æ‰¿æœç´¢é¡ºåºæ˜¯<code>æ·±åº¦ä¼˜å…ˆ</code>ï¼Œ<code>æ–°å¼ç±»</code>å¤šç»§æ‰¿æœç´¢é¡ºåºæ˜¯<code>å¹¿åº¦ä¼˜å…ˆ</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è¿™é‡ŒåŸºç±»Personæ˜¾å¼çš„ç»§æ‰¿äº†object</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, I&#x27;m Person.&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Man</span>(<span class="hljs-title class_ inherited__">Person</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, I&#x27;m Man.&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Woman</span>(<span class="hljs-title class_ inherited__">Person</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, I&#x27;m Woman.&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(Man,Woman):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>child = Child()<br>child.say_hello()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&gt;Hello, I<span class="hljs-symbol">&#x27;m</span> Man.<br></code></pre></td></tr></table></figure></blockquote><p>å¦‚æœæ³¨é‡Šæ‰ Mançš„say_helloæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è¿™é‡ŒåŸºç±»Personæ˜¾å¼çš„ç»§æ‰¿äº†object</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, I&#x27;m Person.&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Man</span>(<span class="hljs-title class_ inherited__">Person</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-comment"># def say_hello(self):</span><br>    <span class="hljs-comment">#     print(&quot;Hello, I&#x27;m Man.&quot;)</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Woman</span>(<span class="hljs-title class_ inherited__">Person</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, I&#x27;m Woman.&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(Man,Woman):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>child = Child()<br>child.say_hello()<br><br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&gt;Hello, I<span class="hljs-symbol">&#x27;m</span> Woman.<br></code></pre></td></tr></table></figure></blockquote><p>childç»§æ‰¿äº†Manå’ŒWomanä¸¤ä¸ªç±»ï¼Œæ–°å¼ç±»æœºåˆ¶ä¸‹ï¼Œchildå…ˆè°ƒç”¨mançš„say_helloæ–¹æ³•ï¼Œå¦‚æœmanæ²¡æœ‰è¯¥æ–¹æ³•ï¼Œåˆ™è°ƒç”¨Womanä¸‹çš„say_helloæ–¹æ³•ï¼Œæ˜¯å¹¿åº¦ä¼˜å…ˆè°ƒç”¨ç­–ç•¥ã€‚å¦‚æœæ˜¯æ·±åº¦ä¼˜å…ˆï¼Œchildä¼šä¼˜å…ˆè°ƒç”¨mançš„say_helloæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç„¶åä¼šè°ƒç”¨mançš„çˆ¶ç±»çš„æ–¹æ³•ã€‚</p><h5 id="è°ƒç”¨ç±»çš„å±æ€§å’Œæ–¹æ³•">è°ƒç”¨ç±»çš„å±æ€§å’Œæ–¹æ³•</h5><p>ç±»é‡Œé¢å®šä¹‰çš„å˜é‡æ˜¯å±æ€§ï¼Œç±»é‡Œé¢å®šä¹‰çš„å‡½æ•°æ˜¯æ–¹æ³•ã€‚</p><p>è°ƒç”¨æ ¼å¼ï¼šç±».å˜é‡ ã€ ç±».æ–¹æ³•</p><h5 id="ç±»æ–¹æ³•">ç±»æ–¹æ³•</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    a = <span class="hljs-number">1</span><br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">funcA</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,cls.a)<br>        <br>    <span class="hljs-comment">#def funcB():</span><br>    <span class="hljs-comment">#    print(&quot;a=&quot;,a) #æ— æ³•è°ƒç”¨ç±»å±æ€§</span><br>        <br>obj = ClassA()<br>obj.funcA()<br>ClassA.funcA()<br></code></pre></td></tr></table></figure><p>ç±»æ–¹æ³•è°ƒç”¨ç±»å±æ€§ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>åœ¨æ–¹æ³•ä¸Šé¢ï¼Œç”¨ <code>@classmethod</code>å£°æ˜è¯¥æ–¹æ³•æ˜¯ç±»æ–¹æ³•ã€‚åªæœ‰å£°æ˜äº†æ˜¯ç±»æ–¹æ³•ï¼Œæ‰èƒ½ä½¿ç”¨ç±»å±æ€§</li><li>ç±»æ–¹æ³•æƒ³è¦ä½¿ç”¨ç±»å±æ€§ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œéœ€è¦å†™ä¸Š <code>cls</code> ,cls æ˜¯ classçš„ç¼©å†™ï¼Œå…¶å®æ„æ€å°±æ˜¯æŠŠè¿™ä¸ªç±»ä½œä¸ºå‚æ•°ï¼Œä¼ ç»™è‡ªå·±ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ç±»å±æ€§äº†ã€‚</li><li>ç±»å±æ€§çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯ <code>cls.å˜é‡å</code></li></ul><p>æ— è®ºæ˜¯ <code>@classmethod</code> è¿˜æ˜¯ <code>cls</code>,éƒ½æ˜¯ä¸èƒ½çœå»çš„ã€‚</p><h5 id="å¢åŠ å’Œä¿®æ”¹ç±»çš„å±æ€§">å¢åŠ å’Œä¿®æ”¹ç±»çš„å±æ€§</h5><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¿®æ”¹å’Œå¢åŠ ç±»çš„å±æ€§ï¼Œåœ¨ç±»çš„å†…éƒ¨å’Œç±»çš„å¤–éƒ¨</p><p>ç±»çš„å†…å¤–éƒ¨éƒ¨ä¿®æ”¹ã€æ·»åŠ å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    a = <span class="hljs-number">1</span><br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,cls.a)<br>        cls.a = <span class="hljs-number">3</span> <span class="hljs-comment">#å†…éƒ¨ä¿®æ”¹å±æ€§</span><br>        cls.b = <span class="hljs-number">2</span> <span class="hljs-comment">#å†…éƒ¨æ·»åŠ å±æ€§ </span><br>        <br>obj = ClassA()<br>obj.func()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å†…éƒ¨ä¿®æ”¹å a =&quot;</span>, ClassA.a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å†…éƒ¨æ·»åŠ  b =&quot;</span>, ClassA.b)<br><br>ClassA.a = <span class="hljs-number">4</span> <span class="hljs-comment">#å¤–éƒ¨ä¿®æ”¹å±æ€§</span><br>ClassA.c = <span class="hljs-number">5</span> <span class="hljs-comment">#å¤–éƒ¨æ·»åŠ å±æ€§</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤–éƒ¨ä¿®æ”¹å a =&quot;</span>, ClassA.a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤–éƒ¨æ·»åŠ  c =&quot;</span>, ClassA.c)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,obj.a,<span class="hljs-string">&quot;b=&quot;</span>,obj.b,<span class="hljs-string">&quot;c=&quot;</span>,obj.c)<br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&gt;a<span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>&gt;å†…éƒ¨ä¿®æ”¹å a <span class="hljs-operator">=</span> <span class="hljs-number">3</span><br>&gt;å†…éƒ¨æ·»åŠ  b <span class="hljs-operator">=</span> <span class="hljs-number">2</span><br>&gt;å¤–éƒ¨ä¿®æ”¹å a <span class="hljs-operator">=</span> <span class="hljs-number">4</span><br>&gt;å¤–éƒ¨æ·»åŠ  c <span class="hljs-operator">=</span> <span class="hljs-number">5</span><br>&gt;a<span class="hljs-operator">=</span> <span class="hljs-number">4</span> b<span class="hljs-operator">=</span> <span class="hljs-number">2</span> c<span class="hljs-operator">=</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></blockquote><h5id="ç±»å±æ€§ä¸å®ä¾‹å±æ€§ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•">ç±»å±æ€§ä¸å®ä¾‹å±æ€§ã€ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•</h5><p>å…ˆè¯´ç»“è®ºï¼š</p><blockquote><p><strong>ç±»å±æ€§æ”¹å˜äº†ï¼Œå®ä¾‹å±æ€§ä¼šè·Ÿç€æ”¹å˜ã€‚</strong><strong>å®ä¾‹å±æ€§æ”¹å˜äº†ï¼Œç±»å±æ€§ä¸ä¼šæ”¹å˜</strong>ã€‚</p><p><strong>ç±»æ–¹æ³•æ”¹å˜äº†ï¼Œå®ä¾‹æ–¹æ³•ä¼šè·Ÿç€æ”¹å˜ã€‚</strong><strong>å®ä¾‹æ–¹æ³•æ”¹å˜äº†ï¼Œç±»æ–¹æ³•ä¸ä¼šæ”¹å˜(ä¼šæŠ¥é”™)ã€‚</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    a = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment">#ç±»æ–¹æ³•</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,cls.a)<br>    <span class="hljs-comment">#å®ä¾‹æ–¹æ³•</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func1 a=&quot;</span>, self.a)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func2</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func2&quot;</span>)<br>        <br>obj = ClassA()<br>obj.func()<br>obj.func1()<br><span class="hljs-comment"># obj.func2() #æŠ¥é”™</span><br><br>ClassA.func()<br><span class="hljs-comment"># ClassA.func1() #æŠ¥é”™</span><br>ClassA.func2()<br></code></pre></td></tr></table></figure><p>ç±»å±æ€§ä¸å®ä¾‹å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    a = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment">#ç±»æ–¹æ³•</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,cls.a)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func1 a=&quot;</span>, self.a)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func2</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func2&quot;</span>)<br>        <br>obj = ClassA()<br>obj.func()<br>obj.func1()<br><span class="hljs-comment"># obj.func2() #æŠ¥é”™</span><br><br>ClassA.func()<br><span class="hljs-comment"># ClassA.func1() #æŠ¥é”™</span><br>ClassA.func2()<br><br>ClassA.a = <span class="hljs-number">3</span> <span class="hljs-comment">#ä¿®æ”¹ç±»å±æ€§</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç±»å±æ€§ä¿®æ”¹ä¸ºï¼š&quot;</span>,ClassA.a) <span class="hljs-comment">#å®ä¾‹å±æ€§ç”±1 æ”¹ä¸º 3</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å®ä¾‹å±æ€§ä¿®æ”¹ä¸ºï¼š&quot;</span>,obj.a) <span class="hljs-comment">#å®ä¾‹å±æ€§ç”±1 æ”¹ä¸º 3</span><br>obj.a = <span class="hljs-number">4</span> <span class="hljs-comment"># ä¿®æ”¹å®ä¾‹å±æ€§ä¸º4</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å®ä¾‹å±æ€§ä¿®æ”¹ä¸ºï¼š&quot;</span>, obj.a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç±»å±æ€§ï¼š&quot;</span>, ClassA.a) <span class="hljs-comment">#ä¿®æ”¹å®ä¾‹å±æ€§ï¼Œç±»å±æ€§ä¸å˜</span><br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">func1 a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">func2</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">ç±»å±æ€§ä¿®æ”¹ä¸ºï¼š 3</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å®ä¾‹å±æ€§ä¿®æ”¹ä¸ºï¼š 3</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">å®ä¾‹å±æ€§ä¿®æ”¹ä¸ºï¼š 4</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">ç±»å±æ€§ï¼š 3</span><br></code></pre></td></tr></table></figure></blockquote><p>ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    a = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment">#ç±»æ–¹æ³•</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=&quot;</span>,cls.a)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func1 a=&quot;</span>, self.a)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func3</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func3&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func2</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;func2&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">newfunc</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿™æ˜¯æ–°æ–¹æ³•&quot;</span>)<br>        <br>obj = ClassA()<br>obj.func()<br>obj.func1()<br><span class="hljs-comment"># obj.func2() #æŠ¥é”™</span><br><br>ClassA.func()<br><span class="hljs-comment"># ClassA.func1() #æŠ¥é”™</span><br>ClassA.func2()<br><br>ClassA.func1 = newfunc <span class="hljs-comment">#ä¿®æ”¹ç±»çš„æ–¹æ³•</span><br>obj.func1() <span class="hljs-comment"># å®ä¾‹æ–¹æ³•æ”¹å˜</span><br><br>obj.func3 = newfunc<br>obj.func3()  <span class="hljs-comment">#ä¼šæŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">func1 a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a= 1</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">func2</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">è¿™æ˜¯æ–°æ–¹æ³•</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">---------------------------------------------------------------------------</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">TypeError                                 Traceback (most recent call last)</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">Cell In[101], line 34</span><br>    31 obj.func1() # å®ä¾‹æ–¹æ³•æ”¹å˜<br>    33 obj.func3 = newfunc<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">---&gt; 34 obj.func3()  <span class="hljs-comment">#ä¼šæŠ¥é”™</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">TypeError: newfunc() missing 1 required positional argument: <span class="hljs-string">&#x27;self&#x27;</span></span><br></code></pre></td></tr></table></figure></blockquote><h5 id="ç±»ä¸­çš„å‡½æ•°">ç±»ä¸­çš„å‡½æ•°</h5><p>æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–å‡½æ•°ï¼‰ï¼Œåœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨<code>__init__(self)</code></p><p>ææ„å‡½æ•°:å½“é”€æ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨<code>__del__(self)</code></p><h5 id="ç±»çš„ç»§æ‰¿é‡å†™">ç±»çš„ç»§æ‰¿ã€é‡å†™</h5><p>Pythonæ”¯æŒå¤šç»§æ‰¿ï¼Œæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœæ˜¯å•ç‹¬å®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œä¹Ÿå»ºè®®ç»§æ‰¿objectï¼Œå› ä¸ºobjectæ˜¯ä¸€åˆ‡ç±»çš„åŸºç±»ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassName</span>(Base1,Base2,Base3):<br>    &lt;statement-<span class="hljs-number">1</span>&gt;<br>    .<br>    .<br>    .<br>    &lt;statement-N&gt;<br></code></pre></td></tr></table></figure><p>ç±»çš„é‡å†™</p><p>å­ç±»åœ¨ç»§æ‰¿çˆ¶ç±»çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰è‡ªå·±çš„æ„é€ å‡½æ•°<code>__init__</code>ï¼Œä¹Ÿä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°<code>__init__</code>ï¼Œå¦‚æœå®šä¹‰äº†æ„é€ å‡½æ•°<code>__init__</code>,å°±æ˜¯é‡å†™äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚å¦‚æœé‡å†™äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿˜éœ€è¦è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ™é€šè¿‡<code>super()</code>æ–¹å¼è°ƒç”¨ã€‚</p><p><strong>super() åœ¨ python2ã€3ä¸­çš„åŒºåˆ«</strong>ï¼š</p><p>Python3.x å’Œ Python2.x çš„ä¸€ä¸ªåŒºåˆ«: Python 3 å¯ä»¥ä½¿ç”¨ç›´æ¥ä½¿ç”¨super().xxx ä»£æ›¿ super(Class, self).xxx :</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">python3 ç›´æ¥å†™æˆ ï¼š super()<span class="hljs-selector-class">.__init__</span>()<br>python2 å¿…é¡»å†™æˆ ï¼šsuper(æœ¬ç±»å,self)<span class="hljs-selector-class">.__init__</span>()<br></code></pre></td></tr></table></figure><p>Python3.xä¸­çš„é‡å†™ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, x</span>):<br>         y = x+<span class="hljs-number">1</span><br>         <span class="hljs-built_in">print</span>(y)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, x</span>):  <span class="hljs-comment">#é‡å†™çˆ¶ç±»æ–¹æ³•</span><br>        <span class="hljs-built_in">super</span>().add(x)  <span class="hljs-comment">#è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span><br>b = B()<br>b.add(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 3</span><br></code></pre></td></tr></table></figure><p>python2.xä¸­çš„é‡å†™ä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):   <span class="hljs-comment"># Python2.x è®°å¾—ç»§æ‰¿ object</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, x</span>):<br>         y = x+<span class="hljs-number">1</span><br>         <span class="hljs-built_in">print</span>(y)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, x</span>): <span class="hljs-comment">#é‡å†™çˆ¶ç±»æ–¹æ³•</span><br>        <span class="hljs-built_in">super</span>(B, self).add(x) <span class="hljs-comment">#è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span><br>b = B()<br>b.add(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 3</span><br><br></code></pre></td></tr></table></figure><h5 id="ç±»çš„å¤šæ€">ç±»çš„å¤šæ€</h5><p>ç±»çš„å¤šæ€æŒ‡å¯¹ä¸åŒç±»å‹çš„å˜é‡è¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡ï¼ˆæˆ–ç±»ï¼‰ç±»å‹çš„ä¸åŒè€Œè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello !&#x27;</span> + self.name)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVip</span>(<span class="hljs-title class_ inherited__">User</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello ! å°Šæ•¬çš„Vipç”¨æˆ·ï¼š&#x27;</span> + self.name)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserGeneral</span>(<span class="hljs-title class_ inherited__">User</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello ! å°Šæ•¬çš„ç”¨æˆ·ï¼š&#x27;</span> + self.name)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">printUserInfo</span>(<span class="hljs-params">user</span>):<br>    user.printUser()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    userVip = UserVip(<span class="hljs-string">&#x27;VIP&#x27;</span>)<br>    printUserInfo(userVip)<br>    userGeneral = UserGeneral(<span class="hljs-string">&#x27;æ™®é€šç”¨æˆ·&#x27;</span>)<br>    printUserInfo(userGeneral)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><blockquote><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">&gt;Hello ! å°Šæ•¬çš„Vipç”¨æˆ·ï¼šVIP<br>&gt;Hello ! å°Šæ•¬çš„ç”¨æˆ·ï¼šæ™®é€šç”¨æˆ·<br></code></pre></td></tr></table></figure></blockquote><p>ä»è¾“å‡ºå¯ä»¥çœ‹åˆ° æ ¹æ®å¯¹è±¡çš„ä¸åŒè°ƒç”¨ä¸åŒçš„å®ä¾‹æ–¹æ³•ã€‚</p><h5 id="é‡è½½ä¸é‡å†™">é‡è½½ä¸é‡å†™</h5><p><strong>é‡å†™</strong>å­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™,è¿”å›å€¼å’Œå½¢å‚éƒ½ä¸èƒ½æ”¹å˜ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong>å­ç±»å¯ä»¥æ ¹æ®éœ€è¦ï¼Œå®šä¹‰ç‰¹å®šäºè‡ªå·±çš„è¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯è¯´å­ç±»èƒ½å¤Ÿæ ¹æ®éœ€è¦å®ç°çˆ¶ç±»çš„æ–¹æ³•ã€‚</p><p><strong>é‡è½½</strong>(overloading)æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒã€‚è¿”å›ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚æ¯ä¸ªé‡è½½çš„æ–¹æ³•ï¼ˆæˆ–è€…æ„é€ å‡½æ•°ï¼‰éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚</p><p>*é‡è½½ä¸é‡å†™çš„åŒºåˆ«**</p><ol type="1"><li>æ–¹æ³•é‡è½½æ˜¯ä¸€ä¸ªç±»ä¸­å®šä¹‰äº†å¤šä¸ªæ–¹æ³•åç›¸åŒï¼Œè€Œä»–ä»¬çš„å‚æ•°çš„æ•°é‡ä¸åŒæˆ–æ•°é‡ç›¸åŒè€Œç±»å‹å’Œæ¬¡åºä¸åŒï¼Œåˆ™ç§°ä¸ºæ–¹æ³•çš„é‡è½½ã€‚</li><li>æ–¹æ³•é‡å†™æ˜¯åœ¨å­ç±»å­˜åœ¨æ–¹æ³•ä¸çˆ¶ç±»çš„æ–¹æ³•çš„åå­—ç›¸åŒï¼Œè€Œä¸”å‚æ•°çš„ä¸ªæ•°ä¸ç±»å‹ä¸€æ ·ï¼Œè¿”å›å€¼ä¹Ÿä¸€æ ·çš„æ–¹æ³•ï¼Œå°±ç§°ä¸ºé‡å†™ã€‚</li><li>æ–¹æ³•é‡è½½æ˜¯ä¸€ä¸ªç±»çš„å¤šæ€æ€§è¡¨ç°ï¼Œè€Œæ–¹æ³•é‡å†™æ˜¯å­ç±»ä¸çˆ¶ç±»çš„ä¸€ç§å¤šæ€æ€§è¡¨ç°ã€‚</li></ol><h5 id="ç±»çš„å°è£…">ç±»çš„å°è£…</h5><p>åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®é™…ä¸Šæ˜¯å°†å…·æœ‰ç‰¹å®šå±æ€§æˆ–åŠŸèƒ½çš„æ•°æ®æˆ–æ–¹æ³•ï¼Œâ€œæ‰“åŒ…â€å®šä¹‰åˆ°ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä¾›æˆ‘ä»¬éœ€è¦æ—¶è°ƒç”¨å®ƒä»¬ã€‚è¿™ä¸ªæ‰“åŒ…çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ä¹Ÿç§°â€œç±»çš„å°è£…â€ã€‚</p><p>å¦‚ä½•ç®¡ç†å’Œä½¿ç”¨è¢«å°è£…åœ¨ç±»ä¸­çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œå°±éœ€ç”¨åˆ°ç±»çš„è®¿é—®æ§åˆ¶ã€‚</p><h5 id="ç±»çš„è®¿é—®æ§åˆ¶">ç±»çš„è®¿é—®æ§åˆ¶</h5><p><strong>å±æ€§çš„è®¿é—®æ§åˆ¶</strong></p><p>åœ¨pythonä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ <code>__private_attrs</code>ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥å±æ€§ä¸ºç§æœ‰ï¼Œä¸èƒ½åœ¨ç±»åœ°å¤–éƒ¨è¢«ä½¿ç”¨æˆ–ç›´æ¥è®¿é—®ã€‚åœ¨ç±»å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨æ—¶<code>self.__private_attrs</code>ã€‚</p><p>å®é™…ä¸Šï¼Œ Python ä¸­æ˜¯æ²¡æœ‰æä¾›ç§æœ‰å±æ€§ç­‰åŠŸèƒ½çš„ã€‚Pythonå¯¹å±æ€§çš„è®¿é—®æ§åˆ¶æ˜¯é ç¨‹åºå‘˜è‡ªè§‰çš„ã€‚</p><p><strong>æ–¹æ³•çš„è®¿é—®æ§åˆ¶</strong></p><p>æ–¹æ³•çš„è®¿é—®æ§åˆ¶ä¹Ÿæ˜¯è·Ÿå±æ€§æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯æ²¡æœ‰å®è´¨ä¸Šçš„ç§æœ‰æ–¹æ³•ã€‚ä¸€åˆ‡éƒ½æ˜¯é ç¨‹åºå‘˜è‡ªè§‰éµå®ˆPython çš„ç¼–ç¨‹è§„èŒƒï¼Œå…·ä½“è§„åˆ™ä¹Ÿæ˜¯è·Ÿå±æ€§ä¸€æ ·çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, account</span>):<br>        self.name = name<br>        self._age = age<br>        self.__account = account <span class="hljs-comment">#ç§æœ‰å±æ€§</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">upgrade</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_buy_equipment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pk</span>(<span class="hljs-params">self</span>): <span class="hljs-comment"># ç§æœ‰æ–¹æ³•</span><br>        <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><h5 id="ç±»ä¸“æœ‰çš„æ–¹æ³•">ç±»ä¸“æœ‰çš„æ–¹æ³•</h5><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>__init__</code></td><td>æ„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨</td></tr><tr><td><code>__del__</code></td><td>ææ„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨</td></tr><tr><td><code>__repr__</code></td><td>æ‰“å°ï¼Œè½¬æ¢</td></tr><tr><td><code>__setitem__</code></td><td>æŒ‰ç…§ç´¢å¼•èµ‹å€¼</td></tr><tr><td><code>__getitem__</code></td><td>æŒ‰ç…§ç´¢å¼•è·å–å€¼</td></tr><tr><td><code>__len__</code></td><td>è·å¾—é•¿åº¦</td></tr><tr><td><code>__cmp__</code></td><td>æ¯”è¾ƒè¿ç®—</td></tr><tr><td><code>__call__</code></td><td>å‡½æ•°è°ƒç”¨</td></tr><tr><td><code>__add__</code></td><td>åŠ è¿ç®—</td></tr><tr><td><code>__sub__</code></td><td>å‡è¿ç®—</td></tr><tr><td><code>__mul__</code></td><td>ä¹˜è¿ç®—</td></tr><tr><td><code>__div__</code></td><td>é™¤è¿ç®—</td></tr><tr><td><code>__mod__</code></td><td>æ±‚ä½™è¿ç®—</td></tr><tr><td><code>__pow__</code></td><td>ä¹˜æ–¹</td></tr></tbody></table><p>éœ€è¦è·å–ç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š</p><ul><li><code>type(obj)</code>ï¼šæ¥è·å–å¯¹è±¡çš„ç›¸åº”ç±»å‹ï¼›</li><li><code>isinstance(obj, type)</code>ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæŒ‡å®šçš„ typeç±»å‹çš„å®ä¾‹ï¼›</li><li><code>hasattr(obj, attr)</code>ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŒ‡å®šå±æ€§/æ–¹æ³•ï¼›</li><li><code>getattr(obj, attr[, default])</code> è·å–å±æ€§/æ–¹æ³•çš„å€¼,è¦æ˜¯æ²¡æœ‰å¯¹åº”çš„å±æ€§åˆ™è¿”å› default å€¼ï¼ˆå‰ææ˜¯è®¾ç½®äº† defaultï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å‡ºAttributeError å¼‚å¸¸ï¼›</li><li><code>setattr(obj, attr, value)</code>ï¼šè®¾å®šè¯¥å±æ€§/æ–¹æ³•çš„å€¼ï¼Œç±»ä¼¼äºobj.attr=valueï¼›</li><li><code>dir(obj)</code>ï¼šå¯ä»¥è·å–ç›¸åº”å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•åçš„åˆ—è¡¨ï¼š</li></ul><h3 id="é—­åŒ…ä¸è£…é¥°å™¨">é—­åŒ…ä¸è£…é¥°å™¨</h3><h5 id="é—­åŒ…">é—­åŒ…</h5><p><strong>é—­åŒ…</strong>æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°å¯ä»¥è®°ä½å…¶å¤–éƒ¨å˜é‡å¹¶å¯ä»¥è®¿é—®è¿™äº›å˜é‡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + num<br>    <span class="hljs-keyword">return</span>  <span class="hljs-built_in">sum</span><br><br><span class="hljs-built_in">print</span>(add(<span class="hljs-number">2</span>)) <span class="hljs-comment">#æŠ¥é”™ UnboundLocalError: cannot access local variable &#x27;sum&#x27; where it is not associated with a value</span><br><span class="hljs-built_in">print</span>(add(<span class="hljs-number">10</span>)) <br></code></pre></td></tr></table></figure><p>æ¯”å¦‚è¦åšä¸€ä¸ªæ±‚å’Œï¼Œç¬¬7è¡Œä¼šæŠ¥é”™ã€‚å› ä¸ºï¼Œåœ¨ Pythonä¸­ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°ä½¿ç”¨äº†å’Œå…¨å±€å˜é‡ç›¸åŒçš„åå­—ä¸”æ”¹å˜äº†è¯¥å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆè¯¥å˜é‡å°±ä¼šå˜æˆå±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆåœ¨å‡½æ•°ä¸­æˆ‘ä»¬æ²¡æœ‰è¿›è¡Œå®šä¹‰å°±å¼•ç”¨äº†ï¼Œæ‰€ä»¥ä¼šæŠ¥è¯¥é”™è¯¯ã€‚</p><p>å¦‚æœè¦å¼•ç”¨å…¨å±€å˜é‡ï¼Œå¹¶åœ¨å‡½æ•°ä¸­å¯¹å®ƒè¿›è¡Œä¿®æ”¹ï¼Œè¯·ä½¿ç”¨globalå…³é”®å­—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-keyword">global</span> <span class="hljs-built_in">sum</span><br>    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + num<br>    <span class="hljs-keyword">return</span>  <span class="hljs-built_in">sum</span><br><br><span class="hljs-built_in">print</span>(add(<span class="hljs-number">2</span>))<br><span class="hljs-built_in">print</span>(add(<span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">2</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">12</span><br></code></pre></td></tr></table></figure></blockquote><p>ä½¿ç”¨å…¨å±€å˜é‡çš„ç¼ºç‚¹ï¼šä¸åŒæ¨¡å—ï¼Œä¸åŒå‡½æ•°éƒ½å¯ä»¥è‡ªç”±çš„è®¿é—®å…¨å±€å˜é‡ï¼Œå¯èƒ½ä¼šé€ æˆå…¨å±€å˜é‡çš„ä¸å¯é¢„çŸ¥æ€§ã€‚</p><p>å¯æ˜¯ä½¿ç”¨<strong>é—­åŒ…</strong>æ¥è§£å†³ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_num</span>(<span class="hljs-params"><span class="hljs-built_in">sum</span></span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">num</span>):<br>        <span class="hljs-keyword">nonlocal</span> <span class="hljs-built_in">sum</span><br>        <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + num<br>        <span class="hljs-keyword">return</span>  <span class="hljs-built_in">sum</span><br>    <span class="hljs-keyword">return</span> add<br><br>func = add_num(<span class="hljs-built_in">sum</span>)<br><span class="hljs-built_in">print</span>(func.__closure__) <br><span class="hljs-built_in">print</span>(func(<span class="hljs-number">2</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sum</span>)<br><span class="hljs-built_in">print</span>(func(<span class="hljs-number">10</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sum</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">(&lt;cell at 0x7f8c1d5d9480: int object at 0x94f1e8&gt;,)</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">2</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">12</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0</span><br></code></pre></td></tr></table></figure></blockquote><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œadd_sumä¸­ åµŒå¥—äº†ä¸€ä¸ªå‡½æ•°add,addé€šè¿‡nonlocalå…³é”®å­—è®¿é—®å¤–éƒ¨å˜é‡(add_sumçš„å‚æ•°)sumï¼Œè€Œæœ€å¤–å±‚çš„sumå˜é‡å¹¶æ²¡æœ‰å—åˆ°å½±å“ï¼ˆä¾æ—§ä¸º0ï¼‰ã€‚</p><p>åœ¨è¿™é‡Œå¯ä»¥æŠŠglobalå’Œnonlocalåšä¸€ä¸ªåŒºåˆ†ï¼š</p><p>ä¸¤ä¸ªå…³é”®è¯éƒ½ç”¨äºå…è®¸åœ¨ä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨å¤–å±‚çš„å˜é‡ã€‚</p><ul><li>global è¡¨ç¤ºå°†å˜é‡å£°æ˜ä¸ºå…¨å±€å˜é‡</li><li>nonlocalè¡¨ç¤ºå°†å˜é‡å£°æ˜ä¸ºå¤–å±‚å˜é‡ï¼ˆå¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸”ä¸èƒ½æ˜¯å…¨å±€å˜é‡ï¼‰</li><li>åœ¨ä½¿ç”¨ nonlocal a ä¹‹å‰ï¼Œå¿…é¡»ä¿è¯å¤–å±‚çš„ç¡®å·²ç»å®šä¹‰è¿‡ a äº†ï¼Œä½†æ˜¯åœ¨global açš„æ—¶å€™ï¼Œå¯ä»¥å…è®¸å…¨å±€å˜é‡ä¸­è¿˜æ²¡æœ‰å®šä¹‰è¿‡aï¼Œå¯ä»¥ç•™åœ¨åé¢å®šä¹‰ã€‚</li></ul><p>python åœ¨è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œå…ˆè¦å»å®šä½è¿™ä¸ªå˜é‡æ¥æºäºå“ªé‡Œã€‚</p><p>pythonå¼•ç”¨å˜é‡çš„é¡ºåºå¦‚ä¸‹ï¼š</p><ol type="1"><li>å½“å‰ä½œç”¨åŸŸå±€éƒ¨å˜é‡</li><li>å¤–å±‚ä½œç”¨åŸŸå˜é‡</li><li>å½“å‰æ¨¡å—ä¸­çš„å…¨å±€å˜é‡</li><li>pythonå†…ç½®å˜é‡</li></ol><p>å³ä¼˜å…ˆä»å±€éƒ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾è¿™ä¸ªå˜é‡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå†å»å¤–å±‚æ‰¾ï¼Œå¦‚æœåˆ°äº†æœ€åè¿˜æ²¡æ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™ã€‚</p><p>è¿™ç§å†…éƒ¨å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸä¸­å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°å±€éƒ¨ä½œç”¨åŸŸä¸­å˜é‡çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ç§°ä¸ºï¼šé—­åŒ…ã€‚æ›´åŠ ç›´æ¥çš„è¡¨è¾¾æ–¹å¼å°±æ˜¯ï¼Œå½“æŸä¸ªå‡½æ•°è¢«å½“æˆå¯¹è±¡è¿”å›æ—¶ï¼Œå¤¹å¸¦äº†å¤–éƒ¨å˜é‡ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ã€‚æ‰€æœ‰å‡½æ•°éƒ½æœ‰ä¸€ä¸ª<code>__closure__</code> å±æ€§ï¼Œå¦‚æœå‡½æ•°æ˜¯é—­åŒ…çš„è¯ï¼Œé‚£ä¹ˆå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªç”±cell ç»„æˆçš„å…ƒç»„å¯¹è±¡ã€‚cell å¯¹è±¡çš„ cell_contentså±æ€§å°±æ˜¯å­˜å‚¨åœ¨é—­åŒ…ä¸­çš„å˜é‡ã€‚å¦‚ä¸Šé¢ çš„ä»£ç print(func.<code>__closure__</code> ) ï¼Œåˆ™å¯ä»¥å¾—åˆ°è¾“å‡º (&lt;cell at0x7f8c1d5d9480: int object at 0x94f1e8&gt;,)</p><h5 id="è£…é¥°å™¨">è£…é¥°å™¨</h5><p><strong>è£…é¥°å™¨</strong>æ˜¯ä¿®æ”¹å…¶ä»–å‡½æ•°çš„åŠŸèƒ½çš„å‡½æ•°ã€‚è£…é¥°å™¨çš„å®ç°å°±å¯ä»¥é€šè¿‡é—­åŒ…æ¥å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç®€å•å‡½æ•°&#x27;</span>)<br>func()<br></code></pre></td></tr></table></figure><p>ç»™è¿™ä¸ªç®€å•çš„å‡½æ•°åŠ ç‚¹ä¸œè¥¿ï¼Œæ¯”å¦‚è¾“å‡ºæ—¶é—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-built_in">print</span>(time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>, time.localtime(time.time())))  <span class="hljs-comment"># è¾“å‡ºæ—¶é—´</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç®€å•å‡½æ•°&#x27;</span>)<br>func()<br></code></pre></td></tr></table></figure><p>åœ¨åŸæ¥çš„åŸºç¡€ä¸Šä¿®æ”¹å¯ä»¥è¾¾åˆ°è¦æ±‚ï¼Œä½†æ˜¯ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾,å¯¹ä¿®æ”¹å°é—­ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç®€å•å‡½æ•°&#x27;</span>)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">new_func</span>():<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ–°å‡½æ•°&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_time</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-built_in">print</span>(time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>, time.localtime(time.time())))<br>    func()<br><br>add_time(func)<br>add_time(new_func)<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ·»åŠ add_time(func)è¿™ä¸ªåŠŸèƒ½å‡½æ•°ï¼Œå¯ä»¥ä¸ºä»»æ„çš„å‡½æ•°æ·»åŠ è¾“å‡ºæ—¶é—´çš„åŠŸèƒ½ã€‚</p><p>è¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯å†™æ³•ä¸Šä¸å¥½åˆ¤æ–­æ˜¯å“ªä¸ªå‡½æ•°è£…é¥°å“ªä¸ªå‡½æ•°ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„å†™æ³•å‘¢?æ˜¯æœ‰çš„ï¼Œè¿™ä¸ªå†™æ³•å’Œé—­åŒ…çš„å†™æ³•æœ‰ç‚¹ç›¸ä¼¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment">#è£…é¥°å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_time</span>():<br>        <span class="hljs-built_in">print</span>(time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>, time.localtime(time.time())))<br>        func() <br>    <span class="hljs-keyword">return</span> add_time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç®€å•å‡½æ•°&#x27;</span>)<br><br>f = decorator(func) <span class="hljs-comment"># è¿”å›çš„å‡½æ•°å¯¹è±¡</span><br>f()  <span class="hljs-comment"># ä½¿ç”¨è¿”å›çš„å‡½æ•°å¯¹è±¡è°ƒç”¨å‡½æ•°</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒæŠŠadd_timeä½œä¸ºè£…é¥°å‡½æ•°çš„å†…éƒ¨å‡½æ•°ï¼ŒæŠŠå¾…è£…é¥°çš„å‡½æ•°ä¼ å…¥è£…é¥°å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè£…é¥°çš„å‡½æ•°å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªè¿”å›çš„å‡½æ•°å¯¹è±¡ï¼Œå°±å¯ä»¥å®ç°ä»¥ä¸Šä»£ç çš„åŠŸèƒ½ï¼Œè¿™ä¸­å†™æ³•æ›´ç®€æ´ã€‚</p><p>é€šè¿‡ä»£ç ï¼Œèƒ½çŸ¥é“è£…é¥°å™¨å‡½æ•°ä¸€èˆ¬åšè¿™ä¸‰ä»¶äº‹ï¼š</p><ol type="1"><li>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°</li><li>åµŒå¥—ä¸€ä¸ªåŒ…è£…å‡½æ•°,åŒ…è£…å‡½æ•°ä¼šæ¥æ”¶åŸå‡½æ•°çš„ç›¸åŒå‚æ•°ï¼Œå¹¶æ‰§è¡ŒåŸå‡½æ•°ï¼Œä¸”è¿˜ä¼šæ‰§è¡Œé™„åŠ åŠŸèƒ½</li><li>è¿”å›åµŒå¥—å‡½æ•°ã€‚</li></ol><p>å½“ç„¶ï¼Œæœ‰äº†è£…é¥°å™¨å‡½æ•°ï¼Œ Python è®¾è®¡å‡ºäº† <code>@</code> è¯­æ³•ç³–ï¼Œè®©å®šä¹‰è£…é¥°å™¨ï¼ŒæŠŠè£…é¥°å™¨è°ƒç”¨åŸå‡½æ•°å†æŠŠç»“æœèµ‹å€¼ä¸ºåŸå‡½æ•°çš„å¯¹è±¡åçš„è¿‡ç¨‹å˜å¾—æ›´åŠ ç®€å•ï¼Œæ–¹ä¾¿ï¼Œæ˜“æ“ä½œï¼Œæ‰€ä»¥Pythonè£…é¥°å™¨çš„æ ¸å¿ƒå¯ä»¥è¯´å°±æ˜¯å®ƒçš„è¯­æ³•ç³–ã€‚ä½¿ç”¨äº†è¯­æ³•ç³–çš„è£…é¥°å™¨ç”¨æ³•ï¼Œæœ‰ç‚¹åƒjavaä¸­çš„æ³¨è§£ã€‚æŠŠä¸Šé¢çš„ä»£ç æ”¹ä¸ºä½¿ç”¨<code>@</code>è¯­æ³•ç³–çš„å†™æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment">#è£…é¥°å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_time</span>():<br>        <span class="hljs-built_in">print</span>(time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>, time.localtime(time.time())))<br>        func() <br>    <span class="hljs-keyword">return</span> add_time<br><br><span class="hljs-meta">@decorator  </span><span class="hljs-comment">#å°†è£…é¥°å‡½æ•°åŠ åˆ°å¾…è£…é¥°çš„å‡½æ•°ä¸Šé¢ï¼Œå°±å¯ä»¥ä¸ºå¾…è£…é¥°å‡½æ•°å¢æ·»æ–°çš„åŠŸèƒ½ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç®€å•å‡½æ•°&#x27;</span>)<br><br>func()<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨<code>@</code>è¯­æ³•ç³–ï¼Œå°†è£…é¥°å‡½æ•°åŠ åˆ°å¾…è£…é¥°çš„å‡½æ•°ä¸Šé¢ï¼Œå°±å¯ä»¥ä¸ºå¾…è£…é¥°å‡½æ•°å¢æ·»æ–°çš„åŠŸèƒ½ã€‚è€Œä¸”è°ƒç”¨æ–¹å¼ä¹Ÿä¸æ­£å¸¸çš„è°ƒç”¨æ–¹å¼ä¿æŒä¸€è‡´ï¼Œä¸éœ€è¦é€šè¿‡å‡½æ•°å¯¹è±¡çš„æ–¹å¼è°ƒç”¨äº†ã€‚</p><h6 id="pythonå†…ç½®çš„è£…é¥°å™¨">pythonå†…ç½®çš„è£…é¥°å™¨</h6><table><thead><tr><th>è£…é¥°å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><span class="citation" data-cites="lru_cache">@lru_cache</span></td><td>ä½¿ç”¨ç¼“å­˜æŠ€å·§åŠ é€Ÿ</td></tr><tr><td><span class="citation"data-cites="total_ordering">@total_ordering</span></td><td>æ ¹æ®å®šä¹‰çš„æ–¹æ³•ä¸º Python ç±»ç”Ÿæˆç¼ºå°‘çš„æ¯”è¾ƒæ–¹æ³•ã€‚</td></tr><tr><td><span class="citation"data-cites="contextmanager">@contextmanager</span></td><td>Python æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨æœºåˆ¶æ¥å¸®åŠ©ä½ æ­£ç¡®åœ°ç®¡ç†èµ„æºã€‚</td></tr><tr><td><span class="citation" data-cites="property">@property</span></td><td>ä½¿ç”¨ <span class="citation" data-cites="property">@property</span>è£…é¥°å™¨å¯ä»¥è®¾ç½®æ¯ä¸ªç±»å±æ€§çš„getterå’Œsetteræ–¹æ³•ã€‚</td></tr><tr><td><span class="citation"data-cites="cached_property">@cached_property</span></td><td>Python 3.8 ä¸º functool æ¨¡å—å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å¼ºå¤§è£…é¥°å™¨â€”â€”<spanclass="citation"data-cites="cached_property">@cached_property</span>ã€‚å®ƒå¯ä»¥å°†ä¸€ä¸ªç±»çš„æ–¹æ³•è½¬æ¢ä¸ºä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§çš„å€¼è®¡ç®—ä¸€æ¬¡ï¼Œç„¶ååœ¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå†…ä½œä¸ºæ™®é€šå±æ€§ç¼“å­˜ã€‚</td></tr><tr><td><span class="citation"data-cites="classmethod">@classmethod</span></td><td>è¦å®šä¹‰ä¸€ä¸ªç±»æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨@classmethod è£…é¥°å™¨ã€‚</td></tr><tr><td><span class="citation"data-cites="staticmethod">@staticmethod</span></td><td>è¦å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨@staticmethod è£…é¥°å™¨</td></tr><tr><td><span class="citation" data-cites="dataclass">@dataclass</span></td><td><span class="citation"data-cites="dataclassè£…é¥°å™¨">@dataclassè£…é¥°å™¨</span>ï¼ˆPython3.7å¼•å…¥ï¼‰å¯ä»¥è‡ªåŠ¨ä¸ºä¸€ä¸ªç±»ç”Ÿæˆå‡ ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼Œå¦‚<strong>init</strong>ã€<strong>repr</strong>ã€<strong>eq</strong>ã€<strong>lt</strong>ç­‰ã€‚</td></tr><tr><td><span class="citation"data-cites="atexit.register">@atexit.register</span></td><td>æ¥è‡ª atexit æ¨¡å—çš„ <span class="citation"data-cites="register">@register</span> è£…é¥°å™¨å¯ä»¥è®©æˆ‘ä»¬åœ¨ Pythonè§£é‡Šå™¨é€€å‡ºæ—¶æ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚</td></tr></tbody></table><p>å…·ä½“è¯·å‚è€ƒè¿™é‡Œçš„<ahref="https://cloud.tencent.com/developer/article/2210650">ç¤ºä¾‹</a></p><h3 id="è¿›ç¨‹ä¸çº¿ç¨‹">è¿›ç¨‹ä¸çº¿ç¨‹</h3><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•å…ƒã€‚</p><p>è¿›ç¨‹ä¸€èˆ¬ç”±ç¨‹åºã€æ•°æ®é›†åˆå’Œè¿›ç¨‹æ§åˆ¶å—ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ç¨‹åºç”¨äºæè¿°è¿›ç¨‹è¦å®Œæˆçš„åŠŸèƒ½ï¼Œæ˜¯æ§åˆ¶è¿›ç¨‹æ‰§è¡Œçš„æŒ‡ä»¤é›†</li><li>æ•°æ®é›†åˆæ˜¯ç¨‹åºåœ¨æ‰§è¡Œæ—¶æ‰€éœ€è¦çš„æ•°æ®å’Œå·¥ä½œåŒº</li><li>ç¨‹åºæ§åˆ¶å—ï¼ŒåŒ…å«è¿›ç¨‹çš„æè¿°ä¿¡æ¯å’Œæ§åˆ¶ä¿¡æ¯ï¼Œæ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—</li></ul><p><strong>åŒºåˆ«</strong></p><ul><li><strong>æœ¬è´¨åŒºåˆ«</strong>ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½</li><li><strong>ä»å±å…³ç³»ä¸åŒ</strong>:è¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ï¼Œçº¿ç¨‹å±äºè¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚</li><li><strong>å¼€é”€ä¸åŒ</strong>ï¼šè¿›ç¨‹çš„åˆ›å»ºã€é”€æ¯å’Œåˆ‡æ¢çš„å¼€é”€éƒ½è¿œå¤§äºçº¿ç¨‹ã€‚ç”±äºçº¿ç¨‹æ¯”è¿›ç¨‹æ›´å°ï¼ŒåŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œæ•…å¯¹å®ƒçš„è°ƒåº¦æ‰€ä»˜å‡ºçš„å¼€é”€å°±ä¼šå°å¾—å¤šï¼Œèƒ½æ›´é«˜æ•ˆçš„æé«˜ç³»ç»Ÿå†…å¤šä¸ªç¨‹åºé—´å¹¶å‘æ‰§è¡Œçš„ç¨‹åº¦ï¼Œä»è€Œæ˜¾è‘—æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œååé‡ã€‚</li><li><strong>æ‹¥æœ‰èµ„æºä¸åŒ</strong>ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…å­˜å’Œèµ„æºï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¼šå…±äº«è¿™äº›å†…å­˜å’Œèµ„æºã€‚è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚æ‰€æœ‰ä¸è¯¥è¿›ç¨‹æœ‰å…³çš„èµ„æºï¼Œéƒ½è¢«è®°å½•åœ¨è¿›ç¨‹æ§åˆ¶å—PCBä¸­ã€‚ä»¥è¡¨ç¤ºè¯¥è¿›ç¨‹æ‹¥æœ‰è¿™äº›èµ„æºæˆ–æ­£åœ¨ä½¿ç”¨å®ƒä»¬ã€‚å¦å¤–ï¼Œè¿›ç¨‹ä¹Ÿæ˜¯æŠ¢å å¤„ç†æœºçš„è°ƒåº¦å•ä½ï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å½“è¿›ç¨‹å‘ç”Ÿè°ƒåº¦æ—¶ï¼Œä¸åŒçš„è¿›ç¨‹æ‹¥æœ‰ä¸åŒçš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€ŒåŒä¸€è¿›ç¨‹å†…çš„ä¸åŒçº¿ç¨‹å…±äº«åŒä¸€åœ°å€ç©ºé—´ã€‚</li><li><strong>æ§åˆ¶å’Œå½±å“èƒ½åŠ›ä¸åŒ</strong>ï¼šå­è¿›ç¨‹æ— æ³•å½±å“çˆ¶è¿›ç¨‹ï¼Œè€Œå­çº¿ç¨‹å¯ä»¥å½±å“çˆ¶çº¿ç¨‹ï¼Œå¦‚æœä¸»çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ä¼šå½±å“å…¶æ‰€åœ¨è¿›ç¨‹å’Œå­çº¿ç¨‹ã€‚ä¸è¿›ç¨‹ç›¸å¯¹åº”ï¼Œçº¿ç¨‹ä¸èµ„æºåˆ†é…æ— å…³ï¼Œå®ƒå±äºæŸä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸è¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹ä¸€èµ·å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li><li><strong>CPUåˆ©ç”¨ç‡ä¸åŒ</strong>ï¼šè¿›ç¨‹çš„CPUåˆ©ç”¨ç‡è¾ƒä½ï¼Œå› ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¾ƒå¤§ï¼Œè€Œçº¿ç¨‹çš„CPUçš„åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œä¸Šä¸‹æ–‡çš„åˆ‡æ¢é€Ÿåº¦å¿«ã€‚åœ¨å¤šæ ¸æˆ–å¤šCPUï¼Œæˆ–æ”¯æŒHyper-threadingçš„CPUä¸Šä½¿ç”¨å¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§ï¼Œå³æé«˜äº†ç¨‹åºçš„æ‰§è¡Œååç‡ã€‚åœ¨å•CPUå•æ ¸çš„è®¡ç®—æœºä¸Šï¼Œä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æŠŠè¿›ç¨‹ä¸­è´Ÿè´£I/Oå¤„ç†ã€äººæœºäº¤äº’è€Œå¸¸è¢«é˜»å¡çš„éƒ¨åˆ†ä¸å¯†é›†è®¡ç®—çš„éƒ¨åˆ†åˆ†å¼€æ¥æ‰§è¡Œï¼Œç¼–å†™ä¸“é—¨çš„workhorseçº¿ç¨‹æ‰§è¡Œå¯†é›†è®¡ç®—ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li></ul><h5 id="pythonçš„å¤šçº¿ç¨‹">Pythonçš„å¤šçº¿ç¨‹</h5><p>çº¿ç¨‹çš„çŠ¶æ€å¯ä»¥åˆ†ä¸º</p><ul><li>New åˆ›å»º</li><li>Runnable å°±ç»ªã€‚ç­‰å¾…è°ƒåº¦</li><li>Running è¿è¡Œ</li><li>Blocked é˜»å¡ã€‚é˜»å¡å¯èƒ½åœ¨ Wait Locked Sleeping</li><li>Dead æ¶ˆäº¡</li></ul><p>çº¿ç¨‹çš„ç±»å‹å¯åˆ†ä¸ºï¼š</p><ul><li>ä¸»çº¿ç¨‹</li><li>å­çº¿ç¨‹</li><li>å®ˆæŠ¤çº¿ç¨‹ï¼ˆåå°çº¿ç¨‹ï¼‰</li><li>å‰å°çº¿ç¨‹</li></ul><p>Python æä¾›ä¸¤ä¸ªæ¨¡å—è¿›è¡Œå¤šçº¿ç¨‹çš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯ <code>thread</code> å’Œ<code>threading</code></p><p>Threadæ˜¯æ¯”è¾ƒä½çº§çš„æ¨¡å—ï¼Œç”¨äºæ›´åº•å±‚çš„æ“ä½œã€‚å› æ­¤ï¼Œä¸»è¦ç”¨threadingå¤šä¸€äº›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> threading<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubThread</span>(threading.Thread):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;thread &#123;&#125;, @number: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.name, i))<br>            time.sleep(<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start main threading&quot;</span>)<br><br>    <span class="hljs-comment"># åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹</span><br>    threads = [SubThread() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]<br>    <span class="hljs-comment"># å¯åŠ¨ä¸‰ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.start()<br>    <span class="hljs-comment"># è®©æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ join,ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œ</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;End Main threading&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><h5 id="çº¿ç¨‹åŒæ­¥">çº¿ç¨‹åŒæ­¥</h5><p>å¤šçº¿ç¨‹ä¼šé€ æˆæ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±è¦ä½¿ç”¨é”æœºåˆ¶ã€‚pythonThreadingæ¨¡å—æä¾›äº†LockåŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">lock = threading.Lock()<br>lock.acquire()<br>lock.release()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> threading<br><br>shared_resource_lock = threading.Lock()<br><span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubThread</span>(threading.Thread):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, threadname, startnum, endnum</span>):<br>        threading.Thread.__init__(self)<br>        self._threadname = threadname<br>        self._startnum = startnum<br>        self._endnum = endnum<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">global</span> <span class="hljs-built_in">sum</span><br>        shared_resource_lock.acquire() <span class="hljs-comment">#åŠ é”</span><br>        <span class="hljs-comment"># print(self._startnum, self._endnum)</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self._startnum, self._endnum+<span class="hljs-number">1</span>):<br>            <span class="hljs-comment"># print(i)</span><br>            <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + i<br>            time.sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-built_in">print</span>(self._threadname,<span class="hljs-string">&quot;è®¡ç®—ç»“æœ&quot;</span>,<span class="hljs-built_in">sum</span>)<br>        shared_resource_lock.release() <span class="hljs-comment"># é‡Šæ”¾é”</span><br>    <br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start main threading&quot;</span>)<br><br>    <span class="hljs-comment"># åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹</span><br>    threads = [SubThread(<span class="hljs-string">&quot;çº¿ç¨‹&quot;</span>+<span class="hljs-built_in">str</span>(i), i*<span class="hljs-number">20</span>+<span class="hljs-number">1</span>, (i+<span class="hljs-number">1</span>)*<span class="hljs-number">20</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]<br>    <span class="hljs-comment"># å¯åŠ¨ä¸‰ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.start()<br><br>   <span class="hljs-comment"># ä¸€æ¬¡è®©æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ join</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;End Main threading&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">Start main threading</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">çº¿ç¨‹0 è®¡ç®—ç»“æœ 210</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">çº¿ç¨‹1 è®¡ç®—ç»“æœ 820</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">çº¿ç¨‹2 è®¡ç®—ç»“æœ 1830</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">çº¿ç¨‹3 è®¡ç®—ç»“æœ 3240</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">çº¿ç¨‹4 è®¡ç®—ç»“æœ 5050</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">End Main threading</span><br></code></pre></td></tr></table></figure></blockquote><p>è¿™æ®µä»£ç å±•ç¤ºäº†ä½¿ç”¨å¤šçº¿ç¨‹ä»1åˆ°100çš„æ±‚å’Œã€‚5ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£20ä¸ªæ•°ï¼Œæœ€åå¾—åˆ°5050çš„æ±‚å’Œç»“æœã€‚ä¸ºäº†ä¿è¯æ±‚å’Œçš„é¡ºåˆ©è¿›è¡Œï¼Œå…¨å±€å˜é‡<code>sum</code>æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡åŠ é”ä¿è¯è®¡ç®—çš„æ­£ç¡®æ€§ã€‚</p><h5 id="çº¿ç¨‹åŒæ­¥çš„å…¶ä»–æ–¹å¼">çº¿ç¨‹åŒæ­¥çš„å…¶ä»–æ–¹å¼</h5><h6 id="å¯é‡å…¥é”">å¯é‡å…¥é”</h6><p>æ”¯æŒåœ¨åŒä¸€çº¿ç¨‹ä¸­å¤šæ¬¡è¯·æ±‚åŒä¸€èµ„æºï¼ŒPythonæä¾›äº†å¯é‡å…¥é”ï¼ˆRLockï¼‰ã€‚RLock å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ª Lock å’Œä¸€ä¸ª counterå˜é‡ï¼Œcounter è®°å½•äº† acquire çš„æ¬¡æ•°ï¼Œä»è€Œä½¿å¾—èµ„æºå¯ä»¥è¢«å¤šæ¬¡requireã€‚ç›´åˆ°ä¸€ä¸ªçº¿ç¨‹æ‰€æœ‰çš„ acquire éƒ½è¢«releaseï¼Œå…¶ä»–çš„çº¿ç¨‹æ‰èƒ½è·å¾—èµ„æºã€‚</p><p>r_lock = threading.RLock()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Box</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    lock = threading.RLock() <span class="hljs-comment"># å¯é‡å…¥é”</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.total_items = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self, n</span>):<br>        Box.lock.acquire()<br>        self.total_items += n<br>        Box.lock.release()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self</span>):<br>        Box.lock.acquire()<br>        self.execute(<span class="hljs-number">1</span>)<br>        Box.lock.release()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">self</span>):<br>        Box.lock.acquire()<br>        self.execute(-<span class="hljs-number">1</span>)<br>        Box.lock.release()<br><br><span class="hljs-comment">## These two functions run n in separate</span><br><span class="hljs-comment">## threads and call the Box&#x27;s methods</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">adder</span>(<span class="hljs-params">box, items</span>):<br>    <span class="hljs-keyword">while</span> items &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;adding 1 item in the box&quot;</span>)<br>        box.add()<br>        time.sleep(<span class="hljs-number">1</span>)<br>        items -= <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remover</span>(<span class="hljs-params">box, items</span>):<br>    <span class="hljs-keyword">while</span> items &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;removing 1 item in the box&quot;</span>)<br>        box.remove()<br>        time.sleep(<span class="hljs-number">1</span>)<br>        items -= <span class="hljs-number">1</span><br><br><span class="hljs-comment">## the main program build some</span><br><span class="hljs-comment">## threads and make sure it works</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    items = <span class="hljs-number">5</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;putting %s items in the box &quot;</span> % items)<br>    box = Box()<br>    t1 = threading.Thread(target=adder, args=(box, items))<br>    t2 = threading.Thread(target=remover, args=(box, items))<br>    t1.start()<br>    t2.start()<br><br>    t1.join()<br>    t2.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;%s items still remain in the box &quot;</span> % box.total_items)<br></code></pre></td></tr></table></figure><h6 id="ä¿¡å·é‡">ä¿¡å·é‡</h6><p>ä½¿ç”¨ semaphore = threading.Semaphore(0) å®šä¹‰ä¿¡å·é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-string">&quot;&quot;&quot;Using a Semaphore to synchronize threads&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-comment"># The optional argument gives the initial value for the internal</span><br><span class="hljs-comment"># counter;</span><br><span class="hljs-comment"># it defaults to 1.</span><br><span class="hljs-comment"># If the value given is less than 0, ValueError is raised.</span><br>semaphore = threading.Semaphore(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">consumer</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;consumer is waiting.&quot;</span>)<br>        <span class="hljs-comment"># Acquire a semaphore</span><br>        semaphore.acquire()<br>        <span class="hljs-comment"># The consumer have access to the shared resource</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Consumer notify : consumed item number %s &quot;</span> % item)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">producer</span>():<br>        <span class="hljs-keyword">global</span> item<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        <span class="hljs-comment"># create a random item</span><br>        item = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;producer notify : produced item number %s&quot;</span> % item)<br>         <span class="hljs-comment"># Release a semaphore, incrementing the internal counter by one.</span><br>        <span class="hljs-comment"># When it is zero on entry and another thread is waiting for it</span><br>        <span class="hljs-comment"># to become larger than zero again, wake up that thread.</span><br>        semaphore.release()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,<span class="hljs-number">5</span>) :<br>                t1 = threading.Thread(target=producer)<br>                t2 = threading.Thread(target=consumer)<br>                t1.start()<br>                t2.start()<br>                t1.join()<br>                t2.join()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;program terminated&quot;</span>)<br></code></pre></td></tr></table></figure><h6 id="æ¡ä»¶">æ¡ä»¶</h6><p>condition = Condition()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread, Condition<br><span class="hljs-keyword">import</span> time<br><br>items = []<br>condition = Condition()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">consumer</span>(<span class="hljs-title class_ inherited__">Thread</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        Thread.__init__(self)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">consume</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">global</span> condition<br>        <span class="hljs-keyword">global</span> items<br>        condition.acquire()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(items) == <span class="hljs-number">0</span>:<br>            condition.wait()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Consumer notify : no item to consume&quot;</span>)<br>        items.pop()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Consumer notify : consumed 1 item&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Consumer notify : items to consume are &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(items)))<br><br>        condition.notify()<br>        condition.release()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>):<br>            time.sleep(<span class="hljs-number">2</span>)<br>            self.consume()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">producer</span>(<span class="hljs-title class_ inherited__">Thread</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        Thread.__init__(self)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">global</span> condition<br>        <span class="hljs-keyword">global</span> items<br>        condition.acquire()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(items) == <span class="hljs-number">10</span>:<br>            condition.wait()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Producer notify : items producted are &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(items)))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Producer notify : stop the production!!&quot;</span>)<br>        items.append(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Producer notify : total items producted &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(items)))<br>        condition.notify()<br>        condition.release()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>):<br>            time.sleep(<span class="hljs-number">1</span>)<br>            self.produce()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    producer = producer()<br>    consumer = consumer()<br>    producer.start()<br>    consumer.start()<br>    producer.join()<br>    consumer.join()<br></code></pre></td></tr></table></figure><h6 id="äº‹ä»¶">äº‹ä»¶</h6><p>Python è¿˜æä¾›äº† Eventå¯¹è±¡ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œå®ƒæ˜¯ç”±çº¿ç¨‹è®¾ç½®çš„ä¿¡å·æ ‡å¿—ï¼Œå¦‚æœä¿¡å·æ ‡å¿—ä½çœŸï¼Œåˆ™å…¶ä»–çº¿ç¨‹ç­‰å¾…ç›´åˆ°ä¿¡å·æ¥è§¦ã€‚</p><p>Eventå¯¹è±¡å®ç°äº†ç®€å•çš„çº¿ç¨‹é€šä¿¡æœºåˆ¶ï¼Œå®ƒæä¾›äº†è®¾ç½®ä¿¡å·ï¼Œæ¸…é™¤ä¿¡å·ï¼Œç­‰å¾…ç­‰ç”¨äºå®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p><ul><li>è®¾ç½®ä¿¡å·</li></ul><p>ä½¿ç”¨ Event çš„ <code>set()</code> æ–¹æ³•å¯ä»¥è®¾ç½® Eventå¯¹è±¡å†…éƒ¨çš„ä¿¡å·æ ‡å¿—ä¸ºçœŸã€‚Event å¯¹è±¡æä¾›äº† <code>isSet()</code>æ–¹æ³•æ¥åˆ¤æ–­å…¶å†…éƒ¨ä¿¡å·æ ‡å¿—çš„çŠ¶æ€ã€‚å½“ä½¿ç”¨ event å¯¹è±¡çš„ <code>set()</code>æ–¹æ³•åï¼Œ<code>isSet()</code> æ–¹æ³•è¿”å›çœŸ</p><ul><li>æ¸…é™¤ä¿¡å·</li></ul><p>ä½¿ç”¨ Event å¯¹è±¡çš„ <code>clear()</code> æ–¹æ³•å¯ä»¥æ¸…é™¤ Eventå¯¹è±¡å†…éƒ¨çš„ä¿¡å·æ ‡å¿—ï¼Œå³å°†å…¶è®¾ä¸ºå‡ï¼Œå½“ä½¿ç”¨ Event çš„ clear æ–¹æ³•åï¼ŒisSet()æ–¹æ³•è¿”å›å‡</p><ul><li>ç­‰å¾…</li></ul><p>Event å¯¹è±¡ waitçš„æ–¹æ³•åªæœ‰åœ¨å†…éƒ¨ä¿¡å·ä¸ºçœŸçš„æ—¶å€™æ‰ä¼šå¾ˆå¿«çš„æ‰§è¡Œå¹¶å®Œæˆè¿”å›ã€‚å½“ Eventå¯¹è±¡çš„å†…éƒ¨ä¿¡å·æ ‡å¿—ä½å‡æ—¶ï¼Œåˆ™ wait æ–¹æ³•ä¸€ç›´ç­‰å¾…åˆ°å…¶ä¸ºçœŸæ—¶æ‰è¿”å›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread, Event<br><span class="hljs-keyword">import</span> random<br>items = []<br>event = Event()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">consumer</span>(<span class="hljs-title class_ inherited__">Thread</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, items, event</span>):<br>        Thread.__init__(self)<br>        self.items = items<br>        self.event = event<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            time.sleep(<span class="hljs-number">2</span>)<br>            self.event.wait()<br>            item = self.items.pop()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Consumer notify : %d popped from list by %s&#x27;</span> % (item, self.name))<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">producer</span>(<span class="hljs-title class_ inherited__">Thread</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, items, event</span>):<br>        Thread.__init__(self)<br>        self.items = items<br>        self.event = event<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">global</span> item<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>            time.sleep(<span class="hljs-number">2</span>)<br>            item = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>)<br>            self.items.append(item)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Producer notify : item NÂ° %d appended to list by %s&#x27;</span> % (item, self.name))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Producer notify : event set by %s&#x27;</span> % self.name)<br>            self.event.<span class="hljs-built_in">set</span>()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Produce notify : event cleared by %s &#x27;</span>% self.name)<br>            self.event.clear()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t1 = producer(items, event)<br>    t2 = consumer(items, event)<br>    t1.start()<br>    t2.start()<br>    t1.join()<br>    t2.join()<br></code></pre></td></tr></table></figure><h5 id="pythonçš„å¤šè¿›ç¨‹">pythonçš„å¤šè¿›ç¨‹</h5><p>Python ä¸­çš„å¤šçº¿ç¨‹å…¶å®å¹¶ä¸æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹ï¼Œå¦‚æœæƒ³è¦å……åˆ†åœ°ä½¿ç”¨å¤šæ ¸ CPUçš„èµ„æºï¼Œåœ¨ Python ä¸­å¤§éƒ¨åˆ†æƒ…å†µéœ€è¦ä½¿ç”¨å¤šè¿›ç¨‹ã€‚</p><p>Python æä¾›äº†éå¸¸å¥½ç”¨çš„å¤šè¿›ç¨‹åŒ…multiprocessingï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼ŒPython ä¼šå®Œæˆå…¶ä»–æ‰€æœ‰äº‹æƒ…ã€‚</p><p>å€ŸåŠ©è¿™ä¸ªåŒ…ï¼Œå¯ä»¥è½»æ¾å®Œæˆä»å•è¿›ç¨‹åˆ°å¹¶å‘æ‰§è¡Œçš„è½¬æ¢ã€‚multiprocessingæ”¯æŒå­è¿›ç¨‹ã€é€šä¿¡å’Œå…±äº«æ•°æ®ã€æ‰§è¡Œä¸åŒå½¢å¼çš„åŒæ­¥ï¼Œæä¾›äº†Processã€Queueã€Pipeã€Lock ç­‰ç»„ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> multiprocessing<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;called function in process: %s&#x27;</span> %i)<br>    <span class="hljs-keyword">return</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    Process_jobs = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = multiprocessing.Process(target=foo, args=(i,))<br>        Process_jobs.append(p)<br>        p.start()<br>        p.join()<br></code></pre></td></tr></table></figure><p>åˆ›å»ºè¿›ç¨‹çš„ç±»ï¼š<code>Process([group [, target [, name [, args [, kwargs]]]]])</code></p><ul><li>target è¡¨ç¤ºè°ƒç”¨å¯¹è±¡</li><li>args è¡¨ç¤ºè°ƒç”¨å¯¹è±¡çš„ä½ç½®å‚æ•°å…ƒç»„</li><li>kwargsè¡¨ç¤ºè°ƒç”¨å¯¹è±¡çš„å­—å…¸</li><li>nameä¸ºåˆ«å</li><li>groupå®è´¨ä¸Šä¸ä½¿ç”¨</li></ul><h6 id="ä½¿ç”¨ç±»çš„å½¢å¼åˆ›å»ºè¿›ç¨‹">ä½¿ç”¨ç±»çš„å½¢å¼åˆ›å»ºè¿›ç¨‹</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClockProcess</span>(multiprocessing.Process):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, interval</span>):<br>        multiprocessing.Process.__init__(self)<br>        self.interval = interval<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        n = <span class="hljs-number">5</span><br>        <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å½“å‰æ—¶é—´: &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(time.ctime()))<br>            time.sleep(self.interval)<br>            n -= <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = ClockProcess(<span class="hljs-number">3</span>)<br>    p.start()<br><br></code></pre></td></tr></table></figure><h6 id="è¿›ç¨‹æ± ">è¿›ç¨‹æ± </h6><p>å› ä¸ºè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½éœ€è¦æ¶ˆè€—èµ„æºï¼Œå¯ä»¥ä½¿ç”¨è¿›ç¨‹æ± çš„æ–¹æ³•æ‰¹é‡åˆ›å»ºå­è¿›ç¨‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><span class="hljs-keyword">import</span> os, time, random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">long_time_task</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¿›ç¨‹çš„åç§°ï¼š&#123;0&#125; ï¼›è¿›ç¨‹çš„PID: &#123;1&#125; &#x27;</span>.<span class="hljs-built_in">format</span>(name, os.getpid()))<br>    start = time.time()<br>    time.sleep(random.random() * <span class="hljs-number">3</span>)<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¿›ç¨‹ &#123;0&#125; è¿è¡Œäº† &#123;1&#125; ç§’&#x27;</span>.<span class="hljs-built_in">format</span>(name, (end - start)))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹çš„ PIDï¼š&#123;0&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(os.getpid()))<br>    p = Pool(<span class="hljs-number">4</span>)  <span class="hljs-comment"># è¿›ç¨‹æ± </span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>        p.apply_async(long_time_task, args=(i,))<br>    p.close()<br>    <span class="hljs-comment"># ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸååœ¨å…³é—­ä¸»è¿›ç¨‹</span><br>    p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ã€Endã€‘&#x27;</span>)<br></code></pre></td></tr></table></figure><h6 id="åå°è¿›ç¨‹">åå°è¿›ç¨‹</h6><p>å¦‚æœéœ€è¦å¤„ç†æ¯”è¾ƒå·¨å¤§çš„ä»»åŠ¡ï¼Œåˆä¸éœ€è¦äººä¸ºå¹²é¢„ï¼Œå°†å…¶ä½œä¸ºåå°è¿›ç¨‹æ‰§è¡Œæ˜¯ä¸ªéå¸¸å¸¸ç”¨çš„ç¼–ç¨‹æ¨¡å‹ã€‚æ­¤è¿›ç¨‹åˆå¯ä»¥å’Œå…¶ä»–è¿›ç¨‹å¹¶å‘æ‰§è¡Œã€‚é€šè¿‡Pythonçš„multiprocessingæ¨¡å—çš„åå°è¿›ç¨‹é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿›ç¨‹åœ¨åå°è¿è¡Œã€‚</p><p>ä¸ºäº†åœ¨åå°è¿è¡Œè¿›ç¨‹ï¼Œæˆ‘ä»¬è®¾ç½® <code>daemon</code> å‚æ•°ä¸º<code>True</code></p><p><strong>æ³¨æ„</strong> :åå°è¿›ç¨‹ä¸å…è®¸åˆ›å»ºå­è¿›ç¨‹ã€‚å¦åˆ™ï¼Œå½“åå°è¿›ç¨‹è·Ÿéšçˆ¶è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå­è¿›ç¨‹ä¼šå˜æˆå­¤å„¿è¿›ç¨‹ã€‚å¦å¤–ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯Unixçš„å®ˆæŠ¤è¿›ç¨‹æˆ–æœåŠ¡ï¼ˆdaemonsorservicesï¼‰ï¼Œæ‰€ä»¥å½“éåå°è¿›ç¨‹é€€å‡ºï¼Œå®ƒä»¬ä¼šè¢«ç»ˆç»“ã€‚åå°è¿è¡Œè¿›ç¨‹åœ¨ä¸»è¿›ç¨‹ç»“æŸä¹‹åä¼šè‡ªåŠ¨ç»“æŸã€‚</p><p>æ›´è¿‡å…³äºpythonå¹¶è¡Œç¼–ç¨‹çš„å†…å®¹è¯·å‚è€ƒ<ahref="https://python-parallel-programmning-cookbook.readthedocs.io/zh-cn/latest/chapter2/index.html">è¿™é‡Œ</a>,<ahref="https://github.com/walter201230/Python/tree/master">æ•™ç¨‹</a></p><h3 id="æ¨¡å—ä¸åŒ…">æ¨¡å—ä¸åŒ…</h3><h6 id="æ¨¡å—">æ¨¡å—</h6><p><strong>åœ¨ Python ä¸­ï¼Œä¸€ä¸ª .pyæ–‡ä»¶å°±ç§°ä¹‹ä¸ºä¸€ä¸ªæ¨¡å—ï¼ˆModuleï¼‰ã€‚</strong></p><p>æ¨¡å—çš„å¥½å¤„ï¼š</p><ul><li>æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§</li><li>å¯ä»¥é¿å…å‡½æ•°åå’Œå˜é‡åå†²çª</li></ul><p>ä½¿ç”¨æ¨¡å—çš„æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> module1[, module2[,... moduleN]<br><br><span class="hljs-comment"># from åçš„å‚æ•°å¯ä»¥ä¸ºåŒ…è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¨¡å—åè·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥ç²¾ç¡®æŒ‡å®š import æ¨¡å—ä¸­å„æˆå‘˜ã€‚</span><br><span class="hljs-keyword">from</span> modname <span class="hljs-keyword">import</span> name1[, name2[, ... nameN]]<br><br><span class="hljs-keyword">from</span> modname <span class="hljs-keyword">import</span> *<br></code></pre></td></tr></table></figure><p>ä¸»æ¨¡å—å’Œéä¸»æ¨¡å—</p><p>åœ¨ Pythonä¸­ï¼Œæœ‰ä¸»æ¨¡å—å’Œéä¸»æ¨¡å—ä¹‹åˆ†ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—è¢«ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ²¡æœ‰è¢«åˆ«äººè°ƒç”¨ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ¨¡å—ä¸ºä¸»æ¨¡å—ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—è¢«åˆ«äººè°ƒç”¨ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ¨¡å—ä¸ºéä¸»æ¨¡å—ã€‚</p><p><code>__name__</code>å±æ€§å€¼æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸ªå˜é‡æ˜¯ç³»ç»Ÿç»™å‡ºçš„ã€‚åˆ©ç”¨è¿™ä¸ªå˜é‡å¯ä»¥åˆ¤æ–­ä¸€ä¸ªæ¨¡å—æ˜¯å¦æ˜¯ä¸»æ¨¡å—ã€‚è¿™ä¸ªå±æ€§ä¸èƒ½å†³å®šä»–ä»¬æ˜¯å¦æ˜¯ä¸»æ¨¡å—ï¼Œå†³å®šæ˜¯å¦æ˜¯ä¸»æ¨¡å—çš„æ¡ä»¶åªæ˜¯è¿™ä¸ªæ¨¡å—æœ‰æ²¡æœ‰è¢«äººè°ƒç”¨ã€‚</p><h6 id="åŒ…">åŒ…</h6><p>ä¸ºäº†é¿å…æ¨¡å—åå†²çªï¼ŒPythonåˆå¼•å…¥äº†æŒ‰ç›®å½•æ¥ç»„ç»‡æ¨¡å—çš„æ–¹æ³•ï¼Œç§°ä¸ºåŒ…ï¼ˆPackageï¼‰ã€‚</p><p>ç®€å•è¯´åŒ…å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ª <code>__init__.py</code>æ–‡ä»¶ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚å¼•å…¥äº†åŒ…ä»¥åï¼Œåªè¦é¡¶å±‚çš„åŒ…åä¸å†²çªï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¨¡å—éƒ½ä¸ä¼šå†²çªã€‚</p><p><code>__init__.py</code> å¯ä»¥æ˜¯ç©ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æœ‰Pythonä»£ç ï¼Œå› ä¸º<code>__init__.py</code>æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œè€Œå®ƒå¯¹åº”çš„æ¨¡å—åå°±æ˜¯å®ƒçš„åŒ…åã€‚</p><p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ<ahref="https://pythonhowto.readthedocs.io/zh-cn/latest/module.html">è¿™é‡Œ</a></p><h6 id="ä½œç”¨åŸŸ">ä½œç”¨åŸŸ</h6><p>åœ¨ Python ä¸­ï¼Œæ˜¯é€šè¿‡ <code>_</code>å‰ç¼€æ¥å®ç°çš„ã€‚æ­£å¸¸çš„å‡½æ•°å’Œå˜é‡åæ˜¯å…¬å¼€çš„ï¼ˆpublicï¼‰ï¼Œå¯ä»¥è¢«ç›´æ¥å¼•ç”¨ï¼Œæ¯”å¦‚ï¼šabcï¼Œni12ï¼ŒPIç­‰ï¼›ç±»ä¼¼<code>__xxx__</code>è¿™æ ·çš„å˜é‡æ˜¯ç‰¹æ®Šå˜é‡ï¼Œå¯ä»¥è¢«ç›´æ¥å¼•ç”¨ï¼Œä½†æ˜¯æœ‰ç‰¹æ®Šç”¨é€”ï¼Œæ¯”å¦‚ä¸Šé¢çš„<code>__name__</code> å°±æ˜¯ç‰¹æ®Šå˜é‡ï¼Œè¿˜æœ‰ <code>__author__</code>ä¹Ÿæ˜¯ç‰¹æ®Šå˜é‡ï¼Œç”¨æ¥æ ‡æ˜ä½œè€…ã€‚</p><p>æ³¨æ„ï¼Œæˆ‘ä»¬è‡ªå·±çš„å˜é‡ä¸€èˆ¬ä¸è¦ç”¨è¿™ç§å˜é‡åï¼›ç±»ä¼¼ <code>_xxx</code> å’Œ<code>__xxx</code>è¿™æ ·çš„å‡½æ•°æˆ–å˜é‡å°±æ˜¯éå…¬å¼€çš„ï¼ˆprivateï¼‰ï¼Œä¸åº”è¯¥è¢«ç›´æ¥å¼•ç”¨ï¼Œæ¯”å¦‚<code>_abc</code> ï¼Œ<code>__abc</code> ç­‰ï¼›</p><p><strong>è¿™é‡Œæ˜¯è¯´ä¸åº”è¯¥ï¼Œè€Œä¸æ˜¯ä¸èƒ½ã€‚å› ä¸º Pythonç§å¹¶æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å®Œå…¨é™åˆ¶è®¿é—® privateå‡½æ•°æˆ–å˜é‡ï¼Œä½†æ˜¯ï¼Œä»ç¼–ç¨‹ä¹ æƒ¯ä¸Šä¸åº”è¯¥å¼•ç”¨ privateå‡½æ•°æˆ–å˜é‡ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>å¼€å‘è¯­è¨€</category>
      
      <category>python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>hexoæ–‡ç« ä¸­æ’å…¥å›¾ç‰‡</title>
    <link href="/2024/07/14/hexo%E6%96%87%E7%AB%A0%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87/"/>
    <url>/2024/07/14/hexo%E6%96%87%E7%AB%A0%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h3 id="markdownæ·»åŠ å›¾ç‰‡">Markdownæ·»åŠ å›¾ç‰‡</h3><hr /><p>Markdown æ·»åŠ å›¾ç‰‡çš„æ ¼å¼æ˜¯:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">![<span class="hljs-string">å›¾ç‰‡è¯´æ˜</span>](<span class="hljs-link">å›¾ç‰‡è·¯å¾„ httpç½‘ç»œè·¯å¾„æˆ–è€…æœ¬åœ°è·¯å¾„</span>)<br>![<span class="hljs-string">è¿™æ˜¯ä¸€å¼ å›¾ç‰‡</span>](<span class="hljs-link">https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/20090529_Great_Wall_8185.jpg/2560px-20090529_Great_Wall_8185.jpg</span>)<br></code></pre></td></tr></table></figure><p>æ’å…¥çš„å›¾ç‰‡æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><figure><imgsrc="https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/20090529_Great_Wall_8185.jpg/2560px-20090529_Great_Wall_8185.jpg"alt="è¿™æ˜¯ä¸€å¼ å›¾ç‰‡" /><figcaption aria-hidden="true">è¿™æ˜¯ä¸€å¼ å›¾ç‰‡</figcaption></figure><h3 id="hexoæ–‡ç« ä¸­çš„å›¾ç‰‡">Hexoæ–‡ç« ä¸­çš„å›¾ç‰‡</h3><hr /><p>åœ¨ä½¿ç”¨Hexoå†™æ–‡ç« æ—¶ï¼Œæœ‰çš„å›¾ç‰‡åœ¨æœ¬åœ°ï¼Œåœ¨æœ¬åœ°çš„markdownæ–‡ä»¶ä¸­å¯ä»¥æŸ¥çœ‹ï¼Œä½†æ˜¯å‘å¸ƒåˆ°ç½‘ç»œåï¼Œå°±å› ä¸ºè·¯å¾„é—®é¢˜æ— æ³•æ˜¾ç¤ºå›¾ç‰‡ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><h5 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h5><p>æ‰“å¼€_config.ymlé…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°post_asset_folderé…ç½®é¡¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ä¿®æ”¹å‰</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># ä¿®æ”¹å</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹post_asset_folderä¸ºtrueåï¼Œåœ¨ä½¿ç”¨æ–°å»ºæ–‡æ¡£æ—¶ï¼Œä¼šåœ¨æ–‡æ¡£åŒä¸€ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­å­˜æ”¾å›¾ç‰‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="image_demo.png" /></p><p>å¦‚æœæ˜¯ä½¿ç”¨Typoraç¼–è¾‘æ–‡æ¡£ï¼Œä¸ºäº†å¯ä»¥åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤ºå›¾ç‰‡ï¼Œéœ€è¦è®¾ç½®å›¾ç‰‡çš„ç›®å½•ã€‚</p><h5 id="è®¾ç½®typoraçš„å›¾ç‰‡æ ¹ç›®å½•">è®¾ç½®Typoraçš„å›¾ç‰‡æ ¹ç›®å½•</h5><blockquote><p>æ ¼å¼ï¼ˆOï¼‰ -&gt; å›¾åƒ -&gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½• -&gt;é€‰æ‹©æ–‡ç« åŒåæ–‡ä»¶å¤¹ï¼ˆå³æ”¾ç½®å›¾ç‰‡çš„æ–‡ä»¶å¤¹ï¼‰</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><hr /><p>ç»è¿‡ä»¥ä¸Šè®¾ç½®åï¼Œå°±å¯ä»¥å®ç°æ—¢å¯ä»¥åœ¨æœ¬åœ°æ–‡æ¡£ä¸­æ˜¾ç¤ºå›¾ç‰‡ï¼Œå‘å¸ƒåˆ°ç½‘ç»œåä¹Ÿå¯ä»¥ç°å®å›¾ç‰‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•™ç¨‹</category>
      
      <category>hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºpytorchç¯å¢ƒè¯´æ˜</title>
    <link href="/2024/07/14/%E6%90%AD%E5%BB%BApytorch%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E/"/>
    <url>/2024/07/14/%E6%90%AD%E5%BB%BApytorch%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E/</url>
    
    <content type="html"><![CDATA[<h3 id="pytorchç‰ˆæœ¬é€‰æ‹©">Pytorchç‰ˆæœ¬é€‰æ‹©</h3><hr /><p>Pytorchæ˜¯å½“å‰åº”ç”¨æœ€å¹¿æ³›çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåœ¨<ahref="https://pytorch.org/">Pytorchå®˜æ–¹ç½‘ç«™</a>å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å®‰è£…æ–¹å¼ã€‚</p><figure><img src="pytorch.png" alt="pytorch" /><figcaption aria-hidden="true">pytorch</figcaption></figure><h3 id="pythonåŠè™šæ‹Ÿç¯å¢ƒå®‰è£…ä¸è®¾ç½®">PythonåŠè™šæ‹Ÿç¯å¢ƒå®‰è£…ä¸è®¾ç½®</h3><hr /><p>ä½¿ç”¨Pytorchç¦»ä¸å¼€Pythonï¼Œåœ¨Pytorchçš„å®‰è£…è¦æ±‚ä¸­æœ‰å¯¹pythonç‰ˆæœ¬çš„è¦æ±‚ï¼Œå› æ­¤å¯ä»¥æ ¹æ®éœ€è¦å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿pythonç¯å¢ƒä¸­ä¸åŒåŒ…ç‰ˆæœ¬çš„ç®¡ç†ï¼Œå¯ä»¥ç”¨é€šè¿‡è™šæ‹Ÿç¯å¢ƒè¿›è¡Œä¸åŒpythonç‰ˆæœ¬çš„åˆ‡æ¢ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å»ºç«‹pythonçš„è™šæ‹Ÿç¯å¢ƒï¼švirtualenvã€Virtualenvwrapperã€pipenvã€‚è¿™ä¸‰ç§ä¸åŒçš„å®‰è£…ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ<ahref="https://blog.csdn.net/sirobot/article/details/107067577">è¿™é‡Œ</a>.</p><p>è¿™é‡Œä½¿ç”¨Virtualenvwrapperã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">on Windows</span><br>pip install virtualenvwrapper-win<br><span class="hljs-meta prompt_"># </span><span class="language-bash">on macOS / Linux</span><br>pip install --user virtualenvwrapper #pip install virtualenvwrapper<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">then</span> make Bash load virtualenvwrapper automatically</span><br>echo &quot;source virtualenvwrapper.sh&quot; &gt;&gt; ~/.bashrc  # echo &quot;source å…·ä½“çš„virtualenvwrapper.shè·¯å¾„&quot; &gt;&gt; ~/.bashrc<br>source ~/.bashrc<br></code></pre></td></tr></table></figure><p>â€”user è¡¨ç¤º Install to the Python user install directory for yourplatform. Typically ~/.local/, or %APPDATA%on Windows. (See the Pythondocumentation for site.USER_BASE for full details.) (pip install --userxxx æ˜¯å°†moduleåº“é»˜è®¤å®‰è£…åˆ°ï¼ˆwindowså¹³å°ï¼‰%APPDATA%ï¼Œï¼ˆéwindowså¹³å°ï¼‰~/.local/ ã€‚)</p><p>å¦‚æœä¸ç”¨â€”user å‚æ•°, ä¼šæœ‰é»˜è®¤çš„å®‰è£…ç›®å½•ã€‚</p><p>å¯ä»¥é€šè¿‡ find / -name virtualenvwrapper.sh æ‰¾åˆ°virtualenvwrapper.shçš„ç›®å½•ã€‚å¦‚/root/miniconda3/bin/virtualenvwrapper.sh</p><p>æ ¹æ®æ‰¾åˆ°çš„è·¯å¾„ echo "source/root/miniconda3/bin/virtualenvwrapper.sh" &gt;&gt; ~/.bashrcã€‚</p><p>å¦‚æœä½¿ç”¨pip æœ‰æŠ¥è­¦æç¤º:</p><blockquote><p>WARNING: Running pip as the 'root' user can result in brokenpermissions and conflicting behaviour with the system package manager.It is recommended to use a virtual environment instead</p></blockquote><p>å¯ä»¥é€šè¿‡æ·»åŠ  --root-user-action=ignore æ¥å¿½ç•¥ã€‚å¦‚:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install --root-user-action=ignore virtualenvwrapper<br></code></pre></td></tr></table></figure><p>å®‰è£…å¥½è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·åï¼Œå°±å¯ä»¥é€šè¿‡å·¥å…·ç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œåœ¨è™šæ‹Ÿç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„pythonæˆ–è€…æ¨¡å—è¿›è¡Œå·¥ä½œã€‚</p><h5 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ">åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">on macOS/Linux:</span><br>mkvirtualenv --python=python3.6 venv<br><span class="hljs-meta prompt_"># </span><span class="language-bash">on Windows</span><br>mkvirtualenv --python=python3 venv<br></code></pre></td></tr></table></figure><h5 id="æ¿€æ´»ç¯å¢ƒ">æ¿€æ´»ç¯å¢ƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">workon #åˆ—å‡ºè™šæ‹Ÿç¯å¢ƒåˆ—è¡¨<br>workon [venv] #åˆ‡æ¢ç¯å¢ƒ<br></code></pre></td></tr></table></figure><h5 id="é€€å‡ºç¯å¢ƒ">é€€å‡ºç¯å¢ƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">deactivate<br></code></pre></td></tr></table></figure><p>åˆ é™¤ç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rmvirtualenv venv<br></code></pre></td></tr></table></figure><h3 id="jupyterå®‰è£…å†…æ ¸ä¸ä½¿ç”¨">Jupyterå®‰è£…å†…æ ¸ä¸ä½¿ç”¨</h3><hr /><p>Jupyter Notebookæ˜¯ä¸€ä¸ªäº¤äº’å¼ç¬”è®°æœ¬ï¼Œå¯ä»¥åˆ‡æ¢ä¸åŒçš„å†…æ ¸ã€‚</p><p>ä¸ºäº†ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸‹çš„å†…æ ¸ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼Œæ›´è¯¦ç»†çš„è¯·<ahref="https://blog.singee.me/2018/06/28/python/jupyter-kernel/">å‚è€ƒè¿™é‡Œ</a></p><h5 id="è¿›å…¥è™šæ‹Ÿç¯å¢ƒ">è¿›å…¥è™šæ‹Ÿç¯å¢ƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">workon venv<br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹è™šæ‹Ÿæ˜¯å¦å®‰è£…ipykernel">æŸ¥çœ‹è™šæ‹Ÿæ˜¯å¦å®‰è£…ipykernel</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -m ipykernel --version<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰ç‰ˆæœ¬è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…äº† ipykernelå¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œéœ€è¦å®‰è£…ipykernelã€‚</p><h5 id="å®‰è£…ipykernel">å®‰è£…ipykernel</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install ipykernel<br></code></pre></td></tr></table></figure><h5 id="æ·»åŠ å†…æ ¸">æ·»åŠ å†…æ ¸</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> -<span class="hljs-keyword">m</span> ipykernel install --name <span class="hljs-keyword">python3</span>.<span class="hljs-number">12.3</span> --<span class="hljs-keyword">display</span>-name <span class="hljs-string">&quot;python3.12.3&quot;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ å†…æ ¸åï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ—å‡ºå†…æ ¸å‘½ä»¤æˆ–è€…æ‰“å¼€jupyternotebookæŸ¥çœ‹å†…æ ¸æ˜¯å¦å·²ç»æ·»åŠ ã€‚</p><h5 id="åˆ é™¤å†…æ ¸">åˆ é™¤å†…æ ¸</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">jupyter</span> kernelspec remove python3.<span class="hljs-number">12</span>.<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h5 id="åˆ—å‡ºå†…æ ¸">åˆ—å‡ºå†…æ ¸</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jupyter kernelspec list<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæŠ€æœ¯</category>
      
      <category>æ·±åº¦å­¦ä¹ </category>
      
      <category>pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>hexoæ­å»ºblogæ•™ç¨‹</title>
    <link href="/2024/07/11/hexo%E6%90%AD%E5%BB%BAblog%E6%95%99%E7%A8%8B/"/>
    <url>/2024/07/11/hexo%E6%90%AD%E5%BB%BAblog%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h3 id="hexo">Hexo</h3><hr /><p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚ Hexo ä½¿ç”¨ <ahref="http://daringfireball.net/projects/markdown/">Markdown</a>ï¼ˆæˆ–å…¶ä»–æ ‡è®°è¯­è¨€ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p><h3 id="hexoæ–‡æ¡£">Hexoæ–‡æ¡£</h3><hr /><p><a href="https://hexo.io/zh-cn/docs/">Hexoæ–‡æ¡£</a></p><p>Hexoæ–‡æ¡£åŸºæœ¬è§£å†³å¤§éƒ¨åˆ†å†™ä½œçš„é—®é¢˜ã€‚</p><h3 id="åœ¨githubä¸Šä½¿ç”¨hexoå»ºç«‹blog">åœ¨githubä¸Šä½¿ç”¨hexoå»ºç«‹blog</h3><hr /><p>ä½¿ç”¨Hexoåœ¨githubä¸Šå»ºç«‹blogï¼Œè¯·å‚è€ƒ<ahref="https://blog.csdn.net/wufengfeng130/article/details/131251961">è¿™é‡Œ</a></p><blockquote><p>æ³¨æ„ï¼š</p><p>å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œåœ¨ä¸Šä¼ githubæç¤º hexo Support for passwordauthentication was removed on August 13, 2021. Please use a personalaccess token instead.</p><p>è¯·ä½¿ç”¨ SSHkeyåœ¨githubä»“åº“ä¸­éƒ¨ç½²æ–‡ä»¶ã€‚å…·ä½“çš„ssh key è¯·åœ¨github-&gt;settings-&gt;SSH and GPG keysä¸­è®¾ç½®ã€‚</p><p>å…³äºssh keyçš„ç”Ÿæˆæ–¹æ³•ï¼Œå‚è€ƒ<ahref="https://docs.github.com/zh/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent?platform=mac">githubæ–‡æ¡£</a></p></blockquote><h3 id="hexoè®¾ç½®å¤šçº§ç›®å½•">Hexoè®¾ç½®å¤šçº§ç›®å½•</h3><hr /><p>å¦‚æœæƒ³æŠŠæ–‡ç« æ”¾åœ¨å¤šçº§ç›®å½•ä¸‹ï¼Œ</p><p>è¯·åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ ï¼š</p><blockquote><p>categories: [æ•™ç¨‹, hexo]</p></blockquote><p>[]å†…çš„å¤šçº§ç›®å½•ä½¿ç”¨é€—å·ï¼ˆè‹±æ–‡é€—å·ï¼‰åˆ†å‰²ï¼Œå‰é¢çš„æ˜¯çˆ¶ç›®å½•ï¼Œåé¢çš„æ˜¯å­ç›®å½•ã€‚</p><h3 id="hexoå†™ä½œ">Hexoå†™ä½œ</h3><p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨å¯ä»¥ç”Ÿæˆä¸€ä¸ªè¦å®Œæˆçš„å†™ä½œæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new post &quot;hexoæ­å»ºblogæ•™ç¨‹&quot;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„æ˜¯ æœ¬åœ°blogç›®å½•ä¸‹çš„ source/_postsä¸‹é¢,åœ¨è¯¥ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„"hexoæ­å»ºblogæ•™ç¨‹.md"æ–‡ä»¶ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œå†™ä½œå³å¯ã€‚</p><h3 id="hexoå‘å¸ƒåˆ°github">Hexoå‘å¸ƒåˆ°github</h3><p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå³å¯å°†æ–‡ç« å‘å¸ƒåˆ°ç½‘ç»œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo d -g<br></code></pre></td></tr></table></figure><p>hexo d -g = hero deploy generate.</p><p>å…·ä½“çš„hexoå‘½ä»¤ è¯·å‚è€ƒ<ahref="https://hexo.io/zh-cn/docs/commands">è¿™é‡Œ</a></p>]]></content>
    
    
    <categories>
      
      <category>æ•™ç¨‹</category>
      
      <category>hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>markdownè¾“å…¥æ‹¼éŸ³å£°è°ƒ</title>
    <link href="/2024/06/27/markdown%E8%BE%93%E5%85%A5%E6%8B%BC%E9%9F%B3%E5%A3%B0%E8%B0%83/"/>
    <url>/2024/06/27/markdown%E8%BE%93%E5%85%A5%E6%8B%BC%E9%9F%B3%E5%A3%B0%E8%B0%83/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨markdownå†™ä½œï¼Œæœ‰æ—¶ä¼šé‡åˆ°å¯¹ä¸­æ–‡æ³¨éŸ³çš„æƒ…å†µã€‚é€šè¿‡æŸ¥è¯¢èµ„æ–™ï¼Œåœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚</p><table><thead><tr><th>å£°è°ƒ</th><th>æ ¼å¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>ä¸€å£°ï¼ˆé˜´å¹³ï¼‰</td><td>&amp;<strong>a</strong>macr;</td><td>Ä</td></tr><tr><td>äºŒå£°ï¼ˆé˜³å¹³ï¼‰</td><td>&amp;<strong>a</strong>acute;</td><td>Ã¡</td></tr><tr><td>ä¸‰å£°ï¼ˆä¸Šå£°ï¼‰ä¸Š (shÇng)å£°</td><td>&amp;<strong>e</strong>caron;Çä¸èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨æœç‹—æ‹¼éŸ³è¾“å…¥</td><td>Ä›</td></tr><tr><td>å››å£°ï¼ˆå»å£°ï¼‰</td><td>&amp;<strong>a</strong>grave;</td><td>Ã </td></tr><tr><td>uéŸ³</td><td>&amp;<strong>u</strong>uml;</td><td>Ã¼</td></tr></tbody></table><p>ç”¨æ³•ï¼š æ›¿æ¢<code>&amp;</code>åçš„ç¬¬ä¸€ä¸ªå­—æ¯å³å¯ã€‚ æ³¨ï¼šæœ‰çš„å­—æ¯æ›¿æ¢åæ˜¾ç¤ºä¼šä¸æ­£å¸¸ï¼Œè‡ªå·±å°è¯•ä¸‹å³å¯ã€‚</p><p><ahref="https://dev.w3.org/html5/html-author/charref">ç‰¹æ®Šå­—ç¬¦ç½‘å€</a></p><p><ahref="https://www.w3.org/TR/WD-math-970710/fnewtable17.html">ç‰¹æ®Šå­—ç¬¦ç½‘å€2</a></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·æŠ€å·§</category>
      
      <category>å¥‡æŠ€æ·«å·§</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å’è†è½²</title>
    <link href="/2024/06/24/%E5%92%8F%E8%8D%86%E8%BD%B2/"/>
    <url>/2024/06/24/%E5%92%8F%E8%8D%86%E8%BD%B2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å’è†è½²</p><p>å” æŸ³å®—å…ƒ</p><p>ç‡•ç§¦ä¸ä¸¤ç«‹ï¼Œå¤ªå­å·²ä¸ºè™ã€‚</p><p>åƒé‡‘å¥‰çŸ­è®¡ï¼ŒåŒ•é¦–è†å¿è¶‹ã€‚</p><p>ç©·å¹´å¾‡æ‰€æ¬²ï¼Œå…µåŠ¿ä¸”è§å± ã€‚</p><p>å¾®è¨€æ¿€å¹½æ„¤ï¼Œæ€’ç›®è¾ç‡•éƒ½ã€‚</p><p>æœ”é£åŠ¨æ˜“æ°´ï¼ŒæŒ¥çˆµå‰é•¿é©±ã€‚</p><p>å‡½é¦–è‡´å®¿æ€¨ï¼ŒçŒ®ç”°å¼€ç‰ˆå›¾ã€‚</p><p>ç‚¯ç„¶è€€ç”µå…‰ï¼ŒæŒæ¡ç½”æ­£å¤«ã€‚</p><p>é€ ç«¯ä½•å…¶é”ï¼Œä¸´äº‹ç«Ÿè¶‘ï¼ˆzÄ«ï¼‰è¶„(jÅ«)ã€‚</p><p>é•¿è™¹åç™½æ—¥ï¼Œä»“å’åå—è¯›ã€‚</p><p>æŒ‰å‰‘èµ«å‡­æ€’ï¼Œé£é›·åŠ©å·å‘¼ã€‚</p><p>æ…ˆçˆ¶æ–­å­é¦–ï¼Œç‹‚èµ°æ— å®¹èº¯ã€‚</p><p>å¤·åŸèŠŸï¼ˆshÄnï¼‰ä¸ƒæ—ï¼Œå°è§‚çš†ç„šæ±¡ã€‚</p><p>å§‹æœŸå¿§æ‚£å¼­ï¼Œå’åŠ¨ç¾ç¥¸æ¢ã€‚</p><p>ç§¦çš‡æœ¬è¯ˆåŠ›ï¼Œäº‹ä¸æ¡“å…¬æ®Šã€‚</p><p>å¥ˆä½•æ•ˆæ›¹å­ï¼Œå®è°“å‹‡ä¸”æ„šã€‚</p><p>ä¸–ä¼ æ•…å¤šè°¬ï¼Œå¤ªå²å¾æ— ä¸”ï¼ˆjÅ«ï¼‰ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>äººæ–‡ç¤¾ç§‘</category>
      
      <category>å”è¯—</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç”°å®¶å³äº‹</title>
    <link href="/2024/06/23/%E7%94%B0%E5%AE%B6%E5%8D%B3%E4%BA%8B/"/>
    <url>/2024/06/23/%E7%94%B0%E5%AE%B6%E5%8D%B3%E4%BA%8B/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç”°å®¶å³äº‹</p><p>å” å‚¨å…‰ç¾²</p><p>è’²å¶æ—¥å·²é•¿ï¼ŒæèŠ±æ—¥å·²æ»‹ã€‚</p><p>è€å†œè¦ï¼ˆyÃ oï¼‰çœ‹æ­¤ï¼Œè´µä¸è¿å¤©æ—¶ã€‚</p><p>è¿æ™¨èµ·é¥­ç‰›ï¼ŒåŒé©¾è€•ä¸œè‘ï¼ˆzÄ«ï¼‰ã€‚</p><p>èš¯èš“åœŸä¸­å‡ºï¼Œç”°ä¹Œéšæˆ‘é£ã€‚</p><p>ç¾¤åˆä¹±å•„å™ªï¼Œå—·å—·å¦‚é“é¥¥ã€‚</p><p>æˆ‘å¿ƒå¤šæ»éšï¼Œé¡¾æ­¤ä¸¤ä¼¤æ‚²ã€‚</p><p>æ‹¨é£Ÿä¸ç”°ä¹Œï¼Œæ—¥æš®ç©ºç­å½’ã€‚</p><p>äº²æˆšæ›´ç›¸è¯®ï¼ˆqÃ¬aoï¼‰ï¼Œæˆ‘å¿ƒç»ˆä¸ç§»ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>äººæ–‡ç¤¾ç§‘</category>
      
      <category>å”è¯—</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æµ‹è¯•</title>
    <link href="/2024/06/17/%E6%B5%8B%E8%AF%95/"/>
    <url>/2024/06/17/%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡µé¢.</p>]]></content>
    
    
    <categories>
      
      <category>æ‚è°ˆ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/06/14/hello-world/"/>
    <url>/2024/06/14/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
